var ie=Object.defineProperty,Be=Object.defineProperties,_e=Object.getOwnPropertyDescriptor,Ue=Object.getOwnPropertyDescriptors,Ge=Object.getOwnPropertyNames,Te=Object.getOwnPropertySymbols;var be=Object.prototype.hasOwnProperty,He=Object.prototype.propertyIsEnumerable;var me=(C,e,n)=>e in C?ie(C,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):C[e]=n,te=(C,e)=>{for(var n in e||(e={}))be.call(e,n)&&me(C,n,e[n]);if(Te)for(var n of Te(e))He.call(e,n)&&me(C,n,e[n]);return C},ne=(C,e)=>Be(C,Ue(e));var Y=(C,e)=>()=>(C&&(e=C(C=0)),e);var Ke=(C,e)=>{for(var n in e)ie(C,n,{get:e[n],enumerable:!0})},je=(C,e,n,t)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of Ge(e))!be.call(C,o)&&o!==n&&ie(C,o,{get:()=>e[o],enumerable:!(t=_e(e,o))||t.enumerable});return C};var Xe=C=>je(ie({},"__esModule",{value:!0}),C);var D=(C,e,n)=>me(C,typeof e!="symbol"?e+"":e,n);var se,Re=Y(()=>{"use strict";se=class{constructor(){D(this,"tokens",[]);D(this,"errors",[]);D(this,"tokenMap",new Map)}parse(e,n=""){return this.tokens=[],this.errors=[],this.tokenMap=new Map,this.collectTokens(e,[]),this.resolveAliases(),this.validateTokens(),{tokens:this.tokens,metadata:{filePath:n,format:"auto-detected",errors:this.errors}}}collectTokens(e,n){if(e==null)return;let t=n[n.length-1]||"";if(!(t.startsWith("$")&&t!=="$value"&&t!=="$type")){if(this.isW3CToken(e)){this.addToken(e.$value,e.$type,e.$description,e.$extensions,n);return}if(this.isTokenStudioToken(e)){this.addToken(e.value,e.type,e.description,e.extensions,n);return}if(this.isPrimitiveToken(e,n)){this.addToken(e,void 0,void 0,void 0,n);return}if(typeof e=="object"){let o=Array.isArray(e)?e.map((r,i)=>String(i)):Object.keys(e);for(let r of o){if(r.startsWith("$")||r==="extensions"||r==="description")continue;let i=Array.isArray(e)?e[parseInt(r)]:e[r];this.collectTokens(i,[...n,r])}}}}addToken(e,n,t,o,r){let i=r[r.length-1]||"unnamed",a=this.inferTokenType({$value:e,$type:n},r),s;typeof e=="string"&&(e.startsWith("{")||e.startsWith("$"))&&(s=this.extractAliases(e));let p={name:i,value:e,type:a,path:[...r],description:t,extensions:o,rawValue:e,aliases:s};this.tokens.push(p),this.tokenMap.set(r.join("."),p)}isW3CToken(e){return e&&typeof e=="object"&&"$value"in e}isTokenStudioToken(e){if(!e||typeof e!="object"||"$value"in e||!("value"in e))return!1;let n=e.value;if(typeof n=="string"||typeof n=="number"||typeof n=="boolean")return!0;if(typeof n=="object"&&n!==null){if("type"in e||"description"in e)return!0;let t=Object.keys(n);if(t.some(o=>["color","width","style"].includes(o.toLowerCase()))&&t.filter(r=>["color","width","style","bordercolor","borderwidth","borderstyle"].includes(r.toLowerCase())).length>=2||t.some(o=>["fontfamily","fontsize","fontweight","lineheight","letterspacing"].includes(o.toLowerCase()))||t.some(o=>["blur","spread","offsetx","offsety","x","y"].includes(o.toLowerCase()))&&t.some(o=>o.toLowerCase()==="color")||t.length<=6&&t.length>=2&&t.some(r=>{let i=n[r];return typeof i=="string"&&(i.startsWith("{")||i.startsWith("$"))}))return!0}return!1}isPrimitiveToken(e,n){return!(typeof e!="string"&&typeof e!="number"&&typeof e!="boolean"||n.length<1)}isDesignToken(e){return this.isW3CToken(e)}inferTokenType(e,n){if(e.$type)return e.$type;let t=n.join(".").toLowerCase();if(t.includes("color")||t.includes("colour"))return"color";if(t.includes("font")||t.includes("typography")||t.includes("text"))return t.includes("weight")?"fontWeight":t.includes("family")?"fontFamily":"typography";if(t.includes("spacing")||t.includes("size")||t.includes("gap"))return"dimension";if(t.includes("shadow"))return"shadow";if(t.includes("radius")||t.includes("corner")||t.includes("rounded"))return"borderRadius";if(t.includes("borderwidth")||t.includes("strokeweight")||t.includes("stroke-weight")||t.includes("border-width")||t.includes("border")&&t.includes("width"))return"borderWidth";if(t.includes("border"))return"border";let o=e.$value;if(typeof o=="string"){if(o.match(/^#[0-9A-Fa-f]{3,8}$/)||o.match(/^rgba?\(/)||o.match(/^hsla?\(/))return"color";if(o.match(/^-?\d+(\.\d+)?(px|rem|em|pt|pc|in|cm|mm|q|vh|vw|vmin|vmax|%)$/))return"dimension";if(o.match(/^\d+(\.\d+)?(ms|s)$/))return"duration"}return typeof o=="number"?"number":typeof o=="boolean"?"boolean":"string"}extractAliases(e){let n=[],t=/\{([^}]+)\}/g,o;for(;(o=t.exec(e))!==null;){let r=o[1].split(",").map(i=>i.trim())[0];r.startsWith("$")&&(r=r.substring(1)),n.push(r)}if(e.startsWith("$")&&!e.startsWith("{")){let r=/\$([a-zA-Z0-9._-]+)/g;for(;(o=r.exec(e))!==null;)n.push(o[1])}return n}resolveAliases(){for(let e of this.tokens)if(e.aliases&&e.aliases.length>0)for(let n of e.aliases){let t=this.tokenMap.get(n);t?(e.value=t.value,e.aliases||(e.aliases=[])):this.errors.push({path:e.path,message:`Unresolved alias: ${n}`,severity:"error"})}}validateTokens(){for(let e of this.tokens){let n=this.validateTokenValue(e);n.valid||this.errors.push({path:e.path,message:n.message||"Validation error",severity:n.severity||"error"})}}validateTokenValue(e){let{type:n,value:t}=e;if(t==null)return{valid:!1,message:"Token value cannot be null or undefined",severity:"error"};switch(n){case"color":return this.validateColor(t);case"dimension":return this.validateDimension(t);case"fontWeight":return this.validateFontWeight(t);case"duration":return this.validateDuration(t);case"typography":return this.validateTypography(t);case"shadow":return this.validateShadow(t);case"border":return this.validateBorder(t);case"borderRadius":case"borderWidth":return this.validateDimension(t);default:return{valid:!0}}}validateColor(e){return typeof e!="string"?{valid:!1,message:"Color value must be a string",severity:"error"}:[/^#[0-9A-Fa-f]{3,8}$/,/^rgba?\([^)]+\)$/,/^hsla?\([^)]+\)$/].some(o=>o.test(e))?{valid:!0}:{valid:!1,message:`Invalid color format: ${e}`,severity:"error"}}validateDimension(e){if(typeof e=="string"){let n=/^-?\d+(\.\d+)?(px|rem|em|pt|pc|in|cm|mm|q|vh|vw|vmin|vmax|%)$/,t=/^-?\d+(\.\d+)?$/,o=/^[{$]/;if(!n.test(e)&&!t.test(e)&&!o.test(e))return{valid:!0,message:`Unusual dimension format: ${e}`,severity:"warning"}}else return typeof e=="number"?{valid:!0}:{valid:!1,message:"Dimension value must be a string or number",severity:"error"};return{valid:!0}}validateFontWeight(e){if(typeof e=="string"){if(!["100","200","300","400","500","600","700","800","900","normal","bold"].includes(e))return{valid:!1,message:`Invalid font weight: ${e}`,severity:"warning"}}else if(typeof e=="number"){if(e<1||e>1e3)return{valid:!1,message:"Font weight must be between 1 and 1000",severity:"error"}}else return{valid:!1,message:"Font weight must be a string or number",severity:"error"};return{valid:!0}}validateDuration(e){return typeof e!="string"?{valid:!1,message:"Duration value must be a string",severity:"error"}:/^\d+(\.\d+)?(ms|s)$/.test(e)?{valid:!0}:{valid:!1,message:`Invalid duration format: ${e}`,severity:"error"}}validateTypography(e){return typeof e!="object"||Array.isArray(e)?{valid:!1,message:"Typography value must be an object",severity:"error"}:e.fontFamily?{valid:!0}:{valid:!1,message:"Typography token missing fontFamily",severity:"warning"}}validateShadow(e){return typeof e!="object"||Array.isArray(e)?{valid:!1,message:"Shadow value must be an object",severity:"error"}:e.color?{valid:!0}:{valid:!1,message:"Shadow token missing color",severity:"warning"}}validateBorder(e){if(typeof e=="object"&&!Array.isArray(e)){let n="width"in e||"borderWidth"in e,t="color"in e||"borderColor"in e,o="style"in e||"borderStyle"in e;return!n&&!t&&!o?{valid:!1,message:"Border token should have width, color, or style",severity:"warning"}:{valid:!0}}return typeof e=="string"?e.startsWith("{")||e.startsWith("$")?{valid:!0}:{valid:!0}:typeof e=="number"?{valid:!0}:{valid:!1,message:"Border value must be an object, string, or number",severity:"error"}}getTokensByType(e){return this.tokens.filter(n=>n.type===e)}getTokenByPath(e){return this.tokenMap.get(e.join("."))}getErrors(){return this.errors}}});var ce,ae,Ne=Y(()=>{"use strict";Re();ce=class ce{constructor(){D(this,"parser");this.parser=new se}parseGitHubUrl(e){let n=[/github\.com[\/:]([^\/]+)\/([^\/\.]+)(\.git)?$/,/github\.com\/([^\/]+)\/([^\/]+)/];for(let t of n){let o=e.match(t);if(o)return{owner:o[1],repo:o[2]}}return null}async fetchBranches(e,n,t){try{let o=await fetch(`https://api.github.com/repos/${e}/${n}/branches`,{headers:{Authorization:`Bearer ${t}`,Accept:"application/vnd.github.v3+json"}});if(!o.ok)throw new Error(`GitHub API error: ${o.status}`);return(await o.json()).map(i=>i.name)}catch(o){throw new Error(`Failed to fetch branches: ${o}`)}}async getLatestCommitSha(e,n,t,o){try{let r=`https://api.github.com/repos/${e}/${n}/commits/${t}`,i=await fetch(r,{headers:{Authorization:`Bearer ${o}`,Accept:"application/vnd.github.v3+json"}});return i.ok?(await i.json()).sha||null:(console.warn(`Failed to get commit SHA: ${i.status}`),null)}catch(r){return console.warn("Failed to get latest commit SHA:",r),null}}async fetchFileContents(e,n,t,o,r){try{let i=`https://api.github.com/repos/${e}/${n}/contents/${r}?ref=${t}`,a=await fetch(i,{headers:{Authorization:`Bearer ${o}`,Accept:"application/vnd.github.v3+json"}});if(!a.ok)throw new Error(`GitHub API error: ${a.status}`);return await a.json()}catch(i){throw new Error(`Failed to fetch file contents: ${i}`)}}async fetchDirectoryContents(e,n,t,o,r=""){try{let i=`https://api.github.com/repos/${e}/${n}/contents/${r}?ref=${t}`,a=await fetch(i,{headers:{Authorization:`Bearer ${o}`,Accept:"application/vnd.github.v3+json"}});if(!a.ok)throw new Error(`GitHub API error: ${a.status}`);let s=await a.json();return Array.isArray(s)?s:[s]}catch(i){throw new Error(`Failed to fetch directory contents: ${i}`)}}decodeBase64Content(e){try{let n=e.replace(/\s/g,""),t;if(typeof atob=="function")t=atob(n);else{let r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";t="";let i=0,a=n.replace(/=+$/,"");for(;i<a.length;){let s=r.indexOf(a.charAt(i++)),p=r.indexOf(a.charAt(i++)),f=r.indexOf(a.charAt(i++)),c=r.indexOf(a.charAt(i++)),g=s<<18|p<<12|(f&63)<<6|c&63;t+=String.fromCharCode(g>>16&255),f!==-1&&(t+=String.fromCharCode(g>>8&255)),c!==-1&&(t+=String.fromCharCode(g&255))}}let o;if(typeof TextDecoder!="undefined"){let r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);o=new TextDecoder("utf-8").decode(r)}else try{o=decodeURIComponent(escape(t))}catch(r){o=t}return o.charCodeAt(0)===65279&&(o=o.slice(1)),o=o.replace(/\0/g,""),o=o.trim(),o}catch(n){throw new Error(`Failed to decode base64 content: ${n}`)}}parseJSONContent(e){try{return JSON.parse(e)}catch(n){throw new Error(`Failed to parse JSON: ${n}`)}}flattenTokens(e,n=[]){let t=[],o=[],r=c=>c&&typeof c=="object"&&"$value"in c,i=c=>{if(!c||typeof c!="object"||"$value"in c||!("value"in c))return!1;let g=c.value;if(typeof g=="string"||typeof g=="number"||typeof g=="boolean")return!0;if(typeof g=="object"&&g!==null){if("type"in c||"description"in c)return!0;let u=Object.keys(g);if(u.some($=>["color","width","style"].includes($.toLowerCase()))&&u.filter(R=>["color","width","style","bordercolor","borderwidth","borderstyle"].includes(R.toLowerCase())).length>=2||u.some($=>["fontfamily","fontsize","fontweight","lineheight","letterspacing"].includes($.toLowerCase()))||u.some($=>["blur","spread","offsetx","offsety","x","y"].includes($.toLowerCase()))&&u.some($=>$.toLowerCase()==="color")||u.length<=6&&u.length>=2&&u.some(R=>{let T=g[R];return typeof T=="string"&&(T.startsWith("{")||T.startsWith("$"))}))return!0}return!1},a=(c,g)=>!(typeof c!="string"&&typeof c!="number"&&typeof c!="boolean"||g.length<1),s=(c,g)=>{let u=g.join(".").toLowerCase();if(typeof c=="object"&&c!==null&&!Array.isArray(c)){let $=Object.keys(c).map(R=>R.toLowerCase());if($.some(R=>["width","style"].includes(R))&&$.includes("color"))return"border";if($.some(R=>["fontfamily","fontsize","fontweight","lineheight"].includes(R)))return"typography";if($.some(R=>["blur","spread","x","y","offsetx","offsety"].includes(R)))return"shadow"}if(typeof c=="string"){if(c.match(/^#[0-9A-Fa-f]{3,8}$/)||c.match(/^rgba?\(/)||c.match(/^hsla?\(/)||u.includes("color"))return"color";if(c.match(/^\d+(\.\d+)?(ms|s)$/)||u.includes("duration"))return"duration";if(c.match(/^-?\d+(\.\d+)?(px|rem|em|pt|pc|in|cm|mm|q|vh|vw|vmin|vmax|%)$/)||u.includes("size")||u.includes("spacing"))return"dimension";if(u.includes("font")||u.includes("typography"))return"typography";if(u.includes("shadow"))return"shadow";if(u.includes("radius")||u.includes("corner")||u.includes("rounded"))return"borderRadius";if(u.includes("borderwidth")||u.includes("strokeweight")||u.includes("border")&&u.includes("width"))return"borderWidth";if(u.includes("border"))return"border"}else if(typeof c=="number")return u.includes("spacing")||u.includes("size")||u.includes("radius")||u.includes("gap")||u.includes("padding")||u.includes("margin")||u.includes("width")||u.includes("height")?"dimension":"number";return"string"},p=(c,g,u)=>{let $=u[u.length-1]||"unnamed",R=g||s(c,u);t.push({name:$,path:u,type:R,value:c,rawValue:c})},f=(c,g)=>{if(c==null)return;let u=g[g.length-1]||"";if(!(u.startsWith("$")&&u!=="$value"&&u!=="$type")){if(r(c)){p(c.$value,c.$type,g);return}if(i(c)){p(c.value,c.type,g);return}if(a(c,g)){p(c,void 0,g);return}if(c&&typeof c=="object"){let $=Array.isArray(c)?c.map((R,T)=>String(T)):Object.keys(c);for(let R of $){if(!Array.isArray(c)&&(R.startsWith("$")||R==="extensions"))continue;let T=Array.isArray(c)?c[parseInt(R)]:c[R];f(T,[...g,R])}}}};try{f(e,[])}catch(c){o.push({path:[],message:c instanceof Error?c.message:"Failed to walk tokens"})}return{tokens:t,metadata:{filePath:"",format:"auto-detected",errors:o}}}async fetchTokens(e,n,t,o,r){let i=await this.fetchFileContents(e,n,t,o,r);if(i.type!=="file")throw new Error(`Path is not a file: ${r}`);if(!i.content)throw new Error("File content is empty");let a=this.decodeBase64Content(i.content),s=this.parseJSONContent(a),p=this.parser.parse(s,r);return(!p.tokens||p.tokens.length===0)&&(p=this.flattenTokens(s,[])),p}isExcludedFile(e){var t;let n=((t=e.split("/").pop())==null?void 0:t.toLowerCase())||"";return ce.EXCLUDE_PATTERNS.some(o=>o.test(n)||o.test(e))}async fetchRepoTree(e,n,t,o){try{let r=`https://api.github.com/repos/${e}/${n}/git/trees/${t}?recursive=1`,i=await fetch(r,{headers:{Authorization:`Bearer ${o}`,Accept:"application/vnd.github.v3+json"}});if(!i.ok)throw new Error(`GitHub API error: ${i.status}`);let a=await i.json();return a.truncated?(console.warn("Repository tree was truncated - falling back to recursive fetch"),[]):a.tree||[]}catch(r){return console.error("Failed to fetch repo tree:",r),[]}}async detectTokenFiles(e,n,t,o,r=""){let i=await this.fetchRepoTree(e,n,t,o);if(i.length>0){let a=r.replace(/^\/|\/$/g,"");return i.filter(s=>s.type!=="blob"||!s.path.toLowerCase().endsWith(".json")||a&&!s.path.startsWith(a+"/")&&s.path!==a?!1:!this.isExcludedFile(s.path)).map(s=>s.path)}return this.detectTokenFilesRecursive(e,n,t,o,r)}async detectTokenFilesRecursive(e,n,t,o,r=""){let i=await this.fetchDirectoryContents(e,n,t,o,r),a=[];for(let s of i)if(s.type==="file")s.name.toLowerCase().endsWith(".json")&&!this.isExcludedFile(s.path)&&a.push(s.path);else if(s.type==="dir"&&!this.isExcludedFile(s.path+"/")){let p=await this.detectTokenFilesRecursive(e,n,t,o,s.path);a.push(...p)}return a}};D(ce,"EXCLUDE_PATTERNS",[/package\.json$/i,/package-lock\.json$/i,/tsconfig\.json$/i,/\.config\.json$/i,/eslint.*\.json$/i,/prettier.*\.json$/i,/jest\.config\.json$/i,/webpack\.config\.json$/i,/^\$metadata\.json$/i,/^\$themes\.json$/i,/\(ignore\)\.json$/i,/node_modules\//i,/\.github\//i,/\.vscode\//i]);ae=ce});var le,$e=Y(()=>{"use strict";le=class{constructor(){D(this,"errors",[]);D(this,"TOKENS_STUDIO_NAMESPACE","tokens");D(this,"DEBUG_LOGGING",!1)}getAllTokenKeys(e){let n={},t=["tokens","tokens-studio","tokensStudio","design-tokens","figma-tokens"];for(let o of t)try{let r=e.getSharedPluginDataKeys(o);for(let i of r){let a=e.getSharedPluginData(o,i);a&&a.trim()&&(n[`${o}:${i}`]=a)}}catch(r){}return n}cleanTokenReference(e){let n=e.trim();for(;n.startsWith('"')&&n.endsWith('"')||n.startsWith("'")&&n.endsWith("'");)n=n.slice(1,-1);return n=n.replace(/^[{]|[}]$/g,""),n=n.replace(/^\$/,""),n.trim()}getTokenReference(e,n){try{let t=["tokens","tokens-studio","tokensStudio","design-tokens"];for(let o of t)try{let r=e.getSharedPluginData(o,n);if(r&&r.trim()){let i=this.cleanTokenReference(r);return this.DEBUG_LOGGING&&console.log(`[TokenRef] Found ${o}:${n} = "${i}" on ${e.name}`),i}}catch(r){}try{let o=e.getPluginData(n);if(o&&o.trim())return this.cleanTokenReference(o)}catch(o){}}catch(t){}}getFillTokenReferences(e,n){let t=[`fills[${n}]`,`fill[${n}]`,`fills.${n}`,`fill.${n}`,"fill","fills","fillColor",`fillColor[${n}]`];for(let o of t){let r=this.getTokenReference(e,o);if(r)return r}}getStrokeTokenReferences(e,n){let t=[`strokes[${n}]`,`stroke[${n}]`,`strokes.${n}`,`stroke.${n}`,"stroke","strokes","strokeColor",`strokeColor[${n}]`,"borderColor","border"];for(let o of t){let r=this.getTokenReference(e,o);if(r)return r}}getTypographyTokenReference(e,n){let o={fontFamily:["fontFamily","fontFamilies","font-family","typography.fontFamily"],fontSize:["fontSize","fontSizes","font-size","typography.fontSize"],fontWeight:["fontWeight","fontWeights","font-weight","typography.fontWeight"],lineHeight:["lineHeight","lineHeights","line-height","typography.lineHeight"],letterSpacing:["letterSpacing","letter-spacing","typography.letterSpacing"],typography:["typography","text","textStyle","text-style"]}[n]||[n];for(let r of o){let i=this.getTokenReference(e,r);if(i)return i}}getSpacingTokenReference(e,n){let o={width:["width","sizing","dimension","sizing.width","dimensions.width"],height:["height","sizing","dimension","sizing.height","dimensions.height"],padding:["padding","spacing","paddingTop","paddingRight","paddingBottom","paddingLeft"],paddingTop:["paddingTop","verticalPadding","padding","spacing"],paddingRight:["paddingRight","horizontalPadding","padding","spacing"],paddingBottom:["paddingBottom","verticalPadding","padding","spacing"],paddingLeft:["paddingLeft","horizontalPadding","padding","spacing"],verticalPadding:["verticalPadding","paddingTop","paddingBottom","padding","spacing"],horizontalPadding:["horizontalPadding","paddingLeft","paddingRight","padding","spacing"],gap:["itemSpacing","spacing","gap","counterAxisSpacing"],itemSpacing:["itemSpacing","spacing","gap"],counterAxisSpacing:["counterAxisSpacing","spacing"],borderRadius:["borderRadius","borderRadiusTopLeft","borderRadiusTopRight","borderRadiusBottomRight","borderRadiusBottomLeft","radius","cornerRadius"],borderRadiusTopLeft:["borderRadiusTopLeft","borderRadius","radius"],borderRadiusTopRight:["borderRadiusTopRight","borderRadius","radius"],borderRadiusBottomRight:["borderRadiusBottomRight","borderRadius","radius"],borderRadiusBottomLeft:["borderRadiusBottomLeft","borderRadius","radius"],borderWidth:["borderWidth","strokeWeight","borderWidthTop","borderWidthRight","borderWidthBottom","borderWidthLeft","border"],strokeWeight:["strokeWeight","borderWidth","border"],dimension:["dimension","spacing","sizing","size"]}[n]||[n];for(let r of o){let i=this.getTokenReference(e,r);if(i)return i}}getBorderRadiusTokenReference(e){let n=["borderRadius","borderRadiusTopLeft","borderRadiusTopRight","borderRadiusBottomRight","borderRadiusBottomLeft","radius","cornerRadius","topLeftRadius","topRightRadius","bottomRightRadius","bottomLeftRadius"];for(let t of n){let o=this.getTokenReference(e,t);if(o)return this.DEBUG_LOGGING&&console.log(`[BorderRadius] Found ${t} = "${o}" on ${e.name}`),o}}getBorderWidthTokenReference(e){let n=["borderWidth","strokeWeight","borderWidthTop","borderWidthRight","borderWidthBottom","borderWidthLeft","border","strokeWidth"];for(let t of n){let o=this.getTokenReference(e,t);if(o)return this.DEBUG_LOGGING&&console.log(`[BorderWidth] Found ${t} = "${o}" on ${e.name}`),o}}getEffectTokenReference(e,n){let t=["boxShadow","shadow",`boxShadow[${n}]`,`shadow[${n}]`,"effects","effect",`effects[${n}]`,`effect[${n}]`,"dropShadow","innerShadow","elevation","shadowColor","shadowOffset","shadowRadius","shadowSpread"];for(let o of t){let r=this.getTokenReference(e,o);if(r)return this.DEBUG_LOGGING&&console.log(`[Effect] Found ${o} = "${r}" on ${e.name}`),r}}logNodeTokenData(e){if(!this.DEBUG_LOGGING)return;let n=this.getAllTokenKeys(e);if(Object.keys(n).length>0){console.log(`
[TokenData] Node: "${e.name}" (${e.type})`);for(let[t,o]of Object.entries(n)){let r=this.cleanTokenReference(o);console.log(r!==o?`  ${t} = ${r} (raw: ${o})`:`  ${t} = ${r}`)}}}scanAllComponents(){this.errors=[];let e=[],n=0,t=figma.root.children;for(let o of t)if(o.type==="PAGE"){let r=o.findAll(a=>a.type==="COMPONENT"||a.type==="COMPONENT_SET"),i=o.findAll(a=>a.type==="INSTANCE");n+=i.length;for(let a of r)try{let s=this.extractComponentProperties(a,o.name);s&&e.push(s)}catch(s){this.errors.push({componentId:a.id,componentName:a.name,error:s instanceof Error?s.message:"Unknown error"})}}return{components:e,totalComponents:e.length,totalInstances:n,pagesScanned:t.length,errors:this.errors}}scanFilteredPages(e){this.errors=[];let n=[],t=0,o=figma.root.children,r=e.map(a=>a.toLowerCase().trim()),i=o.filter(a=>a.type==="PAGE"&&r.includes(a.name.toLowerCase().trim()));for(let a of i)if(a.type==="PAGE"){let s=a.findAll(f=>f.type==="COMPONENT"||f.type==="COMPONENT_SET"),p=a.findAll(f=>f.type==="INSTANCE");t+=p.length;for(let f of s)try{let c=this.extractComponentProperties(f,a.name);c&&n.push(c)}catch(c){this.errors.push({componentId:f.id,componentName:f.name,error:c instanceof Error?c.message:"Unknown error"})}}return{components:n,totalComponents:n.length,totalInstances:t,pagesScanned:i.length,errors:this.errors}}scanCurrentPage(){this.errors=[];let e=[],n=figma.currentPage,t=0,o=n.findAll(i=>i.type==="COMPONENT"||i.type==="COMPONENT_SET"),r=n.findAll(i=>i.type==="INSTANCE");t+=r.length;for(let i of o)try{let a=this.extractComponentProperties(i,n.name);a&&e.push(a)}catch(a){this.errors.push({componentId:i.id,componentName:i.name,error:a instanceof Error?a.message:"Unknown error"})}return{components:e,totalComponents:e.length,totalInstances:t,pagesScanned:1,errors:this.errors}}scanNodes(e){this.errors=[];let n=[],t=0,o=figma.currentPage;for(let r of e){let i=[],a=[];"findAll"in r&&typeof r.findAll=="function"&&(i=r.findAll(s=>s.type==="COMPONENT"||s.type==="COMPONENT_SET"),a=r.findAll(s=>s.type==="INSTANCE"),t+=a.length);for(let s of i)try{let p=this.extractComponentProperties(s,o.name);p&&n.push(p)}catch(p){this.errors.push({componentId:s.id,componentName:s.name,error:p instanceof Error?p.message:"Unknown error"})}if(r.type==="COMPONENT"||r.type==="COMPONENT_SET")try{let s=this.extractComponentProperties(r,o.name);s&&(n.find(p=>p.id===s.id)||n.push(s))}catch(s){this.errors.push({componentId:r.id,componentName:r.name,error:s instanceof Error?s.message:"Unknown error"})}}return{components:n,totalComponents:n.length,totalInstances:t,pagesScanned:1,errors:this.errors}}extractComponentProperties(e,n){var o,r;if(e.type!=="COMPONENT"&&e.type!=="COMPONENT_SET"&&e.type!=="INSTANCE")return null;let t={id:e.id,name:e.name,type:e.type,pageName:n,colors:[],typography:[],spacing:[],effects:[]};if(e.type==="COMPONENT_SET")t.mainComponentName=e.name,t.mainComponentId=e.id;else if(e.type==="COMPONENT"){let i=e;((o=i.parent)==null?void 0:o.type)==="COMPONENT_SET"?(t.mainComponentName=i.parent.name,t.mainComponentId=i.parent.id):(t.mainComponentName=e.name,t.mainComponentId=e.id)}else if(e.type==="INSTANCE"){let i=e;try{let a=i.mainComponent;a&&(((r=a.parent)==null?void 0:r.type)==="COMPONENT_SET"?(t.mainComponentName=a.parent.name,t.mainComponentId=a.parent.id):(t.mainComponentName=a.name,t.mainComponentId=a.id))}catch(a){t.mainComponentName=e.name.split(",")[0].trim()}}if(t.colors=this.extractColors(e),t.typography=this.extractTypography(e),t.spacing=this.extractSpacing(e),t.effects=this.extractEffects(e),e.type==="COMPONENT"||e.type==="COMPONENT_SET"){let i=e;"layoutMode"in i&&i.layoutMode&&(t.layoutMode=i.layoutMode,t.itemSpacing=i.itemSpacing,t.paddingTop=i.paddingTop,t.paddingRight=i.paddingRight,t.paddingBottom=i.paddingBottom,t.paddingLeft=i.paddingLeft),t.width=i.width,t.height=i.height}else if(e.type==="INSTANCE"){let i=e;t.width=i.width,t.height=i.height}if("children"in e){let i=[];for(let a of e.children){let s=this.extractComponentProperties(a,n);s&&i.push(s)}i.length>0&&(t.children=i)}return t}extractColors(e,n=!0){var o,r;let t=[];if("fills"in e&&Array.isArray(e.fills))for(let i=0;i<e.fills.length;i++){let a=e.fills[i];if(a.type==="SOLID"){let s=(o=a.opacity)!=null?o:1,p=this.rgbaToColor(a.color,s),f=this.getFillTokenReferences(e,i);t.push({type:"fill",color:{r:a.color.r,g:a.color.g,b:a.color.b,a:s},hex:p.hex,rgba:p.rgba,opacity:s,tokenReference:f,nodeName:e.name,nodeId:e.id})}}if("strokes"in e&&Array.isArray(e.strokes))for(let i=0;i<e.strokes.length;i++){let a=e.strokes[i];if(a.type==="SOLID"){let s=(r=a.opacity)!=null?r:1,p=this.rgbaToColor(a.color,s),f=this.getStrokeTokenReferences(e,i);t.push({type:"stroke",color:{r:a.color.r,g:a.color.g,b:a.color.b,a:s},hex:p.hex,rgba:p.rgba,opacity:s,tokenReference:f,nodeName:e.name,nodeId:e.id})}}if(n&&"children"in e){for(let i of e.children)if(i.type!=="INSTANCE"){let a=this.extractColors(i,!0);t.push(...a)}}return t}extractTypography(e){let n=[];if(e.type==="TEXT"){let t=e;if(typeof t.fontName!="symbol"){let o=t.fontName,r=this.getTypographyTokenReference(t,"typography"),i=this.getTypographyTokenReference(t,"fontFamily"),a=this.getTypographyTokenReference(t,"fontSize"),s=this.getTypographyTokenReference(t,"fontWeight"),p=this.getTypographyTokenReference(t,"lineHeight"),f=this.getTypographyTokenReference(t,"letterSpacing"),c=r||i||a||s||p||f;n.push({fontFamily:o.family,fontSize:typeof t.fontSize=="number"?t.fontSize:16,fontWeight:typeof o.style=="string"?this.parseFontWeight(o.style):400,lineHeight:typeof t.lineHeight=="number"||typeof t.lineHeight=="string"?t.lineHeight:void 0,letterSpacing:typeof t.letterSpacing=="number"?t.letterSpacing:void 0,textDecoration:typeof t.textDecoration=="string"?t.textDecoration:void 0,textCase:typeof t.textCase=="string"?t.textCase:void 0,tokenReference:c})}}if("children"in e)for(let t of e.children)n.push(...this.extractTypography(t));return n}extractSpacing(e,n=!0){let t=[];if(this.logNodeTokenData(e),e.type==="COMPONENT"||e.type==="COMPONENT_SET"||e.type==="FRAME"||e.type==="INSTANCE"){let r=e,i=this.getSpacingTokenReference(e,"width"),a=this.getSpacingTokenReference(e,"height");if(t.push({type:"width",value:r.width,unit:"px",tokenReference:i,nodeName:e.name,nodeId:e.id}),t.push({type:"height",value:r.height,unit:"px",tokenReference:a,nodeName:e.name,nodeId:e.id}),"paddingTop"in r&&typeof r.paddingTop=="number"){let s=this.getSpacingTokenReference(e,"horizontalPadding"),p=this.getSpacingTokenReference(e,"verticalPadding"),f=this.getSpacingTokenReference(e,"padding"),c=this.getSpacingTokenReference(e,"paddingTop"),g=this.getSpacingTokenReference(e,"paddingRight"),u=this.getSpacingTokenReference(e,"paddingBottom"),$=this.getSpacingTokenReference(e,"paddingLeft"),R=(P,h)=>P?`[${h}] ${P}`:void 0,T=(P,h,x)=>{if(P)return P;if(h)return R(h,x);if(f)return R(f,"all")};r.paddingTop&&t.push({type:"padding",value:r.paddingTop,unit:"px",tokenReference:T(c,p,"vertical"),nodeName:e.name,nodeId:e.id}),r.paddingRight&&t.push({type:"padding",value:r.paddingRight,unit:"px",tokenReference:T(g,s,"horizontal"),nodeName:e.name,nodeId:e.id}),r.paddingBottom&&t.push({type:"padding",value:r.paddingBottom,unit:"px",tokenReference:T(u,p,"vertical"),nodeName:e.name,nodeId:e.id}),r.paddingLeft&&t.push({type:"padding",value:r.paddingLeft,unit:"px",tokenReference:T($,s,"horizontal"),nodeName:e.name,nodeId:e.id})}if("itemSpacing"in r&&typeof r.itemSpacing=="number"&&r.itemSpacing){let s=this.getSpacingTokenReference(e,"itemSpacing")||this.getSpacingTokenReference(e,"gap")||this.getSpacingTokenReference(e,"spacing");t.push({type:"gap",value:r.itemSpacing,unit:"px",tokenReference:s,nodeName:e.name,nodeId:e.id})}if("counterAxisSpacing"in r&&typeof r.counterAxisSpacing=="number"&&r.counterAxisSpacing){let s=this.getSpacingTokenReference(e,"counterAxisSpacing");t.push({type:"gap",value:r.counterAxisSpacing,unit:"px",tokenReference:s,nodeName:e.name,nodeId:e.id})}if("cornerRadius"in r){let s=this.getBorderRadiusTokenReference(e);typeof r.cornerRadius=="number"&&r.cornerRadius>0?t.push({type:"borderRadius",value:r.cornerRadius,unit:"px",tokenReference:s,nodeName:e.name,nodeId:e.id}):r.cornerRadius===figma.mixed&&("topLeftRadius"in r&&typeof r.topLeftRadius=="number"&&r.topLeftRadius>0&&t.push({type:"borderRadius",value:r.topLeftRadius,unit:"px",tokenReference:this.getSpacingTokenReference(e,"borderRadiusTopLeft")||s,nodeName:e.name,nodeId:e.id}),"topRightRadius"in r&&typeof r.topRightRadius=="number"&&r.topRightRadius>0&&t.push({type:"borderRadius",value:r.topRightRadius,unit:"px",tokenReference:this.getSpacingTokenReference(e,"borderRadiusTopRight")||s,nodeName:e.name,nodeId:e.id}),"bottomRightRadius"in r&&typeof r.bottomRightRadius=="number"&&r.bottomRightRadius>0&&t.push({type:"borderRadius",value:r.bottomRightRadius,unit:"px",tokenReference:this.getSpacingTokenReference(e,"borderRadiusBottomRight")||s,nodeName:e.name,nodeId:e.id}),"bottomLeftRadius"in r&&typeof r.bottomLeftRadius=="number"&&r.bottomLeftRadius>0&&t.push({type:"borderRadius",value:r.bottomLeftRadius,unit:"px",tokenReference:this.getSpacingTokenReference(e,"borderRadiusBottomLeft")||s,nodeName:e.name,nodeId:e.id}))}if("strokeWeight"in r&&typeof r.strokeWeight=="number"&&r.strokeWeight>0){let s=this.getBorderWidthTokenReference(e);t.push({type:"borderWidth",value:r.strokeWeight,unit:"px",tokenReference:s,nodeName:e.name,nodeId:e.id})}}else if("cornerRadius"in e){let r=this.getBorderRadiusTokenReference(e),i=e;if(typeof i.cornerRadius=="number"&&i.cornerRadius>0&&t.push({type:"borderRadius",value:i.cornerRadius,unit:"px",tokenReference:r,nodeName:e.name,nodeId:e.id}),"strokeWeight"in i&&typeof i.strokeWeight=="number"&&i.strokeWeight>0){let a=this.getBorderWidthTokenReference(e);t.push({type:"borderWidth",value:i.strokeWeight,unit:"px",tokenReference:a,nodeName:e.name,nodeId:e.id})}}else if("strokeWeight"in e){let r=e;if(typeof r.strokeWeight=="number"&&r.strokeWeight>0){let i=this.getBorderWidthTokenReference(e);t.push({type:"borderWidth",value:r.strokeWeight,unit:"px",tokenReference:i,nodeName:e.name,nodeId:e.id})}}if(n&&"children"in e){for(let r of e.children)if(r.type!=="INSTANCE"){let i=this.extractSpacing(r,!0);t.push(...i)}}return t}extractEffects(e){var t,o,r,i,a,s,p,f;let n=[];if("effects"in e&&Array.isArray(e.effects))for(let c=0;c<e.effects.length;c++){let g=e.effects[c];if(g.visible){let u=this.getEffectTokenReference(e,c);switch(g.type){case"DROP_SHADOW":n.push({type:"drop-shadow",visible:g.visible,radius:g.radius,color:g.color?{r:g.color.r,g:g.color.g,b:g.color.b,a:g.color.a}:void 0,offset:{x:(o=(t=g.offset)==null?void 0:t.x)!=null?o:0,y:(i=(r=g.offset)==null?void 0:r.y)!=null?i:0},spread:g.spread,tokenReference:u});break;case"INNER_SHADOW":n.push({type:"inner-shadow",visible:g.visible,radius:g.radius,color:g.color?{r:g.color.r,g:g.color.g,b:g.color.b,a:g.color.a}:void 0,offset:{x:(s=(a=g.offset)==null?void 0:a.x)!=null?s:0,y:(f=(p=g.offset)==null?void 0:p.y)!=null?f:0},spread:g.spread,tokenReference:u});break;case"LAYER_BLUR":n.push({type:"layer-blur",visible:g.visible,radius:g.radius,tokenReference:u});break;case"BACKGROUND_BLUR":n.push({type:"background-blur",visible:g.visible,radius:g.radius,tokenReference:u});break}}}return n}rgbaToColor(e,n){let t=Math.round(e.r*255),o=Math.round(e.g*255),r=Math.round(e.b*255),i=n,a=`#${[t,o,r].map(p=>{let f=p.toString(16);return f.length===1?"0"+f:f}).join("")}`,s=`rgba(${t}, ${o}, ${r}, ${i.toFixed(2)})`;return{hex:a,rgba:s}}parseFontWeight(e){let n={thin:100,extralight:200,light:300,regular:400,medium:500,semibold:600,bold:700,extrabold:800,black:900},t=e.toLowerCase();for(let[r,i]of Object.entries(n))if(t.includes(r))return i;let o=e.match(/(\d+)/);return o?parseInt(o[1],10):400}getComponentUsageStats(e){let n=[],t=new Set;for(let o of figma.root.children)if(o.type==="PAGE"){let r=o.findAll(i=>{var a;return i.type==="INSTANCE"&&((a=i.mainComponent)==null?void 0:a.id)===e});r.length>0&&(n.push(...r),t.add(o.name))}return{instances:n.length,pages:Array.from(t)}}}});var pe,we=Y(()=>{"use strict";pe=class{constructor(){D(this,"errors",[]);D(this,"cache",new Map);D(this,"cacheMaxAge",5*60*1e3);D(this,"tokenIndex",{byPath:new Map,byValue:new Map});D(this,"nodeTokenRefsCache",new WeakMap);D(this,"TOKENS_STUDIO_NAMESPACE","tokens");D(this,"debugLogging",!1);D(this,"SKIP_NODE_TYPES",new Set(["VECTOR","BOOLEAN_OPERATION","LINE","ELLIPSE","STAR","POLYGON","TEXT","RECTANGLE","SLICE","STAMP","STICKY","SHAPE_WITH_TEXT","CODE_BLOCK","WIDGET","EMBED","LINK_UNFURL","MEDIA"]))}setDebugLogging(e){this.debugLogging=e}async clearCache(){this.cache.clear(),this.tokenIndex={byPath:new Map,byValue:new Map},this.nodeTokenRefsCache=new WeakMap;try{let n=(await figma.clientStorage.keysAsync()).filter(t=>t.startsWith("componentCache_"));for(let t of n)await figma.clientStorage.deleteAsync(t)}catch(e){console.error("Error clearing persistent cache:",e)}}getCacheStats(){return{entries:this.cache.size,indexedPaths:this.tokenIndex.byPath.size,indexedValues:this.tokenIndex.byValue.size}}getDocumentVersion(){return{documentVersion:figma.root.children.filter(t=>t.type==="PAGE").map(t=>`${t.id}:${t.name}`).join("|").split("").reduce((t,o)=>(t<<5)-t+o.charCodeAt(0),0).toString(36),editSessionId:figma.root.id}}getPersistentCacheKey(e,n){let t=n.slice().sort().join(",");return`componentCache_${e}_${t||"all"}`}async getFromPersistentCache(e,n){try{let t=this.getPersistentCacheKey(e,n),o=await figma.clientStorage.getAsync(t);if(!o)return null;let r=this.getDocumentVersion();if(o.documentVersion===r.documentVersion&&o.editSessionId===r.editSessionId&&Date.now()-o.timestamp<this.cacheMaxAge)return this.debugLogging&&console.log(`[Cache] HIT - Persistent cache valid for ${e} (${n.length} pages)`),o.components;this.debugLogging&&console.log(`[Cache] MISS - Invalidated (version: ${o.documentVersion} vs ${r.documentVersion})`),await figma.clientStorage.deleteAsync(t)}catch(t){this.debugLogging&&console.error("Error reading persistent cache:",t)}return null}async saveToPersistentCache(e,n,t){try{let o=this.getPersistentCacheKey(e,n),r=this.getDocumentVersion(),i={components:t,timestamp:Date.now(),documentVersion:r.documentVersion,editSessionId:r.editSessionId,tokenType:e,pageNames:n};await figma.clientStorage.setAsync(o,i),this.debugLogging&&console.log(`[Cache] SAVED - ${t.length} components for ${e} (version: ${r.documentVersion})`)}catch(o){this.debugLogging&&console.error("Error saving persistent cache:",o)}}async invalidatePagesCache(e){try{let t=(await figma.clientStorage.keysAsync()).filter(o=>o.startsWith("componentCache_"));for(let o of t)try{let r=await figma.clientStorage.getAsync(o);if(!r)continue;r.pageNames.some(a=>e.some(s=>a.toLowerCase()===s.toLowerCase()))&&(await figma.clientStorage.deleteAsync(o),this.debugLogging&&console.log(`[Cache] INVALIDATED - ${o} (affected pages: ${e.join(", ")})`))}catch(r){}}catch(n){this.debugLogging&&console.error("Error invalidating page caches:",n)}}async getCachedPageNames(){try{let n=(await figma.clientStorage.keysAsync()).filter(o=>o.startsWith("componentCache_")),t=new Set;for(let o of n)try{let r=await figma.clientStorage.getAsync(o);r!=null&&r.pageNames&&r.pageNames.forEach(i=>t.add(i))}catch(r){}return Array.from(t)}catch(e){return[]}}async scanAllComponentsOptimized(e={}){this.errors=[];let n=[],t=0,{tokenType:o="all",maxNodesPerPage:r=0,maxPages:i=0,chunkSize:a=100,onProgress:s,includeChildren:p=!0,maxDepth:f=3,useCache:c=!0,usePersistentCache:g=!0,pageFilter:u=[]}=e,$=figma.root.children.filter(h=>h.type==="PAGE"),R=u.length>0?$.filter(h=>u.includes(h.name)):$,T=i>0?Math.min(i,R.length):R.length,P=R.slice(0,T).map(h=>h.name);if(g&&c){s==null||s({currentPage:0,totalPages:T,currentPageName:"Checking cache...",componentsFound:0,nodesScanned:0,phase:"loading"});let h=await this.getFromPersistentCache(o,P);if(h)return this.buildTokenIndex(h),s==null||s({currentPage:T,totalPages:T,currentPageName:"Complete (from cache)",componentsFound:h.length,nodesScanned:0,phase:"complete"}),{components:h,totalComponents:h.length,totalInstances:0,pagesScanned:T,errors:[]}}for(let h=0;h<T;h++){let x=R[h];s==null||s({currentPage:h+1,totalPages:T,currentPageName:x.name,componentsFound:n.length,nodesScanned:0,phase:"scanning"});let H=`${x.id}-${o}`;if(c){let X=this.getFromCache(H);if(X){n.push(...X);continue}}let O=await this.scanPageChunked(x,o,a,r,p,f,X=>{s==null||s({currentPage:h+1,totalPages:T,currentPageName:x.name,componentsFound:n.length,nodesScanned:X,phase:"scanning"})});c&&this.cache.set(H,{components:O.components,timestamp:Date.now()}),n.push(...O.components),t+=O.totalInstances,await this.yieldToMain()}return this.buildTokenIndex(n),g&&c&&n.length>0&&await this.saveToPersistentCache(o,P,n),s==null||s({currentPage:T,totalPages:T,currentPageName:"Complete",componentsFound:n.length,nodesScanned:0,phase:"complete"}),{components:n,totalComponents:n.length,totalInstances:t,pagesScanned:T,errors:this.errors}}async scanPageChunked(e,n,t,o,r,i,a){let s=[],p=0,f=0;if(e.children.length===0)return{components:[],totalInstances:0};let c=this.pageHasComponents(e),g=[],u=c?o:o>0?Math.min(o,50):50;this.collectComponentNodes(e,g,u),!c&&g.length>=u&&(g.length=0,this.collectComponentNodes(e,g,o)),this.nodeTokenRefsCache=new WeakMap;let $=g.length;for(let R=0;R<$;R+=t){let T=Math.min(R+t,$);for(let P=R;P<T;P++){let h=g[P];try{let x=await this.extractComponentPropertiesOptimized(h,e.name,n,r,i,0);x&&s.push(x),f++,a==null||a(f)}catch(x){this.errors.push({componentId:h.id,componentName:h.name,error:x instanceof Error?x.message:"Unknown error"})}}T<$&&await this.yieldToMain()}return{components:s,totalInstances:p}}collectComponentNodes(e,n,t,o=0){if(t>0&&n.length>=t||o>15)return;let r=e.children,i=r.length;for(let a=0;a<i&&!(t>0&&n.length>=t);a++){let s=r[a],p=s.type;if(p==="COMPONENT"||p==="COMPONENT_SET"){n.push(s);continue}if(!this.SKIP_NODE_TYPES.has(p)&&p!=="INSTANCE"&&!(p!=="GROUP"&&"visible"in s&&!s.visible)&&"children"in s){let f=s;if(f.children.length===0)continue;(p==="FRAME"||p==="GROUP"||p==="SECTION")&&this.collectComponentNodes(f,n,t,o+1)}}}pageHasComponents(e){let n=e.children;if(n.length===0)return!1;let t=Math.min(n.length,30);for(let o=0;o<t;o++){let r=n[o],i=r.type;if(i==="COMPONENT"||i==="COMPONENT_SET")return!0;if((i==="FRAME"||i==="SECTION")&&"children"in r){let a=r.children,s=Math.min(a.length,15);for(let p=0;p<s;p++){let f=a[p];if(f.type==="COMPONENT"||f.type==="COMPONENT_SET")return!0}}}return!1}async extractComponentPropertiesOptimized(e,n,t,o,r,i){var u,$,R;if(e.type!=="COMPONENT"&&e.type!=="COMPONENT_SET"&&e.type!=="INSTANCE"&&e.type!=="FRAME")return null;let a=e.type==="FRAME"?"COMPONENT":e.type,s={id:e.id,name:e.name,type:a,pageName:n,colors:[],typography:[],spacing:[],effects:[]};if(e.type==="COMPONENT_SET")s.mainComponentName=e.name,s.mainComponentId=e.id;else if(e.type==="COMPONENT"){let T=e;((u=T.parent)==null?void 0:u.type)==="COMPONENT_SET"?(s.mainComponentName=T.parent.name,s.mainComponentId=T.parent.id,s.variantName=T.name):(s.mainComponentName=e.name,s.mainComponentId=e.id)}else if(e.type==="INSTANCE"){let T=e;try{let P=await T.getMainComponentAsync();P&&((($=P.parent)==null?void 0:$.type)==="COMPONENT_SET"?(s.mainComponentName=P.parent.name,s.mainComponentId=P.parent.id,s.variantName=P.name):(s.mainComponentName=P.name,s.mainComponentId=P.id))}catch(P){try{let h=T.mainComponent;h?((R=h.parent)==null?void 0:R.type)==="COMPONENT_SET"?(s.mainComponentName=h.parent.name,s.mainComponentId=h.parent.id,s.variantName=h.name):(s.mainComponentName=h.name,s.mainComponentId=h.id):s.mainComponentName=e.name.split(",")[0].trim()}catch(h){s.mainComponentName=e.name.split(",")[0].trim()}}}let p=t==="all"||t==="color",f=t==="all"||t==="typography",c=t==="all"||["dimension","spacing","borderRadius","borderWidth"].includes(t),g=t==="all"||["effect","shadow"].includes(t);if(p&&(s.colors=this.extractColorsOptimized(e)),f&&(s.typography=this.extractTypographyOptimized(e,o)),c&&(s.spacing=this.extractSpacingOptimized(e,t)),g&&(s.effects=this.extractEffectsOptimized(e)),e.type==="COMPONENT"||e.type==="COMPONENT_SET"||e.type==="FRAME"){let T=e;"layoutMode"in T&&T.layoutMode&&(s.layoutMode=T.layoutMode,s.itemSpacing=T.itemSpacing),s.width=T.width,s.height=T.height}if(o&&i<r&&"children"in e){let T=[];for(let P of e.children){if(this.shouldSkipNode(P,t))continue;let h=await this.extractComponentPropertiesOptimized(P,n,t,o,r,i+1);h&&this.hasRelevantProperties(h)&&T.push(h)}T.length>0&&(s.children=T)}return s}shouldSkipNode(e,n){return"visible"in e&&!e.visible||(e.type==="VECTOR"||e.type==="BOOLEAN_OPERATION")&&n!=="color"||"width"in e&&"height"in e&&(e.width<1||e.height<1)}hasRelevantProperties(e){return!!(e.colors.length>0||e.typography.length>0||e.spacing.length>0||e.effects.length>0||e.children&&e.children.length>0)}extractColorsOptimized(e){var t,o;let n=[];if("fills"in e&&Array.isArray(e.fills))for(let r=0;r<e.fills.length;r++){let i=e.fills[r];if(i.type==="SOLID"){let a=(t=i.opacity)!=null?t:1,s=this.rgbaToColor(i.color,a),p=this.getFillTokenReferencesFast(e,r);n.push({type:"fill",color:{r:i.color.r,g:i.color.g,b:i.color.b,a},hex:s.hex,rgba:s.rgba,opacity:a,tokenReference:p})}}if("strokes"in e&&Array.isArray(e.strokes))for(let r=0;r<e.strokes.length;r++){let i=e.strokes[r];if(i.type==="SOLID"){let a=(o=i.opacity)!=null?o:1,s=this.rgbaToColor(i.color,a),p=this.getStrokeTokenReferencesFast(e,r);n.push({type:"stroke",color:{r:i.color.r,g:i.color.g,b:i.color.b,a},hex:s.hex,rgba:s.rgba,opacity:a,tokenReference:p})}}return n}extractTypographyOptimized(e,n){let t=[];if(e.type==="TEXT"){let o=e;if(typeof o.fontName!="symbol"){let r=o.fontName,i=this.getTypographyTokenFast(o);t.push({fontFamily:r.family,fontSize:typeof o.fontSize=="number"?o.fontSize:16,fontWeight:typeof r.style=="string"?this.parseFontWeight(r.style):400,lineHeight:typeof o.lineHeight=="number"?o.lineHeight:void 0,letterSpacing:typeof o.letterSpacing=="number"?o.letterSpacing:void 0,tokenReference:i})}}if(n&&"children"in e)for(let o of e.children)(o.type==="TEXT"||"children"in o&&this.containsTextNode(o))&&t.push(...this.extractTypographyOptimized(o,n));return t}containsTextNode(e){if(e.type==="TEXT")return!0;if("children"in e){for(let n of e.children)if(n.type==="TEXT"||"children"in n&&n.children.length>0&&n.children.some(t=>t.type==="TEXT"))return!0}return!1}extractSpacingOptimized(e,n){let t=[],o=e.type==="COMPONENT"||e.type==="COMPONENT_SET"||e.type==="FRAME"||e.type==="INSTANCE";if(!o&&!("cornerRadius"in e))return t;let r=n==="all"||n==="dimension"||n==="spacing",i=n==="all"||n==="borderRadius",a=n==="all"||n==="borderWidth";if(o){let s=e;if(r&&t.push({type:"width",value:s.width,unit:"px",tokenReference:this.getSpacingTokenFast(e,"width")},{type:"height",value:s.height,unit:"px",tokenReference:this.getSpacingTokenFast(e,"height")}),r&&"paddingTop"in s&&typeof s.paddingTop=="number"){let p=this.getSpacingTokenFast(e,"horizontalPadding"),f=this.getSpacingTokenFast(e,"verticalPadding"),c=this.getSpacingTokenFast(e,"padding");s.paddingTop&&t.push({type:"padding",value:s.paddingTop,unit:"px",tokenReference:f||c}),s.paddingRight&&t.push({type:"padding",value:s.paddingRight,unit:"px",tokenReference:p||c}),s.paddingBottom&&t.push({type:"padding",value:s.paddingBottom,unit:"px",tokenReference:f||c}),s.paddingLeft&&t.push({type:"padding",value:s.paddingLeft,unit:"px",tokenReference:p||c})}if(r&&"itemSpacing"in s&&s.itemSpacing&&t.push({type:"gap",value:s.itemSpacing,unit:"px",tokenReference:this.getSpacingTokenFast(e,"itemSpacing")}),i&&"cornerRadius"in s){let p=this.getBorderRadiusTokenFast(e);typeof s.cornerRadius=="number"&&s.cornerRadius>0&&t.push({type:"borderRadius",value:s.cornerRadius,unit:"px",tokenReference:p})}a&&"strokeWeight"in s&&typeof s.strokeWeight=="number"&&s.strokeWeight>0&&t.push({type:"borderWidth",value:s.strokeWeight,unit:"px",tokenReference:this.getBorderWidthTokenFast(e)})}else if(i&&"cornerRadius"in e){let s=e,p=this.getBorderRadiusTokenFast(e);typeof s.cornerRadius=="number"&&s.cornerRadius>0&&t.push({type:"borderRadius",value:s.cornerRadius,unit:"px",tokenReference:p})}return t}extractEffectsOptimized(e){var t,o,r,i;let n=[];if(!("effects"in e)||!Array.isArray(e.effects))return n;for(let a=0;a<e.effects.length;a++){let s=e.effects[a];if(!s.visible)continue;let p=this.getEffectTokenFast(e,a);s.type==="DROP_SHADOW"||s.type==="INNER_SHADOW"?n.push({type:s.type==="DROP_SHADOW"?"drop-shadow":"inner-shadow",visible:s.visible,radius:s.radius,color:s.color?{r:s.color.r,g:s.color.g,b:s.color.b,a:s.color.a}:void 0,offset:{x:(o=(t=s.offset)==null?void 0:t.x)!=null?o:0,y:(i=(r=s.offset)==null?void 0:r.y)!=null?i:0},spread:s.spread,tokenReference:p}):(s.type==="LAYER_BLUR"||s.type==="BACKGROUND_BLUR")&&n.push({type:s.type==="LAYER_BLUR"?"layer-blur":"background-blur",visible:s.visible,radius:s.radius,tokenReference:p})}return n}getNodeTokenRefs(e){let n=this.nodeTokenRefsCache.get(e);if(n)return n;n=new Map;try{let t=e.getSharedPluginDataKeys("tokens");for(let o of t){let r=e.getSharedPluginData("tokens",o);r&&r.trim()&&n.set(o,this.cleanTokenReference(r))}}catch(t){}return this.nodeTokenRefsCache.set(e,n),n}getFillTokenReferencesFast(e,n){let t=this.getNodeTokenRefs(e);return t.get("fill")||t.get(`fills.${n}`)||t.get(`fills[${n}]`)||t.get("fillColor")}getStrokeTokenReferencesFast(e,n){let t=this.getNodeTokenRefs(e);return t.get("stroke")||t.get(`strokes.${n}`)||t.get(`strokes[${n}]`)||t.get("strokeColor")}getTypographyTokenFast(e){let n=this.getNodeTokenRefs(e);return n.get("typography")||n.get("fontFamily")||n.get("fontSize")||n.get("fontWeight")}getSpacingTokenFast(e,n){return this.getNodeTokenRefs(e).get(n)}getBorderRadiusTokenFast(e){let n=this.getNodeTokenRefs(e);return n.get("borderRadius")||n.get("cornerRadius")||n.get("radius")}getBorderWidthTokenFast(e){let n=this.getNodeTokenRefs(e);return n.get("borderWidth")||n.get("strokeWeight")}getEffectTokenFast(e,n){let t=this.getNodeTokenRefs(e);return t.get("boxShadow")||t.get(`effects.${n}`)||t.get(`effects[${n}]`)||t.get("shadow")}cleanTokenReference(e){let n=e.trim();for(;n.startsWith('"')&&n.endsWith('"')||n.startsWith("'")&&n.endsWith("'");)n=n.slice(1,-1);return n=n.replace(/^[{]|[}]$/g,""),n=n.replace(/^\$/,""),n.trim()}buildTokenIndex(e){this.tokenIndex={byPath:new Map,byValue:new Map};let n=t=>{for(let o of t.colors)o.tokenReference&&this.addToIndex(this.tokenIndex.byPath,o.tokenReference.toLowerCase(),t.id),o.hex&&this.addToIndex(this.tokenIndex.byValue,o.hex.toLowerCase(),t.id);for(let o of t.spacing){if(o.tokenReference){let r=o.tokenReference.replace(/^\[\w+\]\s*/,"").toLowerCase();this.addToIndex(this.tokenIndex.byPath,r,t.id)}this.addToIndex(this.tokenIndex.byValue,`${o.value}${o.unit}`,t.id)}for(let o of t.effects)o.tokenReference&&this.addToIndex(this.tokenIndex.byPath,o.tokenReference.toLowerCase(),t.id);for(let o of t.typography)o.tokenReference&&this.addToIndex(this.tokenIndex.byPath,o.tokenReference.toLowerCase(),t.id);if(t.children)for(let o of t.children)n(o)};for(let t of e)n(t)}addToIndex(e,n,t){e.has(n)||e.set(n,new Set),e.get(n).add(t)}getComponentsByTokenPath(e){let n=e.toLowerCase(),t=this.tokenIndex.byPath.get(n);if(t)return Array.from(t);let o=new Set,r=Array.from(this.tokenIndex.byPath.entries());for(let[i,a]of r)(i.includes(n)||n.includes(i))&&a.forEach(s=>o.add(s));return Array.from(o)}getComponentsByTokenValue(e){let n=e.toLowerCase();return Array.from(this.tokenIndex.byValue.get(n)||[])}yieldToMain(){return new Promise(e=>setTimeout(e,0))}getFromCache(e){let n=this.cache.get(e);return n&&Date.now()-n.timestamp<this.cacheMaxAge?n.components:null}rgbaToColor(e,n){let t=Math.round(e.r*255),o=Math.round(e.g*255),r=Math.round(e.b*255),i=`#${[t,o,r].map(s=>s.toString(16).padStart(2,"0")).join("")}`,a=`rgba(${t}, ${o}, ${r}, ${n.toFixed(2)})`;return{hex:i,rgba:a}}parseFontWeight(e){let n={thin:100,extralight:200,light:300,regular:400,medium:500,semibold:600,bold:700,extrabold:800,black:900},t=e.toLowerCase();for(let[r,i]of Object.entries(n))if(t.includes(r))return i;let o=e.match(/(\d+)/);return o?parseInt(o[1],10):400}async scanAllComponents(){this.errors=[];let e=[],n=0,t=figma.root.children;for(let o of t)if(o.type==="PAGE"){let r=o.findAll(i=>i.type==="COMPONENT"||i.type==="COMPONENT_SET");for(let i of r)try{let a=await this.extractComponentPropertiesOptimized(i,o.name,"all",!0,3,0);a&&e.push(a)}catch(a){this.errors.push({componentId:i.id,componentName:i.name,error:a instanceof Error?a.message:"Unknown error"})}}return{components:e,totalComponents:e.length,totalInstances:n,pagesScanned:t.length,errors:this.errors}}async scanFilteredPages(e){this.errors=[];let n=[],t=0,o=figma.root.children,r=e.map(a=>a.toLowerCase().trim()),i=o.filter(a=>a.type==="PAGE"&&r.includes(a.name.toLowerCase().trim()));for(let a of i)if(a.type==="PAGE"){let s=a.findAll(p=>p.type==="COMPONENT"||p.type==="COMPONENT_SET");for(let p of s)try{let f=await this.extractComponentPropertiesOptimized(p,a.name,"all",!0,3,0);f&&n.push(f)}catch(f){this.errors.push({componentId:p.id,componentName:p.name,error:f instanceof Error?f.message:"Unknown error"})}}return{components:n,totalComponents:n.length,totalInstances:t,pagesScanned:i.length,errors:this.errors}}async scanCurrentPage(){this.errors=[];let e=[],n=figma.currentPage,t=n.findAll(o=>o.type==="COMPONENT"||o.type==="COMPONENT_SET");for(let o of t)try{let r=await this.extractComponentPropertiesOptimized(o,n.name,"all",!0,3,0);r&&e.push(r)}catch(r){this.errors.push({componentId:o.id,componentName:o.name,error:r instanceof Error?r.message:"Unknown error"})}return{components:e,totalComponents:e.length,totalInstances:0,pagesScanned:1,errors:this.errors}}async scanNodes(e){this.errors=[];let n=[],t=figma.currentPage;for(let o of e){if("findAll"in o&&typeof o.findAll=="function"){let r=o.findAll(i=>i.type==="COMPONENT"||i.type==="COMPONENT_SET");for(let i of r)try{let a=await this.extractComponentPropertiesOptimized(i,t.name,"all",!0,3,0);a&&n.push(a)}catch(a){this.errors.push({componentId:i.id,componentName:i.name,error:a instanceof Error?a.message:"Unknown error"})}}if(o.type==="COMPONENT"||o.type==="COMPONENT_SET")try{let r=await this.extractComponentPropertiesOptimized(o,t.name,"all",!0,3,0);r&&!n.find(i=>i.id===r.id)&&n.push(r)}catch(r){this.errors.push({componentId:o.id,componentName:o.name,error:r instanceof Error?r.message:"Unknown error"})}}return{components:n,totalComponents:n.length,totalInstances:0,pagesScanned:1,errors:this.errors}}getComponentUsageStats(e){let n=new Set,t=0;for(let o of figma.root.children)if(o.type==="PAGE"){let r=o.findAll(i=>{var a;return i.type==="INSTANCE"&&((a=i.mainComponent)==null?void 0:a.id)===e});r.length>0&&(t+=r.length,n.add(o.name))}return{instances:t,pages:Array.from(n)}}}});var fe,ve=Y(()=>{"use strict";fe=class{constructor(){D(this,"MIN_CONFIDENCE_THRESHOLD",.85)}matchTokenToComponents(e,n){let t=[];for(let o of n.components){let i=this.matchComponentRecursively(e,o).filter(a=>a.confidence>=this.MIN_CONFIDENCE_THRESHOLD);if(i.length>0){let a=i.reduce((s,p)=>s+p.confidence,0)/i.length;t.push({component:o,matches:i,confidence:a})}}return t.sort((o,r)=>r.confidence-o.confidence),{token:e,matchingComponents:t,totalMatches:t.length,totalComponentsScanned:n.totalComponents}}matchComponentRecursively(e,n){let t=[];switch(e.type){case"color":t.push(...this.matchColor(e,n));break;case"fontFamily":case"fontWeight":case"typography":t.push(...this.matchTypography(e,n));break;case"dimension":t.push(...this.matchSpacing(e,n));break;case"shadow":t.push(...this.matchEffects(e,n));break;case"borderRadius":t.push(...this.matchSpacing(e,n,"borderRadius"));break;case"borderWidth":t.push(...this.matchSpacing(e,n,"borderWidth"));break;case"border":t.push(...this.matchBorder(e,n));break;case"composition":t.push(...this.matchComposition(e,n));break;default:t.push(...this.matchByValue(e,n)),this.looksLikeSpacingToken(e)&&t.push(...this.matchSpacing(e,n)),this.looksLikeBorderRadiusToken(e)&&t.push(...this.matchSpacing(e,n,"borderRadius")),this.looksLikeBorderToken(e)&&t.push(...this.matchSpacing(e,n,"borderWidth")),this.looksLikeEffectToken(e)&&t.push(...this.matchEffects(e,n))}if(t.length>0&&n.mainComponentId&&t.forEach(o=>{o.nestedMainComponentId||(o.nestedMainComponentId=n.mainComponentId)}),n.children&&n.children.length>0)for(let o of n.children){let r=this.matchComponentRecursively(e,o);for(let i of r)t.push(ne(te({},i),{property:`${o.name} \u2192 ${i.property}`}))}return t}matchColor(e,n){let t=[],o=e.path.join("."),r=this.normalizeColor(e.value);for(let s of n.colors)if(s.tokenReference){let p=s.tokenReference.trim();p=p.replace(/^["']|["']$/g,""),p=p.replace(/^[{]|[}]$/g,""),p=p.replace(/^\$/,"");let f=p.toLowerCase(),c=o.toLowerCase();f===c?t.push({property:`${s.type} color (token ref)`,propertyType:"color",matchedValue:`${s.hex} \u2190 ${s.tokenReference}`,tokenValue:o,confidence:1}):(f.endsWith("."+c)||f===c||c.endsWith("."+f)||c===f)&&t.push({property:`${s.type} color (token ref)`,propertyType:"color",matchedValue:`${s.hex} \u2190 ${s.tokenReference}`,tokenValue:o,confidence:.9})}let i=t.filter(s=>s.confidence>=.9);if(i.length>0)return i;let a=this.extractTokenReference(e.value);if(a){let s=a.toLowerCase();for(let p of n.colors)if(p.tokenReference){let c=p.tokenReference.trim().replace(/^["']|["']$/g,"").replace(/^[{]|[}]$/g,"").replace(/^\$/,"").toLowerCase();(c===s||c.endsWith("."+s)||s.endsWith("."+c))&&t.push({property:`${p.type} color (via ${o})`,propertyType:"color",matchedValue:`${p.hex} \u2190 ${p.tokenReference}`,tokenValue:`${o} \u2192 ${e.value}`,confidence:.95})}if(t.length>0)return t}if(r)for(let s of n.colors){let p=this.normalizeColor(s.hex);p&&r===p&&t.push({property:`${s.type} color (value match)`,propertyType:"color",matchedValue:`${s.hex}`,tokenValue:`${o} = ${e.value}`,confidence:.7})}return t}matchTypography(e,n){let t=[],o=e.path.join(".");for(let r of n.typography){let i=0,a="",s="value";if(r.tokenReference){let f=r.tokenReference.replace(/[{}]/g,"").replace(/^\$/,"").toLowerCase().replace(/\./g,"."),c=o.toLowerCase();f===c?(i=1,a=`${r.fontFamily} (ref: ${r.tokenReference})`,s="reference"):(f.includes(c)||c.includes(f))&&(i=.8,a=`${r.fontFamily} (ref: ${r.tokenReference})`,s="reference")}if(i===0){if(e.type==="fontFamily"){let p=String(e.value).toLowerCase().trim(),f=r.fontFamily.toLowerCase().trim();p===f&&(i=.9,a=r.fontFamily)}else if(e.type==="fontWeight"){let p=this.normalizeFontWeight(e.value),f=r.fontWeight;p===f&&(i=.9,a=String(f))}else if(e.type==="typography"&&typeof e.value=="object"&&e.value!==null){let p=e.value,f=this.extractTokenReference(p.fontFamily),c=this.extractTokenReference(p.fontSize),g=this.extractTokenReference(p.fontWeight),u=this.extractTokenReference(p.lineHeight);if(r.tokenReference){let $=r.tokenReference.replace(/[{}]/g,"").replace(/^\$/,"").toLowerCase(),R=[f,c,g,u].filter(Boolean);for(let T of R){if(!T)continue;let P=T.toLowerCase();if($===P||$.endsWith("."+P)||P.endsWith("."+$)){i=.95,a=`${r.fontFamily} (via ${o})`,s="reference";break}}}if(i===0){let $=!1,R=0,T=[];if(p.fontFamily&&!p.fontFamily.toString().includes("{")){let P=String(p.fontFamily).toLowerCase().trim(),h=r.fontFamily.toLowerCase().trim();P===h&&($=!0,R+=.4,T.push(`fontFamily: ${r.fontFamily}`))}if(p.fontSize&&!String(p.fontSize).includes("{")){let P=Number(p.fontSize),h=r.fontSize;!isNaN(P)&&Math.abs(P-h)<.5&&($=!0,R+=.3,T.push(`fontSize: ${h}`))}p.fontWeight&&!String(p.fontWeight).includes("{")&&this.normalizeFontWeight(p.fontWeight)===r.fontWeight&&($=!0,R+=.3,T.push(`fontWeight: ${r.fontWeight}`)),$&&(i=Math.min(R,1),a=T.join(", "))}}}i>0&&t.push({property:`typography${s==="reference"?" (token ref)":""}`,propertyType:"typography",matchedValue:a,tokenValue:typeof e.value=="object"?JSON.stringify(e.value):String(e.value),confidence:i})}return t}matchSpacing(e,n,t){let o=[],r=e.path.join("."),i=this.normalizeDimension(e.value),a=t?n.spacing.filter(f=>f.type===t):n.spacing;for(let f of a)if(f.tokenReference){let c=f.tokenReference.trim();c=c.replace(/^["']|["']$/g,""),c=c.replace(/^[{]|[}]$/g,""),c=c.replace(/^\$/,""),c=c.replace(/^\[\w+\]\s*/,"");let g=c.toLowerCase(),u=r.toLowerCase(),$=this.formatSpacingType(f.type);g===u?o.push({property:`${$} (token ref)`,propertyType:"spacing",matchedValue:`${f.value}${f.unit} \u2190 ${f.tokenReference}`,tokenValue:r,confidence:1}):(g.endsWith("."+u)||g===u||u.endsWith("."+g)||u===g)&&o.push({property:`${$} (token ref)`,propertyType:"spacing",matchedValue:`${f.value}${f.unit} \u2190 ${f.tokenReference}`,tokenValue:r,confidence:.9})}let s=o.filter(f=>f.confidence>=.9);if(s.length>0)return s;let p=this.extractTokenReference(e.value);if(p){let f=p.toLowerCase();for(let c of a)if(c.tokenReference){let u=c.tokenReference.trim().replace(/^["']|["']$/g,"").replace(/^[{]|[}]$/g,"").replace(/^\$/,"").replace(/^\[\w+\]\s*/,"").toLowerCase(),$=this.formatSpacingType(c.type);(u===f||u.endsWith("."+f)||f.endsWith("."+u))&&o.push({property:`${$} (via ${r})`,propertyType:"spacing",matchedValue:`${c.value}${c.unit} \u2190 ${c.tokenReference}`,tokenValue:`${r} \u2192 ${e.value}`,confidence:.95})}if(o.length>0)return o}if(i!==null){for(let f of a)if(Math.abs(f.value-i)<.5){let c=this.formatSpacingType(f.type);o.push({property:`${c} (value match)`,propertyType:"spacing",matchedValue:`${f.value}${f.unit}`,tokenValue:`${r} = ${e.value}`,confidence:.6})}}return o}formatSpacingType(e){switch(e){case"borderRadius":return"border-radius";case"borderWidth":return"border-width";case"gap":return"gap/spacing";default:return e}}matchEffects(e,n){let t=[],o=e.path.join("."),r=o.toLowerCase();for(let s of n.effects)if(s.tokenReference){let p=s.tokenReference.trim();p=p.replace(/^["']|["']$/g,""),p=p.replace(/^[{]|[}]$/g,""),p=p.replace(/^\$/,"");let f=p.toLowerCase();f===r?t.push({property:`${s.type} (token ref)`,propertyType:"effect",matchedValue:`${s.type} \u2190 ${s.tokenReference}`,tokenValue:o,confidence:1}):(f.endsWith("."+r)||r.endsWith("."+f))&&t.push({property:`${s.type} (token ref)`,propertyType:"effect",matchedValue:`${s.type} \u2190 ${s.tokenReference}`,tokenValue:o,confidence:.9})}if(typeof e.value=="object"&&e.value!==null){let s=e.value;for(let[p,f]of Object.entries(s)){let c=this.extractTokenReference(f);if(!c)continue;let g=c.toLowerCase();for(let u of n.effects)if(u.tokenReference){let R=u.tokenReference.trim().replace(/^["']|["']$/g,"").replace(/^[{]|[}]$/g,"").replace(/^\$/,"").toLowerCase();(R===g||R.endsWith("."+g)||g.endsWith("."+R))&&t.push({property:`${u.type} (via ${o}.${p})`,propertyType:"effect",matchedValue:`${u.type} \u2190 ${u.tokenReference}`,tokenValue:`${o} \u2192 ${p}: ${f}`,confidence:.95})}if(p.toLowerCase().includes("color")){for(let u of n.colors)if(u.tokenReference){let R=u.tokenReference.trim().replace(/^["']|["']$/g,"").replace(/^[{]|[}]$/g,"").replace(/^\$/,"").toLowerCase();(R===g||R.endsWith("."+g)||g.endsWith("."+R))&&t.push({property:`shadow color (via ${o}.${p})`,propertyType:"color",matchedValue:`${u.hex} \u2190 ${u.tokenReference}`,tokenValue:`${o} \u2192 ${p}: ${f}`,confidence:.95})}}}}let i=this.deduplicateMatches(t),a=i.filter(s=>s.confidence>=.9);return a.length>0?a:i}extractTokenReference(e){if(typeof e!="string")return null;let t=e.trim().match(/^[{$]?([^{}$]+)[}]?$/);return t?t[1].trim():null}matchBorder(e,n){var f;let t=[],o=e.path.join("."),r=e.value;if(typeof r=="object"&&r!==null&&("color"in r||"width"in r||"style"in r)){let c=r,g=this.extractTokenReference(c.color),u=this.extractTokenReference(c.width);console.log(`[Border Composite] Token: ${o}`),console.log("  - Border value:",c),console.log(`  - Extracted colorRef: "${g}"`),console.log(`  - Extracted widthRef: "${u}"`),console.log(`  - Component ID: ${n.id}, Name: ${n.name}`),console.log("  - Component stroke colors:",n.colors.filter(h=>h.type==="stroke").map(h=>({hex:h.hex,tokenRef:h.tokenReference}))),console.log("  - Component borderWidths:",n.spacing.filter(h=>h.type==="borderWidth").map(h=>({value:h.value,unit:h.unit,tokenRef:h.tokenReference}))),console.log(`  - Component has ${((f=n.children)==null?void 0:f.length)||0} children`);let $=n.colors.filter(h=>h.type==="stroke"),R=n.spacing.filter(h=>h.type==="borderWidth");if($.length===0&&R.length===0&&console.log(`  \u26A0\uFE0F WARNING: Component "${n.name}" has NO strokes or border widths at all!`),g){let h=g.toLowerCase();console.log(`  - Attempting to match colorRef: "${h}"`);for(let x of n.colors.filter(H=>H.type==="stroke"))if(x.tokenReference){let O=x.tokenReference.trim().replace(/^["']|["']$/g,"").replace(/^[{]|[}]$/g,"").replace(/^\$/,"").toLowerCase();console.log(`    - Comparing against component stroke tokenRef: "${O}"`),(O===h||O.endsWith("."+h)||h.endsWith("."+O))&&(console.log("    \u2713 MATCH FOUND!"),t.push({property:`stroke color (via ${o})`,propertyType:"color",matchedValue:`${x.hex} \u2190 ${x.tokenReference}`,tokenValue:`${o} \u2192 color: ${c.color}`,confidence:.95}))}}if(u){let h=u.toLowerCase();console.log(`  - Attempting to match widthRef: "${h}"`);for(let x of n.spacing.filter(H=>H.type==="borderWidth"))if(x.tokenReference){let O=x.tokenReference.trim().replace(/^["']|["']$/g,"").replace(/^[{]|[}]$/g,"").replace(/^\$/,"").toLowerCase();console.log(`    - Comparing against component borderWidth tokenRef: "${O}"`),(O===h||O.endsWith("."+h)||h.endsWith("."+O))&&(console.log("    \u2713 MATCH FOUND!"),t.push({property:`border-width (via ${o})`,propertyType:"spacing",matchedValue:`${x.value}${x.unit} \u2190 ${x.tokenReference}`,tokenValue:`${o} \u2192 width: ${c.width}`,confidence:.95}))}}if(t.length===0&&g&&u){console.log("  - No reference matches found, attempting VALUE-BASED matching...");let h=e.value.color;if(h&&!h.startsWith("{")){let H=this.normalizeColor(h);for(let O of n.colors.filter(X=>X.type==="stroke")){let X=this.normalizeColor(O.hex);H===X&&(console.log(`    \u2713 VALUE MATCH for stroke color: ${O.hex}`),t.push({property:`stroke color (value match via ${o})`,propertyType:"color",matchedValue:`${O.hex}`,tokenValue:`${o} \u2192 color value: ${h}`,confidence:.75}))}}let x=e.value.width;if(x&&!x.startsWith("{")){let H=this.normalizeDimension(x);for(let O of n.spacing.filter(X=>X.type==="borderWidth"))H!==null&&Math.abs(O.value-H)<.5&&(console.log(`    \u2713 VALUE MATCH for border width: ${O.value}${O.unit}`),t.push({property:`border-width (value match via ${o})`,propertyType:"spacing",matchedValue:`${O.value}${O.unit}`,tokenValue:`${o} \u2192 width value: ${x}`,confidence:.75}))}}let T=t.some(h=>h.property.includes("stroke color")),P=t.some(h=>h.property.includes("border-width"));T&&P&&t.forEach(h=>{h.confidence=Math.min(1,h.confidence+.05),h.property=h.property.replace("(via ","(full match via ")}),console.log(`  - Found ${t.length} matches for composite border`),t.length>0&&t.forEach(h=>console.log(`    * ${h.property}: ${h.matchedValue} (confidence: ${h.confidence})`))}else console.log(`[Border Token] "${o}" is NOT a composite (value type: ${typeof r})`);let a=o.toLowerCase();for(let c of n.colors.filter(g=>g.type==="stroke"))if(c.tokenReference){let u=c.tokenReference.trim().replace(/^["']|["']$/g,"").replace(/^[{]|[}]$/g,"").replace(/^\$/,"").toLowerCase();u===a?t.push({property:"stroke color (direct border ref)",propertyType:"color",matchedValue:`${c.hex} \u2190 ${c.tokenReference}`,tokenValue:o,confidence:1}):(u.endsWith("."+a)||a.endsWith("."+u))&&t.push({property:"stroke color (direct border ref)",propertyType:"color",matchedValue:`${c.hex} \u2190 ${c.tokenReference}`,tokenValue:o,confidence:.9})}for(let c of n.spacing.filter(g=>g.type==="borderWidth"))if(c.tokenReference){let u=c.tokenReference.trim().replace(/^["']|["']$/g,"").replace(/^[{]|[}]$/g,"").replace(/^\$/,"").toLowerCase();u===a?t.push({property:"border-width (direct ref)",propertyType:"spacing",matchedValue:`${c.value}${c.unit} \u2190 ${c.tokenReference}`,tokenValue:o,confidence:1}):(u.endsWith("."+a)||a.endsWith("."+u))&&t.push({property:"border-width (direct ref)",propertyType:"spacing",matchedValue:`${c.value}${c.unit} \u2190 ${c.tokenReference}`,tokenValue:o,confidence:.9})}this.looksLikeBorderRadiusToken(e)&&t.push(...this.matchSpacing(e,n,"borderRadius")),this.looksLikeBorderToken(e)&&!this.looksLikeBorderRadiusToken(e)&&t.push(...this.matchSpacing(e,n,"borderWidth"));let s=this.deduplicateMatches(t),p=s.filter(c=>c.confidence>=.85);return console.log(`[Border Matching] Final results for "${o}":`),console.log(`  - Total matches found: ${t.length}`),console.log(`  - Unique matches: ${s.length}`),console.log(`  - High confidence (>=0.85): ${p.length}`),console.log(`  - Returning: ${p.length>0?p.length:s.length} matches`),p.length>0?p:s}matchComposition(e,n){let t=[],o=e.path.join("."),r=e.value;if(typeof r=="object"&&r!==null){let i=r;for(let[a,s]of Object.entries(i)){let p=this.extractTokenReference(s);if(p){let f=p.toLowerCase();for(let c of n.colors)if(c.tokenReference){let u=c.tokenReference.trim().replace(/^["']|["']$/g,"").replace(/^[{]|[}]$/g,"").replace(/^\$/,"").toLowerCase();(u===f||u.endsWith("."+f)||f.endsWith("."+u))&&t.push({property:`${c.type} color (via ${o}.${a})`,propertyType:"color",matchedValue:`${c.hex} \u2190 ${c.tokenReference}`,tokenValue:`${o} \u2192 ${a}: ${s}`,confidence:.95})}for(let c of n.spacing)if(c.tokenReference){let u=c.tokenReference.trim().replace(/^["']|["']$/g,"").replace(/^[{]|[}]$/g,"").replace(/^\$/,"").toLowerCase();(u===f||u.endsWith("."+f)||f.endsWith("."+u))&&t.push({property:`${c.type} (via ${o}.${a})`,propertyType:"spacing",matchedValue:`${c.value}${c.unit} \u2190 ${c.tokenReference}`,tokenValue:`${o} \u2192 ${a}: ${s}`,confidence:.95})}for(let c of n.effects)if(c.tokenReference){let u=c.tokenReference.trim().replace(/^["']|["']$/g,"").replace(/^[{]|[}]$/g,"").replace(/^\$/,"").toLowerCase();(u===f||u.endsWith("."+f)||f.endsWith("."+u))&&t.push({property:`${c.type} (via ${o}.${a})`,propertyType:"effect",matchedValue:`${c.type} \u2190 ${c.tokenReference}`,tokenValue:`${o} \u2192 ${a}: ${s}`,confidence:.95})}}else if(this.looksLikeColor(s))for(let f of n.colors){let c=this.normalizeColor(s),g=this.normalizeColor(f.hex);c===g&&t.push({property:`${f.type} color (composition.${a} literal)`,propertyType:"color",matchedValue:`${f.hex}`,tokenValue:`${o}.${a}`,confidence:.7})}}}for(let i of n.spacing)if(i.tokenReference){let s=i.tokenReference.trim().replace(/^["']|["']$/g,"").replace(/^[{]|[}]$/g,"").replace(/^\$/,"").toLowerCase(),p=o.toLowerCase();s===p?t.push({property:`${i.type} (composition token ref)`,propertyType:"spacing",matchedValue:`${i.value}${i.unit} \u2190 ${i.tokenReference}`,tokenValue:o,confidence:1}):(s.endsWith("."+p)||p.endsWith("."+s))&&t.push({property:`${i.type} (composition token ref)`,propertyType:"spacing",matchedValue:`${i.value}${i.unit} \u2190 ${i.tokenReference}`,tokenValue:o,confidence:.9})}for(let i of n.colors)if(i.tokenReference){let s=i.tokenReference.trim().replace(/^["']|["']$/g,"").replace(/^[{]|[}]$/g,"").replace(/^\$/,"").toLowerCase(),p=o.toLowerCase();s===p?t.push({property:`${i.type} color (composition token ref)`,propertyType:"color",matchedValue:`${i.hex} \u2190 ${i.tokenReference}`,tokenValue:o,confidence:1}):(s.endsWith("."+p)||p.endsWith("."+s))&&t.push({property:`${i.type} color (composition token ref)`,propertyType:"color",matchedValue:`${i.hex} \u2190 ${i.tokenReference}`,tokenValue:o,confidence:.9})}return this.deduplicateMatches(t)}deduplicateMatches(e){let n=new Set;return e.filter(t=>{let o=`${t.property}|${t.matchedValue}`;return n.has(o)?!1:(n.add(o),!0)})}matchByValue(e,n){let t=[];return this.looksLikeColor(e.value)&&t.push(...this.matchColor(e,n)),this.looksLikeDimension(e.value)&&t.push(...this.matchSpacing(e,n)),t}normalizeColor(e){if(typeof e!="string")return null;let n=e.trim().toLowerCase();return n.match(/^#[0-9a-f]{3,8}$/)||n.match(/^rgba?\(/)||n.match(/^hsla?\(/)?n:null}normalizeHex(e){if(!e)return null;let n=e.trim().toLowerCase().replace("#","");return n.length===3&&(n=n.split("").map(t=>t+t).join("")),n.length===6?n:null}normalizeRgba(e){if(!e)return null;let n=e.match(/rgba?\(([^)]+)\)/i);return n?n[1].trim():null}parseRgba(e){let n=this.normalizeRgba(e);if(!n)return null;let t=n.split(",").map(o=>parseFloat(o.trim()));return t.length>=3?{r:t[0],g:t[1],b:t[2],a:t.length>3?t[3]:1}:null}rgbaToString(e){return`rgba(${Math.round(e.r)}, ${Math.round(e.g)}, ${Math.round(e.b)}, ${e.a.toFixed(2)})`}colorsMatch(e,n){let t=this.parseRgba(e),o=this.parseRgba(n);if(t&&o)return Math.abs(t.r-o.r)<2&&Math.abs(t.g-o.g)<2&&Math.abs(t.b-o.b)<2&&Math.abs(t.a-o.a)<.01;let r=this.normalizeHex(e),i=this.normalizeHex(n);return r!==null&&i!==null&&r===i}normalizeFontWeight(e){if(typeof e=="number")return e;if(typeof e!="string")return 400;let n={thin:100,extralight:200,light:300,regular:400,normal:400,medium:500,semibold:600,bold:700,extrabold:800,black:900},t=e.toLowerCase().trim();if(n[t])return n[t];let o=parseInt(e,10);return isNaN(o)?400:o}normalizeDimension(e){if(typeof e=="number")return e;if(typeof e!="string")return null;let n=e.replace(/px|rem|em|pt|pc|in|cm|mm|q|vh|vw|vmin|vmax|%/g,"").trim(),t=parseFloat(n);return isNaN(t)?null:t}looksLikeColor(e){if(typeof e!="string")return!1;let n=e.trim().toLowerCase();return n.match(/^#[0-9a-f]{3,8}$/)!==null||n.match(/^rgba?\(/)!==null||n.match(/^hsla?\(/)!==null}looksLikeDimension(e){return typeof e=="number"?!0:typeof e!="string"?!1:/^-?\d+(\.\d+)?(px|rem|em|pt|pc|in|cm|mm|q|vh|vw|vmin|vmax|%)$/.test(e.trim())}looksLikeSpacingToken(e){let n=e.path.join(".").toLowerCase();return["spacing","space","size","sizing","dimension","width","height","padding","margin","gap","radius","border","inset","offset","corner","round","stroke","weight","1x","2x","3x","4x","5x","6x","8x","10x","12x","16x"].some(o=>n.includes(o))}looksLikeBorderRadiusToken(e){let n=e.path.join(".").toLowerCase();return["radius","corner","round","rounded","borderradius"].some(o=>n.includes(o))}looksLikeBorderToken(e){let n=e.path.join(".").toLowerCase(),t=["border","stroke","outline","line"];return n.includes("radius")?!1:t.some(o=>n.includes(o))}looksLikeEffectToken(e){let n=e.path.join(".").toLowerCase();return["shadow","effect","blur","elevation","drop"].some(o=>n.includes(o))}}});function G(C,e){let n=`${Pe}`;return Pe+=1,re[n]={handler:e,name:C},function(){delete re[n]}}function Se(C,e){let n=!1;for(let t in re)re[t].name===C&&(re[t].handler.apply(null,e),n=!0);if(n===!1)throw new Error(`No event handler with name \`${C}\``)}var re,Pe,b,Ee=Y(()=>{re={},Pe=0;b=typeof window=="undefined"?function(C,...e){figma.ui.postMessage([C,...e])}:function(C,...e){window.parent.postMessage({pluginMessage:[C,...e]},"*")};typeof window=="undefined"?figma.ui.onmessage=function(C){if(!Array.isArray(C))return;let[e,...n]=C;typeof e=="string"&&Se(e,n)}:window.onmessage=function(C){if(typeof C.data.pluginMessage=="undefined")return;let e=C.data.pluginMessage;if(!Array.isArray(e))return;let[n,...t]=C.data.pluginMessage;typeof n=="string"&&Se(n,t)}});function ye(C,e){if(typeof __html__=="undefined")throw new Error("No UI defined");let n=`<div id="create-figma-plugin"></div><script>document.body.classList.add('theme-${figma.editorType}');const __FIGMA_COMMAND__='${typeof figma.command=="undefined"?"":figma.command}';const __SHOW_UI_DATA__=${JSON.stringify(typeof e=="undefined"?{}:e)};${__html__}</script>`;figma.showUI(n,ne(te({},C),{themeColors:typeof C.themeColors=="undefined"?!0:C.themeColors}))}var xe=Y(()=>{});var Ae=Y(()=>{Ee();xe()});var Oe={};Ke(Oe,{default:()=>qe});function qe(){ye({width:400,height:550},{resizable:!0}),figma.loadAllPagesAsync().catch(d=>{console.error("Error loading pages on startup:",d)});let C=new ae,e=new le,n=new pe,t=new fe,o=!0,r=null;function i(){let d=figma.root.children.filter(y=>y.type==="PAGE").map(y=>y.id).join(",");if(r===null)return r=d,!1;let l=d!==r;return r=d,l}async function a(){i()&&(console.log("[Cache] Document changed, clearing component cache"),await n.clearCache())}let s=10*60*1e3;function p(d,l,y,m){return`tokenCache_${d}_${l}_${y}_${m||"root"}`}async function f(d){try{let l=await figma.clientStorage.getAsync(d);if(l&&l.sha&&l.tokens&&Date.now()-l.timestamp<s)return l}catch(l){console.error("Error reading token cache:",l)}return null}async function c(d,l,y,m){try{let N={sha:l,tokens:y,metadata:m,timestamp:Date.now()};await figma.clientStorage.setAsync(d,N)}catch(N){console.error("Error saving token cache:",N)}}async function g(d){try{await figma.clientStorage.deleteAsync(d)}catch(l){console.error("Error clearing token cache:",l)}}async function u(){try{return await figma.clientStorage.getAsync("repoConfig")||null}catch(d){return console.error("Error loading config:",d),null}}async function $(d){try{await figma.clientStorage.setAsync("repoConfig",d)}catch(l){console.error("Error saving config:",l)}}async function R(){try{await figma.clientStorage.deleteAsync("repoConfig")}catch(d){console.error("Error clearing config:",d)}}G("load-config",async()=>{let d=await u();b("config-loaded",d)}),G("clear-config",async()=>{await R(),b("config-loaded",null)}),G("test-connection",async d=>{let l=C.parseGitHubUrl(d.repoUrl);if(!l){b("connection-result",{success:!1,error:"Invalid GitHub URL format"});return}try{b("connection-progress",{message:"Connecting to GitHub..."});let y=await C.fetchBranches(l.owner,l.repo,d.token),m=0,N=[];if(y.length>0)try{let E=y[0];b("connection-progress",{message:"Scanning for token files..."});let k=await C.detectTokenFiles(l.owner,l.repo,E,d.token,d.filePath||"");m=k.length,N=k.slice(0,5)}catch(E){console.error("Token detection failed:",E)}b("connection-result",{success:!0,branches:y.slice(0,10),owner:l.owner,repo:l.repo,fileCount:m,tokenCount:m,sampleFiles:N.map(E=>E.length>50?E.substring(0,47)+"...":E)})}catch(y){b("connection-result",{success:!1,error:y instanceof Error?y.message:"Connection failed"})}}),G("save-config",async d=>{await $(d),b("config-saved",{success:!0})});let T=/^#[0-9A-Fa-f]{3,8}$/,P=/^rgba?\(/,h=/^hsla?\(/,x=/^\d+(\.\d+)?(ms|s)$/,H=/^-?\d+(\.\d+)?(px|rem|em|pt|pc|in|cm|mm|q|vh|vw|vmin|vmax|%)$/,O=/\d+x$/,X=(d,l)=>{if(typeof d=="string")return T.test(d)||P.test(d)||h.test(d)||l.includes("color")||l.includes("colour")?"color":x.test(d)||l.includes("duration")?"duration":l.includes("radius")||l.includes("corner")||l.includes("rounded")||l.includes("borderradius")?"borderRadius":l.includes("border")&&(l.includes("width")||l.includes("weight"))||l.includes("stroke")&&l.includes("weight")?"borderWidth":H.test(d)||l.includes("size")||l.includes("spacing")||l.includes("space")||l.includes("gap")||l.includes("padding")||l.includes("margin")||l.includes("sizing")||l.includes("dimension")||O.test(l)?"dimension":l.includes("font")||l.includes("typography")||l.includes("text")?l.includes("weight")?"fontWeight":l.includes("family")?"fontFamily":"typography":l.includes("shadow")||l.includes("elevation")?"shadow":l.includes("border")&&!l.includes("radius")?"border":"string";if(typeof d=="number")return l.includes("radius")||l.includes("corner")||l.includes("rounded")?"borderRadius":l.includes("border")&&l.includes("width")||l.includes("stroke")&&l.includes("weight")?"borderWidth":l.includes("weight")&&l.includes("font")?"fontWeight":l.includes("opacity")||l.includes("alpha")||l.includes("z-index")||l.includes("zindex")?"number":l.includes("spacing")||l.includes("space")||l.includes("gap")||l.includes("padding")||l.includes("margin")||l.includes("size")||O.test(l)?"dimension":"number";if(typeof d=="object"&&d!==null&&!Array.isArray(d)){let y=Object.keys(d).map(m=>m.toLowerCase());if(l.includes("shadow")||l.includes("elevation")||y.some(m=>["blur","spread","offsetx","offsety"].includes(m)))return"shadow";if(l.includes("typography")||y.some(m=>["fontfamily","fontsize","fontweight","lineheight"].includes(m)))return"typography";if(l.includes("border")||y.includes("width")&&(y.includes("color")||y.includes("style"))||y.includes("color")&&y.includes("style"))return"border"}return"string"},Me=d=>d&&typeof d=="object"&&"$value"in d,Le=d=>{if(!d||typeof d!="object"||"$value"in d||!("value"in d))return!1;let l=d.value;if(typeof l=="string"||typeof l=="number"||typeof l=="boolean")return!0;if(typeof l=="object"&&l!==null){if("type"in d||"description"in d)return!0;let y=Object.keys(l);if(y.some(m=>["color","width","style"].includes(m.toLowerCase()))&&y.filter(N=>["color","width","style","bordercolor","borderwidth","borderstyle"].includes(N.toLowerCase())).length>=2||y.some(m=>["fontfamily","fontsize","fontweight","lineheight","letterspacing"].includes(m.toLowerCase()))||y.some(m=>["blur","spread","offsetx","offsety","x","y"].includes(m.toLowerCase()))&&y.some(m=>m.toLowerCase()==="color")||y.length<=6&&y.length>=2&&y.some(N=>{let E=l[N];return typeof E=="string"&&(E.startsWith("{")||E.startsWith("$"))}))return!0}return!1},Fe=(d,l)=>{if(!d||typeof d!="object"||Array.isArray(d)||"$value"in d||"value"in d)return!1;let m=Object.keys(d).map(W=>W.toLowerCase()),N=["fontfamily","fontsize","fontweight","lineheight","letterspacing","texttransform","textdecoration"];return!!(m.filter(W=>N.includes(W)).length>=2||m.includes("color")&&(m.includes("width")||m.includes("style"))||m.some(W=>["blur","spread"].includes(W))&&m.includes("color")&&m.some(W=>["x","y","offsetx","offsety"].includes(W)))},We=(d,l)=>!(typeof d!="string"&&typeof d!="number"&&typeof d!="boolean"||l.length<1),De=(d,l)=>{let y=[],m=[],N=(k,F)=>{let W=m[m.length-1]||"unnamed",I=m.join(".").toLowerCase(),L=F||X(k,I);y.push({name:W,path:m.slice(),type:L,sourceFile:l,value:k})},E=k=>{if(k==null)return;let F=m[m.length-1]||"";if(!(F.startsWith("$")&&F!=="$value"&&F!=="$type")){if(Me(k)){N(k.$value,k.$type);return}if(Le(k)){N(k.value,k.type);return}if(We(k,m)){N(k,void 0);return}if(Fe(k,m)){N(k,void 0);return}if(typeof k=="object"){let W=Array.isArray(k)?k.map((I,L)=>String(L)):Object.keys(k);for(let I of W){if(!Array.isArray(k)&&(I.startsWith("$")||I==="extensions"))continue;let L=Array.isArray(k)?k[parseInt(I)]:k[I];m.push(I),E(L),m.pop()}}}};return E(d),y},de=5,oe=100;G("fetch-tokens",async d=>{let l=C.parseGitHubUrl(d.repoUrl);if(!l){b("tokens-result",{success:!1,error:"Invalid GitHub URL format"});return}try{let y=d.filePath||"",m=p(l.owner,l.repo,d.branch,y);if(!d.forceRefresh){b("tokens-progress",{message:"Checking for cached tokens..."});let[M,_]=await Promise.all([C.getLatestCommitSha(l.owner,l.repo,d.branch,d.token),f(m)]);if(_&&M&&_.sha===M){b("tokens-progress",{message:"Using cached tokens (no changes detected)"});let v=_.tokens;for(let w=0;w<v.length;w+=oe){let S=v.slice(w,w+oe),z=w+oe>=v.length;b("tokens-chunk",{tokens:S,chunkIndex:Math.floor(w/oe),totalChunks:Math.ceil(v.length/oe),isLast:z})}b("tokens-result",{success:!0,tokens:v,metadata:ne(te({},_.metadata),{fromCache:!0,cacheAge:Date.now()-_.timestamp,errors:[]})});return}}b("tokens-progress",{message:"Scanning for token files..."});let N=await C.detectTokenFiles(l.owner,l.repo,d.branch,d.token,y);if(N.length===0){b("tokens-result",{success:!1,error:`No token files found${y?` in '${y}'`:" in repository"}. Looking for .json files (excluding config files).`});return}let E=[],k=[],F=0,W=0,I=[],L=[];b("tokens-progress",{message:`Fetching ${N.length} files...`});for(let M=0;M<N.length;M+=de){let _=N.slice(M,M+de),v=Math.min(M+de,N.length);b("tokens-progress",{message:`Fetching files ${M+1}-${v} of ${N.length}...`});let w=await Promise.all(_.map(async S=>{try{let z=await C.fetchFileContents(l.owner,l.repo,d.branch,d.token,S);if(!z.content)return{path:S,error:"Empty file content"};let V=C.decodeBase64Content(z.content);return{path:S,content:V}}catch(z){return{path:S,error:z instanceof Error?z.message:"Fetch failed"}}}));for(let S of w)"content"in S&&S.content?L.push({path:S.path,content:S.content}):"error"in S&&(k.push({file:S.path,message:S.error}),I.push({file:S.path,count:0}))}b("tokens-progress",{message:`Processing ${L.length} files...`});let B=[],J=0;for(let{path:M,content:_}of L)try{let v;try{v=JSON.parse(_)}catch(z){throw new Error(`JSON parse failed: ${z.message}`)}let w=De(v,M),S=w.length;W+=S,I.push({file:M,count:S}),S===0&&k.push({file:M,message:"No token values found in this file (checked $value, value, and primitives)"});for(let z of w){let V={name:z.name||"",path:z.path||"",type:z.type||"unknown",sourceFile:z.sourceFile||"",value:z.value};E.push(V),B.push(V),B.length>=oe&&(b("tokens-chunk",{tokens:B,chunkIndex:J++,isLast:!1}),B=[])}F++}catch(v){console.error(`Failed to parse ${M}:`,v),I.push({file:M,count:0}),k.push({file:M,message:v instanceof Error?v.message:"Failed to parse file"})}B.length>0&&b("tokens-chunk",{tokens:B,chunkIndex:J++,isLast:!0}),b("tokens-progress",{message:`Found ${W} tokens in ${F} files`});let Z=await C.getLatestCommitSha(l.owner,l.repo,d.branch,d.token);Z&&await c(m,Z,E,{totalTokens:W,filesProcessed:F,totalFiles:N.length,perFileCounts:I}),b("tokens-result",{success:!0,tokens:E,metadata:{totalTokens:W,filesProcessed:F,totalFiles:N.length,perFileCounts:I,errors:k,fromCache:!1}})}catch(y){b("tokens-result",{success:!1,error:y instanceof Error?y.message:"Failed to fetch tokens"})}}),G("detect-token-files",async d=>{let l=C.parseGitHubUrl(d.repoUrl);if(!l){b("token-files-result",{success:!1,error:"Invalid GitHub URL format"});return}try{let y=await C.detectTokenFiles(l.owner,l.repo,d.branch,d.token,d.directoryPath||"");b("token-files-result",{success:!0,files:y})}catch(y){b("token-files-result",{success:!1,error:y instanceof Error?y.message:"Failed to detect token files"})}}),G("scan-components",async d=>{try{let l=d.scanAll===!0;l?(b("scan-progress",{message:"Loading all pages..."}),await figma.loadAllPagesAsync(),b("scan-progress",{message:"Scanning all pages..."})):b("scan-progress",{message:"Scanning current page..."});let y=l?await e.scanAllComponents():await e.scanCurrentPage();b("scan-result",{success:!0,result:y})}catch(l){b("scan-result",{success:!1,error:l instanceof Error?l.message:"Failed to scan components"})}}),G("scan-components-for-token",async d=>{try{let{token:l,scanAll:y,scanSelection:m,pageFilter:N}=d,E=y===!0,k=m===!0,F=N&&N.length>0;if(!l){b("scan-result",{success:!1,error:"No token provided"});return}await a();let W=l.type||"all",I="Scanning for token matches...";E?(I=F?`Loading ${N.length} page(s)...`:"Loading all pages...",b("scan-progress",{message:I}),await figma.loadAllPagesAsync(),I=F?`Scanning ${N.join(", ")} for token matches...`:"Scanning all pages for token matches..."):k?I="Scanning selection for token matches...":I="Scanning current page for token matches...",b("scan-progress",{message:I});let L;if(o&&E){b("scan-progress",{message:"Scanning components (optimized)..."});let v={tokenType:W,useCache:!0,usePersistentCache:!0,chunkSize:100,maxDepth:3,includeChildren:!0,pageFilter:F?N:void 0,onProgress:w=>{let S=Math.round(w.currentPage/w.totalPages*100);b("scan-progress",{message:`Page ${w.currentPage}/${w.totalPages}: ${w.currentPageName} (${w.componentsFound} found)`,progress:S})}};L=await n.scanAllComponentsOptimized(v)}else if(b("scan-progress",{message:"Scanning components..."}),E)F?L=await e.scanFilteredPages(N):L=await e.scanAllComponents();else if(k){let v=figma.currentPage.selection;if(v.length===0){b("scan-result",{success:!1,error:"No selection found. Please select a frame or node to scan."});return}L=await e.scanNodes(v)}else L=await e.scanCurrentPage();b("scan-progress",{message:`Found ${L.totalComponents} components. Matching tokens...`});let B=t.matchTokenToComponents(l,L);b("scan-progress",{message:"Filtering nested duplicates..."});let J=v=>{if(!v.includes(" \u2192 "))return!0;let w=v.split(" \u2192 ");return w.length===2&&w[0].includes("=")?!0:(w.length>2,!1)},Z=new Set;for(let v of B.matchingComponents)v.matches.some(S=>J(S.property))&&v.component.mainComponentId&&Z.add(v.component.mainComponentId);let M=B.matchingComponents.filter(v=>v.matches.some(S=>J(S.property))?!0:v.matches.some(S=>J(S.property)?!1:!S.nestedMainComponentId||!Z.has(S.nestedMainComponentId)));b("scan-progress",{message:"Matching complete!"});let _={token:{name:l.name,path:l.path,type:l.type,value:l.value},matchingComponents:M.map(v=>({id:v.component.id,name:v.component.name,page:v.component.pageName,type:v.component.type,mainComponentName:v.component.mainComponentName,mainComponentId:v.component.mainComponentId,variantName:v.component.variantName,matches:v.matches.map(w=>`${w.property}: ${w.matchedValue}`),matchDetails:v.matches,confidence:v.confidence})),totalMatches:M.length,totalComponentsScanned:B.totalComponentsScanned};b("scan-result",{success:!0,result:_})}catch(l){b("scan-result",{success:!1,error:l instanceof Error?l.message:"Failed to scan components for token"})}}),G("get-component-usage",async d=>{try{let{componentId:l}=d,y=e.getComponentUsageStats(l);b("component-usage-result",{success:!0,stats:y})}catch(l){b("component-usage-result",{success:!1,error:l instanceof Error?l.message:"Failed to get usage stats"})}}),G("navigate-to-component",async d=>{try{let{componentId:l}=d,y=await figma.getNodeByIdAsync(l);if(y&&"type"in y){let m=ze(y);m&&m.type==="PAGE"&&m!==figma.currentPage&&await figma.setCurrentPageAsync(m),y.type!=="DOCUMENT"&&y.type!=="PAGE"?(figma.currentPage.selection=[y],figma.viewport.scrollAndZoomIntoView([y]),b("navigate-result",{success:!0})):b("navigate-result",{success:!1,error:"Cannot select document or page nodes"})}else b("navigate-result",{success:!1,error:"Node not found"})}catch(l){b("navigate-result",{success:!1,error:l instanceof Error?l.message:"Failed to navigate to component"})}});function ze(d){let l=d;for(;l&&l.type!=="PAGE";)l=l.parent;return l}async function Ze(d){let l=await figma.getNodeByIdAsync(d);if(!l)return null;if(l.type==="COMPONENT_SET"){let y=l,m=y.defaultVariant||y.children[0];if((m==null?void 0:m.type)==="COMPONENT")return m}return l.type==="COMPONENT"?l:l.type==="INSTANCE"?await l.getMainComponentAsync():null}G("create-component-collection",async d=>{try{let{token:l,groupedComponents:y,matchingComponents:m}=d,N=Object.entries(y||{});if(N.length===0&&(!m||m.length===0)){b("create-collection-result",{success:!1,error:"No components to collect"});return}let E=Array.isArray(l.path)?l.path.join("."):l.name,k=figma.createFrame();k.name=`Token Matches: ${E}`,k.layoutMode="VERTICAL",k.primaryAxisSizingMode="AUTO",k.counterAxisSizingMode="AUTO",k.paddingTop=32,k.paddingBottom=32,k.paddingLeft=32,k.paddingRight=32,k.itemSpacing=24,k.fills=[{type:"SOLID",color:{r:.95,g:.95,b:.95}}],k.cornerRadius=8;let F=figma.createText();await figma.loadFontAsync({family:"Inter",style:"Bold"}),await figma.loadFontAsync({family:"Inter",style:"Regular"}),F.fontName={family:"Inter",style:"Bold"},F.characters=`Token: ${E}`,F.fontSize=18,F.fills=[{type:"SOLID",color:{r:.1,g:.1,b:.1}}],k.appendChild(F);let W=N.length,I=(m==null?void 0:m.length)||0,L=figma.createText();L.fontName={family:"Inter",style:"Regular"},L.characters=`${W} component${W!==1?"s":""}${I>W?` (${I} variants total)`:""}`,L.fontSize=12,L.fills=[{type:"SOLID",color:{r:.4,g:.4,b:.4}}],k.appendChild(L);let B=figma.createFrame();B.name="Components List",B.layoutMode="VERTICAL",B.primaryAxisSizingMode="AUTO",B.counterAxisSizingMode="AUTO",B.itemSpacing=16,B.fills=[],k.appendChild(B);let J=0;for(let[M,_]of N){let v=_.length;try{let w=figma.createFrame();w.name=M,w.layoutMode="VERTICAL",w.primaryAxisSizingMode="AUTO",w.counterAxisSizingMode="AUTO",w.paddingTop=16,w.paddingBottom=16,w.paddingLeft=16,w.paddingRight=16,w.itemSpacing=8,w.fills=[{type:"SOLID",color:{r:1,g:1,b:1}}],w.strokes=[{type:"SOLID",color:{r:.85,g:.85,b:.85}}],w.strokeWeight=1,w.cornerRadius=6;let S=figma.createText();S.fontName={family:"Inter",style:"Bold"},S.characters=M,S.fontSize=12,S.fills=[{type:"SOLID",color:{r:.1,g:.1,b:.1}}],w.appendChild(S);let z=_[0];if(z!=null&&z.matchDetails&&z.matchDetails.length>0){let K=z.matchDetails[0],j=figma.createText();j.fontName={family:"Inter",style:"Regular"};let A="";if(K.matchedValue){let ee=K.matchedValue.match(/^([^]+)/);ee&&(A=ee[1].trim())}let q=K.property.replace(/\s*\([^)]*\)\s*/g,"").trim(),U=A?`${A} \u2192 ${q}`:q;v>1&&(U+=` (${v} variants)`),j.characters=U,j.fontSize=10,j.fills=[{type:"SOLID",color:{r:.5,g:.5,b:.5}}],w.appendChild(j)}let V=figma.createFrame();V.name="Variants",V.layoutMode="HORIZONTAL",V.layoutWrap="WRAP",V.primaryAxisSizingMode="AUTO",V.counterAxisSizingMode="AUTO",V.paddingTop=60,V.paddingBottom=60,V.paddingLeft=60,V.paddingRight=60,V.itemSpacing=20,V.counterAxisSpacing=20,V.fills=[],V.clipsContent=!1,w.appendChild(V);let ue=0,Q=new Set,ge=new Set;for(let K of _){if(K.matchDetails&&K.matchDetails.length>0)for(let j of K.matchDetails){let A=j.property.split(" \u2192 ");A.length>0&&A[0].includes("=")&&ge.add(A[0].trim())}K.variantName&&ge.add(K.variantName)}let Ce=_[0];if(!Ce)continue;try{let K=await figma.getNodeByIdAsync(Ce.id);if(!K)continue;if(K.type==="COMPONENT_SET"){let j=K;for(let A of Array.from(ge)){if(Q.has(A))continue;Q.add(A);let q=null;for(let U of j.children)if(U.type==="COMPONENT"&&U.name===A){q=U;break}if(q){let U=q.createInstance();V.appendChild(U),ue++}}}else for(let j of _)try{let A=await figma.getNodeByIdAsync(j.id);if(!A)continue;let q=null,U=j.name;if(A.type==="INSTANCE"){let ee=A;try{let he=await ee.getMainComponentAsync();he&&(U=he.name)}catch(he){}if(Q.has(U))continue;Q.add(U),q=ee.clone()}else if(A.type==="COMPONENT"){let ee=A;if(U=ee.name,Q.has(U))continue;Q.add(U),q=ee.createInstance()}else if(A.type==="FRAME"||A.type==="GROUP"||A.type==="RECTANGLE"||A.type==="ELLIPSE"||A.type==="LINE"||A.type==="TEXT"||A.type==="VECTOR"||A.type==="POLYGON"||A.type==="STAR"){if(Q.has(U))continue;Q.add(U),q=A.clone()}q&&(V.appendChild(q),ue++)}catch(A){console.error(`Failed to create instance for variant ${j.id}:`,A)}}catch(K){console.error(`Failed to process component ${M}:`,K)}ue>0?(B.appendChild(w),J++):w.remove()}catch(w){console.error(`Failed to create card for ${M}:`,w)}}let Z=figma.viewport;k.x=Z.center.x-k.width/2,k.y=Z.center.y-k.height/2,figma.currentPage.appendChild(k),figma.currentPage.selection=[k],figma.viewport.scrollAndZoomIntoView([k]),figma.notify(`Created collection with ${J} component${J!==1?"s":""}`),b("create-collection-result",{success:!0,count:J,frameId:k.id})}catch(l){console.error("Failed to create component collection:",l),b("create-collection-result",{success:!1,error:l instanceof Error?l.message:"Failed to create collection"})}}),G("cancel",()=>{figma.closePlugin()}),G("resize-window",d=>{figma.ui.resize(d.width,d.height)});function Ve(d){let l={nodeId:d.id,nodeName:d.name,nodeType:d.type,pluginData:{},sharedPluginData:{}};try{let m=d.getPluginDataKeys();for(let N of m)l.pluginData[N]=d.getPluginData(N)}catch(m){console.error("Error getting plugin data keys:",m)}let y=["tokens","tokens-studio","tokensStudio","figma-tokens","design-tokens","token-studio","com.tokens.studio","tokens.studio","io.tokens.studio","figmatokens","style-dictionary","ds","design-system","theme"];for(let m of y)try{let N=d.getSharedPluginDataKeys(m);if(N.length>0){l.sharedPluginData[m]={};for(let E of N){let k=d.getSharedPluginData(m,E);l.sharedPluginData[m][E]=k}}}catch(N){}return l}function ke(d,l=3,y=0){let m=[],N=Ve(d),E=Object.keys(N.pluginData).length>0||Object.keys(N.sharedPluginData).length>0;if(m.push(ne(te({},N),{pluginData:E?N.pluginData:{_noData:"true"}})),y<l&&"children"in d)for(let k of d.children)m.push(...ke(k,l,y+1));return m}G("inspect-selection",async()=>{try{let d=figma.currentPage.selection;if(d.length===0){b("inspect-result",{success:!1,error:"No selection. Please select a node to inspect."});return}b("inspect-progress",{message:"Inspecting plugin data..."});let l=[];for(let m of d){let N=ke(m,3);l.push(...N)}let y=l.filter(m=>!m.pluginData._noData&&(Object.keys(m.pluginData).length>0||Object.keys(m.sharedPluginData).length>0));l.forEach(m=>{m.pluginData._noData&&(m.pluginData={})}),b("inspect-result",{success:!0,results:l,summary:{totalNodesInspected:l.length,nodesWithPluginData:y.length,namespacesFound:Array.from(new Set(y.flatMap(m=>Object.keys(m.sharedPluginData)))),pluginDataKeysFound:Array.from(new Set(y.flatMap(m=>Object.keys(m.pluginData))))}})}catch(d){b("inspect-result",{success:!1,error:d instanceof Error?d.message:"Failed to inspect selection"})}})}var Ie=Y(()=>{"use strict";Ne();$e();we();ve();Ae()});var Je={"src/main.ts--default":(Ie(),Xe(Oe)).default},Ye="src/main.ts--default";Je[Ye]();
