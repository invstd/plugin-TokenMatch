var R=Object.defineProperty,oe=Object.defineProperties,se=Object.getOwnPropertyDescriptor,ie=Object.getOwnPropertyDescriptors,ae=Object.getOwnPropertyNames,H=Object.getOwnPropertySymbols;var G=Object.prototype.hasOwnProperty,ce=Object.prototype.propertyIsEnumerable;var B=(g,e,n)=>e in g?R(g,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):g[e]=n,E=(g,e)=>{for(var n in e||(e={}))G.call(e,n)&&B(g,n,e[n]);if(H)for(var n of H(e))ce.call(e,n)&&B(g,n,e[n]);return g},M=(g,e)=>oe(g,ie(e));var N=(g,e)=>()=>(g&&(e=g(g=0)),e);var le=(g,e)=>{for(var n in e)R(g,n,{get:e[n],enumerable:!0})},fe=(g,e,n,t)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of ae(e))!G.call(g,r)&&r!==n&&R(g,r,{get:()=>e[r],enumerable:!(t=se(e,r))||t.enumerable});return g};var pe=g=>fe(R({},"__esModule",{value:!0}),g);var $=(g,e,n)=>B(g,typeof e!="symbol"?e+"":e,n);var O,K=N(()=>{"use strict";O=class{constructor(){$(this,"tokens",[]);$(this,"errors",[]);$(this,"tokenMap",new Map)}parse(e,n=""){return this.tokens=[],this.errors=[],this.tokenMap=new Map,this.collectTokens(e,[]),this.resolveAliases(),this.validateTokens(),{tokens:this.tokens,metadata:{filePath:n,format:"auto-detected",errors:this.errors}}}collectTokens(e,n){if(e==null)return;let t=n[n.length-1]||"";if(!(t.startsWith("$")&&t!=="$value"&&t!=="$type")){if(this.isW3CToken(e)){this.addToken(e.$value,e.$type,e.$description,e.$extensions,n);return}if(this.isTokenStudioToken(e)){this.addToken(e.value,e.type,e.description,e.extensions,n);return}if(this.isPrimitiveToken(e,n)){this.addToken(e,void 0,void 0,void 0,n);return}if(typeof e=="object"){let r=Array.isArray(e)?e.map((o,s)=>String(s)):Object.keys(e);for(let o of r){if(o.startsWith("$")||o==="extensions"||o==="description")continue;let s=Array.isArray(e)?e[parseInt(o)]:e[o];this.collectTokens(s,[...n,o])}}}}addToken(e,n,t,r,o){let s=o[o.length-1]||"unnamed",l=this.inferTokenType({$value:e,$type:n},o),p;typeof e=="string"&&(e.startsWith("{")||e.startsWith("$"))&&(p=this.extractAliases(e));let u={name:s,value:e,type:l,path:[...o],description:t,extensions:r,rawValue:e,aliases:p};this.tokens.push(u),this.tokenMap.set(o.join("."),u)}isW3CToken(e){return e&&typeof e=="object"&&"$value"in e}isTokenStudioToken(e){if(!e||typeof e!="object"||"$value"in e||!("value"in e))return!1;let n=e.value;return typeof n=="string"||typeof n=="number"||typeof n=="boolean"?!0:typeof n=="object"&&n!==null?"type"in e||"description"in e:!1}isPrimitiveToken(e,n){return!(typeof e!="string"&&typeof e!="number"&&typeof e!="boolean"||n.length<1)}isDesignToken(e){return this.isW3CToken(e)}inferTokenType(e,n){if(e.$type)return e.$type;let t=n.join(".").toLowerCase();if(t.includes("color")||t.includes("colour"))return"color";if(t.includes("font")||t.includes("typography")||t.includes("text"))return t.includes("weight")?"fontWeight":t.includes("family")?"fontFamily":"typography";if(t.includes("spacing")||t.includes("size")||t.includes("gap"))return"dimension";if(t.includes("shadow"))return"shadow";if(t.includes("border"))return"border";let r=e.$value;if(typeof r=="string"){if(r.match(/^#[0-9A-Fa-f]{3,8}$/)||r.match(/^rgba?\(/)||r.match(/^hsla?\(/))return"color";if(r.match(/^-?\d+(\.\d+)?(px|rem|em|pt|pc|in|cm|mm|q|vh|vw|vmin|vmax|%)$/))return"dimension";if(r.match(/^\d+(\.\d+)?(ms|s)$/))return"duration"}return typeof r=="number"?"number":typeof r=="boolean"?"boolean":"string"}extractAliases(e){let n=[],t=/\{([^}]+)\}/g,r;for(;(r=t.exec(e))!==null;){let o=r[1].split(",").map(s=>s.trim())[0];o.startsWith("$")&&(o=o.substring(1)),n.push(o)}if(e.startsWith("$")&&!e.startsWith("{")){let o=/\$([a-zA-Z0-9._-]+)/g;for(;(r=o.exec(e))!==null;)n.push(r[1])}return n}resolveAliases(){for(let e of this.tokens)if(e.aliases&&e.aliases.length>0)for(let n of e.aliases){let t=this.tokenMap.get(n);t?(e.value=t.value,e.aliases||(e.aliases=[])):this.errors.push({path:e.path,message:`Unresolved alias: ${n}`,severity:"error"})}}validateTokens(){for(let e of this.tokens){let n=this.validateTokenValue(e);n.valid||this.errors.push({path:e.path,message:n.message||"Validation error",severity:n.severity||"error"})}}validateTokenValue(e){let{type:n,value:t}=e;if(t==null)return{valid:!1,message:"Token value cannot be null or undefined",severity:"error"};switch(n){case"color":return this.validateColor(t);case"dimension":return this.validateDimension(t);case"fontWeight":return this.validateFontWeight(t);case"duration":return this.validateDuration(t);case"typography":return this.validateTypography(t);case"shadow":return this.validateShadow(t);default:return{valid:!0}}}validateColor(e){return typeof e!="string"?{valid:!1,message:"Color value must be a string",severity:"error"}:[/^#[0-9A-Fa-f]{3,8}$/,/^rgba?\([^)]+\)$/,/^hsla?\([^)]+\)$/].some(r=>r.test(e))?{valid:!0}:{valid:!1,message:`Invalid color format: ${e}`,severity:"error"}}validateDimension(e){if(typeof e=="string"){if(!/^-?\d+(\.\d+)?(px|rem|em|pt|pc|in|cm|mm|q|vh|vw|vmin|vmax|%)$/.test(e))return{valid:!1,message:`Invalid dimension format: ${e}`,severity:"error"}}else return typeof e=="number"?{valid:!0}:{valid:!1,message:"Dimension value must be a string or number",severity:"error"};return{valid:!0}}validateFontWeight(e){if(typeof e=="string"){if(!["100","200","300","400","500","600","700","800","900","normal","bold"].includes(e))return{valid:!1,message:`Invalid font weight: ${e}`,severity:"warning"}}else if(typeof e=="number"){if(e<1||e>1e3)return{valid:!1,message:"Font weight must be between 1 and 1000",severity:"error"}}else return{valid:!1,message:"Font weight must be a string or number",severity:"error"};return{valid:!0}}validateDuration(e){return typeof e!="string"?{valid:!1,message:"Duration value must be a string",severity:"error"}:/^\d+(\.\d+)?(ms|s)$/.test(e)?{valid:!0}:{valid:!1,message:`Invalid duration format: ${e}`,severity:"error"}}validateTypography(e){return typeof e!="object"||Array.isArray(e)?{valid:!1,message:"Typography value must be an object",severity:"error"}:e.fontFamily?{valid:!0}:{valid:!1,message:"Typography token missing fontFamily",severity:"warning"}}validateShadow(e){return typeof e!="object"||Array.isArray(e)?{valid:!1,message:"Shadow value must be an object",severity:"error"}:e.color?{valid:!0}:{valid:!1,message:"Shadow token missing color",severity:"warning"}}getTokensByType(e){return this.tokens.filter(n=>n.type===e)}getTokenByPath(e){return this.tokenMap.get(e.join("."))}getErrors(){return this.errors}}});var I,J=N(()=>{"use strict";K();I=class{constructor(){$(this,"parser");this.parser=new O}parseGitHubUrl(e){let n=[/github\.com[\/:]([^\/]+)\/([^\/\.]+)(\.git)?$/,/github\.com\/([^\/]+)\/([^\/]+)/];for(let t of n){let r=e.match(t);if(r)return{owner:r[1],repo:r[2]}}return null}async fetchBranches(e,n,t){try{let r=await fetch(`https://api.github.com/repos/${e}/${n}/branches`,{headers:{Authorization:`Bearer ${t}`,Accept:"application/vnd.github.v3+json"}});if(!r.ok)throw new Error(`GitHub API error: ${r.status}`);return(await r.json()).map(s=>s.name)}catch(r){throw new Error(`Failed to fetch branches: ${r}`)}}async fetchFileContents(e,n,t,r,o){try{let s=`https://api.github.com/repos/${e}/${n}/contents/${o}?ref=${t}`,l=await fetch(s,{headers:{Authorization:`Bearer ${r}`,Accept:"application/vnd.github.v3+json"}});if(!l.ok)throw new Error(`GitHub API error: ${l.status}`);return await l.json()}catch(s){throw new Error(`Failed to fetch file contents: ${s}`)}}async fetchDirectoryContents(e,n,t,r,o=""){try{let s=`https://api.github.com/repos/${e}/${n}/contents/${o}?ref=${t}`,l=await fetch(s,{headers:{Authorization:`Bearer ${r}`,Accept:"application/vnd.github.v3+json"}});if(!l.ok)throw new Error(`GitHub API error: ${l.status}`);let p=await l.json();return Array.isArray(p)?p:[p]}catch(s){throw new Error(`Failed to fetch directory contents: ${s}`)}}decodeBase64Content(e){try{let n=e.replace(/\s/g,""),t;if(typeof atob=="function")t=atob(n);else{let o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";t="";let s=0,l=n.replace(/=+$/,"");for(;s<l.length;){let p=o.indexOf(l.charAt(s++)),u=o.indexOf(l.charAt(s++)),b=o.indexOf(l.charAt(s++)),a=o.indexOf(l.charAt(s++)),y=p<<18|u<<12|(b&63)<<6|a&63;t+=String.fromCharCode(y>>16&255),b!==-1&&(t+=String.fromCharCode(y>>8&255)),a!==-1&&(t+=String.fromCharCode(y&255))}}let r;if(typeof TextDecoder!="undefined"){let o=new Uint8Array(t.length);for(let s=0;s<t.length;s++)o[s]=t.charCodeAt(s);r=new TextDecoder("utf-8").decode(o)}else try{r=decodeURIComponent(escape(t))}catch(o){r=t}return r.charCodeAt(0)===65279&&(r=r.slice(1)),r=r.replace(/\0/g,""),r=r.trim(),r}catch(n){throw new Error(`Failed to decode base64 content: ${n}`)}}parseJSONContent(e){try{return JSON.parse(e)}catch(n){throw new Error(`Failed to parse JSON: ${n}`)}}flattenTokens(e,n=[]){let t=[],r=[],o=a=>a&&typeof a=="object"&&"$value"in a,s=a=>{if(!a||typeof a!="object"||"$value"in a||!("value"in a))return!1;let y=a.value;return typeof y=="string"||typeof y=="number"||typeof y=="boolean"?!0:typeof y=="object"&&y!==null?"type"in a||"description"in a:!1},l=(a,y)=>!(typeof a!="string"&&typeof a!="number"&&typeof a!="boolean"||y.length<1),p=(a,y)=>{let C=y.join(".").toLowerCase();if(typeof a=="string"){if(a.match(/^#[0-9A-Fa-f]{3,8}$/)||a.match(/^rgba?\(/)||a.match(/^hsla?\(/)||C.includes("color"))return"color";if(a.match(/^\d+(\.\d+)?(ms|s)$/)||C.includes("duration"))return"duration";if(a.match(/^-?\d+(\.\d+)?(px|rem|em|pt|pc|in|cm|mm|q|vh|vw|vmin|vmax|%)$/)||C.includes("size")||C.includes("spacing")||C.includes("radius"))return"dimension";if(C.includes("font")||C.includes("typography"))return"typography";if(C.includes("shadow"))return"shadow"}else if(typeof a=="number")return"number";return"string"},u=(a,y,C)=>{let i=C[C.length-1]||"unnamed",c=y||p(a,C);t.push({name:i,path:C,type:c,value:a,rawValue:a})},b=(a,y)=>{if(a==null)return;let C=y[y.length-1]||"";if(!(C.startsWith("$")&&C!=="$value"&&C!=="$type")){if(o(a)){u(a.$value,a.$type,y);return}if(s(a)){u(a.value,a.type,y);return}if(l(a,y)){u(a,void 0,y);return}if(a&&typeof a=="object"){let i=Array.isArray(a)?a.map((c,f)=>String(f)):Object.keys(a);for(let c of i){if(!Array.isArray(a)&&(c.startsWith("$")||c==="extensions"))continue;let f=Array.isArray(a)?a[parseInt(c)]:a[c];b(f,[...y,c])}}}};try{b(e,[])}catch(a){r.push({path:[],message:a instanceof Error?a.message:"Failed to walk tokens"})}return{tokens:t,metadata:{filePath:"",format:"auto-detected",errors:r}}}async fetchTokens(e,n,t,r,o){let s=await this.fetchFileContents(e,n,t,r,o);if(s.type!=="file")throw new Error(`Path is not a file: ${o}`);if(!s.content)throw new Error("File content is empty");let l=this.decodeBase64Content(s.content),p=this.parseJSONContent(l),u=this.parser.parse(p,o);return(!u.tokens||u.tokens.length===0)&&(u=this.flattenTokens(p,[])),u}async detectTokenFiles(e,n,t,r,o=""){let s=await this.fetchDirectoryContents(e,n,t,r,o),l=[/package\.json$/i,/package-lock\.json$/i,/tsconfig\.json$/i,/\.config\.json$/i,/eslint.*\.json$/i,/prettier.*\.json$/i,/jest\.config\.json$/i,/webpack\.config\.json$/i,/^\$metadata\.json$/i,/^\$themes\.json$/i,/\(ignore\)\.json$/i],p=[];for(let u of s)if(u.type==="file"){let b=u.name.toLowerCase();b.endsWith(".json")&&(l.some(y=>y.test(b))||p.push(u.path))}else if(u.type==="dir"){let b=await this.detectTokenFiles(e,n,t,r,u.path);p.push(...b)}return p}}});var V,j=N(()=>{"use strict";V=class{constructor(){$(this,"errors",[]);$(this,"TOKENS_STUDIO_NAMESPACE","tokens")}getTokenReference(e,n){try{let t=["tokens","tokens-studio","tokensStudio","design-tokens"];for(let r of t)try{let o=e.getSharedPluginData(r,n);if(o&&o.trim())return o}catch(o){}try{let r=e.getPluginData(n);if(r&&r.trim())return r}catch(r){}}catch(t){}}getFillTokenReferences(e,n){let t=[`fills[${n}]`,`fill[${n}]`,`fills.${n}`,`fill.${n}`,"fill","fills","fillColor",`fillColor[${n}]`];for(let r of t){let o=this.getTokenReference(e,r);if(o)return o}}getStrokeTokenReferences(e,n){let t=[`strokes[${n}]`,`stroke[${n}]`,`strokes.${n}`,`stroke.${n}`,"stroke","strokes","strokeColor",`strokeColor[${n}]`];for(let r of t){let o=this.getTokenReference(e,r);if(o)return o}}scanAllComponents(){this.errors=[];let e=[],n=0,t=figma.root.children;for(let r of t)if(r.type==="PAGE"){let o=r.findAll(l=>l.type==="COMPONENT"||l.type==="COMPONENT_SET"),s=r.findAll(l=>l.type==="INSTANCE");n+=s.length;for(let l of o)try{let p=this.extractComponentProperties(l,r.name);p&&e.push(p)}catch(p){this.errors.push({componentId:l.id,componentName:l.name,error:p instanceof Error?p.message:"Unknown error"})}}return{components:e,totalComponents:e.length,totalInstances:n,pagesScanned:t.length,errors:this.errors}}scanCurrentPage(){this.errors=[];let e=[],n=figma.currentPage,t=0,r=n.findAll(s=>s.type==="COMPONENT"||s.type==="COMPONENT_SET"),o=n.findAll(s=>s.type==="INSTANCE");t+=o.length;for(let s of r)try{let l=this.extractComponentProperties(s,n.name);l&&e.push(l)}catch(l){this.errors.push({componentId:s.id,componentName:s.name,error:l instanceof Error?l.message:"Unknown error"})}return{components:e,totalComponents:e.length,totalInstances:t,pagesScanned:1,errors:this.errors}}scanNodes(e){this.errors=[];let n=[],t=0,r=figma.currentPage;for(let o of e){let s=[],l=[];"findAll"in o&&typeof o.findAll=="function"&&(s=o.findAll(p=>p.type==="COMPONENT"||p.type==="COMPONENT_SET"),l=o.findAll(p=>p.type==="INSTANCE"),t+=l.length);for(let p of s)try{let u=this.extractComponentProperties(p,r.name);u&&n.push(u)}catch(u){this.errors.push({componentId:p.id,componentName:p.name,error:u instanceof Error?u.message:"Unknown error"})}if(o.type==="COMPONENT"||o.type==="COMPONENT_SET")try{let p=this.extractComponentProperties(o,r.name);p&&(n.find(u=>u.id===p.id)||n.push(p))}catch(p){this.errors.push({componentId:o.id,componentName:o.name,error:p instanceof Error?p.message:"Unknown error"})}}return{components:n,totalComponents:n.length,totalInstances:t,pagesScanned:1,errors:this.errors}}extractComponentProperties(e,n){if(e.type!=="COMPONENT"&&e.type!=="COMPONENT_SET"&&e.type!=="INSTANCE")return null;let t={id:e.id,name:e.name,type:e.type,pageName:n,colors:[],typography:[],spacing:[],effects:[]};if(t.colors=this.extractColors(e),t.typography=this.extractTypography(e),t.spacing=this.extractSpacing(e),t.effects=this.extractEffects(e),e.type==="COMPONENT"||e.type==="COMPONENT_SET"){let r=e;"layoutMode"in r&&r.layoutMode&&(t.layoutMode=r.layoutMode,t.itemSpacing=r.itemSpacing,t.paddingTop=r.paddingTop,t.paddingRight=r.paddingRight,t.paddingBottom=r.paddingBottom,t.paddingLeft=r.paddingLeft),t.width=r.width,t.height=r.height}else if(e.type==="INSTANCE"){let r=e;t.width=r.width,t.height=r.height}if("children"in e){let r=[];for(let o of e.children){let s=this.extractComponentProperties(o,n);s&&r.push(s)}r.length>0&&(t.children=r)}return t}extractColors(e){var t,r;let n=[];if("fills"in e&&Array.isArray(e.fills))for(let o=0;o<e.fills.length;o++){let s=e.fills[o];if(s.type==="SOLID"){let l=(t=s.opacity)!=null?t:1,p=this.rgbaToColor(s.color,l),u=this.getFillTokenReferences(e,o);n.push({type:"fill",color:{r:s.color.r,g:s.color.g,b:s.color.b,a:l},hex:p.hex,rgba:p.rgba,opacity:l,tokenReference:u})}}if("strokes"in e&&Array.isArray(e.strokes))for(let o=0;o<e.strokes.length;o++){let s=e.strokes[o];if(s.type==="SOLID"){let l=(r=s.opacity)!=null?r:1,p=this.rgbaToColor(s.color,l),u=this.getStrokeTokenReferences(e,o);n.push({type:"stroke",color:{r:s.color.r,g:s.color.g,b:s.color.b,a:l},hex:p.hex,rgba:p.rgba,opacity:l,tokenReference:u})}}return n}extractTypography(e){let n=[];if(e.type==="TEXT"){let t=e;if(typeof t.fontName!="symbol"){let r=t.fontName,o=this.getTokenReference(t,"fontFamily")||this.getTokenReference(t,"font-family"),s=this.getTokenReference(t,"fontSize")||this.getTokenReference(t,"font-size"),l=this.getTokenReference(t,"fontWeight")||this.getTokenReference(t,"font-weight"),p=o||s||l;n.push({fontFamily:r.family,fontSize:typeof t.fontSize=="number"?t.fontSize:16,fontWeight:typeof r.style=="string"?this.parseFontWeight(r.style):400,lineHeight:typeof t.lineHeight=="number"||typeof t.lineHeight=="string"?t.lineHeight:void 0,letterSpacing:typeof t.letterSpacing=="number"?t.letterSpacing:void 0,textDecoration:typeof t.textDecoration=="string"?t.textDecoration:void 0,textCase:typeof t.textCase=="string"?t.textCase:void 0,tokenReference:p})}}if("children"in e)for(let t of e.children)n.push(...this.extractTypography(t));return n}extractSpacing(e){let n=[];if(e.type==="COMPONENT"||e.type==="COMPONENT_SET"){let t=e;n.push({type:"width",value:t.width,unit:"px"}),n.push({type:"height",value:t.height,unit:"px"}),"paddingTop"in t&&typeof t.paddingTop=="number"&&(t.paddingTop&&n.push({type:"padding",value:t.paddingTop,unit:"px"}),t.paddingRight&&n.push({type:"padding",value:t.paddingRight,unit:"px"}),t.paddingBottom&&n.push({type:"padding",value:t.paddingBottom,unit:"px"}),t.paddingLeft&&n.push({type:"padding",value:t.paddingLeft,unit:"px"})),"itemSpacing"in t&&typeof t.itemSpacing=="number"&&t.itemSpacing&&n.push({type:"gap",value:t.itemSpacing,unit:"px"})}else if(e.type==="INSTANCE"){let t=e;n.push({type:"width",value:t.width,unit:"px"}),n.push({type:"height",value:t.height,unit:"px"})}return n}extractEffects(e){var t,r,o,s,l,p,u,b;let n=[];if("effects"in e&&Array.isArray(e.effects)){for(let a of e.effects)if(a.visible)switch(a.type){case"DROP_SHADOW":n.push({type:"drop-shadow",visible:a.visible,radius:a.radius,color:a.color?{r:a.color.r,g:a.color.g,b:a.color.b,a:a.color.a}:void 0,offset:{x:(r=(t=a.offset)==null?void 0:t.x)!=null?r:0,y:(s=(o=a.offset)==null?void 0:o.y)!=null?s:0},spread:a.spread});break;case"INNER_SHADOW":n.push({type:"inner-shadow",visible:a.visible,radius:a.radius,color:a.color?{r:a.color.r,g:a.color.g,b:a.color.b,a:a.color.a}:void 0,offset:{x:(p=(l=a.offset)==null?void 0:l.x)!=null?p:0,y:(b=(u=a.offset)==null?void 0:u.y)!=null?b:0},spread:a.spread});break;case"LAYER_BLUR":n.push({type:"layer-blur",visible:a.visible,radius:a.radius});break;case"BACKGROUND_BLUR":n.push({type:"background-blur",visible:a.visible,radius:a.radius});break}}return n}rgbaToColor(e,n){let t=Math.round(e.r*255),r=Math.round(e.g*255),o=Math.round(e.b*255),s=n,l=`#${[t,r,o].map(u=>{let b=u.toString(16);return b.length===1?"0"+b:b}).join("")}`,p=`rgba(${t}, ${r}, ${o}, ${s.toFixed(2)})`;return{hex:l,rgba:p}}parseFontWeight(e){let n={thin:100,extralight:200,light:300,regular:400,medium:500,semibold:600,bold:700,extrabold:800,black:900},t=e.toLowerCase();for(let[o,s]of Object.entries(n))if(t.includes(o))return s;let r=e.match(/(\d+)/);return r?parseInt(r[1],10):400}getComponentUsageStats(e){let n=[],t=new Set;for(let r of figma.root.children)if(r.type==="PAGE"){let o=r.findAll(s=>{var l;return s.type==="INSTANCE"&&((l=s.mainComponent)==null?void 0:l.id)===e});o.length>0&&(n.push(...o),t.add(r.name))}return{instances:n.length,pages:Array.from(t)}}}});var W,q=N(()=>{"use strict";W=class{matchTokenToComponents(e,n){let t=[];for(let r of n.components){let o=this.matchComponentRecursively(e,r);if(o.length>0){let s=o.reduce((l,p)=>l+p.confidence,0)/o.length;t.push({component:r,matches:o,confidence:s})}}return t.sort((r,o)=>o.confidence-r.confidence),{token:e,matchingComponents:t,totalMatches:t.length,totalComponentsScanned:n.totalComponents}}matchComponentRecursively(e,n){let t=[];switch(e.type){case"color":t.push(...this.matchColor(e,n));break;case"fontFamily":case"fontWeight":case"typography":t.push(...this.matchTypography(e,n));break;case"dimension":t.push(...this.matchSpacing(e,n));break;case"shadow":t.push(...this.matchEffects(e,n));break;default:t.push(...this.matchByValue(e,n))}if(n.children&&n.children.length>0)for(let r of n.children){let o=this.matchComponentRecursively(e,r);for(let s of o)t.push(M(E({},s),{property:`${r.name} \u2192 ${s.property}`}))}return t}matchColor(e,n){let t=[],r=e.path.join("."),o=this.normalizeColor(e.value);for(let s of n.colors)if(s.tokenReference){let l=s.tokenReference.trim();l=l.replace(/^["']|["']$/g,""),l=l.replace(/^[{]|[}]$/g,""),l=l.replace(/^\$/,"");let p=l.toLowerCase(),u=r.toLowerCase();p===u?t.push({property:`${s.type} color (token ref)`,propertyType:"color",matchedValue:`${s.hex} \u2190 ${s.tokenReference}`,tokenValue:r,confidence:1}):(p.includes(u)||u.includes(p))&&t.push({property:`${s.type} color (token ref)`,propertyType:"color",matchedValue:`${s.hex} \u2190 ${s.tokenReference}`,tokenValue:r,confidence:.85})}if(t.length>0||!o)return t;for(let s of n.colors){let l=this.normalizeHex(s.hex),p=this.normalizeRgba(s.rgba),u=this.normalizeHex(o),b=this.normalizeRgba(o);if(u&&l&&u===l)t.push({property:`${s.type} color (value)`,propertyType:"color",matchedValue:s.hex,tokenValue:String(e.value),confidence:.7});else if(b&&p){let a=this.parseRgba(o),y=this.parseRgba(s.rgba);if(a&&y){let C=Math.abs(a.r-y.r),i=Math.abs(a.g-y.g),c=Math.abs(a.b-y.b),f=Math.abs(a.a-y.a);C<2&&i<2&&c<2&&f<.01&&t.push({property:`${s.type} color (value)`,propertyType:"color",matchedValue:s.rgba,tokenValue:String(e.value),confidence:.7})}}}return t}matchTypography(e,n){let t=[],r=e.path.join(".");for(let o of n.typography){let s=0,l="",p="value";if(o.tokenReference){let b=o.tokenReference.replace(/[{}]/g,"").replace(/^\$/,"").toLowerCase().replace(/\./g,"."),a=r.toLowerCase();b===a?(s=1,l=`${o.fontFamily} (ref: ${o.tokenReference})`,p="reference"):(b.includes(a)||a.includes(b))&&(s=.8,l=`${o.fontFamily} (ref: ${o.tokenReference})`,p="reference")}if(s===0){if(e.type==="fontFamily"){let u=String(e.value).toLowerCase().trim(),b=o.fontFamily.toLowerCase().trim();u===b&&(s=.9,l=o.fontFamily)}else if(e.type==="fontWeight"){let u=this.normalizeFontWeight(e.value),b=o.fontWeight;u===b&&(s=.9,l=String(b))}else if(e.type==="typography"&&typeof e.value=="object"&&e.value!==null){let u=e.value,b=!1,a=0,y=[];if(u.fontFamily){let C=String(u.fontFamily).toLowerCase().trim(),i=o.fontFamily.toLowerCase().trim();C===i&&(b=!0,a+=.4,y.push(`fontFamily: ${o.fontFamily}`))}if(u.fontSize){let C=Number(u.fontSize),i=o.fontSize;Math.abs(C-i)<.5&&(b=!0,a+=.3,y.push(`fontSize: ${i}`))}u.fontWeight&&this.normalizeFontWeight(u.fontWeight)===o.fontWeight&&(b=!0,a+=.3,y.push(`fontWeight: ${o.fontWeight}`)),b&&(s=Math.min(a,1),l=y.join(", "))}}s>0&&t.push({property:`typography${p==="reference"?" (token ref)":""}`,propertyType:"typography",matchedValue:l,tokenValue:String(e.value),confidence:s})}return t}matchSpacing(e,n){let t=[],r=this.normalizeDimension(e.value);if(r===null)return t;for(let o of n.spacing){let s=o.value;Math.abs(r-s)<.5&&t.push({property:o.type,propertyType:"spacing",matchedValue:`${o.value}${o.unit}`,tokenValue:String(e.value),confidence:1})}return t}matchEffects(e,n){let t=[];if(typeof e.value!="object"||e.value===null)return t;let r=e.value;for(let o of n.effects)if(o.type==="drop-shadow"||o.type==="inner-shadow"){let s=0,l=[],p=r.blur||r.radius||r.spreadRadius;if(p!==void 0&&o.radius!==void 0&&Math.abs(Number(p)-o.radius)<1&&(s+=.4,l.push(`radius: ${o.radius}px`)),r.color&&o.color){let u=this.normalizeColor(r.color),b=this.rgbaToString(o.color);u&&this.colorsMatch(u,b)&&(s+=.4,l.push(`color: ${b}`))}if(r.offset&&o.offset){let u=Number(r.offset.x||0),b=Number(r.offset.y||0),a=o.offset.x||0,y=o.offset.y||0;Math.abs(u-a)<1&&Math.abs(b-y)<1&&(s+=.2,l.push(`offset: ${a}, ${y}`))}s>0&&t.push({property:o.type,propertyType:"effect",matchedValue:l.join(", "),tokenValue:JSON.stringify(e.value),confidence:Math.min(s,1)})}return t}matchByValue(e,n){let t=[];return this.looksLikeColor(e.value)&&t.push(...this.matchColor(e,n)),this.looksLikeDimension(e.value)&&t.push(...this.matchSpacing(e,n)),t}normalizeColor(e){if(typeof e!="string")return null;let n=e.trim().toLowerCase();return n.match(/^#[0-9a-f]{3,8}$/)||n.match(/^rgba?\(/)||n.match(/^hsla?\(/)?n:null}normalizeHex(e){if(!e)return null;let n=e.trim().toLowerCase().replace("#","");return n.length===3&&(n=n.split("").map(t=>t+t).join("")),n.length===6?n:null}normalizeRgba(e){if(!e)return null;let n=e.match(/rgba?\(([^)]+)\)/i);return n?n[1].trim():null}parseRgba(e){let n=this.normalizeRgba(e);if(!n)return null;let t=n.split(",").map(r=>parseFloat(r.trim()));return t.length>=3?{r:t[0],g:t[1],b:t[2],a:t.length>3?t[3]:1}:null}rgbaToString(e){return`rgba(${Math.round(e.r)}, ${Math.round(e.g)}, ${Math.round(e.b)}, ${e.a.toFixed(2)})`}colorsMatch(e,n){let t=this.parseRgba(e),r=this.parseRgba(n);if(t&&r)return Math.abs(t.r-r.r)<2&&Math.abs(t.g-r.g)<2&&Math.abs(t.b-r.b)<2&&Math.abs(t.a-r.a)<.01;let o=this.normalizeHex(e),s=this.normalizeHex(n);return o!==null&&s!==null&&o===s}normalizeFontWeight(e){if(typeof e=="number")return e;if(typeof e!="string")return 400;let n={thin:100,extralight:200,light:300,regular:400,normal:400,medium:500,semibold:600,bold:700,extrabold:800,black:900},t=e.toLowerCase().trim();if(n[t])return n[t];let r=parseInt(e,10);return isNaN(r)?400:r}normalizeDimension(e){if(typeof e=="number")return e;if(typeof e!="string")return null;let n=e.replace(/px|rem|em|pt|pc|in|cm|mm|q|vh|vw|vmin|vmax|%/g,"").trim(),t=parseFloat(n);return isNaN(t)?null:t}looksLikeColor(e){if(typeof e!="string")return!1;let n=e.trim().toLowerCase();return n.match(/^#[0-9a-f]{3,8}$/)!==null||n.match(/^rgba?\(/)!==null||n.match(/^hsla?\(/)!==null}looksLikeDimension(e){return typeof e=="number"?!0:typeof e!="string"?!1:/^-?\d+(\.\d+)?(px|rem|em|pt|pc|in|cm|mm|q|vh|vw|vmin|vmax|%)$/.test(e.trim())}}});function P(g,e){let n=`${X}`;return X+=1,F[n]={handler:e,name:g},function(){delete F[n]}}function Y(g,e){let n=!1;for(let t in F)F[t].name===g&&(F[t].handler.apply(null,e),n=!0);if(n===!1)throw new Error(`No event handler with name \`${g}\``)}var F,X,h,Z=N(()=>{F={},X=0;h=typeof window=="undefined"?function(g,...e){figma.ui.postMessage([g,...e])}:function(g,...e){window.parent.postMessage({pluginMessage:[g,...e]},"*")};typeof window=="undefined"?figma.ui.onmessage=function(g){if(!Array.isArray(g))return;let[e,...n]=g;typeof e=="string"&&Y(e,n)}:window.onmessage=function(g){if(typeof g.data.pluginMessage=="undefined")return;let e=g.data.pluginMessage;if(!Array.isArray(e))return;let[n,...t]=g.data.pluginMessage;typeof n=="string"&&Y(n,t)}});function _(g,e){if(typeof __html__=="undefined")throw new Error("No UI defined");let n=`<div id="create-figma-plugin"></div><script>document.body.classList.add('theme-${figma.editorType}');const __FIGMA_COMMAND__='${typeof figma.command=="undefined"?"":figma.command}';const __SHOW_UI_DATA__=${JSON.stringify(typeof e=="undefined"?{}:e)};${__html__}</script>`;figma.showUI(n,M(E({},g),{themeColors:typeof g.themeColors=="undefined"?!0:g.themeColors}))}var Q=N(()=>{});var ee=N(()=>{Z();Q()});var te={};le(te,{default:()=>ue});function ue(){_({width:400,height:550},{resizable:!0}),figma.loadAllPagesAsync().catch(i=>{console.error("Error loading pages on startup:",i)});let g=new I,e=new V,n=new W;async function t(){try{return await figma.clientStorage.getAsync("repoConfig")||null}catch(i){return console.error("Error loading config:",i),null}}async function r(i){try{await figma.clientStorage.setAsync("repoConfig",i)}catch(c){console.error("Error saving config:",c)}}async function o(){try{await figma.clientStorage.deleteAsync("repoConfig")}catch(i){console.error("Error clearing config:",i)}}P("load-config",async()=>{let i=await t();h("config-loaded",i)}),P("clear-config",async()=>{await o(),h("config-loaded",null)}),P("test-connection",async i=>{let c=g.parseGitHubUrl(i.repoUrl);if(!c){h("connection-result",{success:!1,error:"Invalid GitHub URL format"});return}try{h("connection-progress",{message:"Connecting to GitHub..."});let f=await g.fetchBranches(c.owner,c.repo,i.token),d=0,v=[];if(f.length>0)try{let m=f[0];h("connection-progress",{message:"Scanning for token files..."});let k=await g.detectTokenFiles(c.owner,c.repo,m,i.token,i.filePath||"");d=k.length,v=k.slice(0,5)}catch(m){console.error("Token detection failed:",m)}h("connection-result",{success:!0,branches:f.slice(0,10),owner:c.owner,repo:c.repo,fileCount:d,tokenCount:d,sampleFiles:v.map(m=>m.length>50?m.substring(0,47)+"...":m)})}catch(f){h("connection-result",{success:!1,error:f instanceof Error?f.message:"Connection failed"})}}),P("save-config",async i=>{await r(i),h("config-saved",{success:!0})});let s=(i,c)=>{let f=c.join(".").toLowerCase();if(typeof i=="string"){if(i.match(/^#[0-9A-Fa-f]{3,8}$/)||i.match(/^rgba?\(/)||i.match(/^hsla?\(/)||f.includes("color")||f.includes("colour"))return"color";if(i.match(/^\d+(\.\d+)?(ms|s)$/)||f.includes("duration"))return"duration";if(i.match(/^-?\d+(\.\d+)?(px|rem|em|pt|pc|in|cm|mm|q|vh|vw|vmin|vmax|%)$/)||f.includes("size")||f.includes("spacing")||f.includes("radius")||f.includes("gap")||f.includes("padding")||f.includes("margin"))return"dimension";if(f.includes("font")||f.includes("typography")||f.includes("text"))return f.includes("weight")?"fontWeight":f.includes("family")?"fontFamily":"typography";if(f.includes("shadow"))return"shadow";if(f.includes("border"))return"border"}else{if(typeof i=="number")return f.includes("weight")?"fontWeight":(f.includes("opacity")||f.includes("alpha")||f.includes("z-index")||f.includes("zindex"),"number");if(typeof i=="object"&&i!==null){if(f.includes("shadow")||i.blur!==void 0||i.spread!==void 0)return"shadow";if(f.includes("typography")||i.fontFamily!==void 0)return"typography";if(f.includes("border")||i.width!==void 0&&i.style!==void 0)return"border"}}return"string"},l=i=>i&&typeof i=="object"&&"$value"in i,p=i=>{if(!i||typeof i!="object"||"$value"in i||!("value"in i))return!1;let c=i.value;return typeof c=="string"||typeof c=="number"||typeof c=="boolean"?!0:typeof c=="object"&&c!==null?"type"in i||"description"in i:!1},u=(i,c)=>!(typeof i!="string"&&typeof i!="number"&&typeof i!="boolean"||c.length<1),b=(i,c)=>{let f=[],d=(m,k,w)=>{let x=w[w.length-1]||"unnamed",A=k||s(m,w);f.push({name:x,path:[...w],type:A,sourceFile:c,value:m})},v=(m,k,w)=>{if(m==null)return;let x=k[k.length-1]||"";if(!(x.startsWith("$")&&x!=="$value"&&x!=="$type")){if(l(m)){d(m.$value,m.$type,k);return}if(p(m)){d(m.value,m.type,k);return}if(u(m,k)){d(m,void 0,k);return}if(typeof m=="object"){let A=Array.isArray(m)?m.map((T,S)=>String(S)):Object.keys(m);for(let T of A){if(!Array.isArray(m)&&(T.startsWith("$")||T==="extensions"))continue;let S=Array.isArray(m)?m[parseInt(T)]:m[T];v(S,[...k,T],w+1)}}}};return v(i,[],0),f};P("fetch-tokens",async i=>{let c=g.parseGitHubUrl(i.repoUrl);if(!c){h("tokens-result",{success:!1,error:"Invalid GitHub URL format"});return}try{let f=i.filePath||"";h("tokens-progress",{message:"Scanning for token files..."});let d=await g.detectTokenFiles(c.owner,c.repo,i.branch,i.token,f);if(d.length===0){h("tokens-result",{success:!1,error:`No token files found${f?` in '${f}'`:" in repository"}. Looking for .json files (excluding config files).`});return}let v=[],m=[],k=0,w=0,x=[],A=150;for(let T of d)try{h("tokens-progress",{message:`Processing ${T}...`});let S=await g.fetchFileContents(c.owner,c.repo,i.branch,i.token,T);if(!S.content)throw new Error("Empty file content");let re=g.decodeBase64Content(S.content),U;try{U=JSON.parse(re)}catch(z){throw new Error(`JSON parse failed: ${z.message}`)}let L=b(U,T),D=L.length;w+=D,x.push({file:T,count:D}),h("tokens-progress",{message:`Found ${D} tokens in ${T}`}),D===0&&m.push({file:T,message:"No token values found in this file (checked $value, value, and primitives)"});for(let z of L)if(v.length<A)v.push(z);else break;k++}catch(S){console.error(`Failed to parse ${T}:`,S),x.push({file:T,count:0}),m.push({file:T,message:S instanceof Error?S.message:"Failed to parse file"})}h("tokens-result",{success:!0,tokens:v.map(T=>({name:T.name||"",path:T.path||"",type:T.type||"unknown",sourceFile:T.sourceFile||""})),metadata:{totalTokens:w,truncated:w>v.length,filesProcessed:k,totalFiles:d.length,perFileCounts:x,errors:m}})}catch(f){h("tokens-result",{success:!1,error:f instanceof Error?f.message:"Failed to fetch tokens"})}}),P("detect-token-files",async i=>{let c=g.parseGitHubUrl(i.repoUrl);if(!c){h("token-files-result",{success:!1,error:"Invalid GitHub URL format"});return}try{let f=await g.detectTokenFiles(c.owner,c.repo,i.branch,i.token,i.directoryPath||"");h("token-files-result",{success:!0,files:f})}catch(f){h("token-files-result",{success:!1,error:f instanceof Error?f.message:"Failed to detect token files"})}}),P("scan-components",async i=>{try{let c=i.scanAll===!0;c?(h("scan-progress",{message:"Loading all pages..."}),await figma.loadAllPagesAsync(),h("scan-progress",{message:"Scanning all pages..."})):h("scan-progress",{message:"Scanning current page..."});let f=c?e.scanAllComponents():e.scanCurrentPage();h("scan-result",{success:!0,result:f})}catch(c){h("scan-result",{success:!1,error:c instanceof Error?c.message:"Failed to scan components"})}}),P("scan-components-for-token",async i=>{try{let{token:c,scanAll:f,scanSelection:d}=i,v=f===!0,m=d===!0;if(!c){h("scan-result",{success:!1,error:"No token provided"});return}let k="Scanning for token matches...";v?(k="Loading all pages...",h("scan-progress",{message:k}),await figma.loadAllPagesAsync(),k="Scanning all pages for token matches..."):m?k="Scanning selection for token matches...":k="Scanning current page for token matches...",h("scan-progress",{message:k}),h("scan-progress",{message:"Scanning components..."});let w;if(v)w=e.scanAllComponents();else if(m){let T=figma.currentPage.selection;if(T.length===0){h("scan-result",{success:!1,error:"No selection found. Please select a frame or node to scan."});return}w=e.scanNodes(T)}else w=e.scanCurrentPage();h("scan-progress",{message:`Found ${w.totalComponents} components. Matching tokens...`});let x=n.matchTokenToComponents(c,w);h("scan-progress",{message:"Matching complete!"});let A={token:{name:c.name,path:c.path,type:c.type,value:c.value},matchingComponents:x.matchingComponents.map(T=>({id:T.component.id,name:T.component.name,page:T.component.pageName,type:T.component.type,matches:T.matches.map(S=>`${S.property}: ${S.matchedValue}`),matchDetails:T.matches,confidence:T.confidence})),totalMatches:x.totalMatches,totalComponentsScanned:x.totalComponentsScanned};h("scan-result",{success:!0,result:A})}catch(c){h("scan-result",{success:!1,error:c instanceof Error?c.message:"Failed to scan components for token"})}}),P("get-component-usage",async i=>{try{let{componentId:c}=i,f=e.getComponentUsageStats(c);h("component-usage-result",{success:!0,stats:f})}catch(c){h("component-usage-result",{success:!1,error:c instanceof Error?c.message:"Failed to get usage stats"})}}),P("navigate-to-component",async i=>{try{let{componentId:c}=i,f=figma.getNodeById(c);if(f&&"type"in f){let d=a(f);d&&d.type==="PAGE"&&d!==figma.currentPage&&await figma.setCurrentPageAsync(d),f.type!=="DOCUMENT"&&f.type!=="PAGE"?(figma.currentPage.selection=[f],figma.viewport.scrollAndZoomIntoView([f]),h("navigate-result",{success:!0})):h("navigate-result",{success:!1,error:"Cannot select document or page nodes"})}else h("navigate-result",{success:!1,error:"Node not found"})}catch(c){h("navigate-result",{success:!1,error:c instanceof Error?c.message:"Failed to navigate to component"})}});function a(i){let c=i;for(;c&&c.type!=="PAGE";)c=c.parent;return c}P("cancel",()=>{figma.closePlugin()}),P("resize-window",i=>{figma.ui.resize(i.width,i.height)});function y(i){let c={nodeId:i.id,nodeName:i.name,nodeType:i.type,pluginData:{},sharedPluginData:{}};try{let d=i.getPluginDataKeys();for(let v of d)c.pluginData[v]=i.getPluginData(v)}catch(d){console.error("Error getting plugin data keys:",d)}let f=["tokens","tokens-studio","tokensStudio","figma-tokens","design-tokens","token-studio","com.tokens.studio","tokens.studio","io.tokens.studio","figmatokens","style-dictionary","ds","design-system","theme","variables"];for(let d of f)try{let v=i.getSharedPluginDataKeys(d);if(v.length>0){c.sharedPluginData[d]={};for(let m of v){let k=i.getSharedPluginData(d,m);c.sharedPluginData[d][m]=k}}}catch(v){}try{if("boundVariables"in i&&i.boundVariables){c.boundVariables={};let d=i.boundVariables;for(let[v,m]of Object.entries(d))if(m){if(Array.isArray(m))c.boundVariables[v]=m.map(k=>{try{let w=figma.variables.getVariableById(k.id);return{id:k.id,name:w==null?void 0:w.name,resolvedType:w==null?void 0:w.resolvedType,valuesByMode:w==null?void 0:w.valuesByMode}}catch(w){return{id:k.id,error:"Could not resolve variable"}}});else if(m.id)try{let k=figma.variables.getVariableById(m.id);c.boundVariables[v]={id:m.id,name:k==null?void 0:k.name,resolvedType:k==null?void 0:k.resolvedType,valuesByMode:k==null?void 0:k.valuesByMode}}catch(k){c.boundVariables[v]={id:m.id,error:"Could not resolve variable"}}}}}catch(d){console.error("Error getting bound variables:",d)}return c}function C(i,c=3,f=0){let d=[],v=y(i),m=Object.keys(v.pluginData).length>0||Object.keys(v.sharedPluginData).length>0||v.boundVariables&&Object.keys(v.boundVariables).length>0;if(d.push(M(E({},v),{pluginData:m?v.pluginData:{_noData:"true"}})),f<c&&"children"in i)for(let k of i.children)d.push(...C(k,c,f+1));return d}P("inspect-selection",async()=>{try{let i=figma.currentPage.selection;if(i.length===0){h("inspect-result",{success:!1,error:"No selection. Please select a node to inspect."});return}h("inspect-progress",{message:"Inspecting plugin data..."});let c=[];for(let d of i){let v=C(d,3);c.push(...v)}let f=c.filter(d=>!d.pluginData._noData&&(Object.keys(d.pluginData).length>0||Object.keys(d.sharedPluginData).length>0||d.boundVariables&&Object.keys(d.boundVariables).length>0));c.forEach(d=>{d.pluginData._noData&&(d.pluginData={})}),h("inspect-result",{success:!0,results:c,summary:{totalNodesInspected:c.length,nodesWithPluginData:f.length,namespacesFound:Array.from(new Set(f.flatMap(d=>Object.keys(d.sharedPluginData)))),pluginDataKeysFound:Array.from(new Set(f.flatMap(d=>Object.keys(d.pluginData)))),hasVariableBindings:f.some(d=>d.boundVariables&&Object.keys(d.boundVariables).length>0)}})}catch(i){h("inspect-result",{success:!1,error:i instanceof Error?i.message:"Failed to inspect selection"})}})}var ne=N(()=>{"use strict";J();j();q();ee()});var ge={"src/main.ts--default":(ne(),pe(te)).default},de="src/main.ts--default";ge[de]();
