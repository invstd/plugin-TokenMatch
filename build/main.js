var oe=Object.defineProperty,Le=Object.defineProperties,We=Object.getOwnPropertyDescriptor,Be=Object.getOwnPropertyDescriptors,ze=Object.getOwnPropertyNames,ke=Object.getOwnPropertySymbols;var be=Object.prototype.hasOwnProperty,Ve=Object.prototype.propertyIsEnumerable;var ge=(m,e,t)=>e in m?oe(m,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):m[e]=t,Y=(m,e)=>{for(var t in e||(e={}))be.call(e,t)&&ge(m,t,e[t]);if(ke)for(var t of ke(e))Ve.call(e,t)&&ge(m,t,e[t]);return m},Q=(m,e)=>Le(m,Be(e));var X=(m,e)=>()=>(m&&(e=m(m=0)),e);var _e=(m,e)=>{for(var t in e)oe(m,t,{get:e[t],enumerable:!0})},Ue=(m,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of ze(e))!be.call(m,r)&&r!==t&&oe(m,r,{get:()=>e[r],enumerable:!(n=We(e,r))||n.enumerable});return m};var Ge=m=>Ue(oe({},"__esModule",{value:!0}),m);var I=(m,e,t)=>ge(m,typeof e!="symbol"?e+"":e,t);var ie,Te=X(()=>{"use strict";ie=class{constructor(){I(this,"tokens",[]);I(this,"errors",[]);I(this,"tokenMap",new Map)}parse(e,t=""){return this.tokens=[],this.errors=[],this.tokenMap=new Map,this.collectTokens(e,[]),this.resolveAliases(),this.validateTokens(),{tokens:this.tokens,metadata:{filePath:t,format:"auto-detected",errors:this.errors}}}collectTokens(e,t){if(e==null)return;let n=t[t.length-1]||"";if(!(n.startsWith("$")&&n!=="$value"&&n!=="$type")){if(this.isW3CToken(e)){this.addToken(e.$value,e.$type,e.$description,e.$extensions,t);return}if(this.isTokenStudioToken(e)){this.addToken(e.value,e.type,e.description,e.extensions,t);return}if(this.isPrimitiveToken(e,t)){this.addToken(e,void 0,void 0,void 0,t);return}if(typeof e=="object"){let r=Array.isArray(e)?e.map((i,o)=>String(o)):Object.keys(e);for(let i of r){if(i.startsWith("$")||i==="extensions"||i==="description")continue;let o=Array.isArray(e)?e[parseInt(i)]:e[i];this.collectTokens(o,[...t,i])}}}}addToken(e,t,n,r,i){let o=i[i.length-1]||"unnamed",s=this.inferTokenType({$value:e,$type:t},i),a;typeof e=="string"&&(e.startsWith("{")||e.startsWith("$"))&&(a=this.extractAliases(e));let p={name:o,value:e,type:s,path:[...i],description:n,extensions:r,rawValue:e,aliases:a};this.tokens.push(p),this.tokenMap.set(i.join("."),p)}isW3CToken(e){return e&&typeof e=="object"&&"$value"in e}isTokenStudioToken(e){if(!e||typeof e!="object"||"$value"in e||!("value"in e))return!1;let t=e.value;return typeof t=="string"||typeof t=="number"||typeof t=="boolean"?!0:typeof t=="object"&&t!==null?"type"in e||"description"in e:!1}isPrimitiveToken(e,t){return!(typeof e!="string"&&typeof e!="number"&&typeof e!="boolean"||t.length<1)}isDesignToken(e){return this.isW3CToken(e)}inferTokenType(e,t){if(e.$type)return e.$type;let n=t.join(".").toLowerCase();if(n.includes("color")||n.includes("colour"))return"color";if(n.includes("font")||n.includes("typography")||n.includes("text"))return n.includes("weight")?"fontWeight":n.includes("family")?"fontFamily":"typography";if(n.includes("spacing")||n.includes("size")||n.includes("gap"))return"dimension";if(n.includes("shadow"))return"shadow";if(n.includes("border"))return"border";let r=e.$value;if(typeof r=="string"){if(r.match(/^#[0-9A-Fa-f]{3,8}$/)||r.match(/^rgba?\(/)||r.match(/^hsla?\(/))return"color";if(r.match(/^-?\d+(\.\d+)?(px|rem|em|pt|pc|in|cm|mm|q|vh|vw|vmin|vmax|%)$/))return"dimension";if(r.match(/^\d+(\.\d+)?(ms|s)$/))return"duration"}return typeof r=="number"?"number":typeof r=="boolean"?"boolean":"string"}extractAliases(e){let t=[],n=/\{([^}]+)\}/g,r;for(;(r=n.exec(e))!==null;){let i=r[1].split(",").map(o=>o.trim())[0];i.startsWith("$")&&(i=i.substring(1)),t.push(i)}if(e.startsWith("$")&&!e.startsWith("{")){let i=/\$([a-zA-Z0-9._-]+)/g;for(;(r=i.exec(e))!==null;)t.push(r[1])}return t}resolveAliases(){for(let e of this.tokens)if(e.aliases&&e.aliases.length>0)for(let t of e.aliases){let n=this.tokenMap.get(t);n?(e.value=n.value,e.aliases||(e.aliases=[])):this.errors.push({path:e.path,message:`Unresolved alias: ${t}`,severity:"error"})}}validateTokens(){for(let e of this.tokens){let t=this.validateTokenValue(e);t.valid||this.errors.push({path:e.path,message:t.message||"Validation error",severity:t.severity||"error"})}}validateTokenValue(e){let{type:t,value:n}=e;if(n==null)return{valid:!1,message:"Token value cannot be null or undefined",severity:"error"};switch(t){case"color":return this.validateColor(n);case"dimension":return this.validateDimension(n);case"fontWeight":return this.validateFontWeight(n);case"duration":return this.validateDuration(n);case"typography":return this.validateTypography(n);case"shadow":return this.validateShadow(n);default:return{valid:!0}}}validateColor(e){return typeof e!="string"?{valid:!1,message:"Color value must be a string",severity:"error"}:[/^#[0-9A-Fa-f]{3,8}$/,/^rgba?\([^)]+\)$/,/^hsla?\([^)]+\)$/].some(r=>r.test(e))?{valid:!0}:{valid:!1,message:`Invalid color format: ${e}`,severity:"error"}}validateDimension(e){if(typeof e=="string"){if(!/^-?\d+(\.\d+)?(px|rem|em|pt|pc|in|cm|mm|q|vh|vw|vmin|vmax|%)$/.test(e))return{valid:!1,message:`Invalid dimension format: ${e}`,severity:"error"}}else return typeof e=="number"?{valid:!0}:{valid:!1,message:"Dimension value must be a string or number",severity:"error"};return{valid:!0}}validateFontWeight(e){if(typeof e=="string"){if(!["100","200","300","400","500","600","700","800","900","normal","bold"].includes(e))return{valid:!1,message:`Invalid font weight: ${e}`,severity:"warning"}}else if(typeof e=="number"){if(e<1||e>1e3)return{valid:!1,message:"Font weight must be between 1 and 1000",severity:"error"}}else return{valid:!1,message:"Font weight must be a string or number",severity:"error"};return{valid:!0}}validateDuration(e){return typeof e!="string"?{valid:!1,message:"Duration value must be a string",severity:"error"}:/^\d+(\.\d+)?(ms|s)$/.test(e)?{valid:!0}:{valid:!1,message:`Invalid duration format: ${e}`,severity:"error"}}validateTypography(e){return typeof e!="object"||Array.isArray(e)?{valid:!1,message:"Typography value must be an object",severity:"error"}:e.fontFamily?{valid:!0}:{valid:!1,message:"Typography token missing fontFamily",severity:"warning"}}validateShadow(e){return typeof e!="object"||Array.isArray(e)?{valid:!1,message:"Shadow value must be an object",severity:"error"}:e.color?{valid:!0}:{valid:!1,message:"Shadow token missing color",severity:"warning"}}getTokensByType(e){return this.tokens.filter(t=>t.type===e)}getTokenByPath(e){return this.tokenMap.get(e.join("."))}getErrors(){return this.errors}}});var ae,se,Ce=X(()=>{"use strict";Te();ae=class ae{constructor(){I(this,"parser");this.parser=new ie}parseGitHubUrl(e){let t=[/github\.com[\/:]([^\/]+)\/([^\/\.]+)(\.git)?$/,/github\.com\/([^\/]+)\/([^\/]+)/];for(let n of t){let r=e.match(n);if(r)return{owner:r[1],repo:r[2]}}return null}async fetchBranches(e,t,n){try{let r=await fetch(`https://api.github.com/repos/${e}/${t}/branches`,{headers:{Authorization:`Bearer ${n}`,Accept:"application/vnd.github.v3+json"}});if(!r.ok)throw new Error(`GitHub API error: ${r.status}`);return(await r.json()).map(o=>o.name)}catch(r){throw new Error(`Failed to fetch branches: ${r}`)}}async getLatestCommitSha(e,t,n,r){try{let i=`https://api.github.com/repos/${e}/${t}/commits/${n}`,o=await fetch(i,{headers:{Authorization:`Bearer ${r}`,Accept:"application/vnd.github.v3+json"}});return o.ok?(await o.json()).sha||null:(console.warn(`Failed to get commit SHA: ${o.status}`),null)}catch(i){return console.warn("Failed to get latest commit SHA:",i),null}}async fetchFileContents(e,t,n,r,i){try{let o=`https://api.github.com/repos/${e}/${t}/contents/${i}?ref=${n}`,s=await fetch(o,{headers:{Authorization:`Bearer ${r}`,Accept:"application/vnd.github.v3+json"}});if(!s.ok)throw new Error(`GitHub API error: ${s.status}`);return await s.json()}catch(o){throw new Error(`Failed to fetch file contents: ${o}`)}}async fetchDirectoryContents(e,t,n,r,i=""){try{let o=`https://api.github.com/repos/${e}/${t}/contents/${i}?ref=${n}`,s=await fetch(o,{headers:{Authorization:`Bearer ${r}`,Accept:"application/vnd.github.v3+json"}});if(!s.ok)throw new Error(`GitHub API error: ${s.status}`);let a=await s.json();return Array.isArray(a)?a:[a]}catch(o){throw new Error(`Failed to fetch directory contents: ${o}`)}}decodeBase64Content(e){try{let t=e.replace(/\s/g,""),n;if(typeof atob=="function")n=atob(t);else{let i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";n="";let o=0,s=t.replace(/=+$/,"");for(;o<s.length;){let a=i.indexOf(s.charAt(o++)),p=i.indexOf(s.charAt(o++)),u=i.indexOf(s.charAt(o++)),d=i.indexOf(s.charAt(o++)),f=a<<18|p<<12|(u&63)<<6|d&63;n+=String.fromCharCode(f>>16&255),u!==-1&&(n+=String.fromCharCode(f>>8&255)),d!==-1&&(n+=String.fromCharCode(f&255))}}let r;if(typeof TextDecoder!="undefined"){let i=new Uint8Array(n.length);for(let o=0;o<n.length;o++)i[o]=n.charCodeAt(o);r=new TextDecoder("utf-8").decode(i)}else try{r=decodeURIComponent(escape(n))}catch(i){r=n}return r.charCodeAt(0)===65279&&(r=r.slice(1)),r=r.replace(/\0/g,""),r=r.trim(),r}catch(t){throw new Error(`Failed to decode base64 content: ${t}`)}}parseJSONContent(e){try{return JSON.parse(e)}catch(t){throw new Error(`Failed to parse JSON: ${t}`)}}flattenTokens(e,t=[]){let n=[],r=[],i=d=>d&&typeof d=="object"&&"$value"in d,o=d=>{if(!d||typeof d!="object"||"$value"in d||!("value"in d))return!1;let f=d.value;return typeof f=="string"||typeof f=="number"||typeof f=="boolean"?!0:typeof f=="object"&&f!==null?"type"in d||"description"in d:!1},s=(d,f)=>!(typeof d!="string"&&typeof d!="number"&&typeof d!="boolean"||f.length<1),a=(d,f)=>{let N=f.join(".").toLowerCase();if(typeof d=="string"){if(d.match(/^#[0-9A-Fa-f]{3,8}$/)||d.match(/^rgba?\(/)||d.match(/^hsla?\(/)||N.includes("color"))return"color";if(d.match(/^\d+(\.\d+)?(ms|s)$/)||N.includes("duration"))return"duration";if(d.match(/^-?\d+(\.\d+)?(px|rem|em|pt|pc|in|cm|mm|q|vh|vw|vmin|vmax|%)$/)||N.includes("size")||N.includes("spacing")||N.includes("radius"))return"dimension";if(N.includes("font")||N.includes("typography"))return"typography";if(N.includes("shadow"))return"shadow"}else if(typeof d=="number")return"number";return"string"},p=(d,f,N)=>{let A=N[N.length-1]||"unnamed",C=f||a(d,N);n.push({name:A,path:N,type:C,value:d,rawValue:d})},u=(d,f)=>{if(d==null)return;let N=f[f.length-1]||"";if(!(N.startsWith("$")&&N!=="$value"&&N!=="$type")){if(i(d)){p(d.$value,d.$type,f);return}if(o(d)){p(d.value,d.type,f);return}if(s(d,f)){p(d,void 0,f);return}if(d&&typeof d=="object"){let A=Array.isArray(d)?d.map((C,P)=>String(P)):Object.keys(d);for(let C of A){if(!Array.isArray(d)&&(C.startsWith("$")||C==="extensions"))continue;let P=Array.isArray(d)?d[parseInt(C)]:d[C];u(P,[...f,C])}}}};try{u(e,[])}catch(d){r.push({path:[],message:d instanceof Error?d.message:"Failed to walk tokens"})}return{tokens:n,metadata:{filePath:"",format:"auto-detected",errors:r}}}async fetchTokens(e,t,n,r,i){let o=await this.fetchFileContents(e,t,n,r,i);if(o.type!=="file")throw new Error(`Path is not a file: ${i}`);if(!o.content)throw new Error("File content is empty");let s=this.decodeBase64Content(o.content),a=this.parseJSONContent(s),p=this.parser.parse(a,i);return(!p.tokens||p.tokens.length===0)&&(p=this.flattenTokens(a,[])),p}isExcludedFile(e){var n;let t=((n=e.split("/").pop())==null?void 0:n.toLowerCase())||"";return ae.EXCLUDE_PATTERNS.some(r=>r.test(t)||r.test(e))}async fetchRepoTree(e,t,n,r){try{let i=`https://api.github.com/repos/${e}/${t}/git/trees/${n}?recursive=1`,o=await fetch(i,{headers:{Authorization:`Bearer ${r}`,Accept:"application/vnd.github.v3+json"}});if(!o.ok)throw new Error(`GitHub API error: ${o.status}`);let s=await o.json();return s.truncated?(console.warn("Repository tree was truncated - falling back to recursive fetch"),[]):s.tree||[]}catch(i){return console.error("Failed to fetch repo tree:",i),[]}}async detectTokenFiles(e,t,n,r,i=""){let o=await this.fetchRepoTree(e,t,n,r);if(o.length>0){let s=i.replace(/^\/|\/$/g,"");return o.filter(a=>a.type!=="blob"||!a.path.toLowerCase().endsWith(".json")||s&&!a.path.startsWith(s+"/")&&a.path!==s?!1:!this.isExcludedFile(a.path)).map(a=>a.path)}return this.detectTokenFilesRecursive(e,t,n,r,i)}async detectTokenFilesRecursive(e,t,n,r,i=""){let o=await this.fetchDirectoryContents(e,t,n,r,i),s=[];for(let a of o)if(a.type==="file")a.name.toLowerCase().endsWith(".json")&&!this.isExcludedFile(a.path)&&s.push(a.path);else if(a.type==="dir"&&!this.isExcludedFile(a.path+"/")){let p=await this.detectTokenFilesRecursive(e,t,n,r,a.path);s.push(...p)}return s}};I(ae,"EXCLUDE_PATTERNS",[/package\.json$/i,/package-lock\.json$/i,/tsconfig\.json$/i,/\.config\.json$/i,/eslint.*\.json$/i,/prettier.*\.json$/i,/jest\.config\.json$/i,/webpack\.config\.json$/i,/^\$metadata\.json$/i,/^\$themes\.json$/i,/\(ignore\)\.json$/i,/node_modules\//i,/\.github\//i,/\.vscode\//i]);se=ae});var ce,Ne=X(()=>{"use strict";ce=class{constructor(){I(this,"errors",[]);I(this,"TOKENS_STUDIO_NAMESPACE","tokens");I(this,"DEBUG_LOGGING",!1)}getAllTokenKeys(e){let t={},n=["tokens","tokens-studio","tokensStudio","design-tokens","figma-tokens"];for(let r of n)try{let i=e.getSharedPluginDataKeys(r);for(let o of i){let s=e.getSharedPluginData(r,o);s&&s.trim()&&(t[`${r}:${o}`]=s)}}catch(i){}return t}getVariableBinding(e,t){try{if(!("boundVariables"in e)||!e.boundVariables)return;let r=e.boundVariables[t];if(r){let i=Array.isArray(r)?r[0]:r;if(i!=null&&i.id)try{let o=figma.variables.getVariableById(i.id);if(o!=null&&o.name)return this.DEBUG_LOGGING&&console.log(`[Variable] ${e.name}.${t} \u2192 ${o.name}`),o.name}catch(o){}}}catch(n){}}cleanTokenReference(e){let t=e.trim();for(;t.startsWith('"')&&t.endsWith('"')||t.startsWith("'")&&t.endsWith("'");)t=t.slice(1,-1);return t=t.replace(/^[{]|[}]$/g,""),t=t.replace(/^\$/,""),t.trim()}getTokenReference(e,t){try{let n=["tokens","tokens-studio","tokensStudio","design-tokens"];for(let r of n)try{let i=e.getSharedPluginData(r,t);if(i&&i.trim()){let o=this.cleanTokenReference(i);return this.DEBUG_LOGGING&&console.log(`[TokenRef] Found ${r}:${t} = "${o}" on ${e.name}`),o}}catch(i){}try{let r=e.getPluginData(t);if(r&&r.trim())return this.cleanTokenReference(r)}catch(r){}}catch(n){}}getFillTokenReferences(e,t){let n=[`fills[${t}]`,`fill[${t}]`,`fills.${t}`,`fill.${t}`,"fill","fills","fillColor",`fillColor[${t}]`];for(let r of n){let i=this.getTokenReference(e,r);if(i)return i}}getStrokeTokenReferences(e,t){let n=[`strokes[${t}]`,`stroke[${t}]`,`strokes.${t}`,`stroke.${t}`,"stroke","strokes","strokeColor",`strokeColor[${t}]`,"borderColor"];for(let r of n){let i=this.getTokenReference(e,r);if(i)return i}}getTypographyTokenReference(e,t){let r={fontFamily:["fontFamily","fontFamilies","font-family","typography.fontFamily"],fontSize:["fontSize","fontSizes","font-size","typography.fontSize"],fontWeight:["fontWeight","fontWeights","font-weight","typography.fontWeight"],lineHeight:["lineHeight","lineHeights","line-height","typography.lineHeight"],letterSpacing:["letterSpacing","letter-spacing","typography.letterSpacing"],typography:["typography","text","textStyle","text-style"]}[t]||[t];for(let i of r){let o=this.getTokenReference(e,i);if(o)return o}}getSpacingTokenReference(e,t){let r={width:["width","sizing","dimension","sizing.width","dimensions.width"],height:["height","sizing","dimension","sizing.height","dimensions.height"],padding:["padding","spacing","paddingTop","paddingRight","paddingBottom","paddingLeft"],paddingTop:["paddingTop","verticalPadding","padding","spacing"],paddingRight:["paddingRight","horizontalPadding","padding","spacing"],paddingBottom:["paddingBottom","verticalPadding","padding","spacing"],paddingLeft:["paddingLeft","horizontalPadding","padding","spacing"],verticalPadding:["verticalPadding","paddingTop","paddingBottom","padding","spacing"],horizontalPadding:["horizontalPadding","paddingLeft","paddingRight","padding","spacing"],gap:["itemSpacing","spacing","gap","counterAxisSpacing"],itemSpacing:["itemSpacing","spacing","gap"],counterAxisSpacing:["counterAxisSpacing","spacing"],borderRadius:["borderRadius","borderRadiusTopLeft","borderRadiusTopRight","borderRadiusBottomRight","borderRadiusBottomLeft","radius","cornerRadius"],borderRadiusTopLeft:["borderRadiusTopLeft","borderRadius","radius"],borderRadiusTopRight:["borderRadiusTopRight","borderRadius","radius"],borderRadiusBottomRight:["borderRadiusBottomRight","borderRadius","radius"],borderRadiusBottomLeft:["borderRadiusBottomLeft","borderRadius","radius"],borderWidth:["borderWidth","strokeWeight","borderWidthTop","borderWidthRight","borderWidthBottom","borderWidthLeft","border"],strokeWeight:["strokeWeight","borderWidth","border"],dimension:["dimension","spacing","sizing","size"]}[t]||[t];for(let o of r){let s=this.getTokenReference(e,o);if(s)return s}let i=this.getVariableBinding(e,t);if(i)return i}getBorderRadiusTokenReference(e){let t=["borderRadius","borderRadiusTopLeft","borderRadiusTopRight","borderRadiusBottomRight","borderRadiusBottomLeft","radius","cornerRadius","topLeftRadius","topRightRadius","bottomRightRadius","bottomLeftRadius"];for(let r of t){let i=this.getTokenReference(e,r);if(i)return this.DEBUG_LOGGING&&console.log(`[BorderRadius] Found ${r} = "${i}" on ${e.name}`),i}let n=this.getVariableBinding(e,"cornerRadius");if(n)return n}getBorderWidthTokenReference(e){let t=["borderWidth","strokeWeight","borderWidthTop","borderWidthRight","borderWidthBottom","borderWidthLeft","border","strokeWidth"];for(let r of t){let i=this.getTokenReference(e,r);if(i)return this.DEBUG_LOGGING&&console.log(`[BorderWidth] Found ${r} = "${i}" on ${e.name}`),i}let n=this.getVariableBinding(e,"strokeWeight");if(n)return n}getEffectTokenReference(e,t){let n=["boxShadow","shadow",`boxShadow[${t}]`,`shadow[${t}]`,"effects","effect",`effects[${t}]`,`effect[${t}]`,"dropShadow","innerShadow","elevation","shadowColor","shadowOffset","shadowRadius","shadowSpread"];for(let i of n){let o=this.getTokenReference(e,i);if(o)return this.DEBUG_LOGGING&&console.log(`[Effect] Found ${i} = "${o}" on ${e.name}`),o}let r=this.getVariableBinding(e,"effects");if(r)return r}logNodeTokenData(e){if(!this.DEBUG_LOGGING)return;let t=this.getAllTokenKeys(e);if(Object.keys(t).length>0){console.log(`
[TokenData] Node: "${e.name}" (${e.type})`);for(let[n,r]of Object.entries(t)){let i=this.cleanTokenReference(r);console.log(i!==r?`  ${n} = ${i} (raw: ${r})`:`  ${n} = ${i}`)}}}scanAllComponents(){this.errors=[];let e=[],t=0,n=figma.root.children;for(let r of n)if(r.type==="PAGE"){let i=r.findAll(s=>s.type==="COMPONENT"||s.type==="COMPONENT_SET"),o=r.findAll(s=>s.type==="INSTANCE");t+=o.length;for(let s of i)try{let a=this.extractComponentProperties(s,r.name);a&&e.push(a)}catch(a){this.errors.push({componentId:s.id,componentName:s.name,error:a instanceof Error?a.message:"Unknown error"})}}return{components:e,totalComponents:e.length,totalInstances:t,pagesScanned:n.length,errors:this.errors}}scanFilteredPages(e){this.errors=[];let t=[],n=0,r=figma.root.children,i=e.map(s=>s.toLowerCase().trim()),o=r.filter(s=>s.type==="PAGE"&&i.includes(s.name.toLowerCase().trim()));for(let s of o)if(s.type==="PAGE"){let a=s.findAll(u=>u.type==="COMPONENT"||u.type==="COMPONENT_SET"),p=s.findAll(u=>u.type==="INSTANCE");n+=p.length;for(let u of a)try{let d=this.extractComponentProperties(u,s.name);d&&t.push(d)}catch(d){this.errors.push({componentId:u.id,componentName:u.name,error:d instanceof Error?d.message:"Unknown error"})}}return{components:t,totalComponents:t.length,totalInstances:n,pagesScanned:o.length,errors:this.errors}}scanCurrentPage(){this.errors=[];let e=[],t=figma.currentPage,n=0,r=t.findAll(o=>o.type==="COMPONENT"||o.type==="COMPONENT_SET"),i=t.findAll(o=>o.type==="INSTANCE");n+=i.length;for(let o of r)try{let s=this.extractComponentProperties(o,t.name);s&&e.push(s)}catch(s){this.errors.push({componentId:o.id,componentName:o.name,error:s instanceof Error?s.message:"Unknown error"})}return{components:e,totalComponents:e.length,totalInstances:n,pagesScanned:1,errors:this.errors}}scanNodes(e){this.errors=[];let t=[],n=0,r=figma.currentPage;for(let i of e){let o=[],s=[];"findAll"in i&&typeof i.findAll=="function"&&(o=i.findAll(a=>a.type==="COMPONENT"||a.type==="COMPONENT_SET"),s=i.findAll(a=>a.type==="INSTANCE"),n+=s.length);for(let a of o)try{let p=this.extractComponentProperties(a,r.name);p&&t.push(p)}catch(p){this.errors.push({componentId:a.id,componentName:a.name,error:p instanceof Error?p.message:"Unknown error"})}if(i.type==="COMPONENT"||i.type==="COMPONENT_SET")try{let a=this.extractComponentProperties(i,r.name);a&&(t.find(p=>p.id===a.id)||t.push(a))}catch(a){this.errors.push({componentId:i.id,componentName:i.name,error:a instanceof Error?a.message:"Unknown error"})}}return{components:t,totalComponents:t.length,totalInstances:n,pagesScanned:1,errors:this.errors}}extractComponentProperties(e,t){var r,i;if(e.type!=="COMPONENT"&&e.type!=="COMPONENT_SET"&&e.type!=="INSTANCE")return null;let n={id:e.id,name:e.name,type:e.type,pageName:t,colors:[],typography:[],spacing:[],effects:[]};if(e.type==="COMPONENT_SET")n.mainComponentName=e.name,n.mainComponentId=e.id;else if(e.type==="COMPONENT"){let o=e;((r=o.parent)==null?void 0:r.type)==="COMPONENT_SET"?(n.mainComponentName=o.parent.name,n.mainComponentId=o.parent.id):(n.mainComponentName=e.name,n.mainComponentId=e.id)}else if(e.type==="INSTANCE"){let o=e;try{let s=o.mainComponent;s&&(((i=s.parent)==null?void 0:i.type)==="COMPONENT_SET"?(n.mainComponentName=s.parent.name,n.mainComponentId=s.parent.id):(n.mainComponentName=s.name,n.mainComponentId=s.id))}catch(s){n.mainComponentName=e.name.split(",")[0].trim()}}if(n.colors=this.extractColors(e),n.typography=this.extractTypography(e),n.spacing=this.extractSpacing(e),n.effects=this.extractEffects(e),e.type==="COMPONENT"||e.type==="COMPONENT_SET"){let o=e;"layoutMode"in o&&o.layoutMode&&(n.layoutMode=o.layoutMode,n.itemSpacing=o.itemSpacing,n.paddingTop=o.paddingTop,n.paddingRight=o.paddingRight,n.paddingBottom=o.paddingBottom,n.paddingLeft=o.paddingLeft),n.width=o.width,n.height=o.height}else if(e.type==="INSTANCE"){let o=e;n.width=o.width,n.height=o.height}if("children"in e){let o=[];for(let s of e.children){let a=this.extractComponentProperties(s,t);a&&o.push(a)}o.length>0&&(n.children=o)}return n}extractColors(e){var n,r;let t=[];if("fills"in e&&Array.isArray(e.fills))for(let i=0;i<e.fills.length;i++){let o=e.fills[i];if(o.type==="SOLID"){let s=(n=o.opacity)!=null?n:1,a=this.rgbaToColor(o.color,s),p=this.getFillTokenReferences(e,i);t.push({type:"fill",color:{r:o.color.r,g:o.color.g,b:o.color.b,a:s},hex:a.hex,rgba:a.rgba,opacity:s,tokenReference:p})}}if("strokes"in e&&Array.isArray(e.strokes))for(let i=0;i<e.strokes.length;i++){let o=e.strokes[i];if(o.type==="SOLID"){let s=(r=o.opacity)!=null?r:1,a=this.rgbaToColor(o.color,s),p=this.getStrokeTokenReferences(e,i);t.push({type:"stroke",color:{r:o.color.r,g:o.color.g,b:o.color.b,a:s},hex:a.hex,rgba:a.rgba,opacity:s,tokenReference:p})}}return t}extractTypography(e){let t=[];if(e.type==="TEXT"){let n=e;if(typeof n.fontName!="symbol"){let r=n.fontName,i=this.getTypographyTokenReference(n,"typography"),o=this.getTypographyTokenReference(n,"fontFamily"),s=this.getTypographyTokenReference(n,"fontSize"),a=this.getTypographyTokenReference(n,"fontWeight"),p=this.getTypographyTokenReference(n,"lineHeight"),u=this.getTypographyTokenReference(n,"letterSpacing"),d=i||o||s||a||p||u;t.push({fontFamily:r.family,fontSize:typeof n.fontSize=="number"?n.fontSize:16,fontWeight:typeof r.style=="string"?this.parseFontWeight(r.style):400,lineHeight:typeof n.lineHeight=="number"||typeof n.lineHeight=="string"?n.lineHeight:void 0,letterSpacing:typeof n.letterSpacing=="number"?n.letterSpacing:void 0,textDecoration:typeof n.textDecoration=="string"?n.textDecoration:void 0,textCase:typeof n.textCase=="string"?n.textCase:void 0,tokenReference:d})}}if("children"in e)for(let n of e.children)t.push(...this.extractTypography(n));return t}extractSpacing(e){let t=[];if(this.logNodeTokenData(e),e.type==="COMPONENT"||e.type==="COMPONENT_SET"||e.type==="FRAME"||e.type==="INSTANCE"){let r=e,i=this.getSpacingTokenReference(e,"width"),o=this.getSpacingTokenReference(e,"height");if(t.push({type:"width",value:r.width,unit:"px",tokenReference:i}),t.push({type:"height",value:r.height,unit:"px",tokenReference:o}),"paddingTop"in r&&typeof r.paddingTop=="number"){let s=this.getSpacingTokenReference(e,"horizontalPadding"),a=this.getSpacingTokenReference(e,"verticalPadding"),p=this.getSpacingTokenReference(e,"padding"),u=this.getSpacingTokenReference(e,"paddingTop"),d=this.getSpacingTokenReference(e,"paddingRight"),f=this.getSpacingTokenReference(e,"paddingBottom"),N=this.getSpacingTokenReference(e,"paddingLeft"),A=(P,z)=>P?`[${z}] ${P}`:void 0,C=(P,z,J)=>{if(P)return P;if(z)return A(z,J);if(p)return A(p,"all")};r.paddingTop&&t.push({type:"padding",value:r.paddingTop,unit:"px",tokenReference:C(u,a,"vertical")}),r.paddingRight&&t.push({type:"padding",value:r.paddingRight,unit:"px",tokenReference:C(d,s,"horizontal")}),r.paddingBottom&&t.push({type:"padding",value:r.paddingBottom,unit:"px",tokenReference:C(f,a,"vertical")}),r.paddingLeft&&t.push({type:"padding",value:r.paddingLeft,unit:"px",tokenReference:C(N,s,"horizontal")})}if("itemSpacing"in r&&typeof r.itemSpacing=="number"&&r.itemSpacing){let s=this.getSpacingTokenReference(e,"itemSpacing")||this.getSpacingTokenReference(e,"gap")||this.getSpacingTokenReference(e,"spacing");t.push({type:"gap",value:r.itemSpacing,unit:"px",tokenReference:s})}if("counterAxisSpacing"in r&&typeof r.counterAxisSpacing=="number"&&r.counterAxisSpacing){let s=this.getSpacingTokenReference(e,"counterAxisSpacing");t.push({type:"gap",value:r.counterAxisSpacing,unit:"px",tokenReference:s})}if("cornerRadius"in r){let s=this.getBorderRadiusTokenReference(e);typeof r.cornerRadius=="number"&&r.cornerRadius>0?t.push({type:"borderRadius",value:r.cornerRadius,unit:"px",tokenReference:s}):r.cornerRadius===figma.mixed&&("topLeftRadius"in r&&typeof r.topLeftRadius=="number"&&r.topLeftRadius>0&&t.push({type:"borderRadius",value:r.topLeftRadius,unit:"px",tokenReference:this.getSpacingTokenReference(e,"borderRadiusTopLeft")||s}),"topRightRadius"in r&&typeof r.topRightRadius=="number"&&r.topRightRadius>0&&t.push({type:"borderRadius",value:r.topRightRadius,unit:"px",tokenReference:this.getSpacingTokenReference(e,"borderRadiusTopRight")||s}),"bottomRightRadius"in r&&typeof r.bottomRightRadius=="number"&&r.bottomRightRadius>0&&t.push({type:"borderRadius",value:r.bottomRightRadius,unit:"px",tokenReference:this.getSpacingTokenReference(e,"borderRadiusBottomRight")||s}),"bottomLeftRadius"in r&&typeof r.bottomLeftRadius=="number"&&r.bottomLeftRadius>0&&t.push({type:"borderRadius",value:r.bottomLeftRadius,unit:"px",tokenReference:this.getSpacingTokenReference(e,"borderRadiusBottomLeft")||s}))}if("strokeWeight"in r&&typeof r.strokeWeight=="number"&&r.strokeWeight>0){let s=this.getBorderWidthTokenReference(e);t.push({type:"borderWidth",value:r.strokeWeight,unit:"px",tokenReference:s})}}else if("cornerRadius"in e){let r=this.getBorderRadiusTokenReference(e),i=e;typeof i.cornerRadius=="number"&&i.cornerRadius>0&&t.push({type:"borderRadius",value:i.cornerRadius,unit:"px",tokenReference:r})}return t}extractEffects(e){var n,r,i,o,s,a,p,u;let t=[];if("effects"in e&&Array.isArray(e.effects))for(let d=0;d<e.effects.length;d++){let f=e.effects[d];if(f.visible){let N=this.getEffectTokenReference(e,d);switch(f.type){case"DROP_SHADOW":t.push({type:"drop-shadow",visible:f.visible,radius:f.radius,color:f.color?{r:f.color.r,g:f.color.g,b:f.color.b,a:f.color.a}:void 0,offset:{x:(r=(n=f.offset)==null?void 0:n.x)!=null?r:0,y:(o=(i=f.offset)==null?void 0:i.y)!=null?o:0},spread:f.spread,tokenReference:N});break;case"INNER_SHADOW":t.push({type:"inner-shadow",visible:f.visible,radius:f.radius,color:f.color?{r:f.color.r,g:f.color.g,b:f.color.b,a:f.color.a}:void 0,offset:{x:(a=(s=f.offset)==null?void 0:s.x)!=null?a:0,y:(u=(p=f.offset)==null?void 0:p.y)!=null?u:0},spread:f.spread,tokenReference:N});break;case"LAYER_BLUR":t.push({type:"layer-blur",visible:f.visible,radius:f.radius,tokenReference:N});break;case"BACKGROUND_BLUR":t.push({type:"background-blur",visible:f.visible,radius:f.radius,tokenReference:N});break}}}return t}rgbaToColor(e,t){let n=Math.round(e.r*255),r=Math.round(e.g*255),i=Math.round(e.b*255),o=t,s=`#${[n,r,i].map(p=>{let u=p.toString(16);return u.length===1?"0"+u:u}).join("")}`,a=`rgba(${n}, ${r}, ${i}, ${o.toFixed(2)})`;return{hex:s,rgba:a}}parseFontWeight(e){let t={thin:100,extralight:200,light:300,regular:400,medium:500,semibold:600,bold:700,extrabold:800,black:900},n=e.toLowerCase();for(let[i,o]of Object.entries(t))if(n.includes(i))return o;let r=e.match(/(\d+)/);return r?parseInt(r[1],10):400}getComponentUsageStats(e){let t=[],n=new Set;for(let r of figma.root.children)if(r.type==="PAGE"){let i=r.findAll(o=>{var s;return o.type==="INSTANCE"&&((s=o.mainComponent)==null?void 0:s.id)===e});i.length>0&&(t.push(...i),n.add(r.name))}return{instances:t.length,pages:Array.from(n)}}}});var le,Re=X(()=>{"use strict";le=class{constructor(){I(this,"errors",[]);I(this,"cache",new Map);I(this,"cacheMaxAge",5*60*1e3);I(this,"tokenIndex",{byPath:new Map,byValue:new Map});I(this,"TOKENS_STUDIO_NAMESPACE","tokens");I(this,"debugLogging",!1)}setDebugLogging(e){this.debugLogging=e}clearCache(){this.cache.clear(),this.tokenIndex={byPath:new Map,byValue:new Map}}getCacheStats(){return{entries:this.cache.size,indexedPaths:this.tokenIndex.byPath.size,indexedValues:this.tokenIndex.byValue.size}}async scanAllComponentsOptimized(e={}){this.errors=[];let t=[],n=0,{tokenType:r="all",maxNodesPerPage:i=0,maxPages:o=0,chunkSize:s=100,onProgress:a,includeChildren:p=!0,maxDepth:u=3,useCache:d=!0,pageFilter:f=[]}=e,N=figma.root.children.filter(P=>P.type==="PAGE"),A=f.length>0?N.filter(P=>f.includes(P.name)):N,C=o>0?Math.min(o,A.length):A.length;for(let P=0;P<C;P++){let z=A[P];a==null||a({currentPage:P+1,totalPages:C,currentPageName:z.name,componentsFound:t.length,nodesScanned:0,phase:"scanning"});let J=`${z.id}-${r}`;if(d){let ee=this.getFromCache(J);if(ee){t.push(...ee);continue}}let ne=await this.scanPageChunked(z,r,s,i,p,u,ee=>{a==null||a({currentPage:P+1,totalPages:C,currentPageName:z.name,componentsFound:t.length,nodesScanned:ee,phase:"scanning"})});d&&this.cache.set(J,{components:ne.components,timestamp:Date.now()}),t.push(...ne.components),n+=ne.totalInstances,await this.yieldToMain()}return this.buildTokenIndex(t),a==null||a({currentPage:C,totalPages:C,currentPageName:"Complete",componentsFound:t.length,nodesScanned:0,phase:"complete"}),{components:t,totalComponents:t.length,totalInstances:n,pagesScanned:C,errors:this.errors}}async scanPageChunked(e,t,n,r,i,o,s){let a=[],p=0,u=0,d=[];this.collectComponentNodes(e,d,r);for(let f=0;f<d.length;f+=n){let N=d.slice(f,f+n);for(let A of N)try{let C=this.extractComponentPropertiesOptimized(A,e.name,t,i,o,0);C&&a.push(C),u++,s==null||s(u)}catch(C){this.errors.push({componentId:A.id,componentName:A.name,error:C instanceof Error?C.message:"Unknown error"})}f+n<d.length&&await this.yieldToMain()}return{components:a,totalInstances:p}}collectComponentNodes(e,t,n){if(!(n>0&&t.length>=n))for(let r of e.children){if(n>0&&t.length>=n)break;(r.type==="COMPONENT"||r.type==="COMPONENT_SET")&&t.push(r),"children"in r&&(r.type==="FRAME"||r.type==="GROUP"||r.type==="SECTION")&&this.collectComponentNodes(r,t,n)}}extractComponentPropertiesOptimized(e,t,n,r,i,o){var N,A;if(e.type!=="COMPONENT"&&e.type!=="COMPONENT_SET"&&e.type!=="INSTANCE"&&e.type!=="FRAME")return null;let s=e.type==="FRAME"?"COMPONENT":e.type,a={id:e.id,name:e.name,type:s,pageName:t,colors:[],typography:[],spacing:[],effects:[]};if(e.type==="COMPONENT_SET")a.mainComponentName=e.name,a.mainComponentId=e.id;else if(e.type==="COMPONENT"){let C=e;((N=C.parent)==null?void 0:N.type)==="COMPONENT_SET"?(a.mainComponentName=C.parent.name,a.mainComponentId=C.parent.id):(a.mainComponentName=e.name,a.mainComponentId=e.id)}else if(e.type==="INSTANCE"){let C=e;try{let P=C.mainComponent;P&&(((A=P.parent)==null?void 0:A.type)==="COMPONENT_SET"?(a.mainComponentName=P.parent.name,a.mainComponentId=P.parent.id):(a.mainComponentName=P.name,a.mainComponentId=P.id))}catch(P){a.mainComponentName=e.name.split(",")[0].trim()}}let p=n==="all"||n==="color",u=n==="all"||n==="typography",d=n==="all"||["dimension","spacing","borderRadius","borderWidth"].includes(n),f=n==="all"||["effect","shadow"].includes(n);if(p&&(a.colors=this.extractColorsOptimized(e)),u&&(a.typography=this.extractTypographyOptimized(e,r)),d&&(a.spacing=this.extractSpacingOptimized(e,n)),f&&(a.effects=this.extractEffectsOptimized(e)),e.type==="COMPONENT"||e.type==="COMPONENT_SET"||e.type==="FRAME"){let C=e;"layoutMode"in C&&C.layoutMode&&(a.layoutMode=C.layoutMode,a.itemSpacing=C.itemSpacing),a.width=C.width,a.height=C.height}if(r&&o<i&&"children"in e){let C=[];for(let P of e.children){if(this.shouldSkipNode(P,n))continue;let z=this.extractComponentPropertiesOptimized(P,t,n,r,i,o+1);z&&this.hasRelevantProperties(z)&&C.push(z)}C.length>0&&(a.children=C)}return a}shouldSkipNode(e,t){return"visible"in e&&!e.visible||(e.type==="VECTOR"||e.type==="BOOLEAN_OPERATION")&&t!=="color"||"width"in e&&"height"in e&&(e.width<1||e.height<1)}hasRelevantProperties(e){return!!(e.colors.length>0||e.typography.length>0||e.spacing.length>0||e.effects.length>0||e.children&&e.children.length>0)}extractColorsOptimized(e){var n,r;let t=[];if("fills"in e&&Array.isArray(e.fills))for(let i=0;i<e.fills.length;i++){let o=e.fills[i];if(o.type==="SOLID"){let s=(n=o.opacity)!=null?n:1,a=this.rgbaToColor(o.color,s),p=this.getFillTokenReferencesFast(e,i);t.push({type:"fill",color:{r:o.color.r,g:o.color.g,b:o.color.b,a:s},hex:a.hex,rgba:a.rgba,opacity:s,tokenReference:p})}}if("strokes"in e&&Array.isArray(e.strokes))for(let i=0;i<e.strokes.length;i++){let o=e.strokes[i];if(o.type==="SOLID"){let s=(r=o.opacity)!=null?r:1,a=this.rgbaToColor(o.color,s),p=this.getStrokeTokenReferencesFast(e,i);t.push({type:"stroke",color:{r:o.color.r,g:o.color.g,b:o.color.b,a:s},hex:a.hex,rgba:a.rgba,opacity:s,tokenReference:p})}}return t}extractTypographyOptimized(e,t){let n=[];if(e.type==="TEXT"){let r=e;if(typeof r.fontName!="symbol"){let i=r.fontName,o=this.getTypographyTokenFast(r);n.push({fontFamily:i.family,fontSize:typeof r.fontSize=="number"?r.fontSize:16,fontWeight:typeof i.style=="string"?this.parseFontWeight(i.style):400,lineHeight:typeof r.lineHeight=="number"?r.lineHeight:void 0,letterSpacing:typeof r.letterSpacing=="number"?r.letterSpacing:void 0,tokenReference:o})}}if(t&&"children"in e)for(let r of e.children)(r.type==="TEXT"||"children"in r&&this.containsTextNode(r))&&n.push(...this.extractTypographyOptimized(r,t));return n}containsTextNode(e){if(e.type==="TEXT")return!0;if("children"in e){for(let t of e.children)if(t.type==="TEXT"||"children"in t&&t.children.length>0&&t.children.some(n=>n.type==="TEXT"))return!0}return!1}extractSpacingOptimized(e,t){let n=[],r=e.type==="COMPONENT"||e.type==="COMPONENT_SET"||e.type==="FRAME"||e.type==="INSTANCE";if(!r&&!("cornerRadius"in e))return n;let i=t==="all"||t==="dimension"||t==="spacing",o=t==="all"||t==="borderRadius",s=t==="all"||t==="borderWidth";if(r){let a=e;if(i&&n.push({type:"width",value:a.width,unit:"px",tokenReference:this.getSpacingTokenFast(e,"width")},{type:"height",value:a.height,unit:"px",tokenReference:this.getSpacingTokenFast(e,"height")}),i&&"paddingTop"in a&&typeof a.paddingTop=="number"){let p=this.getSpacingTokenFast(e,"horizontalPadding"),u=this.getSpacingTokenFast(e,"verticalPadding"),d=this.getSpacingTokenFast(e,"padding");a.paddingTop&&n.push({type:"padding",value:a.paddingTop,unit:"px",tokenReference:u||d}),a.paddingRight&&n.push({type:"padding",value:a.paddingRight,unit:"px",tokenReference:p||d}),a.paddingBottom&&n.push({type:"padding",value:a.paddingBottom,unit:"px",tokenReference:u||d}),a.paddingLeft&&n.push({type:"padding",value:a.paddingLeft,unit:"px",tokenReference:p||d})}if(i&&"itemSpacing"in a&&a.itemSpacing&&n.push({type:"gap",value:a.itemSpacing,unit:"px",tokenReference:this.getSpacingTokenFast(e,"itemSpacing")}),o&&"cornerRadius"in a){let p=this.getBorderRadiusTokenFast(e);typeof a.cornerRadius=="number"&&a.cornerRadius>0&&n.push({type:"borderRadius",value:a.cornerRadius,unit:"px",tokenReference:p})}s&&"strokeWeight"in a&&typeof a.strokeWeight=="number"&&a.strokeWeight>0&&n.push({type:"borderWidth",value:a.strokeWeight,unit:"px",tokenReference:this.getBorderWidthTokenFast(e)})}else if(o&&"cornerRadius"in e){let a=e,p=this.getBorderRadiusTokenFast(e);typeof a.cornerRadius=="number"&&a.cornerRadius>0&&n.push({type:"borderRadius",value:a.cornerRadius,unit:"px",tokenReference:p})}return n}extractEffectsOptimized(e){var n,r,i,o;let t=[];if(!("effects"in e)||!Array.isArray(e.effects))return t;for(let s=0;s<e.effects.length;s++){let a=e.effects[s];if(!a.visible)continue;let p=this.getEffectTokenFast(e,s);a.type==="DROP_SHADOW"||a.type==="INNER_SHADOW"?t.push({type:a.type==="DROP_SHADOW"?"drop-shadow":"inner-shadow",visible:a.visible,radius:a.radius,color:a.color?{r:a.color.r,g:a.color.g,b:a.color.b,a:a.color.a}:void 0,offset:{x:(r=(n=a.offset)==null?void 0:n.x)!=null?r:0,y:(o=(i=a.offset)==null?void 0:i.y)!=null?o:0},spread:a.spread,tokenReference:p}):(a.type==="LAYER_BLUR"||a.type==="BACKGROUND_BLUR")&&t.push({type:a.type==="LAYER_BLUR"?"layer-blur":"background-blur",visible:a.visible,radius:a.radius,tokenReference:p})}return t}getFillTokenReferencesFast(e,t){return this.getSharedDataFast(e,"fill")||this.getSharedDataFast(e,`fills.${t}`)||this.getSharedDataFast(e,"fillColor")||this.getVariableBindingFast(e,"fills")}getStrokeTokenReferencesFast(e,t){return this.getSharedDataFast(e,"stroke")||this.getSharedDataFast(e,`strokes.${t}`)||this.getSharedDataFast(e,"strokeColor")||this.getVariableBindingFast(e,"strokes")}getTypographyTokenFast(e){return this.getSharedDataFast(e,"typography")||this.getSharedDataFast(e,"fontFamily")||this.getSharedDataFast(e,"fontSize")}getSpacingTokenFast(e,t){return this.getSharedDataFast(e,t)||this.getVariableBindingFast(e,t)}getBorderRadiusTokenFast(e){return this.getSharedDataFast(e,"borderRadius")||this.getSharedDataFast(e,"cornerRadius")||this.getVariableBindingFast(e,"cornerRadius")}getBorderWidthTokenFast(e){return this.getSharedDataFast(e,"borderWidth")||this.getSharedDataFast(e,"strokeWeight")||this.getVariableBindingFast(e,"strokeWeight")}getEffectTokenFast(e,t){return this.getSharedDataFast(e,"boxShadow")||this.getSharedDataFast(e,`effects.${t}`)||this.getVariableBindingFast(e,"effects")}getSharedDataFast(e,t){try{let n=e.getSharedPluginData("tokens",t);if(n&&n.trim())return this.cleanTokenReference(n)}catch(n){}}getVariableBindingFast(e,t){try{if(!("boundVariables"in e)||!e.boundVariables)return;let r=e.boundVariables[t];if(r){let i=Array.isArray(r)?r[0]:r;if(i!=null&&i.id){let o=figma.variables.getVariableById(i.id);return o==null?void 0:o.name}}}catch(n){}}cleanTokenReference(e){let t=e.trim();for(;t.startsWith('"')&&t.endsWith('"')||t.startsWith("'")&&t.endsWith("'");)t=t.slice(1,-1);return t=t.replace(/^[{]|[}]$/g,""),t=t.replace(/^\$/,""),t.trim()}buildTokenIndex(e){this.tokenIndex={byPath:new Map,byValue:new Map};let t=n=>{for(let r of n.colors)r.tokenReference&&this.addToIndex(this.tokenIndex.byPath,r.tokenReference.toLowerCase(),n.id),r.hex&&this.addToIndex(this.tokenIndex.byValue,r.hex.toLowerCase(),n.id);for(let r of n.spacing){if(r.tokenReference){let i=r.tokenReference.replace(/^\[\w+\]\s*/,"").toLowerCase();this.addToIndex(this.tokenIndex.byPath,i,n.id)}this.addToIndex(this.tokenIndex.byValue,`${r.value}${r.unit}`,n.id)}for(let r of n.effects)r.tokenReference&&this.addToIndex(this.tokenIndex.byPath,r.tokenReference.toLowerCase(),n.id);for(let r of n.typography)r.tokenReference&&this.addToIndex(this.tokenIndex.byPath,r.tokenReference.toLowerCase(),n.id);if(n.children)for(let r of n.children)t(r)};for(let n of e)t(n)}addToIndex(e,t,n){e.has(t)||e.set(t,new Set),e.get(t).add(n)}getComponentsByTokenPath(e){let t=e.toLowerCase(),n=this.tokenIndex.byPath.get(t);if(n)return Array.from(n);let r=new Set,i=Array.from(this.tokenIndex.byPath.entries());for(let[o,s]of i)(o.includes(t)||t.includes(o))&&s.forEach(a=>r.add(a));return Array.from(r)}getComponentsByTokenValue(e){let t=e.toLowerCase();return Array.from(this.tokenIndex.byValue.get(t)||[])}yieldToMain(){return new Promise(e=>setTimeout(e,0))}getFromCache(e){let t=this.cache.get(e);return t&&Date.now()-t.timestamp<this.cacheMaxAge?t.components:null}rgbaToColor(e,t){let n=Math.round(e.r*255),r=Math.round(e.g*255),i=Math.round(e.b*255),o=`#${[n,r,i].map(a=>a.toString(16).padStart(2,"0")).join("")}`,s=`rgba(${n}, ${r}, ${i}, ${t.toFixed(2)})`;return{hex:o,rgba:s}}parseFontWeight(e){let t={thin:100,extralight:200,light:300,regular:400,medium:500,semibold:600,bold:700,extrabold:800,black:900},n=e.toLowerCase();for(let[i,o]of Object.entries(t))if(n.includes(i))return o;let r=e.match(/(\d+)/);return r?parseInt(r[1],10):400}scanAllComponents(){this.errors=[];let e=[],t=0,n=figma.root.children;for(let r of n)if(r.type==="PAGE"){let i=r.findAll(o=>o.type==="COMPONENT"||o.type==="COMPONENT_SET");for(let o of i)try{let s=this.extractComponentPropertiesOptimized(o,r.name,"all",!0,3,0);s&&e.push(s)}catch(s){this.errors.push({componentId:o.id,componentName:o.name,error:s instanceof Error?s.message:"Unknown error"})}}return{components:e,totalComponents:e.length,totalInstances:t,pagesScanned:n.length,errors:this.errors}}scanFilteredPages(e){this.errors=[];let t=[],n=0,r=figma.root.children,i=e.map(s=>s.toLowerCase().trim()),o=r.filter(s=>s.type==="PAGE"&&i.includes(s.name.toLowerCase().trim()));for(let s of o)if(s.type==="PAGE"){let a=s.findAll(p=>p.type==="COMPONENT"||p.type==="COMPONENT_SET");for(let p of a)try{let u=this.extractComponentPropertiesOptimized(p,s.name,"all",!0,3,0);u&&t.push(u)}catch(u){this.errors.push({componentId:p.id,componentName:p.name,error:u instanceof Error?u.message:"Unknown error"})}}return{components:t,totalComponents:t.length,totalInstances:n,pagesScanned:o.length,errors:this.errors}}scanCurrentPage(){this.errors=[];let e=[],t=figma.currentPage,n=t.findAll(r=>r.type==="COMPONENT"||r.type==="COMPONENT_SET");for(let r of n)try{let i=this.extractComponentPropertiesOptimized(r,t.name,"all",!0,3,0);i&&e.push(i)}catch(i){this.errors.push({componentId:r.id,componentName:r.name,error:i instanceof Error?i.message:"Unknown error"})}return{components:e,totalComponents:e.length,totalInstances:0,pagesScanned:1,errors:this.errors}}scanNodes(e){this.errors=[];let t=[],n=figma.currentPage;for(let r of e){if("findAll"in r&&typeof r.findAll=="function"){let i=r.findAll(o=>o.type==="COMPONENT"||o.type==="COMPONENT_SET");for(let o of i)try{let s=this.extractComponentPropertiesOptimized(o,n.name,"all",!0,3,0);s&&t.push(s)}catch(s){this.errors.push({componentId:o.id,componentName:o.name,error:s instanceof Error?s.message:"Unknown error"})}}if(r.type==="COMPONENT"||r.type==="COMPONENT_SET")try{let i=this.extractComponentPropertiesOptimized(r,n.name,"all",!0,3,0);i&&!t.find(o=>o.id===i.id)&&t.push(i)}catch(i){this.errors.push({componentId:r.id,componentName:r.name,error:i instanceof Error?i.message:"Unknown error"})}}return{components:t,totalComponents:t.length,totalInstances:0,pagesScanned:1,errors:this.errors}}getComponentUsageStats(e){let t=new Set,n=0;for(let r of figma.root.children)if(r.type==="PAGE"){let i=r.findAll(o=>{var s;return o.type==="INSTANCE"&&((s=o.mainComponent)==null?void 0:s.id)===e});i.length>0&&(n+=i.length,t.add(r.name))}return{instances:n,pages:Array.from(t)}}}});var pe,Se=X(()=>{"use strict";pe=class{constructor(){I(this,"MIN_CONFIDENCE_THRESHOLD",.85)}matchTokenToComponents(e,t){let n=[];for(let r of t.components){let o=this.matchComponentRecursively(e,r).filter(s=>s.confidence>=this.MIN_CONFIDENCE_THRESHOLD);if(o.length>0){let s=o.reduce((a,p)=>a+p.confidence,0)/o.length;n.push({component:r,matches:o,confidence:s})}}return n.sort((r,i)=>i.confidence-r.confidence),{token:e,matchingComponents:n,totalMatches:n.length,totalComponentsScanned:t.totalComponents}}matchComponentRecursively(e,t){let n=[];switch(e.type){case"color":n.push(...this.matchColor(e,t));break;case"fontFamily":case"fontWeight":case"typography":n.push(...this.matchTypography(e,t));break;case"dimension":n.push(...this.matchSpacing(e,t));break;case"shadow":n.push(...this.matchEffects(e,t));break;case"borderRadius":n.push(...this.matchSpacing(e,t,"borderRadius"));break;case"borderWidth":n.push(...this.matchSpacing(e,t,"borderWidth"));break;default:n.push(...this.matchByValue(e,t)),this.looksLikeSpacingToken(e)&&n.push(...this.matchSpacing(e,t)),this.looksLikeBorderRadiusToken(e)&&n.push(...this.matchSpacing(e,t,"borderRadius")),this.looksLikeBorderToken(e)&&n.push(...this.matchSpacing(e,t,"borderWidth")),this.looksLikeEffectToken(e)&&n.push(...this.matchEffects(e,t))}if(t.children&&t.children.length>0)for(let r of t.children){let i=this.matchComponentRecursively(e,r);for(let o of i)n.push(Q(Y({},o),{property:`${r.name} \u2192 ${o.property}`}))}return n}matchColor(e,t){let n=[],r=e.path.join("."),i=this.normalizeColor(e.value);for(let s of t.colors)if(s.tokenReference){let a=s.tokenReference.trim();a=a.replace(/^["']|["']$/g,""),a=a.replace(/^[{]|[}]$/g,""),a=a.replace(/^\$/,"");let p=a.toLowerCase(),u=r.toLowerCase();p===u?n.push({property:`${s.type} color (token ref)`,propertyType:"color",matchedValue:`${s.hex} \u2190 ${s.tokenReference}`,tokenValue:r,confidence:1}):(p.endsWith("."+u)||p===u||u.endsWith("."+p)||u===p)&&n.push({property:`${s.type} color (token ref)`,propertyType:"color",matchedValue:`${s.hex} \u2190 ${s.tokenReference}`,tokenValue:r,confidence:.9})}let o=n.filter(s=>s.confidence>=.9);return o.length>0?o:n}matchTypography(e,t){let n=[],r=e.path.join(".");for(let i of t.typography){let o=0,s="",a="value";if(i.tokenReference){let u=i.tokenReference.replace(/[{}]/g,"").replace(/^\$/,"").toLowerCase().replace(/\./g,"."),d=r.toLowerCase();u===d?(o=1,s=`${i.fontFamily} (ref: ${i.tokenReference})`,a="reference"):(u.includes(d)||d.includes(u))&&(o=.8,s=`${i.fontFamily} (ref: ${i.tokenReference})`,a="reference")}if(o===0){if(e.type==="fontFamily"){let p=String(e.value).toLowerCase().trim(),u=i.fontFamily.toLowerCase().trim();p===u&&(o=.9,s=i.fontFamily)}else if(e.type==="fontWeight"){let p=this.normalizeFontWeight(e.value),u=i.fontWeight;p===u&&(o=.9,s=String(u))}else if(e.type==="typography"&&typeof e.value=="object"&&e.value!==null){let p=e.value,u=!1,d=0,f=[];if(p.fontFamily){let N=String(p.fontFamily).toLowerCase().trim(),A=i.fontFamily.toLowerCase().trim();N===A&&(u=!0,d+=.4,f.push(`fontFamily: ${i.fontFamily}`))}if(p.fontSize){let N=Number(p.fontSize),A=i.fontSize;Math.abs(N-A)<.5&&(u=!0,d+=.3,f.push(`fontSize: ${A}`))}p.fontWeight&&this.normalizeFontWeight(p.fontWeight)===i.fontWeight&&(u=!0,d+=.3,f.push(`fontWeight: ${i.fontWeight}`)),u&&(o=Math.min(d,1),s=f.join(", "))}}o>0&&n.push({property:`typography${a==="reference"?" (token ref)":""}`,propertyType:"typography",matchedValue:s,tokenValue:String(e.value),confidence:o})}return n}matchSpacing(e,t,n){let r=[],i=e.path.join("."),o=this.normalizeDimension(e.value),s=n?t.spacing.filter(p=>p.type===n):t.spacing;for(let p of s)if(p.tokenReference){let u=p.tokenReference.trim();u=u.replace(/^["']|["']$/g,""),u=u.replace(/^[{]|[}]$/g,""),u=u.replace(/^\$/,""),u=u.replace(/^\[\w+\]\s*/,"");let d=u.toLowerCase(),f=i.toLowerCase(),N=this.formatSpacingType(p.type);d===f?r.push({property:`${N} (token ref)`,propertyType:"spacing",matchedValue:`${p.value}${p.unit} \u2190 ${p.tokenReference}`,tokenValue:i,confidence:1}):(d.endsWith("."+f)||d===f||f.endsWith("."+d)||f===d)&&r.push({property:`${N} (token ref)`,propertyType:"spacing",matchedValue:`${p.value}${p.unit} \u2190 ${p.tokenReference}`,tokenValue:i,confidence:.9})}let a=r.filter(p=>p.confidence>=.9);return a.length>0?a:r}formatSpacingType(e){switch(e){case"borderRadius":return"border-radius";case"borderWidth":return"border-width";case"gap":return"gap/spacing";default:return e}}matchEffects(e,t){let n=[],r=e.path.join(".");for(let o of t.effects)if(o.tokenReference){let s=o.tokenReference.trim();s=s.replace(/^["']|["']$/g,""),s=s.replace(/^[{]|[}]$/g,""),s=s.replace(/^\$/,"");let a=s.toLowerCase(),p=r.toLowerCase();a===p?n.push({property:`${o.type} (token ref)`,propertyType:"effect",matchedValue:`${o.type} \u2190 ${o.tokenReference}`,tokenValue:r,confidence:1}):(a.endsWith("."+p)||a===p||p.endsWith("."+a)||p===a)&&n.push({property:`${o.type} (token ref)`,propertyType:"effect",matchedValue:`${o.type} \u2190 ${o.tokenReference}`,tokenValue:r,confidence:.9})}let i=n.filter(o=>o.confidence>=.9);return i.length>0?i:n}matchByValue(e,t){let n=[];return this.looksLikeColor(e.value)&&n.push(...this.matchColor(e,t)),this.looksLikeDimension(e.value)&&n.push(...this.matchSpacing(e,t)),n}normalizeColor(e){if(typeof e!="string")return null;let t=e.trim().toLowerCase();return t.match(/^#[0-9a-f]{3,8}$/)||t.match(/^rgba?\(/)||t.match(/^hsla?\(/)?t:null}normalizeHex(e){if(!e)return null;let t=e.trim().toLowerCase().replace("#","");return t.length===3&&(t=t.split("").map(n=>n+n).join("")),t.length===6?t:null}normalizeRgba(e){if(!e)return null;let t=e.match(/rgba?\(([^)]+)\)/i);return t?t[1].trim():null}parseRgba(e){let t=this.normalizeRgba(e);if(!t)return null;let n=t.split(",").map(r=>parseFloat(r.trim()));return n.length>=3?{r:n[0],g:n[1],b:n[2],a:n.length>3?n[3]:1}:null}rgbaToString(e){return`rgba(${Math.round(e.r)}, ${Math.round(e.g)}, ${Math.round(e.b)}, ${e.a.toFixed(2)})`}colorsMatch(e,t){let n=this.parseRgba(e),r=this.parseRgba(t);if(n&&r)return Math.abs(n.r-r.r)<2&&Math.abs(n.g-r.g)<2&&Math.abs(n.b-r.b)<2&&Math.abs(n.a-r.a)<.01;let i=this.normalizeHex(e),o=this.normalizeHex(t);return i!==null&&o!==null&&i===o}normalizeFontWeight(e){if(typeof e=="number")return e;if(typeof e!="string")return 400;let t={thin:100,extralight:200,light:300,regular:400,normal:400,medium:500,semibold:600,bold:700,extrabold:800,black:900},n=e.toLowerCase().trim();if(t[n])return t[n];let r=parseInt(e,10);return isNaN(r)?400:r}normalizeDimension(e){if(typeof e=="number")return e;if(typeof e!="string")return null;let t=e.replace(/px|rem|em|pt|pc|in|cm|mm|q|vh|vw|vmin|vmax|%/g,"").trim(),n=parseFloat(t);return isNaN(n)?null:n}looksLikeColor(e){if(typeof e!="string")return!1;let t=e.trim().toLowerCase();return t.match(/^#[0-9a-f]{3,8}$/)!==null||t.match(/^rgba?\(/)!==null||t.match(/^hsla?\(/)!==null}looksLikeDimension(e){return typeof e=="number"?!0:typeof e!="string"?!1:/^-?\d+(\.\d+)?(px|rem|em|pt|pc|in|cm|mm|q|vh|vw|vmin|vmax|%)$/.test(e.trim())}looksLikeSpacingToken(e){let t=e.path.join(".").toLowerCase();return["spacing","space","size","sizing","dimension","width","height","padding","margin","gap","radius","border","inset","offset","corner","round","stroke","weight","1x","2x","3x","4x","5x","6x","8x","10x","12x","16x"].some(r=>t.includes(r))}looksLikeBorderRadiusToken(e){let t=e.path.join(".").toLowerCase();return["radius","corner","round","rounded","borderradius"].some(r=>t.includes(r))}looksLikeBorderToken(e){let t=e.path.join(".").toLowerCase(),n=["border","stroke","outline","line"];return t.includes("radius")?!1:n.some(r=>t.includes(r))}looksLikeEffectToken(e){let t=e.path.join(".").toLowerCase();return["shadow","effect","blur","elevation","drop"].some(r=>t.includes(r))}}});function B(m,e){let t=`${Pe}`;return Pe+=1,re[t]={handler:e,name:m},function(){delete re[t]}}function ve(m,e){let t=!1;for(let n in re)re[n].name===m&&(re[n].handler.apply(null,e),t=!0);if(t===!1)throw new Error(`No event handler with name \`${m}\``)}var re,Pe,y,we=X(()=>{re={},Pe=0;y=typeof window=="undefined"?function(m,...e){figma.ui.postMessage([m,...e])}:function(m,...e){window.parent.postMessage({pluginMessage:[m,...e]},"*")};typeof window=="undefined"?figma.ui.onmessage=function(m){if(!Array.isArray(m))return;let[e,...t]=m;typeof e=="string"&&ve(e,t)}:window.onmessage=function(m){if(typeof m.data.pluginMessage=="undefined")return;let e=m.data.pluginMessage;if(!Array.isArray(e))return;let[t,...n]=m.data.pluginMessage;typeof t=="string"&&ve(t,n)}});function ue(m,e){if(typeof __html__=="undefined")throw new Error("No UI defined");let t=`<div id="create-figma-plugin"></div><script>document.body.classList.add('theme-${figma.editorType}');const __FIGMA_COMMAND__='${typeof figma.command=="undefined"?"":figma.command}';const __SHOW_UI_DATA__=${JSON.stringify(typeof e=="undefined"?{}:e)};${__html__}</script>`;figma.showUI(t,Q(Y({},m),{themeColors:typeof m.themeColors=="undefined"?!0:m.themeColors}))}var xe=X(()=>{});var Ee=X(()=>{we();xe()});var Ae={};_e(Ae,{default:()=>He});function He(){ue({width:400,height:550},{resizable:!0}),figma.loadAllPagesAsync().catch(l=>{console.error("Error loading pages on startup:",l)});let m=new se,e=new ce,t=new le,n=new pe,r=!0,i=10*60*1e3;function o(l,c,k,h){return`tokenCache_${l}_${c}_${k}_${h||"root"}`}async function s(l){try{let c=await figma.clientStorage.getAsync(l);if(c&&c.sha&&c.tokens&&Date.now()-c.timestamp<i)return c}catch(c){console.error("Error reading token cache:",c)}return null}async function a(l,c,k,h){try{let b={sha:c,tokens:k,metadata:h,timestamp:Date.now()};await figma.clientStorage.setAsync(l,b)}catch(b){console.error("Error saving token cache:",b)}}async function p(l){try{await figma.clientStorage.deleteAsync(l)}catch(c){console.error("Error clearing token cache:",c)}}async function u(){try{return await figma.clientStorage.getAsync("repoConfig")||null}catch(l){return console.error("Error loading config:",l),null}}async function d(l){try{await figma.clientStorage.setAsync("repoConfig",l)}catch(c){console.error("Error saving config:",c)}}async function f(){try{await figma.clientStorage.deleteAsync("repoConfig")}catch(l){console.error("Error clearing config:",l)}}B("load-config",async()=>{let l=await u();y("config-loaded",l)}),B("clear-config",async()=>{await f(),y("config-loaded",null)}),B("test-connection",async l=>{let c=m.parseGitHubUrl(l.repoUrl);if(!c){y("connection-result",{success:!1,error:"Invalid GitHub URL format"});return}try{y("connection-progress",{message:"Connecting to GitHub..."});let k=await m.fetchBranches(c.owner,c.repo,l.token),h=0,b=[];if(k.length>0)try{let S=k[0];y("connection-progress",{message:"Scanning for token files..."});let g=await m.detectTokenFiles(c.owner,c.repo,S,l.token,l.filePath||"");h=g.length,b=g.slice(0,5)}catch(S){console.error("Token detection failed:",S)}y("connection-result",{success:!0,branches:k.slice(0,10),owner:c.owner,repo:c.repo,fileCount:h,tokenCount:h,sampleFiles:b.map(S=>S.length>50?S.substring(0,47)+"...":S)})}catch(k){y("connection-result",{success:!1,error:k instanceof Error?k.message:"Connection failed"})}}),B("save-config",async l=>{await d(l),y("config-saved",{success:!0})});let N=/^#[0-9A-Fa-f]{3,8}$/,A=/^rgba?\(/,C=/^hsla?\(/,P=/^\d+(\.\d+)?(ms|s)$/,z=/^-?\d+(\.\d+)?(px|rem|em|pt|pc|in|cm|mm|q|vh|vw|vmin|vmax|%)$/,J=/\d+x$/,ne=(l,c)=>{if(typeof l=="string")return N.test(l)||A.test(l)||C.test(l)||c.includes("color")||c.includes("colour")?"color":P.test(l)||c.includes("duration")?"duration":c.includes("radius")||c.includes("corner")||c.includes("rounded")||c.includes("borderradius")?"borderRadius":c.includes("border")&&(c.includes("width")||c.includes("weight"))||c.includes("stroke")&&c.includes("weight")?"borderWidth":z.test(l)||c.includes("size")||c.includes("spacing")||c.includes("space")||c.includes("gap")||c.includes("padding")||c.includes("margin")||c.includes("sizing")||c.includes("dimension")||J.test(c)?"dimension":c.includes("font")||c.includes("typography")||c.includes("text")?c.includes("weight")?"fontWeight":c.includes("family")?"fontFamily":"typography":c.includes("shadow")||c.includes("elevation")?"shadow":c.includes("border")&&!c.includes("radius")?"border":"string";if(typeof l=="number")return c.includes("radius")||c.includes("corner")||c.includes("rounded")?"borderRadius":c.includes("border")&&c.includes("width")||c.includes("stroke")&&c.includes("weight")?"borderWidth":c.includes("weight")&&c.includes("font")?"fontWeight":c.includes("opacity")||c.includes("alpha")||c.includes("z-index")||c.includes("zindex")?"number":c.includes("spacing")||c.includes("space")||c.includes("gap")||c.includes("padding")||c.includes("margin")||c.includes("size")||J.test(c)?"dimension":"number";if(typeof l=="object"&&l!==null){if(c.includes("shadow")||l.blur!==void 0||l.spread!==void 0)return"shadow";if(c.includes("typography")||l.fontFamily!==void 0)return"typography";if(c.includes("border")||l.width!==void 0&&l.style!==void 0)return"border"}return"string"},ee=l=>l&&typeof l=="object"&&"$value"in l,Oe=l=>{if(!l||typeof l!="object"||"$value"in l||!("value"in l))return!1;let c=l.value;return typeof c=="string"||typeof c=="number"||typeof c=="boolean"?!0:typeof c=="object"&&c!==null?"type"in l||"description"in l:!1},Fe=(l,c)=>!(typeof l!="string"&&typeof l!="number"&&typeof l!="boolean"||c.length<1),Me=(l,c)=>{let k=[],h=[],b=(g,v)=>{let V=h[h.length-1]||"unnamed",$=h.join(".").toLowerCase(),O=v||ne(g,$);k.push({name:V,path:h.slice(),type:O,sourceFile:c,value:g})},S=g=>{if(g==null)return;let v=h[h.length-1]||"";if(!(v.startsWith("$")&&v!=="$value"&&v!=="$type")){if(ee(g)){b(g.$value,g.$type);return}if(Oe(g)){b(g.value,g.type);return}if(Fe(g,h)){b(g,void 0);return}if(typeof g=="object"){let V=Array.isArray(g)?g.map(($,O)=>String(O)):Object.keys(g);for(let $ of V){if(!Array.isArray(g)&&($.startsWith("$")||$==="extensions"))continue;let O=Array.isArray(g)?g[parseInt($)]:g[$];h.push($),S(O),h.pop()}}}};return S(l),k},de=5,he=500,te=100;B("fetch-tokens",async l=>{let c=m.parseGitHubUrl(l.repoUrl);if(!c){y("tokens-result",{success:!1,error:"Invalid GitHub URL format"});return}try{let k=l.filePath||"",h=o(c.owner,c.repo,l.branch,k);if(!l.forceRefresh){y("tokens-progress",{message:"Checking for cached tokens..."});let[F,_]=await Promise.all([m.getLatestCommitSha(c.owner,c.repo,l.branch,l.token),s(h)]);if(_&&F&&_.sha===F){y("tokens-progress",{message:"Using cached tokens (no changes detected)"});let R=_.tokens;for(let T=0;T<R.length;T+=te){let w=R.slice(T,T+te),x=T+te>=R.length;y("tokens-chunk",{tokens:w,chunkIndex:Math.floor(T/te),totalChunks:Math.ceil(R.length/te),isLast:x})}y("tokens-result",{success:!0,tokens:R,metadata:Q(Y({},_.metadata),{fromCache:!0,cacheAge:Date.now()-_.timestamp,errors:[]})});return}}y("tokens-progress",{message:"Scanning for token files..."});let b=await m.detectTokenFiles(c.owner,c.repo,l.branch,l.token,k);if(b.length===0){y("tokens-result",{success:!1,error:`No token files found${k?` in '${k}'`:" in repository"}. Looking for .json files (excluding config files).`});return}let S=[],g=[],v=0,V=0,$=[],O=[];y("tokens-progress",{message:`Fetching ${b.length} files...`});for(let F=0;F<b.length;F+=de){let _=b.slice(F,F+de),R=Math.min(F+de,b.length);y("tokens-progress",{message:`Fetching files ${F+1}-${R} of ${b.length}...`});let T=await Promise.all(_.map(async w=>{try{let x=await m.fetchFileContents(c.owner,c.repo,l.branch,l.token,w);if(!x.content)return{path:w,error:"Empty file content"};let M=m.decodeBase64Content(x.content);return{path:w,content:M}}catch(x){return{path:w,error:x instanceof Error?x.message:"Fetch failed"}}}));for(let w of T)"content"in w&&w.content?O.push({path:w.path,content:w.content}):"error"in w&&(g.push({file:w.path,message:w.error}),$.push({file:w.path,count:0}))}y("tokens-progress",{message:`Processing ${O.length} files...`});let D=[],K=0;for(let{path:F,content:_}of O)try{let R;try{R=JSON.parse(_)}catch(x){throw new Error(`JSON parse failed: ${x.message}`)}let T=Me(R,F),w=T.length;V+=w,$.push({file:F,count:w}),w===0&&g.push({file:F,message:"No token values found in this file (checked $value, value, and primitives)"});for(let x of T)if(S.length<he){let M={name:x.name||"",path:x.path||"",type:x.type||"unknown",sourceFile:x.sourceFile||""};S.push(M),D.push(M),D.length>=te&&(y("tokens-chunk",{tokens:D,chunkIndex:K++,isLast:!1}),D=[])}v++}catch(R){console.error(`Failed to parse ${F}:`,R),$.push({file:F,count:0}),g.push({file:F,message:R instanceof Error?R.message:"Failed to parse file"})}D.length>0&&y("tokens-chunk",{tokens:D,chunkIndex:K++,isLast:!0}),y("tokens-progress",{message:`Found ${V} tokens in ${v} files`});let Z=await m.getLatestCommitSha(c.owner,c.repo,l.branch,l.token);Z&&await a(h,Z,S,{totalTokens:V,filesProcessed:v,totalFiles:b.length,perFileCounts:$}),y("tokens-result",{success:!0,tokens:S,metadata:{totalTokens:V,truncated:V>he,filesProcessed:v,totalFiles:b.length,perFileCounts:$,errors:g,fromCache:!1}})}catch(k){y("tokens-result",{success:!1,error:k instanceof Error?k.message:"Failed to fetch tokens"})}}),B("detect-token-files",async l=>{let c=m.parseGitHubUrl(l.repoUrl);if(!c){y("token-files-result",{success:!1,error:"Invalid GitHub URL format"});return}try{let k=await m.detectTokenFiles(c.owner,c.repo,l.branch,l.token,l.directoryPath||"");y("token-files-result",{success:!0,files:k})}catch(k){y("token-files-result",{success:!1,error:k instanceof Error?k.message:"Failed to detect token files"})}}),B("scan-components",async l=>{try{let c=l.scanAll===!0;c?(y("scan-progress",{message:"Loading all pages..."}),await figma.loadAllPagesAsync(),y("scan-progress",{message:"Scanning all pages..."})):y("scan-progress",{message:"Scanning current page..."});let k=c?e.scanAllComponents():e.scanCurrentPage();y("scan-result",{success:!0,result:k})}catch(c){y("scan-result",{success:!1,error:c instanceof Error?c.message:"Failed to scan components"})}}),B("scan-components-for-token",async l=>{try{let{token:c,scanAll:k,scanSelection:h,pageFilter:b}=l,S=k===!0,g=h===!0,v=b&&b.length>0;if(!c){y("scan-result",{success:!1,error:"No token provided"});return}let V=c.type||"all",$="Scanning for token matches...";S?($=v?`Loading ${b.length} page(s)...`:"Loading all pages...",y("scan-progress",{message:$}),await figma.loadAllPagesAsync(),$=v?`Scanning ${b.join(", ")} for token matches...`:"Scanning all pages for token matches..."):g?$="Scanning selection for token matches...":$="Scanning current page for token matches...",y("scan-progress",{message:$});let O;if(r&&S){y("scan-progress",{message:"Scanning components (optimized)..."});let R={tokenType:V,useCache:!0,chunkSize:100,maxDepth:3,includeChildren:!0,pageFilter:v?b:void 0,onProgress:T=>{let w=Math.round(T.currentPage/T.totalPages*100);y("scan-progress",{message:`Page ${T.currentPage}/${T.totalPages}: ${T.currentPageName} (${T.componentsFound} found)`,progress:w})}};O=await t.scanAllComponentsOptimized(R)}else if(y("scan-progress",{message:"Scanning components..."}),S)v?O=e.scanFilteredPages(b):O=e.scanAllComponents();else if(g){let R=figma.currentPage.selection;if(R.length===0){y("scan-result",{success:!1,error:"No selection found. Please select a frame or node to scan."});return}O=e.scanNodes(R)}else O=e.scanCurrentPage();y("scan-progress",{message:`Found ${O.totalComponents} components. Matching tokens...`});let D=n.matchTokenToComponents(c,O);y("scan-progress",{message:"Filtering nested duplicates..."});let K=new Set;for(let R of D.matchingComponents)R.matches.some(w=>!w.property.includes(" \u2192 "))&&R.component.mainComponentName&&K.add(R.component.mainComponentName.toLowerCase().trim());let Z=R=>{let T=R.split(" \u2192 ");return T.length<2?null:T[T.length-2].toLowerCase().trim()},F=D.matchingComponents.filter(R=>R.matches.some(x=>!x.property.includes(" \u2192 "))?!0:!R.matches.every(x=>{if(!x.property.includes(" \u2192 "))return!1;let M=Z(x.property);return M?K.has(M):!1}));y("scan-progress",{message:"Matching complete!"});let _={token:{name:c.name,path:c.path,type:c.type,value:c.value},matchingComponents:F.map(R=>({id:R.component.id,name:R.component.name,page:R.component.pageName,type:R.component.type,mainComponentName:R.component.mainComponentName,mainComponentId:R.component.mainComponentId,matches:R.matches.map(T=>`${T.property}: ${T.matchedValue}`),matchDetails:R.matches,confidence:R.confidence})),totalMatches:F.length,totalComponentsScanned:D.totalComponentsScanned};y("scan-result",{success:!0,result:_})}catch(c){y("scan-result",{success:!1,error:c instanceof Error?c.message:"Failed to scan components for token"})}}),B("get-component-usage",async l=>{try{let{componentId:c}=l,k=e.getComponentUsageStats(c);y("component-usage-result",{success:!0,stats:k})}catch(c){y("component-usage-result",{success:!1,error:c instanceof Error?c.message:"Failed to get usage stats"})}}),B("navigate-to-component",async l=>{try{let{componentId:c}=l,k=await figma.getNodeByIdAsync(c);if(k&&"type"in k){let h=Ie(k);h&&h.type==="PAGE"&&h!==figma.currentPage&&await figma.setCurrentPageAsync(h),k.type!=="DOCUMENT"&&k.type!=="PAGE"?(figma.currentPage.selection=[k],figma.viewport.scrollAndZoomIntoView([k]),y("navigate-result",{success:!0})):y("navigate-result",{success:!1,error:"Cannot select document or page nodes"})}else y("navigate-result",{success:!1,error:"Node not found"})}catch(c){y("navigate-result",{success:!1,error:c instanceof Error?c.message:"Failed to navigate to component"})}});function Ie(l){let c=l;for(;c&&c.type!=="PAGE";)c=c.parent;return c}async function Xe(l){let c=await figma.getNodeByIdAsync(l);if(!c)return null;if(c.type==="COMPONENT_SET"){let k=c,h=k.defaultVariant||k.children[0];if((h==null?void 0:h.type)==="COMPONENT")return h}return c.type==="COMPONENT"?c:c.type==="INSTANCE"?await c.getMainComponentAsync():null}B("create-component-collection",async l=>{try{let{token:c,groupedComponents:k,matchingComponents:h}=l,b=Object.entries(k||{});if(b.length===0&&(!h||h.length===0)){y("create-collection-result",{success:!1,error:"No components to collect"});return}let S=Array.isArray(c.path)?c.path.join("."):c.name,g=figma.createFrame();g.name=`Token Matches: ${S}`,g.layoutMode="VERTICAL",g.primaryAxisSizingMode="AUTO",g.counterAxisSizingMode="AUTO",g.paddingTop=32,g.paddingBottom=32,g.paddingLeft=32,g.paddingRight=32,g.itemSpacing=24,g.fills=[{type:"SOLID",color:{r:.95,g:.95,b:.95}}],g.cornerRadius=8;let v=figma.createText();await figma.loadFontAsync({family:"Inter",style:"Bold"}),await figma.loadFontAsync({family:"Inter",style:"Regular"}),v.fontName={family:"Inter",style:"Bold"},v.characters=`Token: ${S}`,v.fontSize=18,v.fills=[{type:"SOLID",color:{r:.1,g:.1,b:.1}}],g.appendChild(v);let V=b.length,$=(h==null?void 0:h.length)||0,O=figma.createText();O.fontName={family:"Inter",style:"Regular"},O.characters=`${V} component${V!==1?"s":""}${$>V?` (${$} variants total)`:""}`,O.fontSize=12,O.fills=[{type:"SOLID",color:{r:.4,g:.4,b:.4}}],g.appendChild(O);let D=figma.createFrame();D.name="Components List",D.layoutMode="VERTICAL",D.primaryAxisSizingMode="AUTO",D.counterAxisSizingMode="AUTO",D.itemSpacing=16,D.fills=[],g.appendChild(D);let K=0;for(let[F,_]of b){let R=_.length;try{let T=figma.createFrame();T.name=F,T.layoutMode="VERTICAL",T.primaryAxisSizingMode="AUTO",T.counterAxisSizingMode="AUTO",T.paddingTop=16,T.paddingBottom=16,T.paddingLeft=16,T.paddingRight=16,T.itemSpacing=8,T.fills=[{type:"SOLID",color:{r:1,g:1,b:1}}],T.strokes=[{type:"SOLID",color:{r:.85,g:.85,b:.85}}],T.strokeWeight=1,T.cornerRadius=6;let w=figma.createText();w.fontName={family:"Inter",style:"Bold"},w.characters=F,w.fontSize=12,w.fills=[{type:"SOLID",color:{r:.1,g:.1,b:.1}}],T.appendChild(w);let x=_[0];if(x!=null&&x.matchDetails&&x.matchDetails.length>0){let j=x.matchDetails[0],E=figma.createText();E.fontName={family:"Inter",style:"Regular"};let L="";if(j.matchedValue){let W=j.matchedValue.match(/^([^]+)/);W&&(L=W[1].trim())}let U=j.property.replace(/\s*\([^)]*\)\s*/g,"").trim(),G=L?`${L} \u2192 ${U}`:U;R>1&&(G+=` (${R} variants)`),E.characters=G,E.fontSize=10,E.fills=[{type:"SOLID",color:{r:.5,g:.5,b:.5}}],T.appendChild(E)}let M=figma.createFrame();M.name="Variants",M.layoutMode="HORIZONTAL",M.layoutWrap="WRAP",M.primaryAxisSizingMode="AUTO",M.counterAxisSizingMode="AUTO",M.paddingTop=40,M.paddingBottom=40,M.paddingLeft=40,M.paddingRight=40,M.itemSpacing=12,M.counterAxisSpacing=12,M.fills=[],M.clipsContent=!1,T.appendChild(M);let ye=0,q=new Set;for(let j of _)try{let E=await figma.getNodeByIdAsync(j.id);if(!E)continue;let L=null,U=j.name;if(E.type==="INSTANCE"){let G=E;try{let W=await G.getMainComponentAsync();W&&(U=W.name)}catch(W){}if(q.has(U))continue;q.add(U),L=G.clone()}else if(E.type==="COMPONENT"){let G=E;if(U=G.name,q.has(U))continue;q.add(U),L=G.createInstance()}else if(E.type==="COMPONENT_SET"){let G=E,W=null;if(j.name.includes("=")){for(let H of G.children)if(H.type==="COMPONENT"&&H.name===j.name){W=H;break}}if(!W){let H=G.defaultVariant||G.children[0];(H==null?void 0:H.type)==="COMPONENT"&&(W=H)}if(W){if(U=W.name,q.has(U))continue;q.add(U),L=W.createInstance()}}else if(E.type==="FRAME"||E.type==="GROUP"||E.type==="RECTANGLE"||E.type==="ELLIPSE"||E.type==="LINE"||E.type==="TEXT"||E.type==="VECTOR"||E.type==="POLYGON"||E.type==="STAR"){if(q.has(U))continue;q.add(U),L=E.clone()}if(L){if("width"in L&&"height"in L){let W=L.width,H=L.height,fe=Math.min(1,150/Math.max(W,H));fe<1&&"resize"in L&&L.resize(W*fe,H*fe)}M.appendChild(L),ye++}}catch(E){console.error(`Failed to create instance for variant ${j.id}:`,E)}ye>0?(D.appendChild(T),K++):T.remove()}catch(T){console.error(`Failed to create card for ${F}:`,T)}}let Z=figma.viewport;g.x=Z.center.x-g.width/2,g.y=Z.center.y-g.height/2,figma.currentPage.appendChild(g),figma.currentPage.selection=[g],figma.viewport.scrollAndZoomIntoView([g]),figma.notify(`Created collection with ${K} component${K!==1?"s":""}`),y("create-collection-result",{success:!0,count:K,frameId:g.id})}catch(c){console.error("Failed to create component collection:",c),y("create-collection-result",{success:!1,error:c instanceof Error?c.message:"Failed to create collection"})}}),B("cancel",()=>{figma.closePlugin()}),B("resize-window",l=>{figma.ui.resize(l.width,l.height)});function De(l){let c={nodeId:l.id,nodeName:l.name,nodeType:l.type,pluginData:{},sharedPluginData:{}};try{let h=l.getPluginDataKeys();for(let b of h)c.pluginData[b]=l.getPluginData(b)}catch(h){console.error("Error getting plugin data keys:",h)}let k=["tokens","tokens-studio","tokensStudio","figma-tokens","design-tokens","token-studio","com.tokens.studio","tokens.studio","io.tokens.studio","figmatokens","style-dictionary","ds","design-system","theme","variables"];for(let h of k)try{let b=l.getSharedPluginDataKeys(h);if(b.length>0){c.sharedPluginData[h]={};for(let S of b){let g=l.getSharedPluginData(h,S);c.sharedPluginData[h][S]=g}}}catch(b){}try{if("boundVariables"in l&&l.boundVariables){c.boundVariables={};let h=l.boundVariables;for(let[b,S]of Object.entries(h))if(S){if(Array.isArray(S))c.boundVariables[b]=S.map(g=>{try{let v=figma.variables.getVariableById(g.id);return{id:g.id,name:v==null?void 0:v.name,resolvedType:v==null?void 0:v.resolvedType,valuesByMode:v==null?void 0:v.valuesByMode}}catch(v){return{id:g.id,error:"Could not resolve variable"}}});else if(S.id)try{let g=figma.variables.getVariableById(S.id);c.boundVariables[b]={id:S.id,name:g==null?void 0:g.name,resolvedType:g==null?void 0:g.resolvedType,valuesByMode:g==null?void 0:g.valuesByMode}}catch(g){c.boundVariables[b]={id:S.id,error:"Could not resolve variable"}}}}}catch(h){console.error("Error getting bound variables:",h)}return c}function me(l,c=3,k=0){let h=[],b=De(l),S=Object.keys(b.pluginData).length>0||Object.keys(b.sharedPluginData).length>0||b.boundVariables&&Object.keys(b.boundVariables).length>0;if(h.push(Q(Y({},b),{pluginData:S?b.pluginData:{_noData:"true"}})),k<c&&"children"in l)for(let g of l.children)h.push(...me(g,c,k+1));return h}B("inspect-selection",async()=>{try{let l=figma.currentPage.selection;if(l.length===0){y("inspect-result",{success:!1,error:"No selection. Please select a node to inspect."});return}y("inspect-progress",{message:"Inspecting plugin data..."});let c=[];for(let h of l){let b=me(h,3);c.push(...b)}let k=c.filter(h=>!h.pluginData._noData&&(Object.keys(h.pluginData).length>0||Object.keys(h.sharedPluginData).length>0||h.boundVariables&&Object.keys(h.boundVariables).length>0));c.forEach(h=>{h.pluginData._noData&&(h.pluginData={})}),y("inspect-result",{success:!0,results:c,summary:{totalNodesInspected:c.length,nodesWithPluginData:k.length,namespacesFound:Array.from(new Set(k.flatMap(h=>Object.keys(h.sharedPluginData)))),pluginDataKeysFound:Array.from(new Set(k.flatMap(h=>Object.keys(h.pluginData)))),hasVariableBindings:k.some(h=>h.boundVariables&&Object.keys(h.boundVariables).length>0)}})}catch(l){y("inspect-result",{success:!1,error:l instanceof Error?l.message:"Failed to inspect selection"})}})}var $e=X(()=>{"use strict";Ce();Ne();Re();Se();Ee()});var Ke={"src/main.ts--default":($e(),Ge(Ae)).default},je="src/main.ts--default";Ke[je]();
