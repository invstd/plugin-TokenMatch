var J=Object.defineProperty,ye=Object.defineProperties,ke=Object.getOwnPropertyDescriptor,be=Object.getOwnPropertyDescriptors,Te=Object.getOwnPropertyNames,oe=Object.getOwnPropertySymbols;var ie=Object.prototype.hasOwnProperty,Re=Object.prototype.propertyIsEnumerable;var te=(m,e,t)=>e in m?J(m,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):m[e]=t,_=(m,e)=>{for(var t in e||(e={}))ie.call(e,t)&&te(m,t,e[t]);if(oe)for(var t of oe(e))Re.call(e,t)&&te(m,t,e[t]);return m},U=(m,e)=>ye(m,be(e));var L=(m,e)=>()=>(m&&(e=m(m=0)),e);var ve=(m,e)=>{for(var t in e)J(m,t,{get:e[t],enumerable:!0})},Ce=(m,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of Te(e))!ie.call(m,r)&&r!==t&&J(m,r,{get:()=>e[r],enumerable:!(n=ke(e,r))||n.enumerable});return m};var Se=m=>Ce(J({},"__esModule",{value:!0}),m);var E=(m,e,t)=>te(m,typeof e!="symbol"?e+"":e,t);var X,se=L(()=>{"use strict";X=class{constructor(){E(this,"tokens",[]);E(this,"errors",[]);E(this,"tokenMap",new Map)}parse(e,t=""){return this.tokens=[],this.errors=[],this.tokenMap=new Map,this.collectTokens(e,[]),this.resolveAliases(),this.validateTokens(),{tokens:this.tokens,metadata:{filePath:t,format:"auto-detected",errors:this.errors}}}collectTokens(e,t){if(e==null)return;let n=t[t.length-1]||"";if(!(n.startsWith("$")&&n!=="$value"&&n!=="$type")){if(this.isW3CToken(e)){this.addToken(e.$value,e.$type,e.$description,e.$extensions,t);return}if(this.isTokenStudioToken(e)){this.addToken(e.value,e.type,e.description,e.extensions,t);return}if(this.isPrimitiveToken(e,t)){this.addToken(e,void 0,void 0,void 0,t);return}if(typeof e=="object"){let r=Array.isArray(e)?e.map((i,o)=>String(o)):Object.keys(e);for(let i of r){if(i.startsWith("$")||i==="extensions"||i==="description")continue;let o=Array.isArray(e)?e[parseInt(i)]:e[i];this.collectTokens(o,[...t,i])}}}}addToken(e,t,n,r,i){let o=i[i.length-1]||"unnamed",s=this.inferTokenType({$value:e,$type:t},i),p;typeof e=="string"&&(e.startsWith("{")||e.startsWith("$"))&&(p=this.extractAliases(e));let d={name:o,value:e,type:s,path:[...i],description:n,extensions:r,rawValue:e,aliases:p};this.tokens.push(d),this.tokenMap.set(i.join("."),d)}isW3CToken(e){return e&&typeof e=="object"&&"$value"in e}isTokenStudioToken(e){if(!e||typeof e!="object"||"$value"in e||!("value"in e))return!1;let t=e.value;return typeof t=="string"||typeof t=="number"||typeof t=="boolean"?!0:typeof t=="object"&&t!==null?"type"in e||"description"in e:!1}isPrimitiveToken(e,t){return!(typeof e!="string"&&typeof e!="number"&&typeof e!="boolean"||t.length<1)}isDesignToken(e){return this.isW3CToken(e)}inferTokenType(e,t){if(e.$type)return e.$type;let n=t.join(".").toLowerCase();if(n.includes("color")||n.includes("colour"))return"color";if(n.includes("font")||n.includes("typography")||n.includes("text"))return n.includes("weight")?"fontWeight":n.includes("family")?"fontFamily":"typography";if(n.includes("spacing")||n.includes("size")||n.includes("gap"))return"dimension";if(n.includes("shadow"))return"shadow";if(n.includes("border"))return"border";let r=e.$value;if(typeof r=="string"){if(r.match(/^#[0-9A-Fa-f]{3,8}$/)||r.match(/^rgba?\(/)||r.match(/^hsla?\(/))return"color";if(r.match(/^-?\d+(\.\d+)?(px|rem|em|pt|pc|in|cm|mm|q|vh|vw|vmin|vmax|%)$/))return"dimension";if(r.match(/^\d+(\.\d+)?(ms|s)$/))return"duration"}return typeof r=="number"?"number":typeof r=="boolean"?"boolean":"string"}extractAliases(e){let t=[],n=/\{([^}]+)\}/g,r;for(;(r=n.exec(e))!==null;){let i=r[1].split(",").map(o=>o.trim())[0];i.startsWith("$")&&(i=i.substring(1)),t.push(i)}if(e.startsWith("$")&&!e.startsWith("{")){let i=/\$([a-zA-Z0-9._-]+)/g;for(;(r=i.exec(e))!==null;)t.push(r[1])}return t}resolveAliases(){for(let e of this.tokens)if(e.aliases&&e.aliases.length>0)for(let t of e.aliases){let n=this.tokenMap.get(t);n?(e.value=n.value,e.aliases||(e.aliases=[])):this.errors.push({path:e.path,message:`Unresolved alias: ${t}`,severity:"error"})}}validateTokens(){for(let e of this.tokens){let t=this.validateTokenValue(e);t.valid||this.errors.push({path:e.path,message:t.message||"Validation error",severity:t.severity||"error"})}}validateTokenValue(e){let{type:t,value:n}=e;if(n==null)return{valid:!1,message:"Token value cannot be null or undefined",severity:"error"};switch(t){case"color":return this.validateColor(n);case"dimension":return this.validateDimension(n);case"fontWeight":return this.validateFontWeight(n);case"duration":return this.validateDuration(n);case"typography":return this.validateTypography(n);case"shadow":return this.validateShadow(n);default:return{valid:!0}}}validateColor(e){return typeof e!="string"?{valid:!1,message:"Color value must be a string",severity:"error"}:[/^#[0-9A-Fa-f]{3,8}$/,/^rgba?\([^)]+\)$/,/^hsla?\([^)]+\)$/].some(r=>r.test(e))?{valid:!0}:{valid:!1,message:`Invalid color format: ${e}`,severity:"error"}}validateDimension(e){if(typeof e=="string"){if(!/^-?\d+(\.\d+)?(px|rem|em|pt|pc|in|cm|mm|q|vh|vw|vmin|vmax|%)$/.test(e))return{valid:!1,message:`Invalid dimension format: ${e}`,severity:"error"}}else return typeof e=="number"?{valid:!0}:{valid:!1,message:"Dimension value must be a string or number",severity:"error"};return{valid:!0}}validateFontWeight(e){if(typeof e=="string"){if(!["100","200","300","400","500","600","700","800","900","normal","bold"].includes(e))return{valid:!1,message:`Invalid font weight: ${e}`,severity:"warning"}}else if(typeof e=="number"){if(e<1||e>1e3)return{valid:!1,message:"Font weight must be between 1 and 1000",severity:"error"}}else return{valid:!1,message:"Font weight must be a string or number",severity:"error"};return{valid:!0}}validateDuration(e){return typeof e!="string"?{valid:!1,message:"Duration value must be a string",severity:"error"}:/^\d+(\.\d+)?(ms|s)$/.test(e)?{valid:!0}:{valid:!1,message:`Invalid duration format: ${e}`,severity:"error"}}validateTypography(e){return typeof e!="object"||Array.isArray(e)?{valid:!1,message:"Typography value must be an object",severity:"error"}:e.fontFamily?{valid:!0}:{valid:!1,message:"Typography token missing fontFamily",severity:"warning"}}validateShadow(e){return typeof e!="object"||Array.isArray(e)?{valid:!1,message:"Shadow value must be an object",severity:"error"}:e.color?{valid:!0}:{valid:!1,message:"Shadow token missing color",severity:"warning"}}getTokensByType(e){return this.tokens.filter(t=>t.type===e)}getTokenByPath(e){return this.tokenMap.get(e.join("."))}getErrors(){return this.errors}}});var Z,ae=L(()=>{"use strict";se();Z=class{constructor(){E(this,"parser");this.parser=new X}parseGitHubUrl(e){let t=[/github\.com[\/:]([^\/]+)\/([^\/\.]+)(\.git)?$/,/github\.com\/([^\/]+)\/([^\/]+)/];for(let n of t){let r=e.match(n);if(r)return{owner:r[1],repo:r[2]}}return null}async fetchBranches(e,t,n){try{let r=await fetch(`https://api.github.com/repos/${e}/${t}/branches`,{headers:{Authorization:`Bearer ${n}`,Accept:"application/vnd.github.v3+json"}});if(!r.ok)throw new Error(`GitHub API error: ${r.status}`);return(await r.json()).map(o=>o.name)}catch(r){throw new Error(`Failed to fetch branches: ${r}`)}}async fetchFileContents(e,t,n,r,i){try{let o=`https://api.github.com/repos/${e}/${t}/contents/${i}?ref=${n}`,s=await fetch(o,{headers:{Authorization:`Bearer ${r}`,Accept:"application/vnd.github.v3+json"}});if(!s.ok)throw new Error(`GitHub API error: ${s.status}`);return await s.json()}catch(o){throw new Error(`Failed to fetch file contents: ${o}`)}}async fetchDirectoryContents(e,t,n,r,i=""){try{let o=`https://api.github.com/repos/${e}/${t}/contents/${i}?ref=${n}`,s=await fetch(o,{headers:{Authorization:`Bearer ${r}`,Accept:"application/vnd.github.v3+json"}});if(!s.ok)throw new Error(`GitHub API error: ${s.status}`);let p=await s.json();return Array.isArray(p)?p:[p]}catch(o){throw new Error(`Failed to fetch directory contents: ${o}`)}}decodeBase64Content(e){try{let t=e.replace(/\s/g,""),n;if(typeof atob=="function")n=atob(t);else{let i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";n="";let o=0,s=t.replace(/=+$/,"");for(;o<s.length;){let p=i.indexOf(s.charAt(o++)),d=i.indexOf(s.charAt(o++)),k=i.indexOf(s.charAt(o++)),f=i.indexOf(s.charAt(o++)),u=p<<18|d<<12|(k&63)<<6|f&63;n+=String.fromCharCode(u>>16&255),k!==-1&&(n+=String.fromCharCode(u>>8&255)),f!==-1&&(n+=String.fromCharCode(u&255))}}let r;if(typeof TextDecoder!="undefined"){let i=new Uint8Array(n.length);for(let o=0;o<n.length;o++)i[o]=n.charCodeAt(o);r=new TextDecoder("utf-8").decode(i)}else try{r=decodeURIComponent(escape(n))}catch(i){r=n}return r.charCodeAt(0)===65279&&(r=r.slice(1)),r=r.replace(/\0/g,""),r=r.trim(),r}catch(t){throw new Error(`Failed to decode base64 content: ${t}`)}}parseJSONContent(e){try{return JSON.parse(e)}catch(t){throw new Error(`Failed to parse JSON: ${t}`)}}flattenTokens(e,t=[]){let n=[],r=[],i=f=>f&&typeof f=="object"&&"$value"in f,o=f=>{if(!f||typeof f!="object"||"$value"in f||!("value"in f))return!1;let u=f.value;return typeof u=="string"||typeof u=="number"||typeof u=="boolean"?!0:typeof u=="object"&&u!==null?"type"in f||"description"in f:!1},s=(f,u)=>!(typeof f!="string"&&typeof f!="number"&&typeof f!="boolean"||u.length<1),p=(f,u)=>{let v=u.join(".").toLowerCase();if(typeof f=="string"){if(f.match(/^#[0-9A-Fa-f]{3,8}$/)||f.match(/^rgba?\(/)||f.match(/^hsla?\(/)||v.includes("color"))return"color";if(f.match(/^\d+(\.\d+)?(ms|s)$/)||v.includes("duration"))return"duration";if(f.match(/^-?\d+(\.\d+)?(px|rem|em|pt|pc|in|cm|mm|q|vh|vw|vmin|vmax|%)$/)||v.includes("size")||v.includes("spacing")||v.includes("radius"))return"dimension";if(v.includes("font")||v.includes("typography"))return"typography";if(v.includes("shadow"))return"shadow"}else if(typeof f=="number")return"number";return"string"},d=(f,u,v)=>{let N=v[v.length-1]||"unnamed",a=u||p(f,v);n.push({name:N,path:v,type:a,value:f,rawValue:f})},k=(f,u)=>{if(f==null)return;let v=u[u.length-1]||"";if(!(v.startsWith("$")&&v!=="$value"&&v!=="$type")){if(i(f)){d(f.$value,f.$type,u);return}if(o(f)){d(f.value,f.type,u);return}if(s(f,u)){d(f,void 0,u);return}if(f&&typeof f=="object"){let N=Array.isArray(f)?f.map((a,l)=>String(l)):Object.keys(f);for(let a of N){if(!Array.isArray(f)&&(a.startsWith("$")||a==="extensions"))continue;let l=Array.isArray(f)?f[parseInt(a)]:f[a];k(l,[...u,a])}}}};try{k(e,[])}catch(f){r.push({path:[],message:f instanceof Error?f.message:"Failed to walk tokens"})}return{tokens:n,metadata:{filePath:"",format:"auto-detected",errors:r}}}async fetchTokens(e,t,n,r,i){let o=await this.fetchFileContents(e,t,n,r,i);if(o.type!=="file")throw new Error(`Path is not a file: ${i}`);if(!o.content)throw new Error("File content is empty");let s=this.decodeBase64Content(o.content),p=this.parseJSONContent(s),d=this.parser.parse(p,i);return(!d.tokens||d.tokens.length===0)&&(d=this.flattenTokens(p,[])),d}async detectTokenFiles(e,t,n,r,i=""){let o=await this.fetchDirectoryContents(e,t,n,r,i),s=[/package\.json$/i,/package-lock\.json$/i,/tsconfig\.json$/i,/\.config\.json$/i,/eslint.*\.json$/i,/prettier.*\.json$/i,/jest\.config\.json$/i,/webpack\.config\.json$/i,/^\$metadata\.json$/i,/^\$themes\.json$/i,/\(ignore\)\.json$/i],p=[];for(let d of o)if(d.type==="file"){let k=d.name.toLowerCase();k.endsWith(".json")&&(s.some(u=>u.test(k))||p.push(d.path))}else if(d.type==="dir"){let k=await this.detectTokenFiles(e,t,n,r,d.path);p.push(...k)}return p}}});var Y,ce=L(()=>{"use strict";Y=class{constructor(){E(this,"errors",[]);E(this,"TOKENS_STUDIO_NAMESPACE","tokens");E(this,"DEBUG_LOGGING",!0)}getAllTokenKeys(e){let t={},n=["tokens","tokens-studio","tokensStudio","design-tokens","figma-tokens"];for(let r of n)try{let i=e.getSharedPluginDataKeys(r);for(let o of i){let s=e.getSharedPluginData(r,o);s&&s.trim()&&(t[`${r}:${o}`]=s)}}catch(i){}return t}getVariableBinding(e,t){try{if(!("boundVariables"in e)||!e.boundVariables)return;let r=e.boundVariables[t];if(r){let i=Array.isArray(r)?r[0]:r;if(i!=null&&i.id)try{let o=figma.variables.getVariableById(i.id);if(o!=null&&o.name)return this.DEBUG_LOGGING&&console.log(`[Variable] ${e.name}.${t} \u2192 ${o.name}`),o.name}catch(o){}}}catch(n){}}cleanTokenReference(e){let t=e.trim();for(;t.startsWith('"')&&t.endsWith('"')||t.startsWith("'")&&t.endsWith("'");)t=t.slice(1,-1);return t=t.replace(/^[{]|[}]$/g,""),t=t.replace(/^\$/,""),t.trim()}getTokenReference(e,t){try{let n=["tokens","tokens-studio","tokensStudio","design-tokens"];for(let r of n)try{let i=e.getSharedPluginData(r,t);if(i&&i.trim()){let o=this.cleanTokenReference(i);return this.DEBUG_LOGGING&&console.log(`[TokenRef] Found ${r}:${t} = "${o}" on ${e.name}`),o}}catch(i){}try{let r=e.getPluginData(t);if(r&&r.trim())return this.cleanTokenReference(r)}catch(r){}}catch(n){}}getFillTokenReferences(e,t){let n=[`fills[${t}]`,`fill[${t}]`,`fills.${t}`,`fill.${t}`,"fill","fills","fillColor",`fillColor[${t}]`];for(let r of n){let i=this.getTokenReference(e,r);if(i)return i}}getStrokeTokenReferences(e,t){let n=[`strokes[${t}]`,`stroke[${t}]`,`strokes.${t}`,`stroke.${t}`,"stroke","strokes","strokeColor",`strokeColor[${t}]`,"borderColor"];for(let r of n){let i=this.getTokenReference(e,r);if(i)return i}}getTypographyTokenReference(e,t){let r={fontFamily:["fontFamily","fontFamilies","font-family","typography.fontFamily"],fontSize:["fontSize","fontSizes","font-size","typography.fontSize"],fontWeight:["fontWeight","fontWeights","font-weight","typography.fontWeight"],lineHeight:["lineHeight","lineHeights","line-height","typography.lineHeight"],letterSpacing:["letterSpacing","letter-spacing","typography.letterSpacing"],typography:["typography","text","textStyle","text-style"]}[t]||[t];for(let i of r){let o=this.getTokenReference(e,i);if(o)return o}}getSpacingTokenReference(e,t){let r={width:["width","sizing","dimension","sizing.width","dimensions.width"],height:["height","sizing","dimension","sizing.height","dimensions.height"],padding:["padding","spacing","paddingTop","paddingRight","paddingBottom","paddingLeft"],paddingTop:["paddingTop","verticalPadding","padding","spacing"],paddingRight:["paddingRight","horizontalPadding","padding","spacing"],paddingBottom:["paddingBottom","verticalPadding","padding","spacing"],paddingLeft:["paddingLeft","horizontalPadding","padding","spacing"],verticalPadding:["verticalPadding","paddingTop","paddingBottom","padding","spacing"],horizontalPadding:["horizontalPadding","paddingLeft","paddingRight","padding","spacing"],gap:["itemSpacing","spacing","gap","counterAxisSpacing"],itemSpacing:["itemSpacing","spacing","gap"],counterAxisSpacing:["counterAxisSpacing","spacing"],borderRadius:["borderRadius","borderRadiusTopLeft","borderRadiusTopRight","borderRadiusBottomRight","borderRadiusBottomLeft","radius","cornerRadius"],borderRadiusTopLeft:["borderRadiusTopLeft","borderRadius","radius"],borderRadiusTopRight:["borderRadiusTopRight","borderRadius","radius"],borderRadiusBottomRight:["borderRadiusBottomRight","borderRadius","radius"],borderRadiusBottomLeft:["borderRadiusBottomLeft","borderRadius","radius"],borderWidth:["borderWidth","strokeWeight","borderWidthTop","borderWidthRight","borderWidthBottom","borderWidthLeft","border"],strokeWeight:["strokeWeight","borderWidth","border"],dimension:["dimension","spacing","sizing","size"]}[t]||[t];for(let o of r){let s=this.getTokenReference(e,o);if(s)return s}let i=this.getVariableBinding(e,t);if(i)return i}getBorderRadiusTokenReference(e){let t=["borderRadius","borderRadiusTopLeft","borderRadiusTopRight","borderRadiusBottomRight","borderRadiusBottomLeft","radius","cornerRadius","topLeftRadius","topRightRadius","bottomRightRadius","bottomLeftRadius"];for(let r of t){let i=this.getTokenReference(e,r);if(i)return this.DEBUG_LOGGING&&console.log(`[BorderRadius] Found ${r} = "${i}" on ${e.name}`),i}let n=this.getVariableBinding(e,"cornerRadius");if(n)return n}getBorderWidthTokenReference(e){let t=["borderWidth","strokeWeight","borderWidthTop","borderWidthRight","borderWidthBottom","borderWidthLeft","border","strokeWidth"];for(let r of t){let i=this.getTokenReference(e,r);if(i)return this.DEBUG_LOGGING&&console.log(`[BorderWidth] Found ${r} = "${i}" on ${e.name}`),i}let n=this.getVariableBinding(e,"strokeWeight");if(n)return n}getEffectTokenReference(e,t){let n=["boxShadow","shadow",`boxShadow[${t}]`,`shadow[${t}]`,"effects","effect",`effects[${t}]`,`effect[${t}]`,"dropShadow","innerShadow","elevation","shadowColor","shadowOffset","shadowRadius","shadowSpread"];for(let i of n){let o=this.getTokenReference(e,i);if(o)return this.DEBUG_LOGGING&&console.log(`[Effect] Found ${i} = "${o}" on ${e.name}`),o}let r=this.getVariableBinding(e,"effects");if(r)return r}logNodeTokenData(e){if(!this.DEBUG_LOGGING)return;let t=this.getAllTokenKeys(e);if(Object.keys(t).length>0){console.log(`
[TokenData] Node: "${e.name}" (${e.type})`);for(let[n,r]of Object.entries(t)){let i=this.cleanTokenReference(r);console.log(i!==r?`  ${n} = ${i} (raw: ${r})`:`  ${n} = ${i}`)}}}scanAllComponents(){this.errors=[];let e=[],t=0,n=figma.root.children;for(let r of n)if(r.type==="PAGE"){let i=r.findAll(s=>s.type==="COMPONENT"||s.type==="COMPONENT_SET"),o=r.findAll(s=>s.type==="INSTANCE");t+=o.length;for(let s of i)try{let p=this.extractComponentProperties(s,r.name);p&&e.push(p)}catch(p){this.errors.push({componentId:s.id,componentName:s.name,error:p instanceof Error?p.message:"Unknown error"})}}return{components:e,totalComponents:e.length,totalInstances:t,pagesScanned:n.length,errors:this.errors}}scanCurrentPage(){this.errors=[];let e=[],t=figma.currentPage,n=0,r=t.findAll(o=>o.type==="COMPONENT"||o.type==="COMPONENT_SET"),i=t.findAll(o=>o.type==="INSTANCE");n+=i.length;for(let o of r)try{let s=this.extractComponentProperties(o,t.name);s&&e.push(s)}catch(s){this.errors.push({componentId:o.id,componentName:o.name,error:s instanceof Error?s.message:"Unknown error"})}return{components:e,totalComponents:e.length,totalInstances:n,pagesScanned:1,errors:this.errors}}scanNodes(e){this.errors=[];let t=[],n=0,r=figma.currentPage;for(let i of e){let o=[],s=[];"findAll"in i&&typeof i.findAll=="function"&&(o=i.findAll(p=>p.type==="COMPONENT"||p.type==="COMPONENT_SET"),s=i.findAll(p=>p.type==="INSTANCE"),n+=s.length);for(let p of o)try{let d=this.extractComponentProperties(p,r.name);d&&t.push(d)}catch(d){this.errors.push({componentId:p.id,componentName:p.name,error:d instanceof Error?d.message:"Unknown error"})}if(i.type==="COMPONENT"||i.type==="COMPONENT_SET")try{let p=this.extractComponentProperties(i,r.name);p&&(t.find(d=>d.id===p.id)||t.push(p))}catch(p){this.errors.push({componentId:i.id,componentName:i.name,error:p instanceof Error?p.message:"Unknown error"})}}return{components:t,totalComponents:t.length,totalInstances:n,pagesScanned:1,errors:this.errors}}extractComponentProperties(e,t){var r,i;if(e.type!=="COMPONENT"&&e.type!=="COMPONENT_SET"&&e.type!=="INSTANCE")return null;let n={id:e.id,name:e.name,type:e.type,pageName:t,colors:[],typography:[],spacing:[],effects:[]};if(e.type==="COMPONENT_SET")n.mainComponentName=e.name,n.mainComponentId=e.id;else if(e.type==="COMPONENT"){let o=e;((r=o.parent)==null?void 0:r.type)==="COMPONENT_SET"?(n.mainComponentName=o.parent.name,n.mainComponentId=o.parent.id):(n.mainComponentName=e.name,n.mainComponentId=e.id)}else if(e.type==="INSTANCE"){let o=e;try{let s=o.mainComponent;s&&(((i=s.parent)==null?void 0:i.type)==="COMPONENT_SET"?(n.mainComponentName=s.parent.name,n.mainComponentId=s.parent.id):(n.mainComponentName=s.name,n.mainComponentId=s.id))}catch(s){n.mainComponentName=e.name.split(",")[0].trim()}}if(n.colors=this.extractColors(e),n.typography=this.extractTypography(e),n.spacing=this.extractSpacing(e),n.effects=this.extractEffects(e),e.type==="COMPONENT"||e.type==="COMPONENT_SET"){let o=e;"layoutMode"in o&&o.layoutMode&&(n.layoutMode=o.layoutMode,n.itemSpacing=o.itemSpacing,n.paddingTop=o.paddingTop,n.paddingRight=o.paddingRight,n.paddingBottom=o.paddingBottom,n.paddingLeft=o.paddingLeft),n.width=o.width,n.height=o.height}else if(e.type==="INSTANCE"){let o=e;n.width=o.width,n.height=o.height}if("children"in e){let o=[];for(let s of e.children){let p=this.extractComponentProperties(s,t);p&&o.push(p)}o.length>0&&(n.children=o)}return n}extractColors(e){var n,r;let t=[];if("fills"in e&&Array.isArray(e.fills))for(let i=0;i<e.fills.length;i++){let o=e.fills[i];if(o.type==="SOLID"){let s=(n=o.opacity)!=null?n:1,p=this.rgbaToColor(o.color,s),d=this.getFillTokenReferences(e,i);t.push({type:"fill",color:{r:o.color.r,g:o.color.g,b:o.color.b,a:s},hex:p.hex,rgba:p.rgba,opacity:s,tokenReference:d})}}if("strokes"in e&&Array.isArray(e.strokes))for(let i=0;i<e.strokes.length;i++){let o=e.strokes[i];if(o.type==="SOLID"){let s=(r=o.opacity)!=null?r:1,p=this.rgbaToColor(o.color,s),d=this.getStrokeTokenReferences(e,i);t.push({type:"stroke",color:{r:o.color.r,g:o.color.g,b:o.color.b,a:s},hex:p.hex,rgba:p.rgba,opacity:s,tokenReference:d})}}return t}extractTypography(e){let t=[];if(e.type==="TEXT"){let n=e;if(typeof n.fontName!="symbol"){let r=n.fontName,i=this.getTypographyTokenReference(n,"typography"),o=this.getTypographyTokenReference(n,"fontFamily"),s=this.getTypographyTokenReference(n,"fontSize"),p=this.getTypographyTokenReference(n,"fontWeight"),d=this.getTypographyTokenReference(n,"lineHeight"),k=this.getTypographyTokenReference(n,"letterSpacing"),f=i||o||s||p||d||k;t.push({fontFamily:r.family,fontSize:typeof n.fontSize=="number"?n.fontSize:16,fontWeight:typeof r.style=="string"?this.parseFontWeight(r.style):400,lineHeight:typeof n.lineHeight=="number"||typeof n.lineHeight=="string"?n.lineHeight:void 0,letterSpacing:typeof n.letterSpacing=="number"?n.letterSpacing:void 0,textDecoration:typeof n.textDecoration=="string"?n.textDecoration:void 0,textCase:typeof n.textCase=="string"?n.textCase:void 0,tokenReference:f})}}if("children"in e)for(let n of e.children)t.push(...this.extractTypography(n));return t}extractSpacing(e){let t=[];if(this.logNodeTokenData(e),e.type==="COMPONENT"||e.type==="COMPONENT_SET"||e.type==="FRAME"||e.type==="INSTANCE"){let r=e,i=this.getSpacingTokenReference(e,"width"),o=this.getSpacingTokenReference(e,"height");if(t.push({type:"width",value:r.width,unit:"px",tokenReference:i}),t.push({type:"height",value:r.height,unit:"px",tokenReference:o}),"paddingTop"in r&&typeof r.paddingTop=="number"){let s=this.getSpacingTokenReference(e,"horizontalPadding"),p=this.getSpacingTokenReference(e,"verticalPadding"),d=this.getSpacingTokenReference(e,"padding"),k=this.getSpacingTokenReference(e,"paddingTop"),f=this.getSpacingTokenReference(e,"paddingRight"),u=this.getSpacingTokenReference(e,"paddingBottom"),v=this.getSpacingTokenReference(e,"paddingLeft"),N=(l,c)=>l?`[${c}] ${l}`:void 0,a=(l,c,g)=>{if(l)return l;if(c)return N(c,g);if(d)return N(d,"all")};r.paddingTop&&t.push({type:"padding",value:r.paddingTop,unit:"px",tokenReference:a(k,p,"vertical")}),r.paddingRight&&t.push({type:"padding",value:r.paddingRight,unit:"px",tokenReference:a(f,s,"horizontal")}),r.paddingBottom&&t.push({type:"padding",value:r.paddingBottom,unit:"px",tokenReference:a(u,p,"vertical")}),r.paddingLeft&&t.push({type:"padding",value:r.paddingLeft,unit:"px",tokenReference:a(v,s,"horizontal")})}if("itemSpacing"in r&&typeof r.itemSpacing=="number"&&r.itemSpacing){let s=this.getSpacingTokenReference(e,"itemSpacing")||this.getSpacingTokenReference(e,"gap")||this.getSpacingTokenReference(e,"spacing");t.push({type:"gap",value:r.itemSpacing,unit:"px",tokenReference:s})}if("counterAxisSpacing"in r&&typeof r.counterAxisSpacing=="number"&&r.counterAxisSpacing){let s=this.getSpacingTokenReference(e,"counterAxisSpacing");t.push({type:"gap",value:r.counterAxisSpacing,unit:"px",tokenReference:s})}if("cornerRadius"in r){let s=this.getBorderRadiusTokenReference(e);typeof r.cornerRadius=="number"&&r.cornerRadius>0?t.push({type:"borderRadius",value:r.cornerRadius,unit:"px",tokenReference:s}):r.cornerRadius===figma.mixed&&("topLeftRadius"in r&&typeof r.topLeftRadius=="number"&&r.topLeftRadius>0&&t.push({type:"borderRadius",value:r.topLeftRadius,unit:"px",tokenReference:this.getSpacingTokenReference(e,"borderRadiusTopLeft")||s}),"topRightRadius"in r&&typeof r.topRightRadius=="number"&&r.topRightRadius>0&&t.push({type:"borderRadius",value:r.topRightRadius,unit:"px",tokenReference:this.getSpacingTokenReference(e,"borderRadiusTopRight")||s}),"bottomRightRadius"in r&&typeof r.bottomRightRadius=="number"&&r.bottomRightRadius>0&&t.push({type:"borderRadius",value:r.bottomRightRadius,unit:"px",tokenReference:this.getSpacingTokenReference(e,"borderRadiusBottomRight")||s}),"bottomLeftRadius"in r&&typeof r.bottomLeftRadius=="number"&&r.bottomLeftRadius>0&&t.push({type:"borderRadius",value:r.bottomLeftRadius,unit:"px",tokenReference:this.getSpacingTokenReference(e,"borderRadiusBottomLeft")||s}))}if("strokeWeight"in r&&typeof r.strokeWeight=="number"&&r.strokeWeight>0){let s=this.getBorderWidthTokenReference(e);t.push({type:"borderWidth",value:r.strokeWeight,unit:"px",tokenReference:s})}}else if("cornerRadius"in e){let r=this.getBorderRadiusTokenReference(e),i=e;typeof i.cornerRadius=="number"&&i.cornerRadius>0&&t.push({type:"borderRadius",value:i.cornerRadius,unit:"px",tokenReference:r})}return t}extractEffects(e){var n,r,i,o,s,p,d,k;let t=[];if("effects"in e&&Array.isArray(e.effects))for(let f=0;f<e.effects.length;f++){let u=e.effects[f];if(u.visible){let v=this.getEffectTokenReference(e,f);switch(u.type){case"DROP_SHADOW":t.push({type:"drop-shadow",visible:u.visible,radius:u.radius,color:u.color?{r:u.color.r,g:u.color.g,b:u.color.b,a:u.color.a}:void 0,offset:{x:(r=(n=u.offset)==null?void 0:n.x)!=null?r:0,y:(o=(i=u.offset)==null?void 0:i.y)!=null?o:0},spread:u.spread,tokenReference:v});break;case"INNER_SHADOW":t.push({type:"inner-shadow",visible:u.visible,radius:u.radius,color:u.color?{r:u.color.r,g:u.color.g,b:u.color.b,a:u.color.a}:void 0,offset:{x:(p=(s=u.offset)==null?void 0:s.x)!=null?p:0,y:(k=(d=u.offset)==null?void 0:d.y)!=null?k:0},spread:u.spread,tokenReference:v});break;case"LAYER_BLUR":t.push({type:"layer-blur",visible:u.visible,radius:u.radius,tokenReference:v});break;case"BACKGROUND_BLUR":t.push({type:"background-blur",visible:u.visible,radius:u.radius,tokenReference:v});break}}}return t}rgbaToColor(e,t){let n=Math.round(e.r*255),r=Math.round(e.g*255),i=Math.round(e.b*255),o=t,s=`#${[n,r,i].map(d=>{let k=d.toString(16);return k.length===1?"0"+k:k}).join("")}`,p=`rgba(${n}, ${r}, ${i}, ${o.toFixed(2)})`;return{hex:s,rgba:p}}parseFontWeight(e){let t={thin:100,extralight:200,light:300,regular:400,medium:500,semibold:600,bold:700,extrabold:800,black:900},n=e.toLowerCase();for(let[i,o]of Object.entries(t))if(n.includes(i))return o;let r=e.match(/(\d+)/);return r?parseInt(r[1],10):400}getComponentUsageStats(e){let t=[],n=new Set;for(let r of figma.root.children)if(r.type==="PAGE"){let i=r.findAll(o=>{var s;return o.type==="INSTANCE"&&((s=o.mainComponent)==null?void 0:s.id)===e});i.length>0&&(t.push(...i),n.add(r.name))}return{instances:t.length,pages:Array.from(n)}}}});var Q,le=L(()=>{"use strict";Q=class{matchTokenToComponents(e,t){let n=[];for(let r of t.components){let i=this.matchComponentRecursively(e,r);if(i.length>0){let o=i.reduce((s,p)=>s+p.confidence,0)/i.length;n.push({component:r,matches:i,confidence:o})}}return n.sort((r,i)=>i.confidence-r.confidence),{token:e,matchingComponents:n,totalMatches:n.length,totalComponentsScanned:t.totalComponents}}matchComponentRecursively(e,t){let n=[];switch(e.type){case"color":n.push(...this.matchColor(e,t));break;case"fontFamily":case"fontWeight":case"typography":n.push(...this.matchTypography(e,t));break;case"dimension":n.push(...this.matchSpacing(e,t));break;case"shadow":n.push(...this.matchEffects(e,t));break;case"borderRadius":n.push(...this.matchSpacing(e,t,"borderRadius"));break;case"borderWidth":n.push(...this.matchSpacing(e,t,"borderWidth"));break;default:n.push(...this.matchByValue(e,t)),this.looksLikeSpacingToken(e)&&n.push(...this.matchSpacing(e,t)),this.looksLikeBorderRadiusToken(e)&&n.push(...this.matchSpacing(e,t,"borderRadius")),this.looksLikeBorderToken(e)&&n.push(...this.matchSpacing(e,t,"borderWidth")),this.looksLikeEffectToken(e)&&n.push(...this.matchEffects(e,t))}if(t.children&&t.children.length>0)for(let r of t.children){let i=this.matchComponentRecursively(e,r);for(let o of i)n.push(U(_({},o),{property:`${r.name} \u2192 ${o.property}`}))}return n}matchColor(e,t){let n=[],r=e.path.join("."),i=this.normalizeColor(e.value);for(let o of t.colors)if(o.tokenReference){let s=o.tokenReference.trim();s=s.replace(/^["']|["']$/g,""),s=s.replace(/^[{]|[}]$/g,""),s=s.replace(/^\$/,"");let p=s.toLowerCase(),d=r.toLowerCase();p===d?n.push({property:`${o.type} color (token ref)`,propertyType:"color",matchedValue:`${o.hex} \u2190 ${o.tokenReference}`,tokenValue:r,confidence:1}):(p.includes(d)||d.includes(p))&&n.push({property:`${o.type} color (token ref)`,propertyType:"color",matchedValue:`${o.hex} \u2190 ${o.tokenReference}`,tokenValue:r,confidence:.85})}if(n.length>0||!i)return n;for(let o of t.colors){let s=this.normalizeHex(o.hex),p=this.normalizeRgba(o.rgba),d=this.normalizeHex(i),k=this.normalizeRgba(i);if(d&&s&&d===s)n.push({property:`${o.type} color (value)`,propertyType:"color",matchedValue:o.hex,tokenValue:String(e.value),confidence:.7});else if(k&&p){let f=this.parseRgba(i),u=this.parseRgba(o.rgba);if(f&&u){let v=Math.abs(f.r-u.r),N=Math.abs(f.g-u.g),a=Math.abs(f.b-u.b),l=Math.abs(f.a-u.a);v<2&&N<2&&a<2&&l<.01&&n.push({property:`${o.type} color (value)`,propertyType:"color",matchedValue:o.rgba,tokenValue:String(e.value),confidence:.7})}}}return n}matchTypography(e,t){let n=[],r=e.path.join(".");for(let i of t.typography){let o=0,s="",p="value";if(i.tokenReference){let k=i.tokenReference.replace(/[{}]/g,"").replace(/^\$/,"").toLowerCase().replace(/\./g,"."),f=r.toLowerCase();k===f?(o=1,s=`${i.fontFamily} (ref: ${i.tokenReference})`,p="reference"):(k.includes(f)||f.includes(k))&&(o=.8,s=`${i.fontFamily} (ref: ${i.tokenReference})`,p="reference")}if(o===0){if(e.type==="fontFamily"){let d=String(e.value).toLowerCase().trim(),k=i.fontFamily.toLowerCase().trim();d===k&&(o=.9,s=i.fontFamily)}else if(e.type==="fontWeight"){let d=this.normalizeFontWeight(e.value),k=i.fontWeight;d===k&&(o=.9,s=String(k))}else if(e.type==="typography"&&typeof e.value=="object"&&e.value!==null){let d=e.value,k=!1,f=0,u=[];if(d.fontFamily){let v=String(d.fontFamily).toLowerCase().trim(),N=i.fontFamily.toLowerCase().trim();v===N&&(k=!0,f+=.4,u.push(`fontFamily: ${i.fontFamily}`))}if(d.fontSize){let v=Number(d.fontSize),N=i.fontSize;Math.abs(v-N)<.5&&(k=!0,f+=.3,u.push(`fontSize: ${N}`))}d.fontWeight&&this.normalizeFontWeight(d.fontWeight)===i.fontWeight&&(k=!0,f+=.3,u.push(`fontWeight: ${i.fontWeight}`)),k&&(o=Math.min(f,1),s=u.join(", "))}}o>0&&n.push({property:`typography${p==="reference"?" (token ref)":""}`,propertyType:"typography",matchedValue:s,tokenValue:String(e.value),confidence:o})}return n}matchSpacing(e,t,n){let r=[],i=e.path.join("."),o=this.normalizeDimension(e.value),s=n?t.spacing.filter(p=>p.type===n):t.spacing;for(let p of s)if(p.tokenReference){let d=p.tokenReference.trim();d=d.replace(/^["']|["']$/g,""),d=d.replace(/^[{]|[}]$/g,""),d=d.replace(/^\$/,""),d=d.replace(/^\[\w+\]\s*/,"");let k=d.toLowerCase(),f=i.toLowerCase(),u=this.formatSpacingType(p.type);k===f?r.push({property:`${u} (token ref)`,propertyType:"spacing",matchedValue:`${p.value}${p.unit} \u2190 ${p.tokenReference}`,tokenValue:i,confidence:1}):(k.includes(f)||f.includes(k))&&r.push({property:`${u} (token ref)`,propertyType:"spacing",matchedValue:`${p.value}${p.unit} \u2190 ${p.tokenReference}`,tokenValue:i,confidence:.85})}if(r.length>0||o===null)return r;for(let p of s){let d=p.value;if(Math.abs(o-d)<.5){let f=this.formatSpacingType(p.type);r.push({property:f,propertyType:"spacing",matchedValue:`${p.value}${p.unit}`,tokenValue:String(e.value),confidence:.7})}}return r}formatSpacingType(e){switch(e){case"borderRadius":return"border-radius";case"borderWidth":return"border-width";case"gap":return"gap/spacing";default:return e}}matchEffects(e,t){let n=[],r=e.path.join(".");for(let o of t.effects)if(o.tokenReference){let s=o.tokenReference.trim();s=s.replace(/^["']|["']$/g,""),s=s.replace(/^[{]|[}]$/g,""),s=s.replace(/^\$/,"");let p=s.toLowerCase(),d=r.toLowerCase();p===d?n.push({property:`${o.type} (token ref)`,propertyType:"effect",matchedValue:`${o.type} \u2190 ${o.tokenReference}`,tokenValue:r,confidence:1}):(p.includes(d)||d.includes(p))&&n.push({property:`${o.type} (token ref)`,propertyType:"effect",matchedValue:`${o.type} \u2190 ${o.tokenReference}`,tokenValue:r,confidence:.85})}if(n.length>0||typeof e.value!="object"||e.value===null)return n;let i=e.value;for(let o of t.effects)if(o.type==="drop-shadow"||o.type==="inner-shadow"){let s=0,p=[],d=i.blur||i.radius||i.spreadRadius;if(d!==void 0&&o.radius!==void 0&&Math.abs(Number(d)-o.radius)<1&&(s+=.4,p.push(`radius: ${o.radius}px`)),i.color&&o.color){let k=this.normalizeColor(i.color),f=this.rgbaToString(o.color);k&&this.colorsMatch(k,f)&&(s+=.4,p.push(`color: ${f}`))}if(i.offset&&o.offset){let k=Number(i.offset.x||0),f=Number(i.offset.y||0),u=o.offset.x||0,v=o.offset.y||0;Math.abs(k-u)<1&&Math.abs(f-v)<1&&(s+=.2,p.push(`offset: ${u}, ${v}`))}s>0&&n.push({property:o.type,propertyType:"effect",matchedValue:p.join(", "),tokenValue:JSON.stringify(e.value),confidence:Math.min(s,.7)})}return n}matchByValue(e,t){let n=[];return this.looksLikeColor(e.value)&&n.push(...this.matchColor(e,t)),this.looksLikeDimension(e.value)&&n.push(...this.matchSpacing(e,t)),n}normalizeColor(e){if(typeof e!="string")return null;let t=e.trim().toLowerCase();return t.match(/^#[0-9a-f]{3,8}$/)||t.match(/^rgba?\(/)||t.match(/^hsla?\(/)?t:null}normalizeHex(e){if(!e)return null;let t=e.trim().toLowerCase().replace("#","");return t.length===3&&(t=t.split("").map(n=>n+n).join("")),t.length===6?t:null}normalizeRgba(e){if(!e)return null;let t=e.match(/rgba?\(([^)]+)\)/i);return t?t[1].trim():null}parseRgba(e){let t=this.normalizeRgba(e);if(!t)return null;let n=t.split(",").map(r=>parseFloat(r.trim()));return n.length>=3?{r:n[0],g:n[1],b:n[2],a:n.length>3?n[3]:1}:null}rgbaToString(e){return`rgba(${Math.round(e.r)}, ${Math.round(e.g)}, ${Math.round(e.b)}, ${e.a.toFixed(2)})`}colorsMatch(e,t){let n=this.parseRgba(e),r=this.parseRgba(t);if(n&&r)return Math.abs(n.r-r.r)<2&&Math.abs(n.g-r.g)<2&&Math.abs(n.b-r.b)<2&&Math.abs(n.a-r.a)<.01;let i=this.normalizeHex(e),o=this.normalizeHex(t);return i!==null&&o!==null&&i===o}normalizeFontWeight(e){if(typeof e=="number")return e;if(typeof e!="string")return 400;let t={thin:100,extralight:200,light:300,regular:400,normal:400,medium:500,semibold:600,bold:700,extrabold:800,black:900},n=e.toLowerCase().trim();if(t[n])return t[n];let r=parseInt(e,10);return isNaN(r)?400:r}normalizeDimension(e){if(typeof e=="number")return e;if(typeof e!="string")return null;let t=e.replace(/px|rem|em|pt|pc|in|cm|mm|q|vh|vw|vmin|vmax|%/g,"").trim(),n=parseFloat(t);return isNaN(n)?null:n}looksLikeColor(e){if(typeof e!="string")return!1;let t=e.trim().toLowerCase();return t.match(/^#[0-9a-f]{3,8}$/)!==null||t.match(/^rgba?\(/)!==null||t.match(/^hsla?\(/)!==null}looksLikeDimension(e){return typeof e=="number"?!0:typeof e!="string"?!1:/^-?\d+(\.\d+)?(px|rem|em|pt|pc|in|cm|mm|q|vh|vw|vmin|vmax|%)$/.test(e.trim())}looksLikeSpacingToken(e){let t=e.path.join(".").toLowerCase();return["spacing","space","size","sizing","dimension","width","height","padding","margin","gap","radius","border","inset","offset","corner","round","stroke","weight","1x","2x","3x","4x","5x","6x","8x","10x","12x","16x"].some(r=>t.includes(r))}looksLikeBorderRadiusToken(e){let t=e.path.join(".").toLowerCase();return["radius","corner","round","rounded","borderradius"].some(r=>t.includes(r))}looksLikeBorderToken(e){let t=e.path.join(".").toLowerCase(),n=["border","stroke","outline","line"];return t.includes("radius")?!1:n.some(r=>t.includes(r))}looksLikeEffectToken(e){let t=e.path.join(".").toLowerCase();return["shadow","effect","blur","elevation","drop"].some(r=>t.includes(r))}}});function x(m,e){let t=`${pe}`;return pe+=1,j[t]={handler:e,name:m},function(){delete j[t]}}function fe(m,e){let t=!1;for(let n in j)j[n].name===m&&(j[n].handler.apply(null,e),t=!0);if(t===!1)throw new Error(`No event handler with name \`${m}\``)}var j,pe,b,de=L(()=>{j={},pe=0;b=typeof window=="undefined"?function(m,...e){figma.ui.postMessage([m,...e])}:function(m,...e){window.parent.postMessage({pluginMessage:[m,...e]},"*")};typeof window=="undefined"?figma.ui.onmessage=function(m){if(!Array.isArray(m))return;let[e,...t]=m;typeof e=="string"&&fe(e,t)}:window.onmessage=function(m){if(typeof m.data.pluginMessage=="undefined")return;let e=m.data.pluginMessage;if(!Array.isArray(e))return;let[t,...n]=m.data.pluginMessage;typeof t=="string"&&fe(t,n)}});function ne(m,e){if(typeof __html__=="undefined")throw new Error("No UI defined");let t=`<div id="create-figma-plugin"></div><script>document.body.classList.add('theme-${figma.editorType}');const __FIGMA_COMMAND__='${typeof figma.command=="undefined"?"":figma.command}';const __SHOW_UI_DATA__=${JSON.stringify(typeof e=="undefined"?{}:e)};${__html__}</script>`;figma.showUI(t,U(_({},m),{themeColors:typeof m.themeColors=="undefined"?!0:m.themeColors}))}var ue=L(()=>{});var ge=L(()=>{de();ue()});var he={};ve(he,{default:()=>we});function we(){ne({width:400,height:550},{resizable:!0}),figma.loadAllPagesAsync().catch(a=>{console.error("Error loading pages on startup:",a)});let m=new Z,e=new Y,t=new Q;async function n(){try{return await figma.clientStorage.getAsync("repoConfig")||null}catch(a){return console.error("Error loading config:",a),null}}async function r(a){try{await figma.clientStorage.setAsync("repoConfig",a)}catch(l){console.error("Error saving config:",l)}}async function i(){try{await figma.clientStorage.deleteAsync("repoConfig")}catch(a){console.error("Error clearing config:",a)}}x("load-config",async()=>{let a=await n();b("config-loaded",a)}),x("clear-config",async()=>{await i(),b("config-loaded",null)}),x("test-connection",async a=>{let l=m.parseGitHubUrl(a.repoUrl);if(!l){b("connection-result",{success:!1,error:"Invalid GitHub URL format"});return}try{b("connection-progress",{message:"Connecting to GitHub..."});let c=await m.fetchBranches(l.owner,l.repo,a.token),g=0,R=[];if(c.length>0)try{let y=c[0];b("connection-progress",{message:"Scanning for token files..."});let h=await m.detectTokenFiles(l.owner,l.repo,y,a.token,a.filePath||"");g=h.length,R=h.slice(0,5)}catch(y){console.error("Token detection failed:",y)}b("connection-result",{success:!0,branches:c.slice(0,10),owner:l.owner,repo:l.repo,fileCount:g,tokenCount:g,sampleFiles:R.map(y=>y.length>50?y.substring(0,47)+"...":y)})}catch(c){b("connection-result",{success:!1,error:c instanceof Error?c.message:"Connection failed"})}}),x("save-config",async a=>{await r(a),b("config-saved",{success:!0})});let o=(a,l)=>{let c=l.join(".").toLowerCase();if(typeof a=="string"){if(a.match(/^#[0-9A-Fa-f]{3,8}$/)||a.match(/^rgba?\(/)||a.match(/^hsla?\(/)||c.includes("color")||c.includes("colour"))return"color";if(a.match(/^\d+(\.\d+)?(ms|s)$/)||c.includes("duration"))return"duration";if(c.includes("radius")||c.includes("corner")||c.includes("rounded")||c.includes("borderradius"))return"borderRadius";if(c.includes("border")&&(c.includes("width")||c.includes("weight"))||c.includes("stroke")&&c.includes("weight"))return"borderWidth";if(a.match(/^-?\d+(\.\d+)?(px|rem|em|pt|pc|in|cm|mm|q|vh|vw|vmin|vmax|%)$/)||c.includes("size")||c.includes("spacing")||c.includes("space")||c.includes("gap")||c.includes("padding")||c.includes("margin")||c.includes("sizing")||c.includes("dimension")||c.match(/\d+x$/))return"dimension";if(c.includes("font")||c.includes("typography")||c.includes("text"))return c.includes("weight")?"fontWeight":c.includes("family")?"fontFamily":"typography";if(c.includes("shadow")||c.includes("elevation"))return"shadow";if(c.includes("border")&&!c.includes("radius"))return"border"}else{if(typeof a=="number")return c.includes("radius")||c.includes("corner")||c.includes("rounded")?"borderRadius":c.includes("border")&&c.includes("width")||c.includes("stroke")&&c.includes("weight")?"borderWidth":c.includes("weight")&&c.includes("font")?"fontWeight":c.includes("opacity")||c.includes("alpha")||c.includes("z-index")||c.includes("zindex")?"number":c.includes("spacing")||c.includes("space")||c.includes("gap")||c.includes("padding")||c.includes("margin")||c.includes("size")||c.match(/\d+x$/)?"dimension":"number";if(typeof a=="object"&&a!==null){if(c.includes("shadow")||a.blur!==void 0||a.spread!==void 0)return"shadow";if(c.includes("typography")||a.fontFamily!==void 0)return"typography";if(c.includes("border")||a.width!==void 0&&a.style!==void 0)return"border"}}return"string"},s=a=>a&&typeof a=="object"&&"$value"in a,p=a=>{if(!a||typeof a!="object"||"$value"in a||!("value"in a))return!1;let l=a.value;return typeof l=="string"||typeof l=="number"||typeof l=="boolean"?!0:typeof l=="object"&&l!==null?"type"in a||"description"in a:!1},d=(a,l)=>!(typeof a!="string"&&typeof a!="number"&&typeof a!="boolean"||l.length<1),k=(a,l)=>{let c=[],g=(y,h,C)=>{let $=C[C.length-1]||"unnamed",A=h||o(y,C);c.push({name:$,path:[...C],type:A,sourceFile:l,value:y})},R=(y,h,C)=>{if(y==null)return;let $=h[h.length-1]||"";if(!($.startsWith("$")&&$!=="$value"&&$!=="$type")){if(s(y)){g(y.$value,y.$type,h);return}if(p(y)){g(y.value,y.type,h);return}if(d(y,h)){g(y,void 0,h);return}if(typeof y=="object"){let A=Array.isArray(y)?y.map((T,S)=>String(S)):Object.keys(y);for(let T of A){if(!Array.isArray(y)&&(T.startsWith("$")||T==="extensions"))continue;let S=Array.isArray(y)?y[parseInt(T)]:y[T];R(S,[...h,T],C+1)}}}};return R(a,[],0),c};x("fetch-tokens",async a=>{let l=m.parseGitHubUrl(a.repoUrl);if(!l){b("tokens-result",{success:!1,error:"Invalid GitHub URL format"});return}try{let c=a.filePath||"";b("tokens-progress",{message:"Scanning for token files..."});let g=await m.detectTokenFiles(l.owner,l.repo,a.branch,a.token,c);if(g.length===0){b("tokens-result",{success:!1,error:`No token files found${c?` in '${c}'`:" in repository"}. Looking for .json files (excluding config files).`});return}let R=[],y=[],h=0,C=0,$=[],A=150;for(let T of g)try{b("tokens-progress",{message:`Processing ${T}...`});let S=await m.fetchFileContents(l.owner,l.repo,a.branch,a.token,T);if(!S.content)throw new Error("Empty file content");let W=m.decodeBase64Content(S.content),G;try{G=JSON.parse(W)}catch(z){throw new Error(`JSON parse failed: ${z.message}`)}let B=k(G,T),F=B.length;C+=F,$.push({file:T,count:F}),b("tokens-progress",{message:`Found ${F} tokens in ${T}`}),F===0&&y.push({file:T,message:"No token values found in this file (checked $value, value, and primitives)"});for(let z of B)if(R.length<A)R.push(z);else break;h++}catch(S){console.error(`Failed to parse ${T}:`,S),$.push({file:T,count:0}),y.push({file:T,message:S instanceof Error?S.message:"Failed to parse file"})}b("tokens-result",{success:!0,tokens:R.map(T=>({name:T.name||"",path:T.path||"",type:T.type||"unknown",sourceFile:T.sourceFile||""})),metadata:{totalTokens:C,truncated:C>R.length,filesProcessed:h,totalFiles:g.length,perFileCounts:$,errors:y}})}catch(c){b("tokens-result",{success:!1,error:c instanceof Error?c.message:"Failed to fetch tokens"})}}),x("detect-token-files",async a=>{let l=m.parseGitHubUrl(a.repoUrl);if(!l){b("token-files-result",{success:!1,error:"Invalid GitHub URL format"});return}try{let c=await m.detectTokenFiles(l.owner,l.repo,a.branch,a.token,a.directoryPath||"");b("token-files-result",{success:!0,files:c})}catch(c){b("token-files-result",{success:!1,error:c instanceof Error?c.message:"Failed to detect token files"})}}),x("scan-components",async a=>{try{let l=a.scanAll===!0;l?(b("scan-progress",{message:"Loading all pages..."}),await figma.loadAllPagesAsync(),b("scan-progress",{message:"Scanning all pages..."})):b("scan-progress",{message:"Scanning current page..."});let c=l?e.scanAllComponents():e.scanCurrentPage();b("scan-result",{success:!0,result:c})}catch(l){b("scan-result",{success:!1,error:l instanceof Error?l.message:"Failed to scan components"})}}),x("scan-components-for-token",async a=>{try{let{token:l,scanAll:c,scanSelection:g}=a,R=c===!0,y=g===!0;if(!l){b("scan-result",{success:!1,error:"No token provided"});return}let h="Scanning for token matches...";R?(h="Loading all pages...",b("scan-progress",{message:h}),await figma.loadAllPagesAsync(),h="Scanning all pages for token matches..."):y?h="Scanning selection for token matches...":h="Scanning current page for token matches...",b("scan-progress",{message:h}),b("scan-progress",{message:"Scanning components..."});let C;if(R)C=e.scanAllComponents();else if(y){let T=figma.currentPage.selection;if(T.length===0){b("scan-result",{success:!1,error:"No selection found. Please select a frame or node to scan."});return}C=e.scanNodes(T)}else C=e.scanCurrentPage();b("scan-progress",{message:`Found ${C.totalComponents} components. Matching tokens...`});let $=t.matchTokenToComponents(l,C);b("scan-progress",{message:"Matching complete!"});let A={token:{name:l.name,path:l.path,type:l.type,value:l.value},matchingComponents:$.matchingComponents.map(T=>({id:T.component.id,name:T.component.name,page:T.component.pageName,type:T.component.type,mainComponentName:T.component.mainComponentName,mainComponentId:T.component.mainComponentId,matches:T.matches.map(S=>`${S.property}: ${S.matchedValue}`),matchDetails:T.matches,confidence:T.confidence})),totalMatches:$.totalMatches,totalComponentsScanned:$.totalComponentsScanned};b("scan-result",{success:!0,result:A})}catch(l){b("scan-result",{success:!1,error:l instanceof Error?l.message:"Failed to scan components for token"})}}),x("get-component-usage",async a=>{try{let{componentId:l}=a,c=e.getComponentUsageStats(l);b("component-usage-result",{success:!0,stats:c})}catch(l){b("component-usage-result",{success:!1,error:l instanceof Error?l.message:"Failed to get usage stats"})}}),x("navigate-to-component",async a=>{try{let{componentId:l}=a,c=await figma.getNodeByIdAsync(l);if(c&&"type"in c){let g=f(c);g&&g.type==="PAGE"&&g!==figma.currentPage&&await figma.setCurrentPageAsync(g),c.type!=="DOCUMENT"&&c.type!=="PAGE"?(figma.currentPage.selection=[c],figma.viewport.scrollAndZoomIntoView([c]),b("navigate-result",{success:!0})):b("navigate-result",{success:!1,error:"Cannot select document or page nodes"})}else b("navigate-result",{success:!1,error:"Node not found"})}catch(l){b("navigate-result",{success:!1,error:l instanceof Error?l.message:"Failed to navigate to component"})}});function f(a){let l=a;for(;l&&l.type!=="PAGE";)l=l.parent;return l}async function u(a){let l=await figma.getNodeByIdAsync(a);if(!l)return null;if(l.type==="COMPONENT_SET"){let c=l,g=c.defaultVariant||c.children[0];if((g==null?void 0:g.type)==="COMPONENT")return g}return l.type==="COMPONENT"?l:l.type==="INSTANCE"?await l.getMainComponentAsync():null}x("create-component-collection",async a=>{try{let{token:l,groupedComponents:c,matchingComponents:g}=a,R=Object.entries(c||{});if(R.length===0&&(!g||g.length===0)){b("create-collection-result",{success:!1,error:"No components to collect"});return}let y=Array.isArray(l.path)?l.path.join("."):l.name,h=figma.createFrame();h.name=`Token Matches: ${y}`,h.layoutMode="VERTICAL",h.primaryAxisSizingMode="AUTO",h.counterAxisSizingMode="AUTO",h.paddingTop=32,h.paddingBottom=32,h.paddingLeft=32,h.paddingRight=32,h.itemSpacing=24,h.fills=[{type:"SOLID",color:{r:.95,g:.95,b:.95}}],h.cornerRadius=8;let C=figma.createText();await figma.loadFontAsync({family:"Inter",style:"Bold"}),await figma.loadFontAsync({family:"Inter",style:"Regular"}),C.fontName={family:"Inter",style:"Bold"},C.characters=`Token: ${y}`,C.fontSize=18,C.fills=[{type:"SOLID",color:{r:.1,g:.1,b:.1}}],h.appendChild(C);let $=R.length,A=(g==null?void 0:g.length)||0,T=figma.createText();T.fontName={family:"Inter",style:"Regular"},T.characters=`${$} component${$!==1?"s":""}${A>$?` (${A} variants total)`:""}`,T.fontSize=12,T.fills=[{type:"SOLID",color:{r:.4,g:.4,b:.4}}],h.appendChild(T);let S=figma.createFrame();S.name="Components Grid",S.layoutMode="HORIZONTAL",S.layoutWrap="WRAP",S.primaryAxisSizingMode="FIXED",S.counterAxisSizingMode="AUTO",S.resize(800,100),S.itemSpacing=24,S.counterAxisSpacing=24,S.fills=[],h.appendChild(S);let W=0;for(let[B,F]of R){let z=F.length;try{let w=figma.createFrame();w.name=B,w.layoutMode="VERTICAL",w.primaryAxisSizingMode="AUTO",w.counterAxisSizingMode="AUTO",w.paddingTop=16,w.paddingBottom=16,w.paddingLeft=16,w.paddingRight=16,w.itemSpacing=8,w.fills=[{type:"SOLID",color:{r:1,g:1,b:1}}],w.strokes=[{type:"SOLID",color:{r:.85,g:.85,b:.85}}],w.strokeWeight=1,w.cornerRadius=6;let H=figma.createText();H.fontName={family:"Inter",style:"Bold"},H.characters=B,H.fontSize=12,H.fills=[{type:"SOLID",color:{r:.1,g:.1,b:.1}}],w.appendChild(H);let K=F[0];if(K!=null&&K.matchDetails&&K.matchDetails.length>0){let V=K.matchDetails[0],P=figma.createText();P.fontName={family:"Inter",style:"Regular"};let M="";if(V.matchedValue){let I=V.matchedValue.match(/^([^â†]+)/);I&&(M=I[1].trim())}let O=V.property.replace(/\s*\([^)]*\)\s*/g,"").trim(),q=M?`${M} \u2192 ${O}`:O;z>1&&(q+=` (${z} variants)`),P.characters=q,P.fontSize=10,P.fills=[{type:"SOLID",color:{r:.5,g:.5,b:.5}}],w.appendChild(P)}let D=figma.createFrame();D.name="Variants",D.layoutMode="HORIZONTAL",D.primaryAxisSizingMode="AUTO",D.counterAxisSizingMode="AUTO",D.itemSpacing=12,D.fills=[],w.appendChild(D);let re=0;for(let V of F)try{let P=null,M=await figma.getNodeByIdAsync(V.id);if(M&&(M.type==="COMPONENT"?P=M:M.type==="INSTANCE"&&(P=await M.getMainComponentAsync())),P){let O=P.createInstance(),q=150;if("width"in O&&"height"in O&&"resize"in O){let I=O,ee=Math.min(1,q/Math.max(I.width,I.height));ee<1&&I.resize(I.width*ee,I.height*ee)}D.appendChild(O),re++}}catch(P){console.error(`Failed to create instance for variant ${V.id}:`,P)}re>0&&(S.appendChild(w),W++)}catch(w){console.error(`Failed to create card for ${B}:`,w)}}let G=figma.viewport;h.x=G.center.x-h.width/2,h.y=G.center.y-h.height/2,figma.currentPage.appendChild(h),figma.currentPage.selection=[h],figma.viewport.scrollAndZoomIntoView([h]),figma.notify(`Created collection with ${W} component${W!==1?"s":""}`),b("create-collection-result",{success:!0,count:W,frameId:h.id})}catch(l){console.error("Failed to create component collection:",l),b("create-collection-result",{success:!1,error:l instanceof Error?l.message:"Failed to create collection"})}}),x("cancel",()=>{figma.closePlugin()}),x("resize-window",a=>{figma.ui.resize(a.width,a.height)});function v(a){let l={nodeId:a.id,nodeName:a.name,nodeType:a.type,pluginData:{},sharedPluginData:{}};try{let g=a.getPluginDataKeys();for(let R of g)l.pluginData[R]=a.getPluginData(R)}catch(g){console.error("Error getting plugin data keys:",g)}let c=["tokens","tokens-studio","tokensStudio","figma-tokens","design-tokens","token-studio","com.tokens.studio","tokens.studio","io.tokens.studio","figmatokens","style-dictionary","ds","design-system","theme","variables"];for(let g of c)try{let R=a.getSharedPluginDataKeys(g);if(R.length>0){l.sharedPluginData[g]={};for(let y of R){let h=a.getSharedPluginData(g,y);l.sharedPluginData[g][y]=h}}}catch(R){}try{if("boundVariables"in a&&a.boundVariables){l.boundVariables={};let g=a.boundVariables;for(let[R,y]of Object.entries(g))if(y){if(Array.isArray(y))l.boundVariables[R]=y.map(h=>{try{let C=figma.variables.getVariableById(h.id);return{id:h.id,name:C==null?void 0:C.name,resolvedType:C==null?void 0:C.resolvedType,valuesByMode:C==null?void 0:C.valuesByMode}}catch(C){return{id:h.id,error:"Could not resolve variable"}}});else if(y.id)try{let h=figma.variables.getVariableById(y.id);l.boundVariables[R]={id:y.id,name:h==null?void 0:h.name,resolvedType:h==null?void 0:h.resolvedType,valuesByMode:h==null?void 0:h.valuesByMode}}catch(h){l.boundVariables[R]={id:y.id,error:"Could not resolve variable"}}}}}catch(g){console.error("Error getting bound variables:",g)}return l}function N(a,l=3,c=0){let g=[],R=v(a),y=Object.keys(R.pluginData).length>0||Object.keys(R.sharedPluginData).length>0||R.boundVariables&&Object.keys(R.boundVariables).length>0;if(g.push(U(_({},R),{pluginData:y?R.pluginData:{_noData:"true"}})),c<l&&"children"in a)for(let h of a.children)g.push(...N(h,l,c+1));return g}x("inspect-selection",async()=>{try{let a=figma.currentPage.selection;if(a.length===0){b("inspect-result",{success:!1,error:"No selection. Please select a node to inspect."});return}b("inspect-progress",{message:"Inspecting plugin data..."});let l=[];for(let g of a){let R=N(g,3);l.push(...R)}let c=l.filter(g=>!g.pluginData._noData&&(Object.keys(g.pluginData).length>0||Object.keys(g.sharedPluginData).length>0||g.boundVariables&&Object.keys(g.boundVariables).length>0));l.forEach(g=>{g.pluginData._noData&&(g.pluginData={})}),b("inspect-result",{success:!0,results:l,summary:{totalNodesInspected:l.length,nodesWithPluginData:c.length,namespacesFound:Array.from(new Set(c.flatMap(g=>Object.keys(g.sharedPluginData)))),pluginDataKeysFound:Array.from(new Set(c.flatMap(g=>Object.keys(g.pluginData)))),hasVariableBindings:c.some(g=>g.boundVariables&&Object.keys(g.boundVariables).length>0)}})}catch(a){b("inspect-result",{success:!1,error:a instanceof Error?a.message:"Failed to inspect selection"})}})}var me=L(()=>{"use strict";ae();ce();le();ge()});var $e={"src/main.ts--default":(me(),Se(he)).default},Ne="src/main.ts--default";$e[Ne]();
