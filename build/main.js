var M=Object.defineProperty,oe=Object.defineProperties,se=Object.getOwnPropertyDescriptor,ie=Object.getOwnPropertyDescriptors,ae=Object.getOwnPropertyNames,U=Object.getOwnPropertySymbols;var H=Object.prototype.hasOwnProperty,ce=Object.prototype.propertyIsEnumerable;var z=(h,e,t)=>e in h?M(h,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):h[e]=t,A=(h,e)=>{for(var t in e||(e={}))H.call(e,t)&&z(h,t,e[t]);if(U)for(var t of U(e))ce.call(e,t)&&z(h,t,e[t]);return h},E=(h,e)=>oe(h,ie(e));var P=(h,e)=>()=>(h&&(e=h(h=0)),e);var le=(h,e)=>{for(var t in e)M(h,t,{get:e[t],enumerable:!0})},fe=(h,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of ae(e))!H.call(h,n)&&n!==t&&M(h,n,{get:()=>e[n],enumerable:!(r=se(e,n))||r.enumerable});return h};var pe=h=>fe(M({},"__esModule",{value:!0}),h);var x=(h,e,t)=>z(h,typeof e!="symbol"?e+"":e,t);var W,K=P(()=>{"use strict";W=class{constructor(){x(this,"tokens",[]);x(this,"errors",[]);x(this,"tokenMap",new Map)}parse(e,t=""){return this.tokens=[],this.errors=[],this.tokenMap=new Map,this.collectTokens(e,[]),this.resolveAliases(),this.validateTokens(),{tokens:this.tokens,metadata:{filePath:t,format:"auto-detected",errors:this.errors}}}collectTokens(e,t){if(e==null)return;let r=t[t.length-1]||"";if(!(r.startsWith("$")&&r!=="$value"&&r!=="$type")){if(this.isW3CToken(e)){this.addToken(e.$value,e.$type,e.$description,e.$extensions,t);return}if(this.isTokenStudioToken(e)){this.addToken(e.value,e.type,e.description,e.extensions,t);return}if(this.isPrimitiveToken(e,t)){this.addToken(e,void 0,void 0,void 0,t);return}if(typeof e=="object"){let n=Array.isArray(e)?e.map((o,s)=>String(s)):Object.keys(e);for(let o of n){if(o.startsWith("$")||o==="extensions"||o==="description")continue;let s=Array.isArray(e)?e[parseInt(o)]:e[o];this.collectTokens(s,[...t,o])}}}}addToken(e,t,r,n,o){let s=o[o.length-1]||"unnamed",i=this.inferTokenType({$value:e,$type:t},o),f;typeof e=="string"&&(e.startsWith("{")||e.startsWith("$"))&&(f=this.extractAliases(e));let d={name:s,value:e,type:i,path:[...o],description:r,extensions:n,rawValue:e,aliases:f};this.tokens.push(d),this.tokenMap.set(o.join("."),d)}isW3CToken(e){return e&&typeof e=="object"&&"$value"in e}isTokenStudioToken(e){if(!e||typeof e!="object"||"$value"in e||!("value"in e))return!1;let t=e.value;return typeof t=="string"||typeof t=="number"||typeof t=="boolean"?!0:typeof t=="object"&&t!==null?"type"in e||"description"in e:!1}isPrimitiveToken(e,t){return!(typeof e!="string"&&typeof e!="number"&&typeof e!="boolean"||t.length<1)}isDesignToken(e){return this.isW3CToken(e)}inferTokenType(e,t){if(e.$type)return e.$type;let r=t.join(".").toLowerCase();if(r.includes("color")||r.includes("colour"))return"color";if(r.includes("font")||r.includes("typography")||r.includes("text"))return r.includes("weight")?"fontWeight":r.includes("family")?"fontFamily":"typography";if(r.includes("spacing")||r.includes("size")||r.includes("gap"))return"dimension";if(r.includes("shadow"))return"shadow";if(r.includes("border"))return"border";let n=e.$value;if(typeof n=="string"){if(n.match(/^#[0-9A-Fa-f]{3,8}$/)||n.match(/^rgba?\(/)||n.match(/^hsla?\(/))return"color";if(n.match(/^-?\d+(\.\d+)?(px|rem|em|pt|pc|in|cm|mm|q|vh|vw|vmin|vmax|%)$/))return"dimension";if(n.match(/^\d+(\.\d+)?(ms|s)$/))return"duration"}return typeof n=="number"?"number":typeof n=="boolean"?"boolean":"string"}extractAliases(e){let t=[],r=/\{([^}]+)\}/g,n;for(;(n=r.exec(e))!==null;){let o=n[1].split(",").map(s=>s.trim())[0];o.startsWith("$")&&(o=o.substring(1)),t.push(o)}if(e.startsWith("$")&&!e.startsWith("{")){let o=/\$([a-zA-Z0-9._-]+)/g;for(;(n=o.exec(e))!==null;)t.push(n[1])}return t}resolveAliases(){for(let e of this.tokens)if(e.aliases&&e.aliases.length>0)for(let t of e.aliases){let r=this.tokenMap.get(t);r?(e.value=r.value,e.aliases||(e.aliases=[])):this.errors.push({path:e.path,message:`Unresolved alias: ${t}`,severity:"error"})}}validateTokens(){for(let e of this.tokens){let t=this.validateTokenValue(e);t.valid||this.errors.push({path:e.path,message:t.message||"Validation error",severity:t.severity||"error"})}}validateTokenValue(e){let{type:t,value:r}=e;if(r==null)return{valid:!1,message:"Token value cannot be null or undefined",severity:"error"};switch(t){case"color":return this.validateColor(r);case"dimension":return this.validateDimension(r);case"fontWeight":return this.validateFontWeight(r);case"duration":return this.validateDuration(r);case"typography":return this.validateTypography(r);case"shadow":return this.validateShadow(r);default:return{valid:!0}}}validateColor(e){return typeof e!="string"?{valid:!1,message:"Color value must be a string",severity:"error"}:[/^#[0-9A-Fa-f]{3,8}$/,/^rgba?\([^)]+\)$/,/^hsla?\([^)]+\)$/].some(n=>n.test(e))?{valid:!0}:{valid:!1,message:`Invalid color format: ${e}`,severity:"error"}}validateDimension(e){if(typeof e=="string"){if(!/^-?\d+(\.\d+)?(px|rem|em|pt|pc|in|cm|mm|q|vh|vw|vmin|vmax|%)$/.test(e))return{valid:!1,message:`Invalid dimension format: ${e}`,severity:"error"}}else return typeof e=="number"?{valid:!0}:{valid:!1,message:"Dimension value must be a string or number",severity:"error"};return{valid:!0}}validateFontWeight(e){if(typeof e=="string"){if(!["100","200","300","400","500","600","700","800","900","normal","bold"].includes(e))return{valid:!1,message:`Invalid font weight: ${e}`,severity:"warning"}}else if(typeof e=="number"){if(e<1||e>1e3)return{valid:!1,message:"Font weight must be between 1 and 1000",severity:"error"}}else return{valid:!1,message:"Font weight must be a string or number",severity:"error"};return{valid:!0}}validateDuration(e){return typeof e!="string"?{valid:!1,message:"Duration value must be a string",severity:"error"}:/^\d+(\.\d+)?(ms|s)$/.test(e)?{valid:!0}:{valid:!1,message:`Invalid duration format: ${e}`,severity:"error"}}validateTypography(e){return typeof e!="object"||Array.isArray(e)?{valid:!1,message:"Typography value must be an object",severity:"error"}:e.fontFamily?{valid:!0}:{valid:!1,message:"Typography token missing fontFamily",severity:"warning"}}validateShadow(e){return typeof e!="object"||Array.isArray(e)?{valid:!1,message:"Shadow value must be an object",severity:"error"}:e.color?{valid:!0}:{valid:!1,message:"Shadow token missing color",severity:"warning"}}getTokensByType(e){return this.tokens.filter(t=>t.type===e)}getTokenByPath(e){return this.tokenMap.get(e.join("."))}getErrors(){return this.errors}}});var L,j=P(()=>{"use strict";K();L=class{constructor(){x(this,"parser");this.parser=new W}parseGitHubUrl(e){let t=[/github\.com[\/:]([^\/]+)\/([^\/\.]+)(\.git)?$/,/github\.com\/([^\/]+)\/([^\/]+)/];for(let r of t){let n=e.match(r);if(n)return{owner:n[1],repo:n[2]}}return null}async fetchBranches(e,t,r){try{let n=await fetch(`https://api.github.com/repos/${e}/${t}/branches`,{headers:{Authorization:`Bearer ${r}`,Accept:"application/vnd.github.v3+json"}});if(!n.ok)throw new Error(`GitHub API error: ${n.status}`);return(await n.json()).map(s=>s.name)}catch(n){throw new Error(`Failed to fetch branches: ${n}`)}}async fetchFileContents(e,t,r,n,o){try{let s=`https://api.github.com/repos/${e}/${t}/contents/${o}?ref=${r}`,i=await fetch(s,{headers:{Authorization:`Bearer ${n}`,Accept:"application/vnd.github.v3+json"}});if(!i.ok)throw new Error(`GitHub API error: ${i.status}`);return await i.json()}catch(s){throw new Error(`Failed to fetch file contents: ${s}`)}}async fetchDirectoryContents(e,t,r,n,o=""){try{let s=`https://api.github.com/repos/${e}/${t}/contents/${o}?ref=${r}`,i=await fetch(s,{headers:{Authorization:`Bearer ${n}`,Accept:"application/vnd.github.v3+json"}});if(!i.ok)throw new Error(`GitHub API error: ${i.status}`);let f=await i.json();return Array.isArray(f)?f:[f]}catch(s){throw new Error(`Failed to fetch directory contents: ${s}`)}}decodeBase64Content(e){try{let t=e.replace(/\s/g,""),r;if(typeof atob=="function")r=atob(t);else{let o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";r="";let s=0,i=t.replace(/=+$/,"");for(;s<i.length;){let f=o.indexOf(i.charAt(s++)),d=o.indexOf(i.charAt(s++)),m=o.indexOf(i.charAt(s++)),p=o.indexOf(i.charAt(s++)),u=f<<18|d<<12|(m&63)<<6|p&63;r+=String.fromCharCode(u>>16&255),m!==-1&&(r+=String.fromCharCode(u>>8&255)),p!==-1&&(r+=String.fromCharCode(u&255))}}let n;if(typeof TextDecoder!="undefined"){let o=new Uint8Array(r.length);for(let s=0;s<r.length;s++)o[s]=r.charCodeAt(s);n=new TextDecoder("utf-8").decode(o)}else try{n=decodeURIComponent(escape(r))}catch(o){n=r}return n.charCodeAt(0)===65279&&(n=n.slice(1)),n=n.replace(/\0/g,""),n=n.trim(),n}catch(t){throw new Error(`Failed to decode base64 content: ${t}`)}}parseJSONContent(e){try{return JSON.parse(e)}catch(t){throw new Error(`Failed to parse JSON: ${t}`)}}flattenTokens(e,t=[]){let r=[],n=[],o=p=>p&&typeof p=="object"&&"$value"in p,s=p=>{if(!p||typeof p!="object"||"$value"in p||!("value"in p))return!1;let u=p.value;return typeof u=="string"||typeof u=="number"||typeof u=="boolean"?!0:typeof u=="object"&&u!==null?"type"in p||"description"in p:!1},i=(p,u)=>!(typeof p!="string"&&typeof p!="number"&&typeof p!="boolean"||u.length<1),f=(p,u)=>{let T=u.join(".").toLowerCase();if(typeof p=="string"){if(p.match(/^#[0-9A-Fa-f]{3,8}$/)||p.match(/^rgba?\(/)||p.match(/^hsla?\(/)||T.includes("color"))return"color";if(p.match(/^\d+(\.\d+)?(ms|s)$/)||T.includes("duration"))return"duration";if(p.match(/^-?\d+(\.\d+)?(px|rem|em|pt|pc|in|cm|mm|q|vh|vw|vmin|vmax|%)$/)||T.includes("size")||T.includes("spacing")||T.includes("radius"))return"dimension";if(T.includes("font")||T.includes("typography"))return"typography";if(T.includes("shadow"))return"shadow"}else if(typeof p=="number")return"number";return"string"},d=(p,u,T)=>{let c=T[T.length-1]||"unnamed",l=u||f(p,T);r.push({name:c,path:T,type:l,value:p,rawValue:p})},m=(p,u)=>{if(p==null)return;let T=u[u.length-1]||"";if(!(T.startsWith("$")&&T!=="$value"&&T!=="$type")){if(o(p)){d(p.$value,p.$type,u);return}if(s(p)){d(p.value,p.type,u);return}if(i(p,u)){d(p,void 0,u);return}if(p&&typeof p=="object"){let c=Array.isArray(p)?p.map((l,a)=>String(a)):Object.keys(p);for(let l of c){if(!Array.isArray(p)&&(l.startsWith("$")||l==="extensions"))continue;let a=Array.isArray(p)?p[parseInt(l)]:p[l];m(a,[...u,l])}}}};try{m(e,[])}catch(p){n.push({path:[],message:p instanceof Error?p.message:"Failed to walk tokens"})}return{tokens:r,metadata:{filePath:"",format:"auto-detected",errors:n}}}async fetchTokens(e,t,r,n,o){let s=await this.fetchFileContents(e,t,r,n,o);if(s.type!=="file")throw new Error(`Path is not a file: ${o}`);if(!s.content)throw new Error("File content is empty");let i=this.decodeBase64Content(s.content),f=this.parseJSONContent(i),d=this.parser.parse(f,o);return(!d.tokens||d.tokens.length===0)&&(d=this.flattenTokens(f,[])),d}async detectTokenFiles(e,t,r,n,o=""){let s=await this.fetchDirectoryContents(e,t,r,n,o),i=[/package\.json$/i,/package-lock\.json$/i,/tsconfig\.json$/i,/\.config\.json$/i,/eslint.*\.json$/i,/prettier.*\.json$/i,/jest\.config\.json$/i,/webpack\.config\.json$/i,/^\$metadata\.json$/i,/^\$themes\.json$/i,/\(ignore\)\.json$/i],f=[];for(let d of s)if(d.type==="file"){let m=d.name.toLowerCase();m.endsWith(".json")&&(i.some(u=>u.test(m))||f.push(d.path))}else if(d.type==="dir"){let m=await this.detectTokenFiles(e,t,r,n,d.path);f.push(...m)}return f}}});var B,J=P(()=>{"use strict";B=class{constructor(){x(this,"errors",[]);x(this,"TOKENS_STUDIO_NAMESPACE","tokens");x(this,"DEBUG_LOGGING",!0)}getAllTokenKeys(e){let t={},r=["tokens","tokens-studio","tokensStudio","design-tokens","figma-tokens"];for(let n of r)try{let o=e.getSharedPluginDataKeys(n);for(let s of o){let i=e.getSharedPluginData(n,s);i&&i.trim()&&(t[`${n}:${s}`]=i)}}catch(o){}return t}getVariableBinding(e,t){try{if(!("boundVariables"in e)||!e.boundVariables)return;let n=e.boundVariables[t];if(n){let o=Array.isArray(n)?n[0]:n;if(o!=null&&o.id)try{let s=figma.variables.getVariableById(o.id);if(s!=null&&s.name)return this.DEBUG_LOGGING&&console.log(`[Variable] ${e.name}.${t} \u2192 ${s.name}`),s.name}catch(s){}}}catch(r){}}cleanTokenReference(e){let t=e.trim();for(;t.startsWith('"')&&t.endsWith('"')||t.startsWith("'")&&t.endsWith("'");)t=t.slice(1,-1);return t=t.replace(/^[{]|[}]$/g,""),t=t.replace(/^\$/,""),t.trim()}getTokenReference(e,t){try{let r=["tokens","tokens-studio","tokensStudio","design-tokens"];for(let n of r)try{let o=e.getSharedPluginData(n,t);if(o&&o.trim()){let s=this.cleanTokenReference(o);return this.DEBUG_LOGGING&&console.log(`[TokenRef] Found ${n}:${t} = "${s}" on ${e.name}`),s}}catch(o){}try{let n=e.getPluginData(t);if(n&&n.trim())return this.cleanTokenReference(n)}catch(n){}}catch(r){}}getFillTokenReferences(e,t){let r=[`fills[${t}]`,`fill[${t}]`,`fills.${t}`,`fill.${t}`,"fill","fills","fillColor",`fillColor[${t}]`];for(let n of r){let o=this.getTokenReference(e,n);if(o)return o}}getStrokeTokenReferences(e,t){let r=[`strokes[${t}]`,`stroke[${t}]`,`strokes.${t}`,`stroke.${t}`,"stroke","strokes","strokeColor",`strokeColor[${t}]`,"borderColor"];for(let n of r){let o=this.getTokenReference(e,n);if(o)return o}}getTypographyTokenReference(e,t){let n={fontFamily:["fontFamily","fontFamilies","font-family","typography.fontFamily"],fontSize:["fontSize","fontSizes","font-size","typography.fontSize"],fontWeight:["fontWeight","fontWeights","font-weight","typography.fontWeight"],lineHeight:["lineHeight","lineHeights","line-height","typography.lineHeight"],letterSpacing:["letterSpacing","letter-spacing","typography.letterSpacing"],typography:["typography","text","textStyle","text-style"]}[t]||[t];for(let o of n){let s=this.getTokenReference(e,o);if(s)return s}}getSpacingTokenReference(e,t){let n={width:["width","sizing","dimension","sizing.width","dimensions.width"],height:["height","sizing","dimension","sizing.height","dimensions.height"],padding:["padding","spacing","paddingTop","paddingRight","paddingBottom","paddingLeft"],paddingTop:["paddingTop","verticalPadding","padding","spacing"],paddingRight:["paddingRight","horizontalPadding","padding","spacing"],paddingBottom:["paddingBottom","verticalPadding","padding","spacing"],paddingLeft:["paddingLeft","horizontalPadding","padding","spacing"],verticalPadding:["verticalPadding","paddingTop","paddingBottom","padding","spacing"],horizontalPadding:["horizontalPadding","paddingLeft","paddingRight","padding","spacing"],gap:["itemSpacing","spacing","gap","counterAxisSpacing"],itemSpacing:["itemSpacing","spacing","gap"],counterAxisSpacing:["counterAxisSpacing","spacing"],borderRadius:["borderRadius","borderRadiusTopLeft","borderRadiusTopRight","borderRadiusBottomRight","borderRadiusBottomLeft","radius","cornerRadius"],borderRadiusTopLeft:["borderRadiusTopLeft","borderRadius","radius"],borderRadiusTopRight:["borderRadiusTopRight","borderRadius","radius"],borderRadiusBottomRight:["borderRadiusBottomRight","borderRadius","radius"],borderRadiusBottomLeft:["borderRadiusBottomLeft","borderRadius","radius"],borderWidth:["borderWidth","strokeWeight","borderWidthTop","borderWidthRight","borderWidthBottom","borderWidthLeft","border"],strokeWeight:["strokeWeight","borderWidth","border"],dimension:["dimension","spacing","sizing","size"]}[t]||[t];for(let s of n){let i=this.getTokenReference(e,s);if(i)return i}let o=this.getVariableBinding(e,t);if(o)return o}getBorderRadiusTokenReference(e){let t=["borderRadius","borderRadiusTopLeft","borderRadiusTopRight","borderRadiusBottomRight","borderRadiusBottomLeft","radius","cornerRadius","topLeftRadius","topRightRadius","bottomRightRadius","bottomLeftRadius"];for(let n of t){let o=this.getTokenReference(e,n);if(o)return this.DEBUG_LOGGING&&console.log(`[BorderRadius] Found ${n} = "${o}" on ${e.name}`),o}let r=this.getVariableBinding(e,"cornerRadius");if(r)return r}getBorderWidthTokenReference(e){let t=["borderWidth","strokeWeight","borderWidthTop","borderWidthRight","borderWidthBottom","borderWidthLeft","border","strokeWidth"];for(let n of t){let o=this.getTokenReference(e,n);if(o)return this.DEBUG_LOGGING&&console.log(`[BorderWidth] Found ${n} = "${o}" on ${e.name}`),o}let r=this.getVariableBinding(e,"strokeWeight");if(r)return r}getEffectTokenReference(e,t){let r=["boxShadow","shadow",`boxShadow[${t}]`,`shadow[${t}]`,"effects","effect",`effects[${t}]`,`effect[${t}]`,"dropShadow","innerShadow","elevation","shadowColor","shadowOffset","shadowRadius","shadowSpread"];for(let o of r){let s=this.getTokenReference(e,o);if(s)return this.DEBUG_LOGGING&&console.log(`[Effect] Found ${o} = "${s}" on ${e.name}`),s}let n=this.getVariableBinding(e,"effects");if(n)return n}logNodeTokenData(e){if(!this.DEBUG_LOGGING)return;let t=this.getAllTokenKeys(e);if(Object.keys(t).length>0){console.log(`
[TokenData] Node: "${e.name}" (${e.type})`);for(let[r,n]of Object.entries(t)){let o=this.cleanTokenReference(n);console.log(o!==n?`  ${r} = ${o} (raw: ${n})`:`  ${r} = ${o}`)}}}scanAllComponents(){this.errors=[];let e=[],t=0,r=figma.root.children;for(let n of r)if(n.type==="PAGE"){let o=n.findAll(i=>i.type==="COMPONENT"||i.type==="COMPONENT_SET"),s=n.findAll(i=>i.type==="INSTANCE");t+=s.length;for(let i of o)try{let f=this.extractComponentProperties(i,n.name);f&&e.push(f)}catch(f){this.errors.push({componentId:i.id,componentName:i.name,error:f instanceof Error?f.message:"Unknown error"})}}return{components:e,totalComponents:e.length,totalInstances:t,pagesScanned:r.length,errors:this.errors}}scanCurrentPage(){this.errors=[];let e=[],t=figma.currentPage,r=0,n=t.findAll(s=>s.type==="COMPONENT"||s.type==="COMPONENT_SET"),o=t.findAll(s=>s.type==="INSTANCE");r+=o.length;for(let s of n)try{let i=this.extractComponentProperties(s,t.name);i&&e.push(i)}catch(i){this.errors.push({componentId:s.id,componentName:s.name,error:i instanceof Error?i.message:"Unknown error"})}return{components:e,totalComponents:e.length,totalInstances:r,pagesScanned:1,errors:this.errors}}scanNodes(e){this.errors=[];let t=[],r=0,n=figma.currentPage;for(let o of e){let s=[],i=[];"findAll"in o&&typeof o.findAll=="function"&&(s=o.findAll(f=>f.type==="COMPONENT"||f.type==="COMPONENT_SET"),i=o.findAll(f=>f.type==="INSTANCE"),r+=i.length);for(let f of s)try{let d=this.extractComponentProperties(f,n.name);d&&t.push(d)}catch(d){this.errors.push({componentId:f.id,componentName:f.name,error:d instanceof Error?d.message:"Unknown error"})}if(o.type==="COMPONENT"||o.type==="COMPONENT_SET")try{let f=this.extractComponentProperties(o,n.name);f&&(t.find(d=>d.id===f.id)||t.push(f))}catch(f){this.errors.push({componentId:o.id,componentName:o.name,error:f instanceof Error?f.message:"Unknown error"})}}return{components:t,totalComponents:t.length,totalInstances:r,pagesScanned:1,errors:this.errors}}extractComponentProperties(e,t){if(e.type!=="COMPONENT"&&e.type!=="COMPONENT_SET"&&e.type!=="INSTANCE")return null;let r={id:e.id,name:e.name,type:e.type,pageName:t,colors:[],typography:[],spacing:[],effects:[]};if(r.colors=this.extractColors(e),r.typography=this.extractTypography(e),r.spacing=this.extractSpacing(e),r.effects=this.extractEffects(e),e.type==="COMPONENT"||e.type==="COMPONENT_SET"){let n=e;"layoutMode"in n&&n.layoutMode&&(r.layoutMode=n.layoutMode,r.itemSpacing=n.itemSpacing,r.paddingTop=n.paddingTop,r.paddingRight=n.paddingRight,r.paddingBottom=n.paddingBottom,r.paddingLeft=n.paddingLeft),r.width=n.width,r.height=n.height}else if(e.type==="INSTANCE"){let n=e;r.width=n.width,r.height=n.height}if("children"in e){let n=[];for(let o of e.children){let s=this.extractComponentProperties(o,t);s&&n.push(s)}n.length>0&&(r.children=n)}return r}extractColors(e){var r,n;let t=[];if("fills"in e&&Array.isArray(e.fills))for(let o=0;o<e.fills.length;o++){let s=e.fills[o];if(s.type==="SOLID"){let i=(r=s.opacity)!=null?r:1,f=this.rgbaToColor(s.color,i),d=this.getFillTokenReferences(e,o);t.push({type:"fill",color:{r:s.color.r,g:s.color.g,b:s.color.b,a:i},hex:f.hex,rgba:f.rgba,opacity:i,tokenReference:d})}}if("strokes"in e&&Array.isArray(e.strokes))for(let o=0;o<e.strokes.length;o++){let s=e.strokes[o];if(s.type==="SOLID"){let i=(n=s.opacity)!=null?n:1,f=this.rgbaToColor(s.color,i),d=this.getStrokeTokenReferences(e,o);t.push({type:"stroke",color:{r:s.color.r,g:s.color.g,b:s.color.b,a:i},hex:f.hex,rgba:f.rgba,opacity:i,tokenReference:d})}}return t}extractTypography(e){let t=[];if(e.type==="TEXT"){let r=e;if(typeof r.fontName!="symbol"){let n=r.fontName,o=this.getTypographyTokenReference(r,"typography"),s=this.getTypographyTokenReference(r,"fontFamily"),i=this.getTypographyTokenReference(r,"fontSize"),f=this.getTypographyTokenReference(r,"fontWeight"),d=this.getTypographyTokenReference(r,"lineHeight"),m=this.getTypographyTokenReference(r,"letterSpacing"),p=o||s||i||f||d||m;t.push({fontFamily:n.family,fontSize:typeof r.fontSize=="number"?r.fontSize:16,fontWeight:typeof n.style=="string"?this.parseFontWeight(n.style):400,lineHeight:typeof r.lineHeight=="number"||typeof r.lineHeight=="string"?r.lineHeight:void 0,letterSpacing:typeof r.letterSpacing=="number"?r.letterSpacing:void 0,textDecoration:typeof r.textDecoration=="string"?r.textDecoration:void 0,textCase:typeof r.textCase=="string"?r.textCase:void 0,tokenReference:p})}}if("children"in e)for(let r of e.children)t.push(...this.extractTypography(r));return t}extractSpacing(e){let t=[];if(this.logNodeTokenData(e),e.type==="COMPONENT"||e.type==="COMPONENT_SET"||e.type==="FRAME"||e.type==="INSTANCE"){let n=e,o=this.getSpacingTokenReference(e,"width"),s=this.getSpacingTokenReference(e,"height");if(t.push({type:"width",value:n.width,unit:"px",tokenReference:o}),t.push({type:"height",value:n.height,unit:"px",tokenReference:s}),"paddingTop"in n&&typeof n.paddingTop=="number"){let i=this.getSpacingTokenReference(e,"horizontalPadding"),f=this.getSpacingTokenReference(e,"verticalPadding"),d=this.getSpacingTokenReference(e,"padding"),m=this.getSpacingTokenReference(e,"paddingTop"),p=this.getSpacingTokenReference(e,"paddingRight"),u=this.getSpacingTokenReference(e,"paddingBottom"),T=this.getSpacingTokenReference(e,"paddingLeft"),c=(a,g)=>a?`[${g}] ${a}`:void 0,l=(a,g,R)=>{if(a)return a;if(g)return c(g,R);if(d)return c(d,"all")};n.paddingTop&&t.push({type:"padding",value:n.paddingTop,unit:"px",tokenReference:l(m,f,"vertical")}),n.paddingRight&&t.push({type:"padding",value:n.paddingRight,unit:"px",tokenReference:l(p,i,"horizontal")}),n.paddingBottom&&t.push({type:"padding",value:n.paddingBottom,unit:"px",tokenReference:l(u,f,"vertical")}),n.paddingLeft&&t.push({type:"padding",value:n.paddingLeft,unit:"px",tokenReference:l(T,i,"horizontal")})}if("itemSpacing"in n&&typeof n.itemSpacing=="number"&&n.itemSpacing){let i=this.getSpacingTokenReference(e,"itemSpacing")||this.getSpacingTokenReference(e,"gap")||this.getSpacingTokenReference(e,"spacing");t.push({type:"gap",value:n.itemSpacing,unit:"px",tokenReference:i})}if("counterAxisSpacing"in n&&typeof n.counterAxisSpacing=="number"&&n.counterAxisSpacing){let i=this.getSpacingTokenReference(e,"counterAxisSpacing");t.push({type:"gap",value:n.counterAxisSpacing,unit:"px",tokenReference:i})}if("cornerRadius"in n){let i=this.getBorderRadiusTokenReference(e);typeof n.cornerRadius=="number"&&n.cornerRadius>0?t.push({type:"borderRadius",value:n.cornerRadius,unit:"px",tokenReference:i}):n.cornerRadius===figma.mixed&&("topLeftRadius"in n&&typeof n.topLeftRadius=="number"&&n.topLeftRadius>0&&t.push({type:"borderRadius",value:n.topLeftRadius,unit:"px",tokenReference:this.getSpacingTokenReference(e,"borderRadiusTopLeft")||i}),"topRightRadius"in n&&typeof n.topRightRadius=="number"&&n.topRightRadius>0&&t.push({type:"borderRadius",value:n.topRightRadius,unit:"px",tokenReference:this.getSpacingTokenReference(e,"borderRadiusTopRight")||i}),"bottomRightRadius"in n&&typeof n.bottomRightRadius=="number"&&n.bottomRightRadius>0&&t.push({type:"borderRadius",value:n.bottomRightRadius,unit:"px",tokenReference:this.getSpacingTokenReference(e,"borderRadiusBottomRight")||i}),"bottomLeftRadius"in n&&typeof n.bottomLeftRadius=="number"&&n.bottomLeftRadius>0&&t.push({type:"borderRadius",value:n.bottomLeftRadius,unit:"px",tokenReference:this.getSpacingTokenReference(e,"borderRadiusBottomLeft")||i}))}if("strokeWeight"in n&&typeof n.strokeWeight=="number"&&n.strokeWeight>0){let i=this.getBorderWidthTokenReference(e);t.push({type:"borderWidth",value:n.strokeWeight,unit:"px",tokenReference:i})}}else if("cornerRadius"in e){let n=this.getBorderRadiusTokenReference(e),o=e;typeof o.cornerRadius=="number"&&o.cornerRadius>0&&t.push({type:"borderRadius",value:o.cornerRadius,unit:"px",tokenReference:n})}return t}extractEffects(e){var r,n,o,s,i,f,d,m;let t=[];if("effects"in e&&Array.isArray(e.effects))for(let p=0;p<e.effects.length;p++){let u=e.effects[p];if(u.visible){let T=this.getEffectTokenReference(e,p);switch(u.type){case"DROP_SHADOW":t.push({type:"drop-shadow",visible:u.visible,radius:u.radius,color:u.color?{r:u.color.r,g:u.color.g,b:u.color.b,a:u.color.a}:void 0,offset:{x:(n=(r=u.offset)==null?void 0:r.x)!=null?n:0,y:(s=(o=u.offset)==null?void 0:o.y)!=null?s:0},spread:u.spread,tokenReference:T});break;case"INNER_SHADOW":t.push({type:"inner-shadow",visible:u.visible,radius:u.radius,color:u.color?{r:u.color.r,g:u.color.g,b:u.color.b,a:u.color.a}:void 0,offset:{x:(f=(i=u.offset)==null?void 0:i.x)!=null?f:0,y:(m=(d=u.offset)==null?void 0:d.y)!=null?m:0},spread:u.spread,tokenReference:T});break;case"LAYER_BLUR":t.push({type:"layer-blur",visible:u.visible,radius:u.radius,tokenReference:T});break;case"BACKGROUND_BLUR":t.push({type:"background-blur",visible:u.visible,radius:u.radius,tokenReference:T});break}}}return t}rgbaToColor(e,t){let r=Math.round(e.r*255),n=Math.round(e.g*255),o=Math.round(e.b*255),s=t,i=`#${[r,n,o].map(d=>{let m=d.toString(16);return m.length===1?"0"+m:m}).join("")}`,f=`rgba(${r}, ${n}, ${o}, ${s.toFixed(2)})`;return{hex:i,rgba:f}}parseFontWeight(e){let t={thin:100,extralight:200,light:300,regular:400,medium:500,semibold:600,bold:700,extrabold:800,black:900},r=e.toLowerCase();for(let[o,s]of Object.entries(t))if(r.includes(o))return s;let n=e.match(/(\d+)/);return n?parseInt(n[1],10):400}getComponentUsageStats(e){let t=[],r=new Set;for(let n of figma.root.children)if(n.type==="PAGE"){let o=n.findAll(s=>{var i;return s.type==="INSTANCE"&&((i=s.mainComponent)==null?void 0:i.id)===e});o.length>0&&(t.push(...o),r.add(n.name))}return{instances:t.length,pages:Array.from(r)}}}});var O,q=P(()=>{"use strict";O=class{matchTokenToComponents(e,t){let r=[];for(let n of t.components){let o=this.matchComponentRecursively(e,n);if(o.length>0){let s=o.reduce((i,f)=>i+f.confidence,0)/o.length;r.push({component:n,matches:o,confidence:s})}}return r.sort((n,o)=>o.confidence-n.confidence),{token:e,matchingComponents:r,totalMatches:r.length,totalComponentsScanned:t.totalComponents}}matchComponentRecursively(e,t){let r=[];switch(e.type){case"color":r.push(...this.matchColor(e,t));break;case"fontFamily":case"fontWeight":case"typography":r.push(...this.matchTypography(e,t));break;case"dimension":r.push(...this.matchSpacing(e,t));break;case"shadow":r.push(...this.matchEffects(e,t));break;case"borderRadius":r.push(...this.matchSpacing(e,t,"borderRadius"));break;case"borderWidth":r.push(...this.matchSpacing(e,t,"borderWidth"));break;default:r.push(...this.matchByValue(e,t)),this.looksLikeSpacingToken(e)&&r.push(...this.matchSpacing(e,t)),this.looksLikeBorderRadiusToken(e)&&r.push(...this.matchSpacing(e,t,"borderRadius")),this.looksLikeBorderToken(e)&&r.push(...this.matchSpacing(e,t,"borderWidth")),this.looksLikeEffectToken(e)&&r.push(...this.matchEffects(e,t))}if(t.children&&t.children.length>0)for(let n of t.children){let o=this.matchComponentRecursively(e,n);for(let s of o)r.push(E(A({},s),{property:`${n.name} \u2192 ${s.property}`}))}return r}matchColor(e,t){let r=[],n=e.path.join("."),o=this.normalizeColor(e.value);for(let s of t.colors)if(s.tokenReference){let i=s.tokenReference.trim();i=i.replace(/^["']|["']$/g,""),i=i.replace(/^[{]|[}]$/g,""),i=i.replace(/^\$/,"");let f=i.toLowerCase(),d=n.toLowerCase();f===d?r.push({property:`${s.type} color (token ref)`,propertyType:"color",matchedValue:`${s.hex} \u2190 ${s.tokenReference}`,tokenValue:n,confidence:1}):(f.includes(d)||d.includes(f))&&r.push({property:`${s.type} color (token ref)`,propertyType:"color",matchedValue:`${s.hex} \u2190 ${s.tokenReference}`,tokenValue:n,confidence:.85})}if(r.length>0||!o)return r;for(let s of t.colors){let i=this.normalizeHex(s.hex),f=this.normalizeRgba(s.rgba),d=this.normalizeHex(o),m=this.normalizeRgba(o);if(d&&i&&d===i)r.push({property:`${s.type} color (value)`,propertyType:"color",matchedValue:s.hex,tokenValue:String(e.value),confidence:.7});else if(m&&f){let p=this.parseRgba(o),u=this.parseRgba(s.rgba);if(p&&u){let T=Math.abs(p.r-u.r),c=Math.abs(p.g-u.g),l=Math.abs(p.b-u.b),a=Math.abs(p.a-u.a);T<2&&c<2&&l<2&&a<.01&&r.push({property:`${s.type} color (value)`,propertyType:"color",matchedValue:s.rgba,tokenValue:String(e.value),confidence:.7})}}}return r}matchTypography(e,t){let r=[],n=e.path.join(".");for(let o of t.typography){let s=0,i="",f="value";if(o.tokenReference){let m=o.tokenReference.replace(/[{}]/g,"").replace(/^\$/,"").toLowerCase().replace(/\./g,"."),p=n.toLowerCase();m===p?(s=1,i=`${o.fontFamily} (ref: ${o.tokenReference})`,f="reference"):(m.includes(p)||p.includes(m))&&(s=.8,i=`${o.fontFamily} (ref: ${o.tokenReference})`,f="reference")}if(s===0){if(e.type==="fontFamily"){let d=String(e.value).toLowerCase().trim(),m=o.fontFamily.toLowerCase().trim();d===m&&(s=.9,i=o.fontFamily)}else if(e.type==="fontWeight"){let d=this.normalizeFontWeight(e.value),m=o.fontWeight;d===m&&(s=.9,i=String(m))}else if(e.type==="typography"&&typeof e.value=="object"&&e.value!==null){let d=e.value,m=!1,p=0,u=[];if(d.fontFamily){let T=String(d.fontFamily).toLowerCase().trim(),c=o.fontFamily.toLowerCase().trim();T===c&&(m=!0,p+=.4,u.push(`fontFamily: ${o.fontFamily}`))}if(d.fontSize){let T=Number(d.fontSize),c=o.fontSize;Math.abs(T-c)<.5&&(m=!0,p+=.3,u.push(`fontSize: ${c}`))}d.fontWeight&&this.normalizeFontWeight(d.fontWeight)===o.fontWeight&&(m=!0,p+=.3,u.push(`fontWeight: ${o.fontWeight}`)),m&&(s=Math.min(p,1),i=u.join(", "))}}s>0&&r.push({property:`typography${f==="reference"?" (token ref)":""}`,propertyType:"typography",matchedValue:i,tokenValue:String(e.value),confidence:s})}return r}matchSpacing(e,t,r){let n=[],o=e.path.join("."),s=this.normalizeDimension(e.value),i=r?t.spacing.filter(f=>f.type===r):t.spacing;for(let f of i)if(f.tokenReference){let d=f.tokenReference.trim();d=d.replace(/^["']|["']$/g,""),d=d.replace(/^[{]|[}]$/g,""),d=d.replace(/^\$/,""),d=d.replace(/^\[\w+\]\s*/,"");let m=d.toLowerCase(),p=o.toLowerCase(),u=this.formatSpacingType(f.type);m===p?n.push({property:`${u} (token ref)`,propertyType:"spacing",matchedValue:`${f.value}${f.unit} \u2190 ${f.tokenReference}`,tokenValue:o,confidence:1}):(m.includes(p)||p.includes(m))&&n.push({property:`${u} (token ref)`,propertyType:"spacing",matchedValue:`${f.value}${f.unit} \u2190 ${f.tokenReference}`,tokenValue:o,confidence:.85})}if(n.length>0||s===null)return n;for(let f of i){let d=f.value;if(Math.abs(s-d)<.5){let p=this.formatSpacingType(f.type);n.push({property:p,propertyType:"spacing",matchedValue:`${f.value}${f.unit}`,tokenValue:String(e.value),confidence:.7})}}return n}formatSpacingType(e){switch(e){case"borderRadius":return"border-radius";case"borderWidth":return"border-width";case"gap":return"gap/spacing";default:return e}}matchEffects(e,t){let r=[],n=e.path.join(".");for(let s of t.effects)if(s.tokenReference){let i=s.tokenReference.trim();i=i.replace(/^["']|["']$/g,""),i=i.replace(/^[{]|[}]$/g,""),i=i.replace(/^\$/,"");let f=i.toLowerCase(),d=n.toLowerCase();f===d?r.push({property:`${s.type} (token ref)`,propertyType:"effect",matchedValue:`${s.type} \u2190 ${s.tokenReference}`,tokenValue:n,confidence:1}):(f.includes(d)||d.includes(f))&&r.push({property:`${s.type} (token ref)`,propertyType:"effect",matchedValue:`${s.type} \u2190 ${s.tokenReference}`,tokenValue:n,confidence:.85})}if(r.length>0||typeof e.value!="object"||e.value===null)return r;let o=e.value;for(let s of t.effects)if(s.type==="drop-shadow"||s.type==="inner-shadow"){let i=0,f=[],d=o.blur||o.radius||o.spreadRadius;if(d!==void 0&&s.radius!==void 0&&Math.abs(Number(d)-s.radius)<1&&(i+=.4,f.push(`radius: ${s.radius}px`)),o.color&&s.color){let m=this.normalizeColor(o.color),p=this.rgbaToString(s.color);m&&this.colorsMatch(m,p)&&(i+=.4,f.push(`color: ${p}`))}if(o.offset&&s.offset){let m=Number(o.offset.x||0),p=Number(o.offset.y||0),u=s.offset.x||0,T=s.offset.y||0;Math.abs(m-u)<1&&Math.abs(p-T)<1&&(i+=.2,f.push(`offset: ${u}, ${T}`))}i>0&&r.push({property:s.type,propertyType:"effect",matchedValue:f.join(", "),tokenValue:JSON.stringify(e.value),confidence:Math.min(i,.7)})}return r}matchByValue(e,t){let r=[];return this.looksLikeColor(e.value)&&r.push(...this.matchColor(e,t)),this.looksLikeDimension(e.value)&&r.push(...this.matchSpacing(e,t)),r}normalizeColor(e){if(typeof e!="string")return null;let t=e.trim().toLowerCase();return t.match(/^#[0-9a-f]{3,8}$/)||t.match(/^rgba?\(/)||t.match(/^hsla?\(/)?t:null}normalizeHex(e){if(!e)return null;let t=e.trim().toLowerCase().replace("#","");return t.length===3&&(t=t.split("").map(r=>r+r).join("")),t.length===6?t:null}normalizeRgba(e){if(!e)return null;let t=e.match(/rgba?\(([^)]+)\)/i);return t?t[1].trim():null}parseRgba(e){let t=this.normalizeRgba(e);if(!t)return null;let r=t.split(",").map(n=>parseFloat(n.trim()));return r.length>=3?{r:r[0],g:r[1],b:r[2],a:r.length>3?r[3]:1}:null}rgbaToString(e){return`rgba(${Math.round(e.r)}, ${Math.round(e.g)}, ${Math.round(e.b)}, ${e.a.toFixed(2)})`}colorsMatch(e,t){let r=this.parseRgba(e),n=this.parseRgba(t);if(r&&n)return Math.abs(r.r-n.r)<2&&Math.abs(r.g-n.g)<2&&Math.abs(r.b-n.b)<2&&Math.abs(r.a-n.a)<.01;let o=this.normalizeHex(e),s=this.normalizeHex(t);return o!==null&&s!==null&&o===s}normalizeFontWeight(e){if(typeof e=="number")return e;if(typeof e!="string")return 400;let t={thin:100,extralight:200,light:300,regular:400,normal:400,medium:500,semibold:600,bold:700,extrabold:800,black:900},r=e.toLowerCase().trim();if(t[r])return t[r];let n=parseInt(e,10);return isNaN(n)?400:n}normalizeDimension(e){if(typeof e=="number")return e;if(typeof e!="string")return null;let t=e.replace(/px|rem|em|pt|pc|in|cm|mm|q|vh|vw|vmin|vmax|%/g,"").trim(),r=parseFloat(t);return isNaN(r)?null:r}looksLikeColor(e){if(typeof e!="string")return!1;let t=e.trim().toLowerCase();return t.match(/^#[0-9a-f]{3,8}$/)!==null||t.match(/^rgba?\(/)!==null||t.match(/^hsla?\(/)!==null}looksLikeDimension(e){return typeof e=="number"?!0:typeof e!="string"?!1:/^-?\d+(\.\d+)?(px|rem|em|pt|pc|in|cm|mm|q|vh|vw|vmin|vmax|%)$/.test(e.trim())}looksLikeSpacingToken(e){let t=e.path.join(".").toLowerCase();return["spacing","space","size","sizing","dimension","width","height","padding","margin","gap","radius","border","inset","offset","corner","round","stroke","weight","1x","2x","3x","4x","5x","6x","8x","10x","12x","16x"].some(n=>t.includes(n))}looksLikeBorderRadiusToken(e){let t=e.path.join(".").toLowerCase();return["radius","corner","round","rounded","borderradius"].some(n=>t.includes(n))}looksLikeBorderToken(e){let t=e.path.join(".").toLowerCase(),r=["border","stroke","outline","line"];return t.includes("radius")?!1:r.some(n=>t.includes(n))}looksLikeEffectToken(e){let t=e.path.join(".").toLowerCase();return["shadow","effect","blur","elevation","drop"].some(n=>t.includes(n))}}});function w(h,e){let t=`${X}`;return X+=1,F[t]={handler:e,name:h},function(){delete F[t]}}function Y(h,e){let t=!1;for(let r in F)F[r].name===h&&(F[r].handler.apply(null,e),t=!0);if(t===!1)throw new Error(`No event handler with name \`${h}\``)}var F,X,k,Z=P(()=>{F={},X=0;k=typeof window=="undefined"?function(h,...e){figma.ui.postMessage([h,...e])}:function(h,...e){window.parent.postMessage({pluginMessage:[h,...e]},"*")};typeof window=="undefined"?figma.ui.onmessage=function(h){if(!Array.isArray(h))return;let[e,...t]=h;typeof e=="string"&&Y(e,t)}:window.onmessage=function(h){if(typeof h.data.pluginMessage=="undefined")return;let e=h.data.pluginMessage;if(!Array.isArray(e))return;let[t,...r]=h.data.pluginMessage;typeof t=="string"&&Y(t,r)}});function I(h,e){if(typeof __html__=="undefined")throw new Error("No UI defined");let t=`<div id="create-figma-plugin"></div><script>document.body.classList.add('theme-${figma.editorType}');const __FIGMA_COMMAND__='${typeof figma.command=="undefined"?"":figma.command}';const __SHOW_UI_DATA__=${JSON.stringify(typeof e=="undefined"?{}:e)};${__html__}</script>`;figma.showUI(t,E(A({},h),{themeColors:typeof h.themeColors=="undefined"?!0:h.themeColors}))}var Q=P(()=>{});var ee=P(()=>{Z();Q()});var te={};le(te,{default:()=>de});function de(){I({width:400,height:550},{resizable:!0}),figma.loadAllPagesAsync().catch(c=>{console.error("Error loading pages on startup:",c)});let h=new L,e=new B,t=new O;async function r(){try{return await figma.clientStorage.getAsync("repoConfig")||null}catch(c){return console.error("Error loading config:",c),null}}async function n(c){try{await figma.clientStorage.setAsync("repoConfig",c)}catch(l){console.error("Error saving config:",l)}}async function o(){try{await figma.clientStorage.deleteAsync("repoConfig")}catch(c){console.error("Error clearing config:",c)}}w("load-config",async()=>{let c=await r();k("config-loaded",c)}),w("clear-config",async()=>{await o(),k("config-loaded",null)}),w("test-connection",async c=>{let l=h.parseGitHubUrl(c.repoUrl);if(!l){k("connection-result",{success:!1,error:"Invalid GitHub URL format"});return}try{k("connection-progress",{message:"Connecting to GitHub..."});let a=await h.fetchBranches(l.owner,l.repo,c.token),g=0,R=[];if(a.length>0)try{let y=a[0];k("connection-progress",{message:"Scanning for token files..."});let b=await h.detectTokenFiles(l.owner,l.repo,y,c.token,c.filePath||"");g=b.length,R=b.slice(0,5)}catch(y){console.error("Token detection failed:",y)}k("connection-result",{success:!0,branches:a.slice(0,10),owner:l.owner,repo:l.repo,fileCount:g,tokenCount:g,sampleFiles:R.map(y=>y.length>50?y.substring(0,47)+"...":y)})}catch(a){k("connection-result",{success:!1,error:a instanceof Error?a.message:"Connection failed"})}}),w("save-config",async c=>{await n(c),k("config-saved",{success:!0})});let s=(c,l)=>{let a=l.join(".").toLowerCase();if(typeof c=="string"){if(c.match(/^#[0-9A-Fa-f]{3,8}$/)||c.match(/^rgba?\(/)||c.match(/^hsla?\(/)||a.includes("color")||a.includes("colour"))return"color";if(c.match(/^\d+(\.\d+)?(ms|s)$/)||a.includes("duration"))return"duration";if(a.includes("radius")||a.includes("corner")||a.includes("rounded")||a.includes("borderradius"))return"borderRadius";if(a.includes("border")&&(a.includes("width")||a.includes("weight"))||a.includes("stroke")&&a.includes("weight"))return"borderWidth";if(c.match(/^-?\d+(\.\d+)?(px|rem|em|pt|pc|in|cm|mm|q|vh|vw|vmin|vmax|%)$/)||a.includes("size")||a.includes("spacing")||a.includes("space")||a.includes("gap")||a.includes("padding")||a.includes("margin")||a.includes("sizing")||a.includes("dimension")||a.match(/\d+x$/))return"dimension";if(a.includes("font")||a.includes("typography")||a.includes("text"))return a.includes("weight")?"fontWeight":a.includes("family")?"fontFamily":"typography";if(a.includes("shadow")||a.includes("elevation"))return"shadow";if(a.includes("border")&&!a.includes("radius"))return"border"}else{if(typeof c=="number")return a.includes("radius")||a.includes("corner")||a.includes("rounded")?"borderRadius":a.includes("border")&&a.includes("width")||a.includes("stroke")&&a.includes("weight")?"borderWidth":a.includes("weight")&&a.includes("font")?"fontWeight":a.includes("opacity")||a.includes("alpha")||a.includes("z-index")||a.includes("zindex")?"number":a.includes("spacing")||a.includes("space")||a.includes("gap")||a.includes("padding")||a.includes("margin")||a.includes("size")||a.match(/\d+x$/)?"dimension":"number";if(typeof c=="object"&&c!==null){if(a.includes("shadow")||c.blur!==void 0||c.spread!==void 0)return"shadow";if(a.includes("typography")||c.fontFamily!==void 0)return"typography";if(a.includes("border")||c.width!==void 0&&c.style!==void 0)return"border"}}return"string"},i=c=>c&&typeof c=="object"&&"$value"in c,f=c=>{if(!c||typeof c!="object"||"$value"in c||!("value"in c))return!1;let l=c.value;return typeof l=="string"||typeof l=="number"||typeof l=="boolean"?!0:typeof l=="object"&&l!==null?"type"in c||"description"in c:!1},d=(c,l)=>!(typeof c!="string"&&typeof c!="number"&&typeof c!="boolean"||l.length<1),m=(c,l)=>{let a=[],g=(y,b,S)=>{let C=S[S.length-1]||"unnamed",N=b||s(y,S);a.push({name:C,path:[...S],type:N,sourceFile:l,value:y})},R=(y,b,S)=>{if(y==null)return;let C=b[b.length-1]||"";if(!(C.startsWith("$")&&C!=="$value"&&C!=="$type")){if(i(y)){g(y.$value,y.$type,b);return}if(f(y)){g(y.value,y.type,b);return}if(d(y,b)){g(y,void 0,b);return}if(typeof y=="object"){let N=Array.isArray(y)?y.map((v,$)=>String($)):Object.keys(y);for(let v of N){if(!Array.isArray(y)&&(v.startsWith("$")||v==="extensions"))continue;let $=Array.isArray(y)?y[parseInt(v)]:y[v];R($,[...b,v],S+1)}}}};return R(c,[],0),a};w("fetch-tokens",async c=>{let l=h.parseGitHubUrl(c.repoUrl);if(!l){k("tokens-result",{success:!1,error:"Invalid GitHub URL format"});return}try{let a=c.filePath||"";k("tokens-progress",{message:"Scanning for token files..."});let g=await h.detectTokenFiles(l.owner,l.repo,c.branch,c.token,a);if(g.length===0){k("tokens-result",{success:!1,error:`No token files found${a?` in '${a}'`:" in repository"}. Looking for .json files (excluding config files).`});return}let R=[],y=[],b=0,S=0,C=[],N=150;for(let v of g)try{k("tokens-progress",{message:`Processing ${v}...`});let $=await h.fetchFileContents(l.owner,l.repo,c.branch,c.token,v);if(!$.content)throw new Error("Empty file content");let re=h.decodeBase64Content($.content),_;try{_=JSON.parse(re)}catch(V){throw new Error(`JSON parse failed: ${V.message}`)}let G=m(_,v),D=G.length;S+=D,C.push({file:v,count:D}),k("tokens-progress",{message:`Found ${D} tokens in ${v}`}),D===0&&y.push({file:v,message:"No token values found in this file (checked $value, value, and primitives)"});for(let V of G)if(R.length<N)R.push(V);else break;b++}catch($){console.error(`Failed to parse ${v}:`,$),C.push({file:v,count:0}),y.push({file:v,message:$ instanceof Error?$.message:"Failed to parse file"})}k("tokens-result",{success:!0,tokens:R.map(v=>({name:v.name||"",path:v.path||"",type:v.type||"unknown",sourceFile:v.sourceFile||""})),metadata:{totalTokens:S,truncated:S>R.length,filesProcessed:b,totalFiles:g.length,perFileCounts:C,errors:y}})}catch(a){k("tokens-result",{success:!1,error:a instanceof Error?a.message:"Failed to fetch tokens"})}}),w("detect-token-files",async c=>{let l=h.parseGitHubUrl(c.repoUrl);if(!l){k("token-files-result",{success:!1,error:"Invalid GitHub URL format"});return}try{let a=await h.detectTokenFiles(l.owner,l.repo,c.branch,c.token,c.directoryPath||"");k("token-files-result",{success:!0,files:a})}catch(a){k("token-files-result",{success:!1,error:a instanceof Error?a.message:"Failed to detect token files"})}}),w("scan-components",async c=>{try{let l=c.scanAll===!0;l?(k("scan-progress",{message:"Loading all pages..."}),await figma.loadAllPagesAsync(),k("scan-progress",{message:"Scanning all pages..."})):k("scan-progress",{message:"Scanning current page..."});let a=l?e.scanAllComponents():e.scanCurrentPage();k("scan-result",{success:!0,result:a})}catch(l){k("scan-result",{success:!1,error:l instanceof Error?l.message:"Failed to scan components"})}}),w("scan-components-for-token",async c=>{try{let{token:l,scanAll:a,scanSelection:g}=c,R=a===!0,y=g===!0;if(!l){k("scan-result",{success:!1,error:"No token provided"});return}let b="Scanning for token matches...";R?(b="Loading all pages...",k("scan-progress",{message:b}),await figma.loadAllPagesAsync(),b="Scanning all pages for token matches..."):y?b="Scanning selection for token matches...":b="Scanning current page for token matches...",k("scan-progress",{message:b}),k("scan-progress",{message:"Scanning components..."});let S;if(R)S=e.scanAllComponents();else if(y){let v=figma.currentPage.selection;if(v.length===0){k("scan-result",{success:!1,error:"No selection found. Please select a frame or node to scan."});return}S=e.scanNodes(v)}else S=e.scanCurrentPage();k("scan-progress",{message:`Found ${S.totalComponents} components. Matching tokens...`});let C=t.matchTokenToComponents(l,S);k("scan-progress",{message:"Matching complete!"});let N={token:{name:l.name,path:l.path,type:l.type,value:l.value},matchingComponents:C.matchingComponents.map(v=>({id:v.component.id,name:v.component.name,page:v.component.pageName,type:v.component.type,matches:v.matches.map($=>`${$.property}: ${$.matchedValue}`),matchDetails:v.matches,confidence:v.confidence})),totalMatches:C.totalMatches,totalComponentsScanned:C.totalComponentsScanned};k("scan-result",{success:!0,result:N})}catch(l){k("scan-result",{success:!1,error:l instanceof Error?l.message:"Failed to scan components for token"})}}),w("get-component-usage",async c=>{try{let{componentId:l}=c,a=e.getComponentUsageStats(l);k("component-usage-result",{success:!0,stats:a})}catch(l){k("component-usage-result",{success:!1,error:l instanceof Error?l.message:"Failed to get usage stats"})}}),w("navigate-to-component",async c=>{try{let{componentId:l}=c,a=await figma.getNodeByIdAsync(l);if(a&&"type"in a){let g=p(a);g&&g.type==="PAGE"&&g!==figma.currentPage&&await figma.setCurrentPageAsync(g),a.type!=="DOCUMENT"&&a.type!=="PAGE"?(figma.currentPage.selection=[a],figma.viewport.scrollAndZoomIntoView([a]),k("navigate-result",{success:!0})):k("navigate-result",{success:!1,error:"Cannot select document or page nodes"})}else k("navigate-result",{success:!1,error:"Node not found"})}catch(l){k("navigate-result",{success:!1,error:l instanceof Error?l.message:"Failed to navigate to component"})}});function p(c){let l=c;for(;l&&l.type!=="PAGE";)l=l.parent;return l}w("cancel",()=>{figma.closePlugin()}),w("resize-window",c=>{figma.ui.resize(c.width,c.height)});function u(c){let l={nodeId:c.id,nodeName:c.name,nodeType:c.type,pluginData:{},sharedPluginData:{}};try{let g=c.getPluginDataKeys();for(let R of g)l.pluginData[R]=c.getPluginData(R)}catch(g){console.error("Error getting plugin data keys:",g)}let a=["tokens","tokens-studio","tokensStudio","figma-tokens","design-tokens","token-studio","com.tokens.studio","tokens.studio","io.tokens.studio","figmatokens","style-dictionary","ds","design-system","theme","variables"];for(let g of a)try{let R=c.getSharedPluginDataKeys(g);if(R.length>0){l.sharedPluginData[g]={};for(let y of R){let b=c.getSharedPluginData(g,y);l.sharedPluginData[g][y]=b}}}catch(R){}try{if("boundVariables"in c&&c.boundVariables){l.boundVariables={};let g=c.boundVariables;for(let[R,y]of Object.entries(g))if(y){if(Array.isArray(y))l.boundVariables[R]=y.map(b=>{try{let S=figma.variables.getVariableById(b.id);return{id:b.id,name:S==null?void 0:S.name,resolvedType:S==null?void 0:S.resolvedType,valuesByMode:S==null?void 0:S.valuesByMode}}catch(S){return{id:b.id,error:"Could not resolve variable"}}});else if(y.id)try{let b=figma.variables.getVariableById(y.id);l.boundVariables[R]={id:y.id,name:b==null?void 0:b.name,resolvedType:b==null?void 0:b.resolvedType,valuesByMode:b==null?void 0:b.valuesByMode}}catch(b){l.boundVariables[R]={id:y.id,error:"Could not resolve variable"}}}}}catch(g){console.error("Error getting bound variables:",g)}return l}function T(c,l=3,a=0){let g=[],R=u(c),y=Object.keys(R.pluginData).length>0||Object.keys(R.sharedPluginData).length>0||R.boundVariables&&Object.keys(R.boundVariables).length>0;if(g.push(E(A({},R),{pluginData:y?R.pluginData:{_noData:"true"}})),a<l&&"children"in c)for(let b of c.children)g.push(...T(b,l,a+1));return g}w("inspect-selection",async()=>{try{let c=figma.currentPage.selection;if(c.length===0){k("inspect-result",{success:!1,error:"No selection. Please select a node to inspect."});return}k("inspect-progress",{message:"Inspecting plugin data..."});let l=[];for(let g of c){let R=T(g,3);l.push(...R)}let a=l.filter(g=>!g.pluginData._noData&&(Object.keys(g.pluginData).length>0||Object.keys(g.sharedPluginData).length>0||g.boundVariables&&Object.keys(g.boundVariables).length>0));l.forEach(g=>{g.pluginData._noData&&(g.pluginData={})}),k("inspect-result",{success:!0,results:l,summary:{totalNodesInspected:l.length,nodesWithPluginData:a.length,namespacesFound:Array.from(new Set(a.flatMap(g=>Object.keys(g.sharedPluginData)))),pluginDataKeysFound:Array.from(new Set(a.flatMap(g=>Object.keys(g.pluginData)))),hasVariableBindings:a.some(g=>g.boundVariables&&Object.keys(g.boundVariables).length>0)}})}catch(c){k("inspect-result",{success:!1,error:c instanceof Error?c.message:"Failed to inspect selection"})}})}var ne=P(()=>{"use strict";j();J();q();ee()});var ue={"src/main.ts--default":(ne(),pe(te)).default},ge="src/main.ts--default";ue[ge]();
