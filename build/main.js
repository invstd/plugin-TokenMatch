var se=Object.defineProperty,Ve=Object.defineProperties,ze=Object.getOwnPropertyDescriptor,_e=Object.getOwnPropertyDescriptors,Ue=Object.getOwnPropertyNames,Ce=Object.getOwnPropertySymbols;var Te=Object.prototype.hasOwnProperty,Ge=Object.prototype.propertyIsEnumerable;var he=(y,e,t)=>e in y?se(y,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):y[e]=t,Y=(y,e)=>{for(var t in e||(e={}))Te.call(e,t)&&he(y,t,e[t]);if(Ce)for(var t of Ce(e))Ge.call(e,t)&&he(y,t,e[t]);return y},Q=(y,e)=>Ve(y,_e(e));var q=(y,e)=>()=>(y&&(e=y(y=0)),e);var He=(y,e)=>{for(var t in e)se(y,t,{get:e[t],enumerable:!0})},Ke=(y,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of Ue(e))!Te.call(y,r)&&r!==t&&se(y,r,{get:()=>e[r],enumerable:!(n=ze(e,r))||n.enumerable});return y};var je=y=>Ke(se({},"__esModule",{value:!0}),y);var D=(y,e,t)=>he(y,typeof e!="symbol"?e+"":e,t);var ae,Se=q(()=>{"use strict";ae=class{constructor(){D(this,"tokens",[]);D(this,"errors",[]);D(this,"tokenMap",new Map)}parse(e,t=""){return this.tokens=[],this.errors=[],this.tokenMap=new Map,this.collectTokens(e,[]),this.resolveAliases(),this.validateTokens(),{tokens:this.tokens,metadata:{filePath:t,format:"auto-detected",errors:this.errors}}}collectTokens(e,t){if(e==null)return;let n=t[t.length-1]||"";if(!(n.startsWith("$")&&n!=="$value"&&n!=="$type")){if(this.isW3CToken(e)){this.addToken(e.$value,e.$type,e.$description,e.$extensions,t);return}if(this.isTokenStudioToken(e)){this.addToken(e.value,e.type,e.description,e.extensions,t);return}if(this.isPrimitiveToken(e,t)){this.addToken(e,void 0,void 0,void 0,t);return}if(typeof e=="object"){let r=Array.isArray(e)?e.map((o,i)=>String(i)):Object.keys(e);for(let o of r){if(o.startsWith("$")||o==="extensions"||o==="description")continue;let i=Array.isArray(e)?e[parseInt(o)]:e[o];this.collectTokens(i,[...t,o])}}}}addToken(e,t,n,r,o){let i=o[o.length-1]||"unnamed",a=this.inferTokenType({$value:e,$type:t},o),s;typeof e=="string"&&(e.startsWith("{")||e.startsWith("$"))&&(s=this.extractAliases(e));let p={name:i,value:e,type:a,path:[...o],description:n,extensions:r,rawValue:e,aliases:s};this.tokens.push(p),this.tokenMap.set(o.join("."),p)}isW3CToken(e){return e&&typeof e=="object"&&"$value"in e}isTokenStudioToken(e){if(!e||typeof e!="object"||"$value"in e||!("value"in e))return!1;let t=e.value;return typeof t=="string"||typeof t=="number"||typeof t=="boolean"?!0:typeof t=="object"&&t!==null?"type"in e||"description"in e:!1}isPrimitiveToken(e,t){return!(typeof e!="string"&&typeof e!="number"&&typeof e!="boolean"||t.length<1)}isDesignToken(e){return this.isW3CToken(e)}inferTokenType(e,t){if(e.$type)return e.$type;let n=t.join(".").toLowerCase();if(n.includes("color")||n.includes("colour"))return"color";if(n.includes("font")||n.includes("typography")||n.includes("text"))return n.includes("weight")?"fontWeight":n.includes("family")?"fontFamily":"typography";if(n.includes("spacing")||n.includes("size")||n.includes("gap"))return"dimension";if(n.includes("shadow"))return"shadow";if(n.includes("border"))return"border";let r=e.$value;if(typeof r=="string"){if(r.match(/^#[0-9A-Fa-f]{3,8}$/)||r.match(/^rgba?\(/)||r.match(/^hsla?\(/))return"color";if(r.match(/^-?\d+(\.\d+)?(px|rem|em|pt|pc|in|cm|mm|q|vh|vw|vmin|vmax|%)$/))return"dimension";if(r.match(/^\d+(\.\d+)?(ms|s)$/))return"duration"}return typeof r=="number"?"number":typeof r=="boolean"?"boolean":"string"}extractAliases(e){let t=[],n=/\{([^}]+)\}/g,r;for(;(r=n.exec(e))!==null;){let o=r[1].split(",").map(i=>i.trim())[0];o.startsWith("$")&&(o=o.substring(1)),t.push(o)}if(e.startsWith("$")&&!e.startsWith("{")){let o=/\$([a-zA-Z0-9._-]+)/g;for(;(r=o.exec(e))!==null;)t.push(r[1])}return t}resolveAliases(){for(let e of this.tokens)if(e.aliases&&e.aliases.length>0)for(let t of e.aliases){let n=this.tokenMap.get(t);n?(e.value=n.value,e.aliases||(e.aliases=[])):this.errors.push({path:e.path,message:`Unresolved alias: ${t}`,severity:"error"})}}validateTokens(){for(let e of this.tokens){let t=this.validateTokenValue(e);t.valid||this.errors.push({path:e.path,message:t.message||"Validation error",severity:t.severity||"error"})}}validateTokenValue(e){let{type:t,value:n}=e;if(n==null)return{valid:!1,message:"Token value cannot be null or undefined",severity:"error"};switch(t){case"color":return this.validateColor(n);case"dimension":return this.validateDimension(n);case"fontWeight":return this.validateFontWeight(n);case"duration":return this.validateDuration(n);case"typography":return this.validateTypography(n);case"shadow":return this.validateShadow(n);default:return{valid:!0}}}validateColor(e){return typeof e!="string"?{valid:!1,message:"Color value must be a string",severity:"error"}:[/^#[0-9A-Fa-f]{3,8}$/,/^rgba?\([^)]+\)$/,/^hsla?\([^)]+\)$/].some(r=>r.test(e))?{valid:!0}:{valid:!1,message:`Invalid color format: ${e}`,severity:"error"}}validateDimension(e){if(typeof e=="string"){if(!/^-?\d+(\.\d+)?(px|rem|em|pt|pc|in|cm|mm|q|vh|vw|vmin|vmax|%)$/.test(e))return{valid:!1,message:`Invalid dimension format: ${e}`,severity:"error"}}else return typeof e=="number"?{valid:!0}:{valid:!1,message:"Dimension value must be a string or number",severity:"error"};return{valid:!0}}validateFontWeight(e){if(typeof e=="string"){if(!["100","200","300","400","500","600","700","800","900","normal","bold"].includes(e))return{valid:!1,message:`Invalid font weight: ${e}`,severity:"warning"}}else if(typeof e=="number"){if(e<1||e>1e3)return{valid:!1,message:"Font weight must be between 1 and 1000",severity:"error"}}else return{valid:!1,message:"Font weight must be a string or number",severity:"error"};return{valid:!0}}validateDuration(e){return typeof e!="string"?{valid:!1,message:"Duration value must be a string",severity:"error"}:/^\d+(\.\d+)?(ms|s)$/.test(e)?{valid:!0}:{valid:!1,message:`Invalid duration format: ${e}`,severity:"error"}}validateTypography(e){return typeof e!="object"||Array.isArray(e)?{valid:!1,message:"Typography value must be an object",severity:"error"}:e.fontFamily?{valid:!0}:{valid:!1,message:"Typography token missing fontFamily",severity:"warning"}}validateShadow(e){return typeof e!="object"||Array.isArray(e)?{valid:!1,message:"Shadow value must be an object",severity:"error"}:e.color?{valid:!0}:{valid:!1,message:"Shadow token missing color",severity:"warning"}}getTokensByType(e){return this.tokens.filter(t=>t.type===e)}getTokenByPath(e){return this.tokenMap.get(e.join("."))}getErrors(){return this.errors}}});var le,ce,Ne=q(()=>{"use strict";Se();le=class le{constructor(){D(this,"parser");this.parser=new ae}parseGitHubUrl(e){let t=[/github\.com[\/:]([^\/]+)\/([^\/\.]+)(\.git)?$/,/github\.com\/([^\/]+)\/([^\/]+)/];for(let n of t){let r=e.match(n);if(r)return{owner:r[1],repo:r[2]}}return null}async fetchBranches(e,t,n){try{let r=await fetch(`https://api.github.com/repos/${e}/${t}/branches`,{headers:{Authorization:`Bearer ${n}`,Accept:"application/vnd.github.v3+json"}});if(!r.ok)throw new Error(`GitHub API error: ${r.status}`);return(await r.json()).map(i=>i.name)}catch(r){throw new Error(`Failed to fetch branches: ${r}`)}}async getLatestCommitSha(e,t,n,r){try{let o=`https://api.github.com/repos/${e}/${t}/commits/${n}`,i=await fetch(o,{headers:{Authorization:`Bearer ${r}`,Accept:"application/vnd.github.v3+json"}});return i.ok?(await i.json()).sha||null:(console.warn(`Failed to get commit SHA: ${i.status}`),null)}catch(o){return console.warn("Failed to get latest commit SHA:",o),null}}async fetchFileContents(e,t,n,r,o){try{let i=`https://api.github.com/repos/${e}/${t}/contents/${o}?ref=${n}`,a=await fetch(i,{headers:{Authorization:`Bearer ${r}`,Accept:"application/vnd.github.v3+json"}});if(!a.ok)throw new Error(`GitHub API error: ${a.status}`);return await a.json()}catch(i){throw new Error(`Failed to fetch file contents: ${i}`)}}async fetchDirectoryContents(e,t,n,r,o=""){try{let i=`https://api.github.com/repos/${e}/${t}/contents/${o}?ref=${n}`,a=await fetch(i,{headers:{Authorization:`Bearer ${r}`,Accept:"application/vnd.github.v3+json"}});if(!a.ok)throw new Error(`GitHub API error: ${a.status}`);let s=await a.json();return Array.isArray(s)?s:[s]}catch(i){throw new Error(`Failed to fetch directory contents: ${i}`)}}decodeBase64Content(e){try{let t=e.replace(/\s/g,""),n;if(typeof atob=="function")n=atob(t);else{let o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";n="";let i=0,a=t.replace(/=+$/,"");for(;i<a.length;){let s=o.indexOf(a.charAt(i++)),p=o.indexOf(a.charAt(i++)),u=o.indexOf(a.charAt(i++)),d=o.indexOf(a.charAt(i++)),f=s<<18|p<<12|(u&63)<<6|d&63;n+=String.fromCharCode(f>>16&255),u!==-1&&(n+=String.fromCharCode(f>>8&255)),d!==-1&&(n+=String.fromCharCode(f&255))}}let r;if(typeof TextDecoder!="undefined"){let o=new Uint8Array(n.length);for(let i=0;i<n.length;i++)o[i]=n.charCodeAt(i);r=new TextDecoder("utf-8").decode(o)}else try{r=decodeURIComponent(escape(n))}catch(o){r=n}return r.charCodeAt(0)===65279&&(r=r.slice(1)),r=r.replace(/\0/g,""),r=r.trim(),r}catch(t){throw new Error(`Failed to decode base64 content: ${t}`)}}parseJSONContent(e){try{return JSON.parse(e)}catch(t){throw new Error(`Failed to parse JSON: ${t}`)}}flattenTokens(e,t=[]){let n=[],r=[],o=d=>d&&typeof d=="object"&&"$value"in d,i=d=>{if(!d||typeof d!="object"||"$value"in d||!("value"in d))return!1;let f=d.value;return typeof f=="string"||typeof f=="number"||typeof f=="boolean"?!0:typeof f=="object"&&f!==null?"type"in d||"description"in d:!1},a=(d,f)=>!(typeof d!="string"&&typeof d!="number"&&typeof d!="boolean"||f.length<1),s=(d,f)=>{let S=f.join(".").toLowerCase();if(typeof d=="string"){if(d.match(/^#[0-9A-Fa-f]{3,8}$/)||d.match(/^rgba?\(/)||d.match(/^hsla?\(/)||S.includes("color"))return"color";if(d.match(/^\d+(\.\d+)?(ms|s)$/)||S.includes("duration"))return"duration";if(d.match(/^-?\d+(\.\d+)?(px|rem|em|pt|pc|in|cm|mm|q|vh|vw|vmin|vmax|%)$/)||S.includes("size")||S.includes("spacing")||S.includes("radius"))return"dimension";if(S.includes("font")||S.includes("typography"))return"typography";if(S.includes("shadow"))return"shadow"}else if(typeof d=="number")return"number";return"string"},p=(d,f,S)=>{let $=S[S.length-1]||"unnamed",T=f||s(d,S);n.push({name:$,path:S,type:T,value:d,rawValue:d})},u=(d,f)=>{if(d==null)return;let S=f[f.length-1]||"";if(!(S.startsWith("$")&&S!=="$value"&&S!=="$type")){if(o(d)){p(d.$value,d.$type,f);return}if(i(d)){p(d.value,d.type,f);return}if(a(d,f)){p(d,void 0,f);return}if(d&&typeof d=="object"){let $=Array.isArray(d)?d.map((T,P)=>String(P)):Object.keys(d);for(let T of $){if(!Array.isArray(d)&&(T.startsWith("$")||T==="extensions"))continue;let P=Array.isArray(d)?d[parseInt(T)]:d[T];u(P,[...f,T])}}}};try{u(e,[])}catch(d){r.push({path:[],message:d instanceof Error?d.message:"Failed to walk tokens"})}return{tokens:n,metadata:{filePath:"",format:"auto-detected",errors:r}}}async fetchTokens(e,t,n,r,o){let i=await this.fetchFileContents(e,t,n,r,o);if(i.type!=="file")throw new Error(`Path is not a file: ${o}`);if(!i.content)throw new Error("File content is empty");let a=this.decodeBase64Content(i.content),s=this.parseJSONContent(a),p=this.parser.parse(s,o);return(!p.tokens||p.tokens.length===0)&&(p=this.flattenTokens(s,[])),p}isExcludedFile(e){var n;let t=((n=e.split("/").pop())==null?void 0:n.toLowerCase())||"";return le.EXCLUDE_PATTERNS.some(r=>r.test(t)||r.test(e))}async fetchRepoTree(e,t,n,r){try{let o=`https://api.github.com/repos/${e}/${t}/git/trees/${n}?recursive=1`,i=await fetch(o,{headers:{Authorization:`Bearer ${r}`,Accept:"application/vnd.github.v3+json"}});if(!i.ok)throw new Error(`GitHub API error: ${i.status}`);let a=await i.json();return a.truncated?(console.warn("Repository tree was truncated - falling back to recursive fetch"),[]):a.tree||[]}catch(o){return console.error("Failed to fetch repo tree:",o),[]}}async detectTokenFiles(e,t,n,r,o=""){let i=await this.fetchRepoTree(e,t,n,r);if(i.length>0){let a=o.replace(/^\/|\/$/g,"");return i.filter(s=>s.type!=="blob"||!s.path.toLowerCase().endsWith(".json")||a&&!s.path.startsWith(a+"/")&&s.path!==a?!1:!this.isExcludedFile(s.path)).map(s=>s.path)}return this.detectTokenFilesRecursive(e,t,n,r,o)}async detectTokenFilesRecursive(e,t,n,r,o=""){let i=await this.fetchDirectoryContents(e,t,n,r,o),a=[];for(let s of i)if(s.type==="file")s.name.toLowerCase().endsWith(".json")&&!this.isExcludedFile(s.path)&&a.push(s.path);else if(s.type==="dir"&&!this.isExcludedFile(s.path+"/")){let p=await this.detectTokenFilesRecursive(e,t,n,r,s.path);a.push(...p)}return a}};D(le,"EXCLUDE_PATTERNS",[/package\.json$/i,/package-lock\.json$/i,/tsconfig\.json$/i,/\.config\.json$/i,/eslint.*\.json$/i,/prettier.*\.json$/i,/jest\.config\.json$/i,/webpack\.config\.json$/i,/^\$metadata\.json$/i,/^\$themes\.json$/i,/\(ignore\)\.json$/i,/node_modules\//i,/\.github\//i,/\.vscode\//i]);ce=le});var pe,Re=q(()=>{"use strict";pe=class{constructor(){D(this,"errors",[]);D(this,"TOKENS_STUDIO_NAMESPACE","tokens");D(this,"DEBUG_LOGGING",!1)}getAllTokenKeys(e){let t={},n=["tokens","tokens-studio","tokensStudio","design-tokens","figma-tokens"];for(let r of n)try{let o=e.getSharedPluginDataKeys(r);for(let i of o){let a=e.getSharedPluginData(r,i);a&&a.trim()&&(t[`${r}:${i}`]=a)}}catch(o){}return t}getVariableBinding(e,t){try{if(!("boundVariables"in e)||!e.boundVariables)return;let r=e.boundVariables[t];if(r){let o=Array.isArray(r)?r[0]:r;if(o!=null&&o.id)try{let i=figma.variables.getVariableById(o.id);if(i!=null&&i.name)return this.DEBUG_LOGGING&&console.log(`[Variable] ${e.name}.${t} \u2192 ${i.name}`),i.name}catch(i){}}}catch(n){}}cleanTokenReference(e){let t=e.trim();for(;t.startsWith('"')&&t.endsWith('"')||t.startsWith("'")&&t.endsWith("'");)t=t.slice(1,-1);return t=t.replace(/^[{]|[}]$/g,""),t=t.replace(/^\$/,""),t.trim()}getTokenReference(e,t){try{let n=["tokens","tokens-studio","tokensStudio","design-tokens"];for(let r of n)try{let o=e.getSharedPluginData(r,t);if(o&&o.trim()){let i=this.cleanTokenReference(o);return this.DEBUG_LOGGING&&console.log(`[TokenRef] Found ${r}:${t} = "${i}" on ${e.name}`),i}}catch(o){}try{let r=e.getPluginData(t);if(r&&r.trim())return this.cleanTokenReference(r)}catch(r){}}catch(n){}}getFillTokenReferences(e,t){let n=[`fills[${t}]`,`fill[${t}]`,`fills.${t}`,`fill.${t}`,"fill","fills","fillColor",`fillColor[${t}]`];for(let r of n){let o=this.getTokenReference(e,r);if(o)return o}}getStrokeTokenReferences(e,t){let n=[`strokes[${t}]`,`stroke[${t}]`,`strokes.${t}`,`stroke.${t}`,"stroke","strokes","strokeColor",`strokeColor[${t}]`,"borderColor"];for(let r of n){let o=this.getTokenReference(e,r);if(o)return o}}getTypographyTokenReference(e,t){let r={fontFamily:["fontFamily","fontFamilies","font-family","typography.fontFamily"],fontSize:["fontSize","fontSizes","font-size","typography.fontSize"],fontWeight:["fontWeight","fontWeights","font-weight","typography.fontWeight"],lineHeight:["lineHeight","lineHeights","line-height","typography.lineHeight"],letterSpacing:["letterSpacing","letter-spacing","typography.letterSpacing"],typography:["typography","text","textStyle","text-style"]}[t]||[t];for(let o of r){let i=this.getTokenReference(e,o);if(i)return i}}getSpacingTokenReference(e,t){let r={width:["width","sizing","dimension","sizing.width","dimensions.width"],height:["height","sizing","dimension","sizing.height","dimensions.height"],padding:["padding","spacing","paddingTop","paddingRight","paddingBottom","paddingLeft"],paddingTop:["paddingTop","verticalPadding","padding","spacing"],paddingRight:["paddingRight","horizontalPadding","padding","spacing"],paddingBottom:["paddingBottom","verticalPadding","padding","spacing"],paddingLeft:["paddingLeft","horizontalPadding","padding","spacing"],verticalPadding:["verticalPadding","paddingTop","paddingBottom","padding","spacing"],horizontalPadding:["horizontalPadding","paddingLeft","paddingRight","padding","spacing"],gap:["itemSpacing","spacing","gap","counterAxisSpacing"],itemSpacing:["itemSpacing","spacing","gap"],counterAxisSpacing:["counterAxisSpacing","spacing"],borderRadius:["borderRadius","borderRadiusTopLeft","borderRadiusTopRight","borderRadiusBottomRight","borderRadiusBottomLeft","radius","cornerRadius"],borderRadiusTopLeft:["borderRadiusTopLeft","borderRadius","radius"],borderRadiusTopRight:["borderRadiusTopRight","borderRadius","radius"],borderRadiusBottomRight:["borderRadiusBottomRight","borderRadius","radius"],borderRadiusBottomLeft:["borderRadiusBottomLeft","borderRadius","radius"],borderWidth:["borderWidth","strokeWeight","borderWidthTop","borderWidthRight","borderWidthBottom","borderWidthLeft","border"],strokeWeight:["strokeWeight","borderWidth","border"],dimension:["dimension","spacing","sizing","size"]}[t]||[t];for(let i of r){let a=this.getTokenReference(e,i);if(a)return a}let o=this.getVariableBinding(e,t);if(o)return o}getBorderRadiusTokenReference(e){let t=["borderRadius","borderRadiusTopLeft","borderRadiusTopRight","borderRadiusBottomRight","borderRadiusBottomLeft","radius","cornerRadius","topLeftRadius","topRightRadius","bottomRightRadius","bottomLeftRadius"];for(let r of t){let o=this.getTokenReference(e,r);if(o)return this.DEBUG_LOGGING&&console.log(`[BorderRadius] Found ${r} = "${o}" on ${e.name}`),o}let n=this.getVariableBinding(e,"cornerRadius");if(n)return n}getBorderWidthTokenReference(e){let t=["borderWidth","strokeWeight","borderWidthTop","borderWidthRight","borderWidthBottom","borderWidthLeft","border","strokeWidth"];for(let r of t){let o=this.getTokenReference(e,r);if(o)return this.DEBUG_LOGGING&&console.log(`[BorderWidth] Found ${r} = "${o}" on ${e.name}`),o}let n=this.getVariableBinding(e,"strokeWeight");if(n)return n}getEffectTokenReference(e,t){let n=["boxShadow","shadow",`boxShadow[${t}]`,`shadow[${t}]`,"effects","effect",`effects[${t}]`,`effect[${t}]`,"dropShadow","innerShadow","elevation","shadowColor","shadowOffset","shadowRadius","shadowSpread"];for(let o of n){let i=this.getTokenReference(e,o);if(i)return this.DEBUG_LOGGING&&console.log(`[Effect] Found ${o} = "${i}" on ${e.name}`),i}let r=this.getVariableBinding(e,"effects");if(r)return r}logNodeTokenData(e){if(!this.DEBUG_LOGGING)return;let t=this.getAllTokenKeys(e);if(Object.keys(t).length>0){console.log(`
[TokenData] Node: "${e.name}" (${e.type})`);for(let[n,r]of Object.entries(t)){let o=this.cleanTokenReference(r);console.log(o!==r?`  ${n} = ${o} (raw: ${r})`:`  ${n} = ${o}`)}}}scanAllComponents(){this.errors=[];let e=[],t=0,n=figma.root.children;for(let r of n)if(r.type==="PAGE"){let o=r.findAll(a=>a.type==="COMPONENT"||a.type==="COMPONENT_SET"),i=r.findAll(a=>a.type==="INSTANCE");t+=i.length;for(let a of o)try{let s=this.extractComponentProperties(a,r.name);s&&e.push(s)}catch(s){this.errors.push({componentId:a.id,componentName:a.name,error:s instanceof Error?s.message:"Unknown error"})}}return{components:e,totalComponents:e.length,totalInstances:t,pagesScanned:n.length,errors:this.errors}}scanFilteredPages(e){this.errors=[];let t=[],n=0,r=figma.root.children,o=e.map(a=>a.toLowerCase().trim()),i=r.filter(a=>a.type==="PAGE"&&o.includes(a.name.toLowerCase().trim()));for(let a of i)if(a.type==="PAGE"){let s=a.findAll(u=>u.type==="COMPONENT"||u.type==="COMPONENT_SET"),p=a.findAll(u=>u.type==="INSTANCE");n+=p.length;for(let u of s)try{let d=this.extractComponentProperties(u,a.name);d&&t.push(d)}catch(d){this.errors.push({componentId:u.id,componentName:u.name,error:d instanceof Error?d.message:"Unknown error"})}}return{components:t,totalComponents:t.length,totalInstances:n,pagesScanned:i.length,errors:this.errors}}scanCurrentPage(){this.errors=[];let e=[],t=figma.currentPage,n=0,r=t.findAll(i=>i.type==="COMPONENT"||i.type==="COMPONENT_SET"),o=t.findAll(i=>i.type==="INSTANCE");n+=o.length;for(let i of r)try{let a=this.extractComponentProperties(i,t.name);a&&e.push(a)}catch(a){this.errors.push({componentId:i.id,componentName:i.name,error:a instanceof Error?a.message:"Unknown error"})}return{components:e,totalComponents:e.length,totalInstances:n,pagesScanned:1,errors:this.errors}}scanNodes(e){this.errors=[];let t=[],n=0,r=figma.currentPage;for(let o of e){let i=[],a=[];"findAll"in o&&typeof o.findAll=="function"&&(i=o.findAll(s=>s.type==="COMPONENT"||s.type==="COMPONENT_SET"),a=o.findAll(s=>s.type==="INSTANCE"),n+=a.length);for(let s of i)try{let p=this.extractComponentProperties(s,r.name);p&&t.push(p)}catch(p){this.errors.push({componentId:s.id,componentName:s.name,error:p instanceof Error?p.message:"Unknown error"})}if(o.type==="COMPONENT"||o.type==="COMPONENT_SET")try{let s=this.extractComponentProperties(o,r.name);s&&(t.find(p=>p.id===s.id)||t.push(s))}catch(s){this.errors.push({componentId:o.id,componentName:o.name,error:s instanceof Error?s.message:"Unknown error"})}}return{components:t,totalComponents:t.length,totalInstances:n,pagesScanned:1,errors:this.errors}}extractComponentProperties(e,t){var r,o;if(e.type!=="COMPONENT"&&e.type!=="COMPONENT_SET"&&e.type!=="INSTANCE")return null;let n={id:e.id,name:e.name,type:e.type,pageName:t,colors:[],typography:[],spacing:[],effects:[]};if(e.type==="COMPONENT_SET")n.mainComponentName=e.name,n.mainComponentId=e.id;else if(e.type==="COMPONENT"){let i=e;((r=i.parent)==null?void 0:r.type)==="COMPONENT_SET"?(n.mainComponentName=i.parent.name,n.mainComponentId=i.parent.id):(n.mainComponentName=e.name,n.mainComponentId=e.id)}else if(e.type==="INSTANCE"){let i=e;try{let a=i.mainComponent;a&&(((o=a.parent)==null?void 0:o.type)==="COMPONENT_SET"?(n.mainComponentName=a.parent.name,n.mainComponentId=a.parent.id):(n.mainComponentName=a.name,n.mainComponentId=a.id))}catch(a){n.mainComponentName=e.name.split(",")[0].trim()}}if(n.colors=this.extractColors(e),n.typography=this.extractTypography(e),n.spacing=this.extractSpacing(e),n.effects=this.extractEffects(e),e.type==="COMPONENT"||e.type==="COMPONENT_SET"){let i=e;"layoutMode"in i&&i.layoutMode&&(n.layoutMode=i.layoutMode,n.itemSpacing=i.itemSpacing,n.paddingTop=i.paddingTop,n.paddingRight=i.paddingRight,n.paddingBottom=i.paddingBottom,n.paddingLeft=i.paddingLeft),n.width=i.width,n.height=i.height}else if(e.type==="INSTANCE"){let i=e;n.width=i.width,n.height=i.height}if("children"in e){let i=[];for(let a of e.children){let s=this.extractComponentProperties(a,t);s&&i.push(s)}i.length>0&&(n.children=i)}return n}extractColors(e){var n,r;let t=[];if("fills"in e&&Array.isArray(e.fills))for(let o=0;o<e.fills.length;o++){let i=e.fills[o];if(i.type==="SOLID"){let a=(n=i.opacity)!=null?n:1,s=this.rgbaToColor(i.color,a),p=this.getFillTokenReferences(e,o);t.push({type:"fill",color:{r:i.color.r,g:i.color.g,b:i.color.b,a},hex:s.hex,rgba:s.rgba,opacity:a,tokenReference:p})}}if("strokes"in e&&Array.isArray(e.strokes))for(let o=0;o<e.strokes.length;o++){let i=e.strokes[o];if(i.type==="SOLID"){let a=(r=i.opacity)!=null?r:1,s=this.rgbaToColor(i.color,a),p=this.getStrokeTokenReferences(e,o);t.push({type:"stroke",color:{r:i.color.r,g:i.color.g,b:i.color.b,a},hex:s.hex,rgba:s.rgba,opacity:a,tokenReference:p})}}return t}extractTypography(e){let t=[];if(e.type==="TEXT"){let n=e;if(typeof n.fontName!="symbol"){let r=n.fontName,o=this.getTypographyTokenReference(n,"typography"),i=this.getTypographyTokenReference(n,"fontFamily"),a=this.getTypographyTokenReference(n,"fontSize"),s=this.getTypographyTokenReference(n,"fontWeight"),p=this.getTypographyTokenReference(n,"lineHeight"),u=this.getTypographyTokenReference(n,"letterSpacing"),d=o||i||a||s||p||u;t.push({fontFamily:r.family,fontSize:typeof n.fontSize=="number"?n.fontSize:16,fontWeight:typeof r.style=="string"?this.parseFontWeight(r.style):400,lineHeight:typeof n.lineHeight=="number"||typeof n.lineHeight=="string"?n.lineHeight:void 0,letterSpacing:typeof n.letterSpacing=="number"?n.letterSpacing:void 0,textDecoration:typeof n.textDecoration=="string"?n.textDecoration:void 0,textCase:typeof n.textCase=="string"?n.textCase:void 0,tokenReference:d})}}if("children"in e)for(let n of e.children)t.push(...this.extractTypography(n));return t}extractSpacing(e){let t=[];if(this.logNodeTokenData(e),e.type==="COMPONENT"||e.type==="COMPONENT_SET"||e.type==="FRAME"||e.type==="INSTANCE"){let r=e,o=this.getSpacingTokenReference(e,"width"),i=this.getSpacingTokenReference(e,"height");if(t.push({type:"width",value:r.width,unit:"px",tokenReference:o}),t.push({type:"height",value:r.height,unit:"px",tokenReference:i}),"paddingTop"in r&&typeof r.paddingTop=="number"){let a=this.getSpacingTokenReference(e,"horizontalPadding"),s=this.getSpacingTokenReference(e,"verticalPadding"),p=this.getSpacingTokenReference(e,"padding"),u=this.getSpacingTokenReference(e,"paddingTop"),d=this.getSpacingTokenReference(e,"paddingRight"),f=this.getSpacingTokenReference(e,"paddingBottom"),S=this.getSpacingTokenReference(e,"paddingLeft"),$=(P,G)=>P?`[${G}] ${P}`:void 0,T=(P,G,I)=>{if(P)return P;if(G)return $(G,I);if(p)return $(p,"all")};r.paddingTop&&t.push({type:"padding",value:r.paddingTop,unit:"px",tokenReference:T(u,s,"vertical")}),r.paddingRight&&t.push({type:"padding",value:r.paddingRight,unit:"px",tokenReference:T(d,a,"horizontal")}),r.paddingBottom&&t.push({type:"padding",value:r.paddingBottom,unit:"px",tokenReference:T(f,s,"vertical")}),r.paddingLeft&&t.push({type:"padding",value:r.paddingLeft,unit:"px",tokenReference:T(S,a,"horizontal")})}if("itemSpacing"in r&&typeof r.itemSpacing=="number"&&r.itemSpacing){let a=this.getSpacingTokenReference(e,"itemSpacing")||this.getSpacingTokenReference(e,"gap")||this.getSpacingTokenReference(e,"spacing");t.push({type:"gap",value:r.itemSpacing,unit:"px",tokenReference:a})}if("counterAxisSpacing"in r&&typeof r.counterAxisSpacing=="number"&&r.counterAxisSpacing){let a=this.getSpacingTokenReference(e,"counterAxisSpacing");t.push({type:"gap",value:r.counterAxisSpacing,unit:"px",tokenReference:a})}if("cornerRadius"in r){let a=this.getBorderRadiusTokenReference(e);typeof r.cornerRadius=="number"&&r.cornerRadius>0?t.push({type:"borderRadius",value:r.cornerRadius,unit:"px",tokenReference:a}):r.cornerRadius===figma.mixed&&("topLeftRadius"in r&&typeof r.topLeftRadius=="number"&&r.topLeftRadius>0&&t.push({type:"borderRadius",value:r.topLeftRadius,unit:"px",tokenReference:this.getSpacingTokenReference(e,"borderRadiusTopLeft")||a}),"topRightRadius"in r&&typeof r.topRightRadius=="number"&&r.topRightRadius>0&&t.push({type:"borderRadius",value:r.topRightRadius,unit:"px",tokenReference:this.getSpacingTokenReference(e,"borderRadiusTopRight")||a}),"bottomRightRadius"in r&&typeof r.bottomRightRadius=="number"&&r.bottomRightRadius>0&&t.push({type:"borderRadius",value:r.bottomRightRadius,unit:"px",tokenReference:this.getSpacingTokenReference(e,"borderRadiusBottomRight")||a}),"bottomLeftRadius"in r&&typeof r.bottomLeftRadius=="number"&&r.bottomLeftRadius>0&&t.push({type:"borderRadius",value:r.bottomLeftRadius,unit:"px",tokenReference:this.getSpacingTokenReference(e,"borderRadiusBottomLeft")||a}))}if("strokeWeight"in r&&typeof r.strokeWeight=="number"&&r.strokeWeight>0){let a=this.getBorderWidthTokenReference(e);t.push({type:"borderWidth",value:r.strokeWeight,unit:"px",tokenReference:a})}}else if("cornerRadius"in e){let r=this.getBorderRadiusTokenReference(e),o=e;typeof o.cornerRadius=="number"&&o.cornerRadius>0&&t.push({type:"borderRadius",value:o.cornerRadius,unit:"px",tokenReference:r})}return t}extractEffects(e){var n,r,o,i,a,s,p,u;let t=[];if("effects"in e&&Array.isArray(e.effects))for(let d=0;d<e.effects.length;d++){let f=e.effects[d];if(f.visible){let S=this.getEffectTokenReference(e,d);switch(f.type){case"DROP_SHADOW":t.push({type:"drop-shadow",visible:f.visible,radius:f.radius,color:f.color?{r:f.color.r,g:f.color.g,b:f.color.b,a:f.color.a}:void 0,offset:{x:(r=(n=f.offset)==null?void 0:n.x)!=null?r:0,y:(i=(o=f.offset)==null?void 0:o.y)!=null?i:0},spread:f.spread,tokenReference:S});break;case"INNER_SHADOW":t.push({type:"inner-shadow",visible:f.visible,radius:f.radius,color:f.color?{r:f.color.r,g:f.color.g,b:f.color.b,a:f.color.a}:void 0,offset:{x:(s=(a=f.offset)==null?void 0:a.x)!=null?s:0,y:(u=(p=f.offset)==null?void 0:p.y)!=null?u:0},spread:f.spread,tokenReference:S});break;case"LAYER_BLUR":t.push({type:"layer-blur",visible:f.visible,radius:f.radius,tokenReference:S});break;case"BACKGROUND_BLUR":t.push({type:"background-blur",visible:f.visible,radius:f.radius,tokenReference:S});break}}}return t}rgbaToColor(e,t){let n=Math.round(e.r*255),r=Math.round(e.g*255),o=Math.round(e.b*255),i=t,a=`#${[n,r,o].map(p=>{let u=p.toString(16);return u.length===1?"0"+u:u}).join("")}`,s=`rgba(${n}, ${r}, ${o}, ${i.toFixed(2)})`;return{hex:a,rgba:s}}parseFontWeight(e){let t={thin:100,extralight:200,light:300,regular:400,medium:500,semibold:600,bold:700,extrabold:800,black:900},n=e.toLowerCase();for(let[o,i]of Object.entries(t))if(n.includes(o))return i;let r=e.match(/(\d+)/);return r?parseInt(r[1],10):400}getComponentUsageStats(e){let t=[],n=new Set;for(let r of figma.root.children)if(r.type==="PAGE"){let o=r.findAll(i=>{var a;return i.type==="INSTANCE"&&((a=i.mainComponent)==null?void 0:a.id)===e});o.length>0&&(t.push(...o),n.add(r.name))}return{instances:t.length,pages:Array.from(n)}}}});var de,Pe=q(()=>{"use strict";de=class{constructor(){D(this,"errors",[]);D(this,"cache",new Map);D(this,"cacheMaxAge",5*60*1e3);D(this,"tokenIndex",{byPath:new Map,byValue:new Map});D(this,"TOKENS_STUDIO_NAMESPACE","tokens");D(this,"debugLogging",!1)}setDebugLogging(e){this.debugLogging=e}async clearCache(){this.cache.clear(),this.tokenIndex={byPath:new Map,byValue:new Map};try{let t=(await figma.clientStorage.keysAsync()).filter(n=>n.startsWith("componentCache_"));for(let n of t)await figma.clientStorage.deleteAsync(n)}catch(e){console.error("Error clearing persistent cache:",e)}}getCacheStats(){return{entries:this.cache.size,indexedPaths:this.tokenIndex.byPath.size,indexedValues:this.tokenIndex.byValue.size}}getDocumentVersion(){return{documentVersion:figma.root.children.filter(n=>n.type==="PAGE").map(n=>`${n.id}:${n.name}`).join("|").split("").reduce((n,r)=>(n<<5)-n+r.charCodeAt(0),0).toString(36),editSessionId:figma.root.id}}getPersistentCacheKey(e,t){let n=t.slice().sort().join(",");return`componentCache_${e}_${n||"all"}`}async getFromPersistentCache(e,t){try{let n=this.getPersistentCacheKey(e,t),r=await figma.clientStorage.getAsync(n);if(!r)return null;let o=this.getDocumentVersion();if(r.documentVersion===o.documentVersion&&r.editSessionId===o.editSessionId&&Date.now()-r.timestamp<this.cacheMaxAge)return this.debugLogging&&console.log(`[Cache] HIT - Persistent cache valid for ${e} (${t.length} pages)`),r.components;this.debugLogging&&console.log(`[Cache] MISS - Invalidated (version: ${r.documentVersion} vs ${o.documentVersion})`),await figma.clientStorage.deleteAsync(n)}catch(n){this.debugLogging&&console.error("Error reading persistent cache:",n)}return null}async saveToPersistentCache(e,t,n){try{let r=this.getPersistentCacheKey(e,t),o=this.getDocumentVersion(),i={components:n,timestamp:Date.now(),documentVersion:o.documentVersion,editSessionId:o.editSessionId,tokenType:e,pageNames:t};await figma.clientStorage.setAsync(r,i),this.debugLogging&&console.log(`[Cache] SAVED - ${n.length} components for ${e} (version: ${o.documentVersion})`)}catch(r){this.debugLogging&&console.error("Error saving persistent cache:",r)}}async invalidatePagesCache(e){try{let n=(await figma.clientStorage.keysAsync()).filter(r=>r.startsWith("componentCache_"));for(let r of n)try{let o=await figma.clientStorage.getAsync(r);if(!o)continue;o.pageNames.some(a=>e.some(s=>a.toLowerCase()===s.toLowerCase()))&&(await figma.clientStorage.deleteAsync(r),this.debugLogging&&console.log(`[Cache] INVALIDATED - ${r} (affected pages: ${e.join(", ")})`))}catch(o){}}catch(t){this.debugLogging&&console.error("Error invalidating page caches:",t)}}async getCachedPageNames(){try{let t=(await figma.clientStorage.keysAsync()).filter(r=>r.startsWith("componentCache_")),n=new Set;for(let r of t)try{let o=await figma.clientStorage.getAsync(r);o!=null&&o.pageNames&&o.pageNames.forEach(i=>n.add(i))}catch(o){}return Array.from(n)}catch(e){return[]}}async scanAllComponentsOptimized(e={}){this.errors=[];let t=[],n=0,{tokenType:r="all",maxNodesPerPage:o=0,maxPages:i=0,chunkSize:a=100,onProgress:s,includeChildren:p=!0,maxDepth:u=3,useCache:d=!0,usePersistentCache:f=!0,pageFilter:S=[]}=e,$=figma.root.children.filter(I=>I.type==="PAGE"),T=S.length>0?$.filter(I=>S.includes(I.name)):$,P=i>0?Math.min(i,T.length):T.length,G=T.slice(0,P).map(I=>I.name);if(f&&d){s==null||s({currentPage:0,totalPages:P,currentPageName:"Checking cache...",componentsFound:0,nodesScanned:0,phase:"loading"});let I=await this.getFromPersistentCache(r,G);if(I)return this.buildTokenIndex(I),s==null||s({currentPage:P,totalPages:P,currentPageName:"Complete (from cache)",componentsFound:I.length,nodesScanned:0,phase:"complete"}),{components:I,totalComponents:I.length,totalInstances:0,pagesScanned:P,errors:[]}}for(let I=0;I<P;I++){let ee=T[I];s==null||s({currentPage:I+1,totalPages:P,currentPageName:ee.name,componentsFound:t.length,nodesScanned:0,phase:"scanning"});let ie=`${ee.id}-${r}`;if(d){let ne=this.getFromCache(ie);if(ne){t.push(...ne);continue}}let te=await this.scanPageChunked(ee,r,a,o,p,u,ne=>{s==null||s({currentPage:I+1,totalPages:P,currentPageName:ee.name,componentsFound:t.length,nodesScanned:ne,phase:"scanning"})});d&&this.cache.set(ie,{components:te.components,timestamp:Date.now()}),t.push(...te.components),n+=te.totalInstances,await this.yieldToMain()}return this.buildTokenIndex(t),f&&d&&t.length>0&&await this.saveToPersistentCache(r,G,t),s==null||s({currentPage:P,totalPages:P,currentPageName:"Complete",componentsFound:t.length,nodesScanned:0,phase:"complete"}),{components:t,totalComponents:t.length,totalInstances:n,pagesScanned:P,errors:this.errors}}async scanPageChunked(e,t,n,r,o,i,a){let s=[],p=0,u=0,d=[];this.collectComponentNodes(e,d,r);for(let f=0;f<d.length;f+=n){let S=d.slice(f,f+n);for(let $ of S)try{let T=this.extractComponentPropertiesOptimized($,e.name,t,o,i,0);T&&s.push(T),u++,a==null||a(u)}catch(T){this.errors.push({componentId:$.id,componentName:$.name,error:T instanceof Error?T.message:"Unknown error"})}f+n<d.length&&await this.yieldToMain()}return{components:s,totalInstances:p}}collectComponentNodes(e,t,n){if(!(n>0&&t.length>=n))for(let r of e.children){if(n>0&&t.length>=n)break;(r.type==="COMPONENT"||r.type==="COMPONENT_SET")&&t.push(r),"children"in r&&(r.type==="FRAME"||r.type==="GROUP"||r.type==="SECTION")&&this.collectComponentNodes(r,t,n)}}extractComponentPropertiesOptimized(e,t,n,r,o,i){var S,$;if(e.type!=="COMPONENT"&&e.type!=="COMPONENT_SET"&&e.type!=="INSTANCE"&&e.type!=="FRAME")return null;let a=e.type==="FRAME"?"COMPONENT":e.type,s={id:e.id,name:e.name,type:a,pageName:t,colors:[],typography:[],spacing:[],effects:[]};if(e.type==="COMPONENT_SET")s.mainComponentName=e.name,s.mainComponentId=e.id;else if(e.type==="COMPONENT"){let T=e;((S=T.parent)==null?void 0:S.type)==="COMPONENT_SET"?(s.mainComponentName=T.parent.name,s.mainComponentId=T.parent.id):(s.mainComponentName=e.name,s.mainComponentId=e.id)}else if(e.type==="INSTANCE"){let T=e;try{let P=T.mainComponent;P&&((($=P.parent)==null?void 0:$.type)==="COMPONENT_SET"?(s.mainComponentName=P.parent.name,s.mainComponentId=P.parent.id):(s.mainComponentName=P.name,s.mainComponentId=P.id))}catch(P){s.mainComponentName=e.name.split(",")[0].trim()}}let p=n==="all"||n==="color",u=n==="all"||n==="typography",d=n==="all"||["dimension","spacing","borderRadius","borderWidth"].includes(n),f=n==="all"||["effect","shadow"].includes(n);if(p&&(s.colors=this.extractColorsOptimized(e)),u&&(s.typography=this.extractTypographyOptimized(e,r)),d&&(s.spacing=this.extractSpacingOptimized(e,n)),f&&(s.effects=this.extractEffectsOptimized(e)),e.type==="COMPONENT"||e.type==="COMPONENT_SET"||e.type==="FRAME"){let T=e;"layoutMode"in T&&T.layoutMode&&(s.layoutMode=T.layoutMode,s.itemSpacing=T.itemSpacing),s.width=T.width,s.height=T.height}if(r&&i<o&&"children"in e){let T=[];for(let P of e.children){if(this.shouldSkipNode(P,n))continue;let G=this.extractComponentPropertiesOptimized(P,t,n,r,o,i+1);G&&this.hasRelevantProperties(G)&&T.push(G)}T.length>0&&(s.children=T)}return s}shouldSkipNode(e,t){return"visible"in e&&!e.visible||(e.type==="VECTOR"||e.type==="BOOLEAN_OPERATION")&&t!=="color"||"width"in e&&"height"in e&&(e.width<1||e.height<1)}hasRelevantProperties(e){return!!(e.colors.length>0||e.typography.length>0||e.spacing.length>0||e.effects.length>0||e.children&&e.children.length>0)}extractColorsOptimized(e){var n,r;let t=[];if("fills"in e&&Array.isArray(e.fills))for(let o=0;o<e.fills.length;o++){let i=e.fills[o];if(i.type==="SOLID"){let a=(n=i.opacity)!=null?n:1,s=this.rgbaToColor(i.color,a),p=this.getFillTokenReferencesFast(e,o);t.push({type:"fill",color:{r:i.color.r,g:i.color.g,b:i.color.b,a},hex:s.hex,rgba:s.rgba,opacity:a,tokenReference:p})}}if("strokes"in e&&Array.isArray(e.strokes))for(let o=0;o<e.strokes.length;o++){let i=e.strokes[o];if(i.type==="SOLID"){let a=(r=i.opacity)!=null?r:1,s=this.rgbaToColor(i.color,a),p=this.getStrokeTokenReferencesFast(e,o);t.push({type:"stroke",color:{r:i.color.r,g:i.color.g,b:i.color.b,a},hex:s.hex,rgba:s.rgba,opacity:a,tokenReference:p})}}return t}extractTypographyOptimized(e,t){let n=[];if(e.type==="TEXT"){let r=e;if(typeof r.fontName!="symbol"){let o=r.fontName,i=this.getTypographyTokenFast(r);n.push({fontFamily:o.family,fontSize:typeof r.fontSize=="number"?r.fontSize:16,fontWeight:typeof o.style=="string"?this.parseFontWeight(o.style):400,lineHeight:typeof r.lineHeight=="number"?r.lineHeight:void 0,letterSpacing:typeof r.letterSpacing=="number"?r.letterSpacing:void 0,tokenReference:i})}}if(t&&"children"in e)for(let r of e.children)(r.type==="TEXT"||"children"in r&&this.containsTextNode(r))&&n.push(...this.extractTypographyOptimized(r,t));return n}containsTextNode(e){if(e.type==="TEXT")return!0;if("children"in e){for(let t of e.children)if(t.type==="TEXT"||"children"in t&&t.children.length>0&&t.children.some(n=>n.type==="TEXT"))return!0}return!1}extractSpacingOptimized(e,t){let n=[],r=e.type==="COMPONENT"||e.type==="COMPONENT_SET"||e.type==="FRAME"||e.type==="INSTANCE";if(!r&&!("cornerRadius"in e))return n;let o=t==="all"||t==="dimension"||t==="spacing",i=t==="all"||t==="borderRadius",a=t==="all"||t==="borderWidth";if(r){let s=e;if(o&&n.push({type:"width",value:s.width,unit:"px",tokenReference:this.getSpacingTokenFast(e,"width")},{type:"height",value:s.height,unit:"px",tokenReference:this.getSpacingTokenFast(e,"height")}),o&&"paddingTop"in s&&typeof s.paddingTop=="number"){let p=this.getSpacingTokenFast(e,"horizontalPadding"),u=this.getSpacingTokenFast(e,"verticalPadding"),d=this.getSpacingTokenFast(e,"padding");s.paddingTop&&n.push({type:"padding",value:s.paddingTop,unit:"px",tokenReference:u||d}),s.paddingRight&&n.push({type:"padding",value:s.paddingRight,unit:"px",tokenReference:p||d}),s.paddingBottom&&n.push({type:"padding",value:s.paddingBottom,unit:"px",tokenReference:u||d}),s.paddingLeft&&n.push({type:"padding",value:s.paddingLeft,unit:"px",tokenReference:p||d})}if(o&&"itemSpacing"in s&&s.itemSpacing&&n.push({type:"gap",value:s.itemSpacing,unit:"px",tokenReference:this.getSpacingTokenFast(e,"itemSpacing")}),i&&"cornerRadius"in s){let p=this.getBorderRadiusTokenFast(e);typeof s.cornerRadius=="number"&&s.cornerRadius>0&&n.push({type:"borderRadius",value:s.cornerRadius,unit:"px",tokenReference:p})}a&&"strokeWeight"in s&&typeof s.strokeWeight=="number"&&s.strokeWeight>0&&n.push({type:"borderWidth",value:s.strokeWeight,unit:"px",tokenReference:this.getBorderWidthTokenFast(e)})}else if(i&&"cornerRadius"in e){let s=e,p=this.getBorderRadiusTokenFast(e);typeof s.cornerRadius=="number"&&s.cornerRadius>0&&n.push({type:"borderRadius",value:s.cornerRadius,unit:"px",tokenReference:p})}return n}extractEffectsOptimized(e){var n,r,o,i;let t=[];if(!("effects"in e)||!Array.isArray(e.effects))return t;for(let a=0;a<e.effects.length;a++){let s=e.effects[a];if(!s.visible)continue;let p=this.getEffectTokenFast(e,a);s.type==="DROP_SHADOW"||s.type==="INNER_SHADOW"?t.push({type:s.type==="DROP_SHADOW"?"drop-shadow":"inner-shadow",visible:s.visible,radius:s.radius,color:s.color?{r:s.color.r,g:s.color.g,b:s.color.b,a:s.color.a}:void 0,offset:{x:(r=(n=s.offset)==null?void 0:n.x)!=null?r:0,y:(i=(o=s.offset)==null?void 0:o.y)!=null?i:0},spread:s.spread,tokenReference:p}):(s.type==="LAYER_BLUR"||s.type==="BACKGROUND_BLUR")&&t.push({type:s.type==="LAYER_BLUR"?"layer-blur":"background-blur",visible:s.visible,radius:s.radius,tokenReference:p})}return t}getFillTokenReferencesFast(e,t){return this.getSharedDataFast(e,"fill")||this.getSharedDataFast(e,`fills.${t}`)||this.getSharedDataFast(e,"fillColor")||this.getVariableBindingFast(e,"fills")}getStrokeTokenReferencesFast(e,t){return this.getSharedDataFast(e,"stroke")||this.getSharedDataFast(e,`strokes.${t}`)||this.getSharedDataFast(e,"strokeColor")||this.getVariableBindingFast(e,"strokes")}getTypographyTokenFast(e){return this.getSharedDataFast(e,"typography")||this.getSharedDataFast(e,"fontFamily")||this.getSharedDataFast(e,"fontSize")}getSpacingTokenFast(e,t){return this.getSharedDataFast(e,t)||this.getVariableBindingFast(e,t)}getBorderRadiusTokenFast(e){return this.getSharedDataFast(e,"borderRadius")||this.getSharedDataFast(e,"cornerRadius")||this.getVariableBindingFast(e,"cornerRadius")}getBorderWidthTokenFast(e){return this.getSharedDataFast(e,"borderWidth")||this.getSharedDataFast(e,"strokeWeight")||this.getVariableBindingFast(e,"strokeWeight")}getEffectTokenFast(e,t){return this.getSharedDataFast(e,"boxShadow")||this.getSharedDataFast(e,`effects.${t}`)||this.getVariableBindingFast(e,"effects")}getSharedDataFast(e,t){try{let n=e.getSharedPluginData("tokens",t);if(n&&n.trim())return this.cleanTokenReference(n)}catch(n){}}getVariableBindingFast(e,t){try{if(!("boundVariables"in e)||!e.boundVariables)return;let r=e.boundVariables[t];if(r){let o=Array.isArray(r)?r[0]:r;if(o!=null&&o.id){let i=figma.variables.getVariableById(o.id);return i==null?void 0:i.name}}}catch(n){}}cleanTokenReference(e){let t=e.trim();for(;t.startsWith('"')&&t.endsWith('"')||t.startsWith("'")&&t.endsWith("'");)t=t.slice(1,-1);return t=t.replace(/^[{]|[}]$/g,""),t=t.replace(/^\$/,""),t.trim()}buildTokenIndex(e){this.tokenIndex={byPath:new Map,byValue:new Map};let t=n=>{for(let r of n.colors)r.tokenReference&&this.addToIndex(this.tokenIndex.byPath,r.tokenReference.toLowerCase(),n.id),r.hex&&this.addToIndex(this.tokenIndex.byValue,r.hex.toLowerCase(),n.id);for(let r of n.spacing){if(r.tokenReference){let o=r.tokenReference.replace(/^\[\w+\]\s*/,"").toLowerCase();this.addToIndex(this.tokenIndex.byPath,o,n.id)}this.addToIndex(this.tokenIndex.byValue,`${r.value}${r.unit}`,n.id)}for(let r of n.effects)r.tokenReference&&this.addToIndex(this.tokenIndex.byPath,r.tokenReference.toLowerCase(),n.id);for(let r of n.typography)r.tokenReference&&this.addToIndex(this.tokenIndex.byPath,r.tokenReference.toLowerCase(),n.id);if(n.children)for(let r of n.children)t(r)};for(let n of e)t(n)}addToIndex(e,t,n){e.has(t)||e.set(t,new Set),e.get(t).add(n)}getComponentsByTokenPath(e){let t=e.toLowerCase(),n=this.tokenIndex.byPath.get(t);if(n)return Array.from(n);let r=new Set,o=Array.from(this.tokenIndex.byPath.entries());for(let[i,a]of o)(i.includes(t)||t.includes(i))&&a.forEach(s=>r.add(s));return Array.from(r)}getComponentsByTokenValue(e){let t=e.toLowerCase();return Array.from(this.tokenIndex.byValue.get(t)||[])}yieldToMain(){return new Promise(e=>setTimeout(e,0))}getFromCache(e){let t=this.cache.get(e);return t&&Date.now()-t.timestamp<this.cacheMaxAge?t.components:null}rgbaToColor(e,t){let n=Math.round(e.r*255),r=Math.round(e.g*255),o=Math.round(e.b*255),i=`#${[n,r,o].map(s=>s.toString(16).padStart(2,"0")).join("")}`,a=`rgba(${n}, ${r}, ${o}, ${t.toFixed(2)})`;return{hex:i,rgba:a}}parseFontWeight(e){let t={thin:100,extralight:200,light:300,regular:400,medium:500,semibold:600,bold:700,extrabold:800,black:900},n=e.toLowerCase();for(let[o,i]of Object.entries(t))if(n.includes(o))return i;let r=e.match(/(\d+)/);return r?parseInt(r[1],10):400}scanAllComponents(){this.errors=[];let e=[],t=0,n=figma.root.children;for(let r of n)if(r.type==="PAGE"){let o=r.findAll(i=>i.type==="COMPONENT"||i.type==="COMPONENT_SET");for(let i of o)try{let a=this.extractComponentPropertiesOptimized(i,r.name,"all",!0,3,0);a&&e.push(a)}catch(a){this.errors.push({componentId:i.id,componentName:i.name,error:a instanceof Error?a.message:"Unknown error"})}}return{components:e,totalComponents:e.length,totalInstances:t,pagesScanned:n.length,errors:this.errors}}scanFilteredPages(e){this.errors=[];let t=[],n=0,r=figma.root.children,o=e.map(a=>a.toLowerCase().trim()),i=r.filter(a=>a.type==="PAGE"&&o.includes(a.name.toLowerCase().trim()));for(let a of i)if(a.type==="PAGE"){let s=a.findAll(p=>p.type==="COMPONENT"||p.type==="COMPONENT_SET");for(let p of s)try{let u=this.extractComponentPropertiesOptimized(p,a.name,"all",!0,3,0);u&&t.push(u)}catch(u){this.errors.push({componentId:p.id,componentName:p.name,error:u instanceof Error?u.message:"Unknown error"})}}return{components:t,totalComponents:t.length,totalInstances:n,pagesScanned:i.length,errors:this.errors}}scanCurrentPage(){this.errors=[];let e=[],t=figma.currentPage,n=t.findAll(r=>r.type==="COMPONENT"||r.type==="COMPONENT_SET");for(let r of n)try{let o=this.extractComponentPropertiesOptimized(r,t.name,"all",!0,3,0);o&&e.push(o)}catch(o){this.errors.push({componentId:r.id,componentName:r.name,error:o instanceof Error?o.message:"Unknown error"})}return{components:e,totalComponents:e.length,totalInstances:0,pagesScanned:1,errors:this.errors}}scanNodes(e){this.errors=[];let t=[],n=figma.currentPage;for(let r of e){if("findAll"in r&&typeof r.findAll=="function"){let o=r.findAll(i=>i.type==="COMPONENT"||i.type==="COMPONENT_SET");for(let i of o)try{let a=this.extractComponentPropertiesOptimized(i,n.name,"all",!0,3,0);a&&t.push(a)}catch(a){this.errors.push({componentId:i.id,componentName:i.name,error:a instanceof Error?a.message:"Unknown error"})}}if(r.type==="COMPONENT"||r.type==="COMPONENT_SET")try{let o=this.extractComponentPropertiesOptimized(r,n.name,"all",!0,3,0);o&&!t.find(i=>i.id===o.id)&&t.push(o)}catch(o){this.errors.push({componentId:r.id,componentName:r.name,error:o instanceof Error?o.message:"Unknown error"})}}return{components:t,totalComponents:t.length,totalInstances:0,pagesScanned:1,errors:this.errors}}getComponentUsageStats(e){let t=new Set,n=0;for(let r of figma.root.children)if(r.type==="PAGE"){let o=r.findAll(i=>{var a;return i.type==="INSTANCE"&&((a=i.mainComponent)==null?void 0:a.id)===e});o.length>0&&(n+=o.length,t.add(r.name))}return{instances:n,pages:Array.from(t)}}}});var fe,ve=q(()=>{"use strict";fe=class{constructor(){D(this,"MIN_CONFIDENCE_THRESHOLD",.85)}matchTokenToComponents(e,t){let n=[];for(let r of t.components){let i=this.matchComponentRecursively(e,r).filter(a=>a.confidence>=this.MIN_CONFIDENCE_THRESHOLD);if(i.length>0){let a=i.reduce((s,p)=>s+p.confidence,0)/i.length;n.push({component:r,matches:i,confidence:a})}}return n.sort((r,o)=>o.confidence-r.confidence),{token:e,matchingComponents:n,totalMatches:n.length,totalComponentsScanned:t.totalComponents}}matchComponentRecursively(e,t){let n=[];switch(e.type){case"color":n.push(...this.matchColor(e,t));break;case"fontFamily":case"fontWeight":case"typography":n.push(...this.matchTypography(e,t));break;case"dimension":n.push(...this.matchSpacing(e,t));break;case"shadow":n.push(...this.matchEffects(e,t));break;case"borderRadius":n.push(...this.matchSpacing(e,t,"borderRadius"));break;case"borderWidth":n.push(...this.matchSpacing(e,t,"borderWidth"));break;default:n.push(...this.matchByValue(e,t)),this.looksLikeSpacingToken(e)&&n.push(...this.matchSpacing(e,t)),this.looksLikeBorderRadiusToken(e)&&n.push(...this.matchSpacing(e,t,"borderRadius")),this.looksLikeBorderToken(e)&&n.push(...this.matchSpacing(e,t,"borderWidth")),this.looksLikeEffectToken(e)&&n.push(...this.matchEffects(e,t))}if(t.children&&t.children.length>0)for(let r of t.children){let o=this.matchComponentRecursively(e,r);for(let i of o)n.push(Q(Y({},i),{property:`${r.name} \u2192 ${i.property}`}))}return n}matchColor(e,t){let n=[],r=e.path.join("."),o=this.normalizeColor(e.value);for(let a of t.colors)if(a.tokenReference){let s=a.tokenReference.trim();s=s.replace(/^["']|["']$/g,""),s=s.replace(/^[{]|[}]$/g,""),s=s.replace(/^\$/,"");let p=s.toLowerCase(),u=r.toLowerCase();p===u?n.push({property:`${a.type} color (token ref)`,propertyType:"color",matchedValue:`${a.hex} \u2190 ${a.tokenReference}`,tokenValue:r,confidence:1}):(p.endsWith("."+u)||p===u||u.endsWith("."+p)||u===p)&&n.push({property:`${a.type} color (token ref)`,propertyType:"color",matchedValue:`${a.hex} \u2190 ${a.tokenReference}`,tokenValue:r,confidence:.9})}let i=n.filter(a=>a.confidence>=.9);return i.length>0?i:n}matchTypography(e,t){let n=[],r=e.path.join(".");for(let o of t.typography){let i=0,a="",s="value";if(o.tokenReference){let u=o.tokenReference.replace(/[{}]/g,"").replace(/^\$/,"").toLowerCase().replace(/\./g,"."),d=r.toLowerCase();u===d?(i=1,a=`${o.fontFamily} (ref: ${o.tokenReference})`,s="reference"):(u.includes(d)||d.includes(u))&&(i=.8,a=`${o.fontFamily} (ref: ${o.tokenReference})`,s="reference")}if(i===0){if(e.type==="fontFamily"){let p=String(e.value).toLowerCase().trim(),u=o.fontFamily.toLowerCase().trim();p===u&&(i=.9,a=o.fontFamily)}else if(e.type==="fontWeight"){let p=this.normalizeFontWeight(e.value),u=o.fontWeight;p===u&&(i=.9,a=String(u))}else if(e.type==="typography"&&typeof e.value=="object"&&e.value!==null){let p=e.value,u=!1,d=0,f=[];if(p.fontFamily){let S=String(p.fontFamily).toLowerCase().trim(),$=o.fontFamily.toLowerCase().trim();S===$&&(u=!0,d+=.4,f.push(`fontFamily: ${o.fontFamily}`))}if(p.fontSize){let S=Number(p.fontSize),$=o.fontSize;Math.abs(S-$)<.5&&(u=!0,d+=.3,f.push(`fontSize: ${$}`))}p.fontWeight&&this.normalizeFontWeight(p.fontWeight)===o.fontWeight&&(u=!0,d+=.3,f.push(`fontWeight: ${o.fontWeight}`)),u&&(i=Math.min(d,1),a=f.join(", "))}}i>0&&n.push({property:`typography${s==="reference"?" (token ref)":""}`,propertyType:"typography",matchedValue:a,tokenValue:String(e.value),confidence:i})}return n}matchSpacing(e,t,n){let r=[],o=e.path.join("."),i=this.normalizeDimension(e.value),a=n?t.spacing.filter(p=>p.type===n):t.spacing;for(let p of a)if(p.tokenReference){let u=p.tokenReference.trim();u=u.replace(/^["']|["']$/g,""),u=u.replace(/^[{]|[}]$/g,""),u=u.replace(/^\$/,""),u=u.replace(/^\[\w+\]\s*/,"");let d=u.toLowerCase(),f=o.toLowerCase(),S=this.formatSpacingType(p.type);d===f?r.push({property:`${S} (token ref)`,propertyType:"spacing",matchedValue:`${p.value}${p.unit} \u2190 ${p.tokenReference}`,tokenValue:o,confidence:1}):(d.endsWith("."+f)||d===f||f.endsWith("."+d)||f===d)&&r.push({property:`${S} (token ref)`,propertyType:"spacing",matchedValue:`${p.value}${p.unit} \u2190 ${p.tokenReference}`,tokenValue:o,confidence:.9})}let s=r.filter(p=>p.confidence>=.9);return s.length>0?s:r}formatSpacingType(e){switch(e){case"borderRadius":return"border-radius";case"borderWidth":return"border-width";case"gap":return"gap/spacing";default:return e}}matchEffects(e,t){let n=[],r=e.path.join(".");for(let i of t.effects)if(i.tokenReference){let a=i.tokenReference.trim();a=a.replace(/^["']|["']$/g,""),a=a.replace(/^[{]|[}]$/g,""),a=a.replace(/^\$/,"");let s=a.toLowerCase(),p=r.toLowerCase();s===p?n.push({property:`${i.type} (token ref)`,propertyType:"effect",matchedValue:`${i.type} \u2190 ${i.tokenReference}`,tokenValue:r,confidence:1}):(s.endsWith("."+p)||s===p||p.endsWith("."+s)||p===s)&&n.push({property:`${i.type} (token ref)`,propertyType:"effect",matchedValue:`${i.type} \u2190 ${i.tokenReference}`,tokenValue:r,confidence:.9})}let o=n.filter(i=>i.confidence>=.9);return o.length>0?o:n}matchByValue(e,t){let n=[];return this.looksLikeColor(e.value)&&n.push(...this.matchColor(e,t)),this.looksLikeDimension(e.value)&&n.push(...this.matchSpacing(e,t)),n}normalizeColor(e){if(typeof e!="string")return null;let t=e.trim().toLowerCase();return t.match(/^#[0-9a-f]{3,8}$/)||t.match(/^rgba?\(/)||t.match(/^hsla?\(/)?t:null}normalizeHex(e){if(!e)return null;let t=e.trim().toLowerCase().replace("#","");return t.length===3&&(t=t.split("").map(n=>n+n).join("")),t.length===6?t:null}normalizeRgba(e){if(!e)return null;let t=e.match(/rgba?\(([^)]+)\)/i);return t?t[1].trim():null}parseRgba(e){let t=this.normalizeRgba(e);if(!t)return null;let n=t.split(",").map(r=>parseFloat(r.trim()));return n.length>=3?{r:n[0],g:n[1],b:n[2],a:n.length>3?n[3]:1}:null}rgbaToString(e){return`rgba(${Math.round(e.r)}, ${Math.round(e.g)}, ${Math.round(e.b)}, ${e.a.toFixed(2)})`}colorsMatch(e,t){let n=this.parseRgba(e),r=this.parseRgba(t);if(n&&r)return Math.abs(n.r-r.r)<2&&Math.abs(n.g-r.g)<2&&Math.abs(n.b-r.b)<2&&Math.abs(n.a-r.a)<.01;let o=this.normalizeHex(e),i=this.normalizeHex(t);return o!==null&&i!==null&&o===i}normalizeFontWeight(e){if(typeof e=="number")return e;if(typeof e!="string")return 400;let t={thin:100,extralight:200,light:300,regular:400,normal:400,medium:500,semibold:600,bold:700,extrabold:800,black:900},n=e.toLowerCase().trim();if(t[n])return t[n];let r=parseInt(e,10);return isNaN(r)?400:r}normalizeDimension(e){if(typeof e=="number")return e;if(typeof e!="string")return null;let t=e.replace(/px|rem|em|pt|pc|in|cm|mm|q|vh|vw|vmin|vmax|%/g,"").trim(),n=parseFloat(t);return isNaN(n)?null:n}looksLikeColor(e){if(typeof e!="string")return!1;let t=e.trim().toLowerCase();return t.match(/^#[0-9a-f]{3,8}$/)!==null||t.match(/^rgba?\(/)!==null||t.match(/^hsla?\(/)!==null}looksLikeDimension(e){return typeof e=="number"?!0:typeof e!="string"?!1:/^-?\d+(\.\d+)?(px|rem|em|pt|pc|in|cm|mm|q|vh|vw|vmin|vmax|%)$/.test(e.trim())}looksLikeSpacingToken(e){let t=e.path.join(".").toLowerCase();return["spacing","space","size","sizing","dimension","width","height","padding","margin","gap","radius","border","inset","offset","corner","round","stroke","weight","1x","2x","3x","4x","5x","6x","8x","10x","12x","16x"].some(r=>t.includes(r))}looksLikeBorderRadiusToken(e){let t=e.path.join(".").toLowerCase();return["radius","corner","round","rounded","borderradius"].some(r=>t.includes(r))}looksLikeBorderToken(e){let t=e.path.join(".").toLowerCase(),n=["border","stroke","outline","line"];return t.includes("radius")?!1:n.some(r=>t.includes(r))}looksLikeEffectToken(e){let t=e.path.join(".").toLowerCase();return["shadow","effect","blur","elevation","drop"].some(r=>t.includes(r))}}});function V(y,e){let t=`${we}`;return we+=1,oe[t]={handler:e,name:y},function(){delete oe[t]}}function Ee(y,e){let t=!1;for(let n in oe)oe[n].name===y&&(oe[n].handler.apply(null,e),t=!0);if(t===!1)throw new Error(`No event handler with name \`${y}\``)}var oe,we,k,xe=q(()=>{oe={},we=0;k=typeof window=="undefined"?function(y,...e){figma.ui.postMessage([y,...e])}:function(y,...e){window.parent.postMessage({pluginMessage:[y,...e]},"*")};typeof window=="undefined"?figma.ui.onmessage=function(y){if(!Array.isArray(y))return;let[e,...t]=y;typeof e=="string"&&Ee(e,t)}:window.onmessage=function(y){if(typeof y.data.pluginMessage=="undefined")return;let e=y.data.pluginMessage;if(!Array.isArray(e))return;let[t,...n]=y.data.pluginMessage;typeof t=="string"&&Ee(t,n)}});function me(y,e){if(typeof __html__=="undefined")throw new Error("No UI defined");let t=`<div id="create-figma-plugin"></div><script>document.body.classList.add('theme-${figma.editorType}');const __FIGMA_COMMAND__='${typeof figma.command=="undefined"?"":figma.command}';const __SHOW_UI_DATA__=${JSON.stringify(typeof e=="undefined"?{}:e)};${__html__}</script>`;figma.showUI(t,Q(Y({},y),{themeColors:typeof y.themeColors=="undefined"?!0:y.themeColors}))}var Ae=q(()=>{});var $e=q(()=>{xe();Ae()});var Oe={};He(Oe,{default:()=>Xe});function Xe(){me({width:400,height:550},{resizable:!0}),figma.loadAllPagesAsync().catch(l=>{console.error("Error loading pages on startup:",l)});let y=new ce,e=new pe,t=new de,n=new fe,r=!0,o=null;function i(){let l=figma.root.children.filter(m=>m.type==="PAGE").map(m=>m.id).join(",");if(o===null)return o=l,!1;let c=l!==o;return o=l,c}async function a(){i()&&(console.log("[Cache] Document changed, clearing component cache"),await t.clearCache())}let s=10*60*1e3;function p(l,c,m,h){return`tokenCache_${l}_${c}_${m}_${h||"root"}`}async function u(l){try{let c=await figma.clientStorage.getAsync(l);if(c&&c.sha&&c.tokens&&Date.now()-c.timestamp<s)return c}catch(c){console.error("Error reading token cache:",c)}return null}async function d(l,c,m,h){try{let b={sha:c,tokens:m,metadata:h,timestamp:Date.now()};await figma.clientStorage.setAsync(l,b)}catch(b){console.error("Error saving token cache:",b)}}async function f(l){try{await figma.clientStorage.deleteAsync(l)}catch(c){console.error("Error clearing token cache:",c)}}async function S(){try{return await figma.clientStorage.getAsync("repoConfig")||null}catch(l){return console.error("Error loading config:",l),null}}async function $(l){try{await figma.clientStorage.setAsync("repoConfig",l)}catch(c){console.error("Error saving config:",c)}}async function T(){try{await figma.clientStorage.deleteAsync("repoConfig")}catch(l){console.error("Error clearing config:",l)}}V("load-config",async()=>{let l=await S();k("config-loaded",l)}),V("clear-config",async()=>{await T(),k("config-loaded",null)}),V("test-connection",async l=>{let c=y.parseGitHubUrl(l.repoUrl);if(!c){k("connection-result",{success:!1,error:"Invalid GitHub URL format"});return}try{k("connection-progress",{message:"Connecting to GitHub..."});let m=await y.fetchBranches(c.owner,c.repo,l.token),h=0,b=[];if(m.length>0)try{let R=m[0];k("connection-progress",{message:"Scanning for token files..."});let g=await y.detectTokenFiles(c.owner,c.repo,R,l.token,l.filePath||"");h=g.length,b=g.slice(0,5)}catch(R){console.error("Token detection failed:",R)}k("connection-result",{success:!0,branches:m.slice(0,10),owner:c.owner,repo:c.repo,fileCount:h,tokenCount:h,sampleFiles:b.map(R=>R.length>50?R.substring(0,47)+"...":R)})}catch(m){k("connection-result",{success:!1,error:m instanceof Error?m.message:"Connection failed"})}}),V("save-config",async l=>{await $(l),k("config-saved",{success:!0})});let P=/^#[0-9A-Fa-f]{3,8}$/,G=/^rgba?\(/,I=/^hsla?\(/,ee=/^\d+(\.\d+)?(ms|s)$/,ie=/^-?\d+(\.\d+)?(px|rem|em|pt|pc|in|cm|mm|q|vh|vw|vmin|vmax|%)$/,te=/\d+x$/,ne=(l,c)=>{if(typeof l=="string")return P.test(l)||G.test(l)||I.test(l)||c.includes("color")||c.includes("colour")?"color":ee.test(l)||c.includes("duration")?"duration":c.includes("radius")||c.includes("corner")||c.includes("rounded")||c.includes("borderradius")?"borderRadius":c.includes("border")&&(c.includes("width")||c.includes("weight"))||c.includes("stroke")&&c.includes("weight")?"borderWidth":ie.test(l)||c.includes("size")||c.includes("spacing")||c.includes("space")||c.includes("gap")||c.includes("padding")||c.includes("margin")||c.includes("sizing")||c.includes("dimension")||te.test(c)?"dimension":c.includes("font")||c.includes("typography")||c.includes("text")?c.includes("weight")?"fontWeight":c.includes("family")?"fontFamily":"typography":c.includes("shadow")||c.includes("elevation")?"shadow":c.includes("border")&&!c.includes("radius")?"border":"string";if(typeof l=="number")return c.includes("radius")||c.includes("corner")||c.includes("rounded")?"borderRadius":c.includes("border")&&c.includes("width")||c.includes("stroke")&&c.includes("weight")?"borderWidth":c.includes("weight")&&c.includes("font")?"fontWeight":c.includes("opacity")||c.includes("alpha")||c.includes("z-index")||c.includes("zindex")?"number":c.includes("spacing")||c.includes("space")||c.includes("gap")||c.includes("padding")||c.includes("margin")||c.includes("size")||te.test(c)?"dimension":"number";if(typeof l=="object"&&l!==null){if(c.includes("shadow")||l.blur!==void 0||l.spread!==void 0)return"shadow";if(c.includes("typography")||l.fontFamily!==void 0)return"typography";if(c.includes("border")||l.width!==void 0&&l.style!==void 0)return"border"}return"string"},Me=l=>l&&typeof l=="object"&&"$value"in l,Ie=l=>{if(!l||typeof l!="object"||"$value"in l||!("value"in l))return!1;let c=l.value;return typeof c=="string"||typeof c=="number"||typeof c=="boolean"?!0:typeof c=="object"&&c!==null?"type"in l||"description"in l:!1},De=(l,c)=>!(typeof l!="string"&&typeof l!="number"&&typeof l!="boolean"||c.length<1),Le=(l,c)=>{let m=[],h=[],b=(g,v)=>{let z=h[h.length-1]||"unnamed",A=h.join(".").toLowerCase(),O=v||ne(g,A);m.push({name:z,path:h.slice(),type:O,sourceFile:c,value:g})},R=g=>{if(g==null)return;let v=h[h.length-1]||"";if(!(v.startsWith("$")&&v!=="$value"&&v!=="$type")){if(Me(g)){b(g.$value,g.$type);return}if(Ie(g)){b(g.value,g.type);return}if(De(g,h)){b(g,void 0);return}if(typeof g=="object"){let z=Array.isArray(g)?g.map((A,O)=>String(O)):Object.keys(g);for(let A of z){if(!Array.isArray(g)&&(A.startsWith("$")||A==="extensions"))continue;let O=Array.isArray(g)?g[parseInt(A)]:g[A];h.push(A),R(O),h.pop()}}}};return R(l),m},ge=5,ye=500,re=100;V("fetch-tokens",async l=>{let c=y.parseGitHubUrl(l.repoUrl);if(!c){k("tokens-result",{success:!1,error:"Invalid GitHub URL format"});return}try{let m=l.filePath||"",h=p(c.owner,c.repo,l.branch,m);if(!l.forceRefresh){k("tokens-progress",{message:"Checking for cached tokens..."});let[F,_]=await Promise.all([y.getLatestCommitSha(c.owner,c.repo,l.branch,l.token),u(h)]);if(_&&F&&_.sha===F){k("tokens-progress",{message:"Using cached tokens (no changes detected)"});let N=_.tokens;for(let C=0;C<N.length;C+=re){let w=N.slice(C,C+re),E=C+re>=N.length;k("tokens-chunk",{tokens:w,chunkIndex:Math.floor(C/re),totalChunks:Math.ceil(N.length/re),isLast:E})}k("tokens-result",{success:!0,tokens:N,metadata:Q(Y({},_.metadata),{fromCache:!0,cacheAge:Date.now()-_.timestamp,errors:[]})});return}}k("tokens-progress",{message:"Scanning for token files..."});let b=await y.detectTokenFiles(c.owner,c.repo,l.branch,l.token,m);if(b.length===0){k("tokens-result",{success:!1,error:`No token files found${m?` in '${m}'`:" in repository"}. Looking for .json files (excluding config files).`});return}let R=[],g=[],v=0,z=0,A=[],O=[];k("tokens-progress",{message:`Fetching ${b.length} files...`});for(let F=0;F<b.length;F+=ge){let _=b.slice(F,F+ge),N=Math.min(F+ge,b.length);k("tokens-progress",{message:`Fetching files ${F+1}-${N} of ${b.length}...`});let C=await Promise.all(_.map(async w=>{try{let E=await y.fetchFileContents(c.owner,c.repo,l.branch,l.token,w);if(!E.content)return{path:w,error:"Empty file content"};let M=y.decodeBase64Content(E.content);return{path:w,content:M}}catch(E){return{path:w,error:E instanceof Error?E.message:"Fetch failed"}}}));for(let w of C)"content"in w&&w.content?O.push({path:w.path,content:w.content}):"error"in w&&(g.push({file:w.path,message:w.error}),A.push({file:w.path,count:0}))}k("tokens-progress",{message:`Processing ${O.length} files...`});let L=[],j=0;for(let{path:F,content:_}of O)try{let N;try{N=JSON.parse(_)}catch(E){throw new Error(`JSON parse failed: ${E.message}`)}let C=Le(N,F),w=C.length;z+=w,A.push({file:F,count:w}),w===0&&g.push({file:F,message:"No token values found in this file (checked $value, value, and primitives)"});for(let E of C)if(R.length<ye){let M={name:E.name||"",path:E.path||"",type:E.type||"unknown",sourceFile:E.sourceFile||""};R.push(M),L.push(M),L.length>=re&&(k("tokens-chunk",{tokens:L,chunkIndex:j++,isLast:!1}),L=[])}v++}catch(N){console.error(`Failed to parse ${F}:`,N),A.push({file:F,count:0}),g.push({file:F,message:N instanceof Error?N.message:"Failed to parse file"})}L.length>0&&k("tokens-chunk",{tokens:L,chunkIndex:j++,isLast:!0}),k("tokens-progress",{message:`Found ${z} tokens in ${v} files`});let Z=await y.getLatestCommitSha(c.owner,c.repo,l.branch,l.token);Z&&await d(h,Z,R,{totalTokens:z,filesProcessed:v,totalFiles:b.length,perFileCounts:A}),k("tokens-result",{success:!0,tokens:R,metadata:{totalTokens:z,truncated:z>ye,filesProcessed:v,totalFiles:b.length,perFileCounts:A,errors:g,fromCache:!1}})}catch(m){k("tokens-result",{success:!1,error:m instanceof Error?m.message:"Failed to fetch tokens"})}}),V("detect-token-files",async l=>{let c=y.parseGitHubUrl(l.repoUrl);if(!c){k("token-files-result",{success:!1,error:"Invalid GitHub URL format"});return}try{let m=await y.detectTokenFiles(c.owner,c.repo,l.branch,l.token,l.directoryPath||"");k("token-files-result",{success:!0,files:m})}catch(m){k("token-files-result",{success:!1,error:m instanceof Error?m.message:"Failed to detect token files"})}}),V("scan-components",async l=>{try{let c=l.scanAll===!0;c?(k("scan-progress",{message:"Loading all pages..."}),await figma.loadAllPagesAsync(),k("scan-progress",{message:"Scanning all pages..."})):k("scan-progress",{message:"Scanning current page..."});let m=c?e.scanAllComponents():e.scanCurrentPage();k("scan-result",{success:!0,result:m})}catch(c){k("scan-result",{success:!1,error:c instanceof Error?c.message:"Failed to scan components"})}}),V("scan-components-for-token",async l=>{try{let{token:c,scanAll:m,scanSelection:h,pageFilter:b}=l,R=m===!0,g=h===!0,v=b&&b.length>0;if(!c){k("scan-result",{success:!1,error:"No token provided"});return}await a();let z=c.type||"all",A="Scanning for token matches...";R?(A=v?`Loading ${b.length} page(s)...`:"Loading all pages...",k("scan-progress",{message:A}),await figma.loadAllPagesAsync(),A=v?`Scanning ${b.join(", ")} for token matches...`:"Scanning all pages for token matches..."):g?A="Scanning selection for token matches...":A="Scanning current page for token matches...",k("scan-progress",{message:A});let O;if(r&&R){k("scan-progress",{message:"Scanning components (optimized)..."});let N={tokenType:z,useCache:!0,usePersistentCache:!0,chunkSize:100,maxDepth:3,includeChildren:!0,pageFilter:v?b:void 0,onProgress:C=>{let w=Math.round(C.currentPage/C.totalPages*100);k("scan-progress",{message:`Page ${C.currentPage}/${C.totalPages}: ${C.currentPageName} (${C.componentsFound} found)`,progress:w})}};O=await t.scanAllComponentsOptimized(N)}else if(k("scan-progress",{message:"Scanning components..."}),R)v?O=e.scanFilteredPages(b):O=e.scanAllComponents();else if(g){let N=figma.currentPage.selection;if(N.length===0){k("scan-result",{success:!1,error:"No selection found. Please select a frame or node to scan."});return}O=e.scanNodes(N)}else O=e.scanCurrentPage();k("scan-progress",{message:`Found ${O.totalComponents} components. Matching tokens...`});let L=n.matchTokenToComponents(c,O);k("scan-progress",{message:"Filtering nested duplicates..."});let j=new Set;for(let N of L.matchingComponents)N.matches.some(w=>!w.property.includes(" \u2192 "))&&N.component.mainComponentName&&j.add(N.component.mainComponentName.toLowerCase().trim());let Z=N=>{let C=N.split(" \u2192 ");return C.length<2?null:C[C.length-2].toLowerCase().trim()},F=L.matchingComponents.filter(N=>N.matches.some(E=>!E.property.includes(" \u2192 "))?!0:!N.matches.every(E=>{if(!E.property.includes(" \u2192 "))return!1;let M=Z(E.property);return M?j.has(M):!1}));k("scan-progress",{message:"Matching complete!"});let _={token:{name:c.name,path:c.path,type:c.type,value:c.value},matchingComponents:F.map(N=>({id:N.component.id,name:N.component.name,page:N.component.pageName,type:N.component.type,mainComponentName:N.component.mainComponentName,mainComponentId:N.component.mainComponentId,matches:N.matches.map(C=>`${C.property}: ${C.matchedValue}`),matchDetails:N.matches,confidence:N.confidence})),totalMatches:F.length,totalComponentsScanned:L.totalComponentsScanned};k("scan-result",{success:!0,result:_})}catch(c){k("scan-result",{success:!1,error:c instanceof Error?c.message:"Failed to scan components for token"})}}),V("get-component-usage",async l=>{try{let{componentId:c}=l,m=e.getComponentUsageStats(c);k("component-usage-result",{success:!0,stats:m})}catch(c){k("component-usage-result",{success:!1,error:c instanceof Error?c.message:"Failed to get usage stats"})}}),V("navigate-to-component",async l=>{try{let{componentId:c}=l,m=await figma.getNodeByIdAsync(c);if(m&&"type"in m){let h=We(m);h&&h.type==="PAGE"&&h!==figma.currentPage&&await figma.setCurrentPageAsync(h),m.type!=="DOCUMENT"&&m.type!=="PAGE"?(figma.currentPage.selection=[m],figma.viewport.scrollAndZoomIntoView([m]),k("navigate-result",{success:!0})):k("navigate-result",{success:!1,error:"Cannot select document or page nodes"})}else k("navigate-result",{success:!1,error:"Node not found"})}catch(c){k("navigate-result",{success:!1,error:c instanceof Error?c.message:"Failed to navigate to component"})}});function We(l){let c=l;for(;c&&c.type!=="PAGE";)c=c.parent;return c}async function Ze(l){let c=await figma.getNodeByIdAsync(l);if(!c)return null;if(c.type==="COMPONENT_SET"){let m=c,h=m.defaultVariant||m.children[0];if((h==null?void 0:h.type)==="COMPONENT")return h}return c.type==="COMPONENT"?c:c.type==="INSTANCE"?await c.getMainComponentAsync():null}V("create-component-collection",async l=>{try{let{token:c,groupedComponents:m,matchingComponents:h}=l,b=Object.entries(m||{});if(b.length===0&&(!h||h.length===0)){k("create-collection-result",{success:!1,error:"No components to collect"});return}let R=Array.isArray(c.path)?c.path.join("."):c.name,g=figma.createFrame();g.name=`Token Matches: ${R}`,g.layoutMode="VERTICAL",g.primaryAxisSizingMode="AUTO",g.counterAxisSizingMode="AUTO",g.paddingTop=32,g.paddingBottom=32,g.paddingLeft=32,g.paddingRight=32,g.itemSpacing=24,g.fills=[{type:"SOLID",color:{r:.95,g:.95,b:.95}}],g.cornerRadius=8;let v=figma.createText();await figma.loadFontAsync({family:"Inter",style:"Bold"}),await figma.loadFontAsync({family:"Inter",style:"Regular"}),v.fontName={family:"Inter",style:"Bold"},v.characters=`Token: ${R}`,v.fontSize=18,v.fills=[{type:"SOLID",color:{r:.1,g:.1,b:.1}}],g.appendChild(v);let z=b.length,A=(h==null?void 0:h.length)||0,O=figma.createText();O.fontName={family:"Inter",style:"Regular"},O.characters=`${z} component${z!==1?"s":""}${A>z?` (${A} variants total)`:""}`,O.fontSize=12,O.fills=[{type:"SOLID",color:{r:.4,g:.4,b:.4}}],g.appendChild(O);let L=figma.createFrame();L.name="Components List",L.layoutMode="VERTICAL",L.primaryAxisSizingMode="AUTO",L.counterAxisSizingMode="AUTO",L.itemSpacing=16,L.fills=[],g.appendChild(L);let j=0;for(let[F,_]of b){let N=_.length;try{let C=figma.createFrame();C.name=F,C.layoutMode="VERTICAL",C.primaryAxisSizingMode="AUTO",C.counterAxisSizingMode="AUTO",C.paddingTop=16,C.paddingBottom=16,C.paddingLeft=16,C.paddingRight=16,C.itemSpacing=8,C.fills=[{type:"SOLID",color:{r:1,g:1,b:1}}],C.strokes=[{type:"SOLID",color:{r:.85,g:.85,b:.85}}],C.strokeWeight=1,C.cornerRadius=6;let w=figma.createText();w.fontName={family:"Inter",style:"Bold"},w.characters=F,w.fontSize=12,w.fills=[{type:"SOLID",color:{r:.1,g:.1,b:.1}}],C.appendChild(w);let E=_[0];if(E!=null&&E.matchDetails&&E.matchDetails.length>0){let X=E.matchDetails[0],x=figma.createText();x.fontName={family:"Inter",style:"Regular"};let W="";if(X.matchedValue){let B=X.matchedValue.match(/^([^]+)/);B&&(W=B[1].trim())}let U=X.property.replace(/\s*\([^)]*\)\s*/g,"").trim(),H=W?`${W} \u2192 ${U}`:U;N>1&&(H+=` (${N} variants)`),x.characters=H,x.fontSize=10,x.fills=[{type:"SOLID",color:{r:.5,g:.5,b:.5}}],C.appendChild(x)}let M=figma.createFrame();M.name="Variants",M.layoutMode="HORIZONTAL",M.layoutWrap="WRAP",M.primaryAxisSizingMode="AUTO",M.counterAxisSizingMode="AUTO",M.paddingTop=40,M.paddingBottom=40,M.paddingLeft=40,M.paddingRight=40,M.itemSpacing=12,M.counterAxisSpacing=12,M.fills=[],M.clipsContent=!1,C.appendChild(M);let be=0,J=new Set;for(let X of _)try{let x=await figma.getNodeByIdAsync(X.id);if(!x)continue;let W=null,U=X.name;if(x.type==="INSTANCE"){let H=x;try{let B=await H.getMainComponentAsync();B&&(U=B.name)}catch(B){}if(J.has(U))continue;J.add(U),W=H.clone()}else if(x.type==="COMPONENT"){let H=x;if(U=H.name,J.has(U))continue;J.add(U),W=H.createInstance()}else if(x.type==="COMPONENT_SET"){let H=x,B=null;if(X.name.includes("=")){for(let K of H.children)if(K.type==="COMPONENT"&&K.name===X.name){B=K;break}}if(!B){let K=H.defaultVariant||H.children[0];(K==null?void 0:K.type)==="COMPONENT"&&(B=K)}if(B){if(U=B.name,J.has(U))continue;J.add(U),W=B.createInstance()}}else if(x.type==="FRAME"||x.type==="GROUP"||x.type==="RECTANGLE"||x.type==="ELLIPSE"||x.type==="LINE"||x.type==="TEXT"||x.type==="VECTOR"||x.type==="POLYGON"||x.type==="STAR"){if(J.has(U))continue;J.add(U),W=x.clone()}if(W){if("width"in W&&"height"in W){let B=W.width,K=W.height,ue=Math.min(1,150/Math.max(B,K));ue<1&&"resize"in W&&W.resize(B*ue,K*ue)}M.appendChild(W),be++}}catch(x){console.error(`Failed to create instance for variant ${X.id}:`,x)}be>0?(L.appendChild(C),j++):C.remove()}catch(C){console.error(`Failed to create card for ${F}:`,C)}}let Z=figma.viewport;g.x=Z.center.x-g.width/2,g.y=Z.center.y-g.height/2,figma.currentPage.appendChild(g),figma.currentPage.selection=[g],figma.viewport.scrollAndZoomIntoView([g]),figma.notify(`Created collection with ${j} component${j!==1?"s":""}`),k("create-collection-result",{success:!0,count:j,frameId:g.id})}catch(c){console.error("Failed to create component collection:",c),k("create-collection-result",{success:!1,error:c instanceof Error?c.message:"Failed to create collection"})}}),V("cancel",()=>{figma.closePlugin()}),V("resize-window",l=>{figma.ui.resize(l.width,l.height)});function Be(l){let c={nodeId:l.id,nodeName:l.name,nodeType:l.type,pluginData:{},sharedPluginData:{}};try{let h=l.getPluginDataKeys();for(let b of h)c.pluginData[b]=l.getPluginData(b)}catch(h){console.error("Error getting plugin data keys:",h)}let m=["tokens","tokens-studio","tokensStudio","figma-tokens","design-tokens","token-studio","com.tokens.studio","tokens.studio","io.tokens.studio","figmatokens","style-dictionary","ds","design-system","theme","variables"];for(let h of m)try{let b=l.getSharedPluginDataKeys(h);if(b.length>0){c.sharedPluginData[h]={};for(let R of b){let g=l.getSharedPluginData(h,R);c.sharedPluginData[h][R]=g}}}catch(b){}try{if("boundVariables"in l&&l.boundVariables){c.boundVariables={};let h=l.boundVariables;for(let[b,R]of Object.entries(h))if(R){if(Array.isArray(R))c.boundVariables[b]=R.map(g=>{try{let v=figma.variables.getVariableById(g.id);return{id:g.id,name:v==null?void 0:v.name,resolvedType:v==null?void 0:v.resolvedType,valuesByMode:v==null?void 0:v.valuesByMode}}catch(v){return{id:g.id,error:"Could not resolve variable"}}});else if(R.id)try{let g=figma.variables.getVariableById(R.id);c.boundVariables[b]={id:R.id,name:g==null?void 0:g.name,resolvedType:g==null?void 0:g.resolvedType,valuesByMode:g==null?void 0:g.valuesByMode}}catch(g){c.boundVariables[b]={id:R.id,error:"Could not resolve variable"}}}}}catch(h){console.error("Error getting bound variables:",h)}return c}function ke(l,c=3,m=0){let h=[],b=Be(l),R=Object.keys(b.pluginData).length>0||Object.keys(b.sharedPluginData).length>0||b.boundVariables&&Object.keys(b.boundVariables).length>0;if(h.push(Q(Y({},b),{pluginData:R?b.pluginData:{_noData:"true"}})),m<c&&"children"in l)for(let g of l.children)h.push(...ke(g,c,m+1));return h}V("inspect-selection",async()=>{try{let l=figma.currentPage.selection;if(l.length===0){k("inspect-result",{success:!1,error:"No selection. Please select a node to inspect."});return}k("inspect-progress",{message:"Inspecting plugin data..."});let c=[];for(let h of l){let b=ke(h,3);c.push(...b)}let m=c.filter(h=>!h.pluginData._noData&&(Object.keys(h.pluginData).length>0||Object.keys(h.sharedPluginData).length>0||h.boundVariables&&Object.keys(h.boundVariables).length>0));c.forEach(h=>{h.pluginData._noData&&(h.pluginData={})}),k("inspect-result",{success:!0,results:c,summary:{totalNodesInspected:c.length,nodesWithPluginData:m.length,namespacesFound:Array.from(new Set(m.flatMap(h=>Object.keys(h.sharedPluginData)))),pluginDataKeysFound:Array.from(new Set(m.flatMap(h=>Object.keys(h.pluginData)))),hasVariableBindings:m.some(h=>h.boundVariables&&Object.keys(h.boundVariables).length>0)}})}catch(l){k("inspect-result",{success:!1,error:l instanceof Error?l.message:"Failed to inspect selection"})}})}var Fe=q(()=>{"use strict";Ne();Re();Pe();ve();$e()});var qe={"src/main.ts--default":(Fe(),je(Oe)).default},Je="src/main.ts--default";qe[Je]();
