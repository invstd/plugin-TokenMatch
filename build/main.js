var ie=Object.defineProperty,Be=Object.defineProperties,_e=Object.getOwnPropertyDescriptor,Ue=Object.getOwnPropertyDescriptors,Ge=Object.getOwnPropertyNames,be=Object.getOwnPropertySymbols;var Te=Object.prototype.hasOwnProperty,He=Object.prototype.propertyIsEnumerable;var me=(b,e,t)=>e in b?ie(b,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):b[e]=t,Z=(b,e)=>{for(var t in e||(e={}))Te.call(e,t)&&me(b,t,e[t]);if(be)for(var t of be(e))He.call(e,t)&&me(b,t,e[t]);return b},Q=(b,e)=>Be(b,Ue(e));var X=(b,e)=>()=>(b&&(e=b(b=0)),e);var Ke=(b,e)=>{for(var t in e)ie(b,t,{get:e[t],enumerable:!0})},je=(b,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of Ge(e))!Te.call(b,r)&&r!==t&&ie(b,r,{get:()=>e[r],enumerable:!(n=_e(e,r))||n.enumerable});return b};var Xe=b=>je(ie({},"__esModule",{value:!0}),b);var F=(b,e,t)=>me(b,typeof e!="symbol"?e+"":e,t);var se,Re=X(()=>{"use strict";se=class{constructor(){F(this,"tokens",[]);F(this,"errors",[]);F(this,"tokenMap",new Map)}parse(e,t=""){return this.tokens=[],this.errors=[],this.tokenMap=new Map,this.collectTokens(e,[]),this.resolveAliases(),this.validateTokens(),{tokens:this.tokens,metadata:{filePath:t,format:"auto-detected",errors:this.errors}}}collectTokens(e,t){if(e==null)return;let n=t[t.length-1]||"";if(!(n.startsWith("$")&&n!=="$value"&&n!=="$type")){if(this.isW3CToken(e)){this.addToken(e.$value,e.$type,e.$description,e.$extensions,t);return}if(this.isTokenStudioToken(e)){this.addToken(e.value,e.type,e.description,e.extensions,t);return}if(this.isPrimitiveToken(e,t)){this.addToken(e,void 0,void 0,void 0,t);return}if(typeof e=="object"){let r=Array.isArray(e)?e.map((o,i)=>String(i)):Object.keys(e);for(let o of r){if(o.startsWith("$")||o==="extensions"||o==="description")continue;let i=Array.isArray(e)?e[parseInt(o)]:e[o];this.collectTokens(i,[...t,o])}}}}addToken(e,t,n,r,o){let i=o[o.length-1]||"unnamed",a=this.inferTokenType({$value:e,$type:t},o),s;typeof e=="string"&&(e.startsWith("{")||e.startsWith("$"))&&(s=this.extractAliases(e));let p={name:i,value:e,type:a,path:[...o],description:n,extensions:r,rawValue:e,aliases:s};this.tokens.push(p),this.tokenMap.set(o.join("."),p)}isW3CToken(e){return e&&typeof e=="object"&&"$value"in e}isTokenStudioToken(e){if(!e||typeof e!="object"||"$value"in e||!("value"in e))return!1;let t=e.value;if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")return!0;if(typeof t=="object"&&t!==null){if("type"in e||"description"in e)return!0;let n=Object.keys(t);if(n.some(r=>["color","width","style"].includes(r.toLowerCase()))&&n.filter(o=>["color","width","style","bordercolor","borderwidth","borderstyle"].includes(o.toLowerCase())).length>=2||n.some(r=>["fontfamily","fontsize","fontweight","lineheight","letterspacing"].includes(r.toLowerCase()))||n.some(r=>["blur","spread","offsetx","offsety","x","y"].includes(r.toLowerCase()))&&n.some(r=>r.toLowerCase()==="color")||n.length<=6&&n.length>=2&&n.some(o=>{let i=t[o];return typeof i=="string"&&(i.startsWith("{")||i.startsWith("$"))}))return!0}return!1}isPrimitiveToken(e,t){return!(typeof e!="string"&&typeof e!="number"&&typeof e!="boolean"||t.length<1)}isDesignToken(e){return this.isW3CToken(e)}inferTokenType(e,t){if(e.$type)return e.$type;let n=t.join(".").toLowerCase();if(n.includes("color")||n.includes("colour"))return"color";if(n.includes("font")||n.includes("typography")||n.includes("text"))return n.includes("weight")?"fontWeight":n.includes("family")?"fontFamily":"typography";if(n.includes("spacing")||n.includes("size")||n.includes("gap"))return"dimension";if(n.includes("shadow"))return"shadow";if(n.includes("radius")||n.includes("corner")||n.includes("rounded"))return"borderRadius";if(n.includes("borderwidth")||n.includes("strokeweight")||n.includes("stroke-weight")||n.includes("border-width")||n.includes("border")&&n.includes("width"))return"borderWidth";if(n.includes("border"))return"border";let r=e.$value;if(typeof r=="string"){if(r.match(/^#[0-9A-Fa-f]{3,8}$/)||r.match(/^rgba?\(/)||r.match(/^hsla?\(/))return"color";if(r.match(/^-?\d+(\.\d+)?(px|rem|em|pt|pc|in|cm|mm|q|vh|vw|vmin|vmax|%)$/))return"dimension";if(r.match(/^\d+(\.\d+)?(ms|s)$/))return"duration"}return typeof r=="number"?"number":typeof r=="boolean"?"boolean":"string"}extractAliases(e){let t=[],n=/\{([^}]+)\}/g,r;for(;(r=n.exec(e))!==null;){let o=r[1].split(",").map(i=>i.trim())[0];o.startsWith("$")&&(o=o.substring(1)),t.push(o)}if(e.startsWith("$")&&!e.startsWith("{")){let o=/\$([a-zA-Z0-9._-]+)/g;for(;(r=o.exec(e))!==null;)t.push(r[1])}return t}resolveAliases(){for(let e of this.tokens)if(e.aliases&&e.aliases.length>0)for(let t of e.aliases){let n=this.tokenMap.get(t);n?(e.value=n.value,e.aliases||(e.aliases=[])):this.errors.push({path:e.path,message:`Unresolved alias: ${t}`,severity:"error"})}}validateTokens(){for(let e of this.tokens){let t=this.validateTokenValue(e);t.valid||this.errors.push({path:e.path,message:t.message||"Validation error",severity:t.severity||"error"})}}validateTokenValue(e){let{type:t,value:n}=e;if(n==null)return{valid:!1,message:"Token value cannot be null or undefined",severity:"error"};switch(t){case"color":return this.validateColor(n);case"dimension":return this.validateDimension(n);case"fontWeight":return this.validateFontWeight(n);case"duration":return this.validateDuration(n);case"typography":return this.validateTypography(n);case"shadow":return this.validateShadow(n);case"border":return this.validateBorder(n);case"borderRadius":case"borderWidth":return this.validateDimension(n);default:return{valid:!0}}}validateColor(e){return typeof e!="string"?{valid:!1,message:"Color value must be a string",severity:"error"}:[/^#[0-9A-Fa-f]{3,8}$/,/^rgba?\([^)]+\)$/,/^hsla?\([^)]+\)$/].some(r=>r.test(e))?{valid:!0}:{valid:!1,message:`Invalid color format: ${e}`,severity:"error"}}validateDimension(e){if(typeof e=="string"){let t=/^-?\d+(\.\d+)?(px|rem|em|pt|pc|in|cm|mm|q|vh|vw|vmin|vmax|%)$/,n=/^-?\d+(\.\d+)?$/,r=/^[{$]/;if(!t.test(e)&&!n.test(e)&&!r.test(e))return{valid:!0,message:`Unusual dimension format: ${e}`,severity:"warning"}}else return typeof e=="number"?{valid:!0}:{valid:!1,message:"Dimension value must be a string or number",severity:"error"};return{valid:!0}}validateFontWeight(e){if(typeof e=="string"){if(!["100","200","300","400","500","600","700","800","900","normal","bold"].includes(e))return{valid:!1,message:`Invalid font weight: ${e}`,severity:"warning"}}else if(typeof e=="number"){if(e<1||e>1e3)return{valid:!1,message:"Font weight must be between 1 and 1000",severity:"error"}}else return{valid:!1,message:"Font weight must be a string or number",severity:"error"};return{valid:!0}}validateDuration(e){return typeof e!="string"?{valid:!1,message:"Duration value must be a string",severity:"error"}:/^\d+(\.\d+)?(ms|s)$/.test(e)?{valid:!0}:{valid:!1,message:`Invalid duration format: ${e}`,severity:"error"}}validateTypography(e){return typeof e!="object"||Array.isArray(e)?{valid:!1,message:"Typography value must be an object",severity:"error"}:e.fontFamily?{valid:!0}:{valid:!1,message:"Typography token missing fontFamily",severity:"warning"}}validateShadow(e){return typeof e!="object"||Array.isArray(e)?{valid:!1,message:"Shadow value must be an object",severity:"error"}:e.color?{valid:!0}:{valid:!1,message:"Shadow token missing color",severity:"warning"}}validateBorder(e){if(typeof e=="object"&&!Array.isArray(e)){let t="width"in e||"borderWidth"in e,n="color"in e||"borderColor"in e,r="style"in e||"borderStyle"in e;return!t&&!n&&!r?{valid:!1,message:"Border token should have width, color, or style",severity:"warning"}:{valid:!0}}return typeof e=="string"?e.startsWith("{")||e.startsWith("$")?{valid:!0}:{valid:!0}:typeof e=="number"?{valid:!0}:{valid:!1,message:"Border value must be an object, string, or number",severity:"error"}}getTokensByType(e){return this.tokens.filter(t=>t.type===e)}getTokenByPath(e){return this.tokenMap.get(e.join("."))}getErrors(){return this.errors}}});var ce,ae,Ne=X(()=>{"use strict";Re();ce=class ce{constructor(){F(this,"parser");this.parser=new se}parseGitHubUrl(e){let t=[/github\.com[\/:]([^\/]+)\/([^\/\.]+)(\.git)?$/,/github\.com\/([^\/]+)\/([^\/]+)/];for(let n of t){let r=e.match(n);if(r)return{owner:r[1],repo:r[2]}}return null}async fetchBranches(e,t,n){try{let r=await fetch(`https://api.github.com/repos/${e}/${t}/branches`,{headers:{Authorization:`Bearer ${n}`,Accept:"application/vnd.github.v3+json"}});if(!r.ok)throw new Error(`GitHub API error: ${r.status}`);return(await r.json()).map(i=>i.name)}catch(r){throw new Error(`Failed to fetch branches: ${r}`)}}async getLatestCommitSha(e,t,n,r){try{let o=`https://api.github.com/repos/${e}/${t}/commits/${n}`,i=await fetch(o,{headers:{Authorization:`Bearer ${r}`,Accept:"application/vnd.github.v3+json"}});return i.ok?(await i.json()).sha||null:(console.warn(`Failed to get commit SHA: ${i.status}`),null)}catch(o){return console.warn("Failed to get latest commit SHA:",o),null}}async fetchFileContents(e,t,n,r,o){try{let i=`https://api.github.com/repos/${e}/${t}/contents/${o}?ref=${n}`,a=await fetch(i,{headers:{Authorization:`Bearer ${r}`,Accept:"application/vnd.github.v3+json"}});if(!a.ok)throw new Error(`GitHub API error: ${a.status}`);return await a.json()}catch(i){throw new Error(`Failed to fetch file contents: ${i}`)}}async fetchDirectoryContents(e,t,n,r,o=""){try{let i=`https://api.github.com/repos/${e}/${t}/contents/${o}?ref=${n}`,a=await fetch(i,{headers:{Authorization:`Bearer ${r}`,Accept:"application/vnd.github.v3+json"}});if(!a.ok)throw new Error(`GitHub API error: ${a.status}`);let s=await a.json();return Array.isArray(s)?s:[s]}catch(i){throw new Error(`Failed to fetch directory contents: ${i}`)}}decodeBase64Content(e){try{let t=e.replace(/\s/g,""),n;if(typeof atob=="function")n=atob(t);else{let o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";n="";let i=0,a=t.replace(/=+$/,"");for(;i<a.length;){let s=o.indexOf(a.charAt(i++)),p=o.indexOf(a.charAt(i++)),f=o.indexOf(a.charAt(i++)),l=o.indexOf(a.charAt(i++)),u=s<<18|p<<12|(f&63)<<6|l&63;n+=String.fromCharCode(u>>16&255),f!==-1&&(n+=String.fromCharCode(u>>8&255)),l!==-1&&(n+=String.fromCharCode(u&255))}}let r;if(typeof TextDecoder!="undefined"){let o=new Uint8Array(n.length);for(let i=0;i<n.length;i++)o[i]=n.charCodeAt(i);r=new TextDecoder("utf-8").decode(o)}else try{r=decodeURIComponent(escape(n))}catch(o){r=n}return r.charCodeAt(0)===65279&&(r=r.slice(1)),r=r.replace(/\0/g,""),r=r.trim(),r}catch(t){throw new Error(`Failed to decode base64 content: ${t}`)}}parseJSONContent(e){try{return JSON.parse(e)}catch(t){throw new Error(`Failed to parse JSON: ${t}`)}}flattenTokens(e,t=[]){let n=[],r=[],o=l=>l&&typeof l=="object"&&"$value"in l,i=l=>{if(!l||typeof l!="object"||"$value"in l||!("value"in l))return!1;let u=l.value;if(typeof u=="string"||typeof u=="number"||typeof u=="boolean")return!0;if(typeof u=="object"&&u!==null){if("type"in l||"description"in l)return!0;let h=Object.keys(u);if(h.some(N=>["color","width","style"].includes(N.toLowerCase()))&&h.filter(k=>["color","width","style","bordercolor","borderwidth","borderstyle"].includes(k.toLowerCase())).length>=2||h.some(N=>["fontfamily","fontsize","fontweight","lineheight","letterspacing"].includes(N.toLowerCase()))||h.some(N=>["blur","spread","offsetx","offsety","x","y"].includes(N.toLowerCase()))&&h.some(N=>N.toLowerCase()==="color")||h.length<=6&&h.length>=2&&h.some(k=>{let C=u[k];return typeof C=="string"&&(C.startsWith("{")||C.startsWith("$"))}))return!0}return!1},a=(l,u)=>!(typeof l!="string"&&typeof l!="number"&&typeof l!="boolean"||u.length<1),s=(l,u)=>{let h=u.join(".").toLowerCase();if(typeof l=="object"&&l!==null&&!Array.isArray(l)){let N=Object.keys(l).map(k=>k.toLowerCase());if(N.some(k=>["width","style"].includes(k))&&N.includes("color"))return"border";if(N.some(k=>["fontfamily","fontsize","fontweight","lineheight"].includes(k)))return"typography";if(N.some(k=>["blur","spread","x","y","offsetx","offsety"].includes(k)))return"shadow"}if(typeof l=="string"){if(l.match(/^#[0-9A-Fa-f]{3,8}$/)||l.match(/^rgba?\(/)||l.match(/^hsla?\(/)||h.includes("color"))return"color";if(l.match(/^\d+(\.\d+)?(ms|s)$/)||h.includes("duration"))return"duration";if(l.match(/^-?\d+(\.\d+)?(px|rem|em|pt|pc|in|cm|mm|q|vh|vw|vmin|vmax|%)$/)||h.includes("size")||h.includes("spacing"))return"dimension";if(h.includes("font")||h.includes("typography"))return"typography";if(h.includes("shadow"))return"shadow";if(h.includes("radius")||h.includes("corner")||h.includes("rounded"))return"borderRadius";if(h.includes("borderwidth")||h.includes("strokeweight")||h.includes("border")&&h.includes("width"))return"borderWidth";if(h.includes("border"))return"border"}else if(typeof l=="number")return h.includes("spacing")||h.includes("size")||h.includes("radius")||h.includes("gap")||h.includes("padding")||h.includes("margin")||h.includes("width")||h.includes("height")?"dimension":"number";return"string"},p=(l,u,h)=>{let N=h[h.length-1]||"unnamed",k=u||s(l,h);n.push({name:N,path:h,type:k,value:l,rawValue:l})},f=(l,u)=>{if(l==null)return;let h=u[u.length-1]||"";if(!(h.startsWith("$")&&h!=="$value"&&h!=="$type")){if(o(l)){p(l.$value,l.$type,u);return}if(i(l)){p(l.value,l.type,u);return}if(a(l,u)){p(l,void 0,u);return}if(l&&typeof l=="object"){let N=Array.isArray(l)?l.map((k,C)=>String(C)):Object.keys(l);for(let k of N){if(!Array.isArray(l)&&(k.startsWith("$")||k==="extensions"))continue;let C=Array.isArray(l)?l[parseInt(k)]:l[k];f(C,[...u,k])}}}};try{f(e,[])}catch(l){r.push({path:[],message:l instanceof Error?l.message:"Failed to walk tokens"})}return{tokens:n,metadata:{filePath:"",format:"auto-detected",errors:r}}}async fetchTokens(e,t,n,r,o){let i=await this.fetchFileContents(e,t,n,r,o);if(i.type!=="file")throw new Error(`Path is not a file: ${o}`);if(!i.content)throw new Error("File content is empty");let a=this.decodeBase64Content(i.content),s=this.parseJSONContent(a),p=this.parser.parse(s,o);return(!p.tokens||p.tokens.length===0)&&(p=this.flattenTokens(s,[])),p}isExcludedFile(e){var n;let t=((n=e.split("/").pop())==null?void 0:n.toLowerCase())||"";return ce.EXCLUDE_PATTERNS.some(r=>r.test(t)||r.test(e))}async fetchRepoTree(e,t,n,r){try{let o=`https://api.github.com/repos/${e}/${t}/git/trees/${n}?recursive=1`,i=await fetch(o,{headers:{Authorization:`Bearer ${r}`,Accept:"application/vnd.github.v3+json"}});if(!i.ok)throw new Error(`GitHub API error: ${i.status}`);let a=await i.json();return a.truncated?(console.warn("Repository tree was truncated - falling back to recursive fetch"),[]):a.tree||[]}catch(o){return console.error("Failed to fetch repo tree:",o),[]}}async detectTokenFiles(e,t,n,r,o=""){let i=await this.fetchRepoTree(e,t,n,r);if(i.length>0){let a=o.replace(/^\/|\/$/g,"");return i.filter(s=>s.type!=="blob"||!s.path.toLowerCase().endsWith(".json")||a&&!s.path.startsWith(a+"/")&&s.path!==a?!1:!this.isExcludedFile(s.path)).map(s=>s.path)}return this.detectTokenFilesRecursive(e,t,n,r,o)}async detectTokenFilesRecursive(e,t,n,r,o=""){let i=await this.fetchDirectoryContents(e,t,n,r,o),a=[];for(let s of i)if(s.type==="file")s.name.toLowerCase().endsWith(".json")&&!this.isExcludedFile(s.path)&&a.push(s.path);else if(s.type==="dir"&&!this.isExcludedFile(s.path+"/")){let p=await this.detectTokenFilesRecursive(e,t,n,r,s.path);a.push(...p)}return a}};F(ce,"EXCLUDE_PATTERNS",[/package\.json$/i,/package-lock\.json$/i,/tsconfig\.json$/i,/\.config\.json$/i,/eslint.*\.json$/i,/prettier.*\.json$/i,/jest\.config\.json$/i,/webpack\.config\.json$/i,/^\$metadata\.json$/i,/^\$themes\.json$/i,/\(ignore\)\.json$/i,/node_modules\//i,/\.github\//i,/\.vscode\//i]);ae=ce});var le,we=X(()=>{"use strict";le=class{constructor(){F(this,"errors",[]);F(this,"TOKENS_STUDIO_NAMESPACE","tokens");F(this,"DEBUG_LOGGING",!1)}getAllTokenKeys(e){let t={},n=["tokens","tokens-studio","tokensStudio","design-tokens","figma-tokens"];for(let r of n)try{let o=e.getSharedPluginDataKeys(r);for(let i of o){let a=e.getSharedPluginData(r,i);a&&a.trim()&&(t[`${r}:${i}`]=a)}}catch(o){}return t}getVariableBinding(e,t){try{if(!("boundVariables"in e)||!e.boundVariables)return;let r=e.boundVariables[t];if(r){let o=Array.isArray(r)?r[0]:r;if(o!=null&&o.id)try{let i=figma.variables.getVariableById(o.id);if(i!=null&&i.name)return this.DEBUG_LOGGING&&console.log(`[Variable] ${e.name}.${t} \u2192 ${i.name}`),i.name}catch(i){}}}catch(n){}}cleanTokenReference(e){let t=e.trim();for(;t.startsWith('"')&&t.endsWith('"')||t.startsWith("'")&&t.endsWith("'");)t=t.slice(1,-1);return t=t.replace(/^[{]|[}]$/g,""),t=t.replace(/^\$/,""),t.trim()}getTokenReference(e,t){try{let n=["tokens","tokens-studio","tokensStudio","design-tokens"];for(let r of n)try{let o=e.getSharedPluginData(r,t);if(o&&o.trim()){let i=this.cleanTokenReference(o);return this.DEBUG_LOGGING&&console.log(`[TokenRef] Found ${r}:${t} = "${i}" on ${e.name}`),i}}catch(o){}try{let r=e.getPluginData(t);if(r&&r.trim())return this.cleanTokenReference(r)}catch(r){}}catch(n){}}getFillTokenReferences(e,t){let n=[`fills[${t}]`,`fill[${t}]`,`fills.${t}`,`fill.${t}`,"fill","fills","fillColor",`fillColor[${t}]`];for(let r of n){let o=this.getTokenReference(e,r);if(o)return o}}getStrokeTokenReferences(e,t){let n=[`strokes[${t}]`,`stroke[${t}]`,`strokes.${t}`,`stroke.${t}`,"stroke","strokes","strokeColor",`strokeColor[${t}]`,"borderColor"];for(let r of n){let o=this.getTokenReference(e,r);if(o)return o}}getTypographyTokenReference(e,t){let r={fontFamily:["fontFamily","fontFamilies","font-family","typography.fontFamily"],fontSize:["fontSize","fontSizes","font-size","typography.fontSize"],fontWeight:["fontWeight","fontWeights","font-weight","typography.fontWeight"],lineHeight:["lineHeight","lineHeights","line-height","typography.lineHeight"],letterSpacing:["letterSpacing","letter-spacing","typography.letterSpacing"],typography:["typography","text","textStyle","text-style"]}[t]||[t];for(let o of r){let i=this.getTokenReference(e,o);if(i)return i}}getSpacingTokenReference(e,t){let r={width:["width","sizing","dimension","sizing.width","dimensions.width"],height:["height","sizing","dimension","sizing.height","dimensions.height"],padding:["padding","spacing","paddingTop","paddingRight","paddingBottom","paddingLeft"],paddingTop:["paddingTop","verticalPadding","padding","spacing"],paddingRight:["paddingRight","horizontalPadding","padding","spacing"],paddingBottom:["paddingBottom","verticalPadding","padding","spacing"],paddingLeft:["paddingLeft","horizontalPadding","padding","spacing"],verticalPadding:["verticalPadding","paddingTop","paddingBottom","padding","spacing"],horizontalPadding:["horizontalPadding","paddingLeft","paddingRight","padding","spacing"],gap:["itemSpacing","spacing","gap","counterAxisSpacing"],itemSpacing:["itemSpacing","spacing","gap"],counterAxisSpacing:["counterAxisSpacing","spacing"],borderRadius:["borderRadius","borderRadiusTopLeft","borderRadiusTopRight","borderRadiusBottomRight","borderRadiusBottomLeft","radius","cornerRadius"],borderRadiusTopLeft:["borderRadiusTopLeft","borderRadius","radius"],borderRadiusTopRight:["borderRadiusTopRight","borderRadius","radius"],borderRadiusBottomRight:["borderRadiusBottomRight","borderRadius","radius"],borderRadiusBottomLeft:["borderRadiusBottomLeft","borderRadius","radius"],borderWidth:["borderWidth","strokeWeight","borderWidthTop","borderWidthRight","borderWidthBottom","borderWidthLeft","border"],strokeWeight:["strokeWeight","borderWidth","border"],dimension:["dimension","spacing","sizing","size"]}[t]||[t];for(let i of r){let a=this.getTokenReference(e,i);if(a)return a}let o=this.getVariableBinding(e,t);if(o)return o}getBorderRadiusTokenReference(e){let t=["borderRadius","borderRadiusTopLeft","borderRadiusTopRight","borderRadiusBottomRight","borderRadiusBottomLeft","radius","cornerRadius","topLeftRadius","topRightRadius","bottomRightRadius","bottomLeftRadius"];for(let r of t){let o=this.getTokenReference(e,r);if(o)return this.DEBUG_LOGGING&&console.log(`[BorderRadius] Found ${r} = "${o}" on ${e.name}`),o}let n=this.getVariableBinding(e,"cornerRadius");if(n)return n}getBorderWidthTokenReference(e){let t=["borderWidth","strokeWeight","borderWidthTop","borderWidthRight","borderWidthBottom","borderWidthLeft","border","strokeWidth"];for(let r of t){let o=this.getTokenReference(e,r);if(o)return this.DEBUG_LOGGING&&console.log(`[BorderWidth] Found ${r} = "${o}" on ${e.name}`),o}let n=this.getVariableBinding(e,"strokeWeight");if(n)return n}getEffectTokenReference(e,t){let n=["boxShadow","shadow",`boxShadow[${t}]`,`shadow[${t}]`,"effects","effect",`effects[${t}]`,`effect[${t}]`,"dropShadow","innerShadow","elevation","shadowColor","shadowOffset","shadowRadius","shadowSpread"];for(let o of n){let i=this.getTokenReference(e,o);if(i)return this.DEBUG_LOGGING&&console.log(`[Effect] Found ${o} = "${i}" on ${e.name}`),i}let r=this.getVariableBinding(e,"effects");if(r)return r}logNodeTokenData(e){if(!this.DEBUG_LOGGING)return;let t=this.getAllTokenKeys(e);if(Object.keys(t).length>0){console.log(`
[TokenData] Node: "${e.name}" (${e.type})`);for(let[n,r]of Object.entries(t)){let o=this.cleanTokenReference(r);console.log(o!==r?`  ${n} = ${o} (raw: ${r})`:`  ${n} = ${o}`)}}}scanAllComponents(){this.errors=[];let e=[],t=0,n=figma.root.children;for(let r of n)if(r.type==="PAGE"){let o=r.findAll(a=>a.type==="COMPONENT"||a.type==="COMPONENT_SET"),i=r.findAll(a=>a.type==="INSTANCE");t+=i.length;for(let a of o)try{let s=this.extractComponentProperties(a,r.name);s&&e.push(s)}catch(s){this.errors.push({componentId:a.id,componentName:a.name,error:s instanceof Error?s.message:"Unknown error"})}}return{components:e,totalComponents:e.length,totalInstances:t,pagesScanned:n.length,errors:this.errors}}scanFilteredPages(e){this.errors=[];let t=[],n=0,r=figma.root.children,o=e.map(a=>a.toLowerCase().trim()),i=r.filter(a=>a.type==="PAGE"&&o.includes(a.name.toLowerCase().trim()));for(let a of i)if(a.type==="PAGE"){let s=a.findAll(f=>f.type==="COMPONENT"||f.type==="COMPONENT_SET"),p=a.findAll(f=>f.type==="INSTANCE");n+=p.length;for(let f of s)try{let l=this.extractComponentProperties(f,a.name);l&&t.push(l)}catch(l){this.errors.push({componentId:f.id,componentName:f.name,error:l instanceof Error?l.message:"Unknown error"})}}return{components:t,totalComponents:t.length,totalInstances:n,pagesScanned:i.length,errors:this.errors}}scanCurrentPage(){this.errors=[];let e=[],t=figma.currentPage,n=0,r=t.findAll(i=>i.type==="COMPONENT"||i.type==="COMPONENT_SET"),o=t.findAll(i=>i.type==="INSTANCE");n+=o.length;for(let i of r)try{let a=this.extractComponentProperties(i,t.name);a&&e.push(a)}catch(a){this.errors.push({componentId:i.id,componentName:i.name,error:a instanceof Error?a.message:"Unknown error"})}return{components:e,totalComponents:e.length,totalInstances:n,pagesScanned:1,errors:this.errors}}scanNodes(e){this.errors=[];let t=[],n=0,r=figma.currentPage;for(let o of e){let i=[],a=[];"findAll"in o&&typeof o.findAll=="function"&&(i=o.findAll(s=>s.type==="COMPONENT"||s.type==="COMPONENT_SET"),a=o.findAll(s=>s.type==="INSTANCE"),n+=a.length);for(let s of i)try{let p=this.extractComponentProperties(s,r.name);p&&t.push(p)}catch(p){this.errors.push({componentId:s.id,componentName:s.name,error:p instanceof Error?p.message:"Unknown error"})}if(o.type==="COMPONENT"||o.type==="COMPONENT_SET")try{let s=this.extractComponentProperties(o,r.name);s&&(t.find(p=>p.id===s.id)||t.push(s))}catch(s){this.errors.push({componentId:o.id,componentName:o.name,error:s instanceof Error?s.message:"Unknown error"})}}return{components:t,totalComponents:t.length,totalInstances:n,pagesScanned:1,errors:this.errors}}extractComponentProperties(e,t){var r,o;if(e.type!=="COMPONENT"&&e.type!=="COMPONENT_SET"&&e.type!=="INSTANCE")return null;let n={id:e.id,name:e.name,type:e.type,pageName:t,colors:[],typography:[],spacing:[],effects:[]};if(e.type==="COMPONENT_SET")n.mainComponentName=e.name,n.mainComponentId=e.id;else if(e.type==="COMPONENT"){let i=e;((r=i.parent)==null?void 0:r.type)==="COMPONENT_SET"?(n.mainComponentName=i.parent.name,n.mainComponentId=i.parent.id):(n.mainComponentName=e.name,n.mainComponentId=e.id)}else if(e.type==="INSTANCE"){let i=e;try{let a=i.mainComponent;a&&(((o=a.parent)==null?void 0:o.type)==="COMPONENT_SET"?(n.mainComponentName=a.parent.name,n.mainComponentId=a.parent.id):(n.mainComponentName=a.name,n.mainComponentId=a.id))}catch(a){n.mainComponentName=e.name.split(",")[0].trim()}}if(n.colors=this.extractColors(e),n.typography=this.extractTypography(e),n.spacing=this.extractSpacing(e),n.effects=this.extractEffects(e),e.type==="COMPONENT"||e.type==="COMPONENT_SET"){let i=e;"layoutMode"in i&&i.layoutMode&&(n.layoutMode=i.layoutMode,n.itemSpacing=i.itemSpacing,n.paddingTop=i.paddingTop,n.paddingRight=i.paddingRight,n.paddingBottom=i.paddingBottom,n.paddingLeft=i.paddingLeft),n.width=i.width,n.height=i.height}else if(e.type==="INSTANCE"){let i=e;n.width=i.width,n.height=i.height}if("children"in e){let i=[];for(let a of e.children){let s=this.extractComponentProperties(a,t);s&&i.push(s)}i.length>0&&(n.children=i)}return n}extractColors(e){var n,r;let t=[];if("fills"in e&&Array.isArray(e.fills))for(let o=0;o<e.fills.length;o++){let i=e.fills[o];if(i.type==="SOLID"){let a=(n=i.opacity)!=null?n:1,s=this.rgbaToColor(i.color,a),p=this.getFillTokenReferences(e,o);t.push({type:"fill",color:{r:i.color.r,g:i.color.g,b:i.color.b,a},hex:s.hex,rgba:s.rgba,opacity:a,tokenReference:p})}}if("strokes"in e&&Array.isArray(e.strokes))for(let o=0;o<e.strokes.length;o++){let i=e.strokes[o];if(i.type==="SOLID"){let a=(r=i.opacity)!=null?r:1,s=this.rgbaToColor(i.color,a),p=this.getStrokeTokenReferences(e,o);t.push({type:"stroke",color:{r:i.color.r,g:i.color.g,b:i.color.b,a},hex:s.hex,rgba:s.rgba,opacity:a,tokenReference:p})}}return t}extractTypography(e){let t=[];if(e.type==="TEXT"){let n=e;if(typeof n.fontName!="symbol"){let r=n.fontName,o=this.getTypographyTokenReference(n,"typography"),i=this.getTypographyTokenReference(n,"fontFamily"),a=this.getTypographyTokenReference(n,"fontSize"),s=this.getTypographyTokenReference(n,"fontWeight"),p=this.getTypographyTokenReference(n,"lineHeight"),f=this.getTypographyTokenReference(n,"letterSpacing"),l=o||i||a||s||p||f;t.push({fontFamily:r.family,fontSize:typeof n.fontSize=="number"?n.fontSize:16,fontWeight:typeof r.style=="string"?this.parseFontWeight(r.style):400,lineHeight:typeof n.lineHeight=="number"||typeof n.lineHeight=="string"?n.lineHeight:void 0,letterSpacing:typeof n.letterSpacing=="number"?n.letterSpacing:void 0,textDecoration:typeof n.textDecoration=="string"?n.textDecoration:void 0,textCase:typeof n.textCase=="string"?n.textCase:void 0,tokenReference:l})}}if("children"in e)for(let n of e.children)t.push(...this.extractTypography(n));return t}extractSpacing(e){let t=[];if(this.logNodeTokenData(e),e.type==="COMPONENT"||e.type==="COMPONENT_SET"||e.type==="FRAME"||e.type==="INSTANCE"){let r=e,o=this.getSpacingTokenReference(e,"width"),i=this.getSpacingTokenReference(e,"height");if(t.push({type:"width",value:r.width,unit:"px",tokenReference:o}),t.push({type:"height",value:r.height,unit:"px",tokenReference:i}),"paddingTop"in r&&typeof r.paddingTop=="number"){let a=this.getSpacingTokenReference(e,"horizontalPadding"),s=this.getSpacingTokenReference(e,"verticalPadding"),p=this.getSpacingTokenReference(e,"padding"),f=this.getSpacingTokenReference(e,"paddingTop"),l=this.getSpacingTokenReference(e,"paddingRight"),u=this.getSpacingTokenReference(e,"paddingBottom"),h=this.getSpacingTokenReference(e,"paddingLeft"),N=(C,S)=>C?`[${S}] ${C}`:void 0,k=(C,S,w)=>{if(C)return C;if(S)return N(S,w);if(p)return N(p,"all")};r.paddingTop&&t.push({type:"padding",value:r.paddingTop,unit:"px",tokenReference:k(f,s,"vertical")}),r.paddingRight&&t.push({type:"padding",value:r.paddingRight,unit:"px",tokenReference:k(l,a,"horizontal")}),r.paddingBottom&&t.push({type:"padding",value:r.paddingBottom,unit:"px",tokenReference:k(u,s,"vertical")}),r.paddingLeft&&t.push({type:"padding",value:r.paddingLeft,unit:"px",tokenReference:k(h,a,"horizontal")})}if("itemSpacing"in r&&typeof r.itemSpacing=="number"&&r.itemSpacing){let a=this.getSpacingTokenReference(e,"itemSpacing")||this.getSpacingTokenReference(e,"gap")||this.getSpacingTokenReference(e,"spacing");t.push({type:"gap",value:r.itemSpacing,unit:"px",tokenReference:a})}if("counterAxisSpacing"in r&&typeof r.counterAxisSpacing=="number"&&r.counterAxisSpacing){let a=this.getSpacingTokenReference(e,"counterAxisSpacing");t.push({type:"gap",value:r.counterAxisSpacing,unit:"px",tokenReference:a})}if("cornerRadius"in r){let a=this.getBorderRadiusTokenReference(e);typeof r.cornerRadius=="number"&&r.cornerRadius>0?t.push({type:"borderRadius",value:r.cornerRadius,unit:"px",tokenReference:a}):r.cornerRadius===figma.mixed&&("topLeftRadius"in r&&typeof r.topLeftRadius=="number"&&r.topLeftRadius>0&&t.push({type:"borderRadius",value:r.topLeftRadius,unit:"px",tokenReference:this.getSpacingTokenReference(e,"borderRadiusTopLeft")||a}),"topRightRadius"in r&&typeof r.topRightRadius=="number"&&r.topRightRadius>0&&t.push({type:"borderRadius",value:r.topRightRadius,unit:"px",tokenReference:this.getSpacingTokenReference(e,"borderRadiusTopRight")||a}),"bottomRightRadius"in r&&typeof r.bottomRightRadius=="number"&&r.bottomRightRadius>0&&t.push({type:"borderRadius",value:r.bottomRightRadius,unit:"px",tokenReference:this.getSpacingTokenReference(e,"borderRadiusBottomRight")||a}),"bottomLeftRadius"in r&&typeof r.bottomLeftRadius=="number"&&r.bottomLeftRadius>0&&t.push({type:"borderRadius",value:r.bottomLeftRadius,unit:"px",tokenReference:this.getSpacingTokenReference(e,"borderRadiusBottomLeft")||a}))}if("strokeWeight"in r&&typeof r.strokeWeight=="number"&&r.strokeWeight>0){let a=this.getBorderWidthTokenReference(e);t.push({type:"borderWidth",value:r.strokeWeight,unit:"px",tokenReference:a})}}else if("cornerRadius"in e){let r=this.getBorderRadiusTokenReference(e),o=e;typeof o.cornerRadius=="number"&&o.cornerRadius>0&&t.push({type:"borderRadius",value:o.cornerRadius,unit:"px",tokenReference:r})}return t}extractEffects(e){var n,r,o,i,a,s,p,f;let t=[];if("effects"in e&&Array.isArray(e.effects))for(let l=0;l<e.effects.length;l++){let u=e.effects[l];if(u.visible){let h=this.getEffectTokenReference(e,l);switch(u.type){case"DROP_SHADOW":t.push({type:"drop-shadow",visible:u.visible,radius:u.radius,color:u.color?{r:u.color.r,g:u.color.g,b:u.color.b,a:u.color.a}:void 0,offset:{x:(r=(n=u.offset)==null?void 0:n.x)!=null?r:0,y:(i=(o=u.offset)==null?void 0:o.y)!=null?i:0},spread:u.spread,tokenReference:h});break;case"INNER_SHADOW":t.push({type:"inner-shadow",visible:u.visible,radius:u.radius,color:u.color?{r:u.color.r,g:u.color.g,b:u.color.b,a:u.color.a}:void 0,offset:{x:(s=(a=u.offset)==null?void 0:a.x)!=null?s:0,y:(f=(p=u.offset)==null?void 0:p.y)!=null?f:0},spread:u.spread,tokenReference:h});break;case"LAYER_BLUR":t.push({type:"layer-blur",visible:u.visible,radius:u.radius,tokenReference:h});break;case"BACKGROUND_BLUR":t.push({type:"background-blur",visible:u.visible,radius:u.radius,tokenReference:h});break}}}return t}rgbaToColor(e,t){let n=Math.round(e.r*255),r=Math.round(e.g*255),o=Math.round(e.b*255),i=t,a=`#${[n,r,o].map(p=>{let f=p.toString(16);return f.length===1?"0"+f:f}).join("")}`,s=`rgba(${n}, ${r}, ${o}, ${i.toFixed(2)})`;return{hex:a,rgba:s}}parseFontWeight(e){let t={thin:100,extralight:200,light:300,regular:400,medium:500,semibold:600,bold:700,extrabold:800,black:900},n=e.toLowerCase();for(let[o,i]of Object.entries(t))if(n.includes(o))return i;let r=e.match(/(\d+)/);return r?parseInt(r[1],10):400}getComponentUsageStats(e){let t=[],n=new Set;for(let r of figma.root.children)if(r.type==="PAGE"){let o=r.findAll(i=>{var a;return i.type==="INSTANCE"&&((a=i.mainComponent)==null?void 0:a.id)===e});o.length>0&&(t.push(...o),n.add(r.name))}return{instances:t.length,pages:Array.from(n)}}}});var pe,ve=X(()=>{"use strict";pe=class{constructor(){F(this,"errors",[]);F(this,"cache",new Map);F(this,"cacheMaxAge",5*60*1e3);F(this,"tokenIndex",{byPath:new Map,byValue:new Map});F(this,"nodeTokenRefsCache",new WeakMap);F(this,"TOKENS_STUDIO_NAMESPACE","tokens");F(this,"debugLogging",!1);F(this,"SKIP_NODE_TYPES",new Set(["VECTOR","BOOLEAN_OPERATION","LINE","ELLIPSE","STAR","POLYGON","TEXT","RECTANGLE","SLICE","STAMP","STICKY","SHAPE_WITH_TEXT","CODE_BLOCK","WIDGET","EMBED","LINK_UNFURL","MEDIA"]))}setDebugLogging(e){this.debugLogging=e}async clearCache(){this.cache.clear(),this.tokenIndex={byPath:new Map,byValue:new Map},this.nodeTokenRefsCache=new WeakMap;try{let t=(await figma.clientStorage.keysAsync()).filter(n=>n.startsWith("componentCache_"));for(let n of t)await figma.clientStorage.deleteAsync(n)}catch(e){console.error("Error clearing persistent cache:",e)}}getCacheStats(){return{entries:this.cache.size,indexedPaths:this.tokenIndex.byPath.size,indexedValues:this.tokenIndex.byValue.size}}getDocumentVersion(){return{documentVersion:figma.root.children.filter(n=>n.type==="PAGE").map(n=>`${n.id}:${n.name}`).join("|").split("").reduce((n,r)=>(n<<5)-n+r.charCodeAt(0),0).toString(36),editSessionId:figma.root.id}}getPersistentCacheKey(e,t){let n=t.slice().sort().join(",");return`componentCache_${e}_${n||"all"}`}async getFromPersistentCache(e,t){try{let n=this.getPersistentCacheKey(e,t),r=await figma.clientStorage.getAsync(n);if(!r)return null;let o=this.getDocumentVersion();if(r.documentVersion===o.documentVersion&&r.editSessionId===o.editSessionId&&Date.now()-r.timestamp<this.cacheMaxAge)return this.debugLogging&&console.log(`[Cache] HIT - Persistent cache valid for ${e} (${t.length} pages)`),r.components;this.debugLogging&&console.log(`[Cache] MISS - Invalidated (version: ${r.documentVersion} vs ${o.documentVersion})`),await figma.clientStorage.deleteAsync(n)}catch(n){this.debugLogging&&console.error("Error reading persistent cache:",n)}return null}async saveToPersistentCache(e,t,n){try{let r=this.getPersistentCacheKey(e,t),o=this.getDocumentVersion(),i={components:n,timestamp:Date.now(),documentVersion:o.documentVersion,editSessionId:o.editSessionId,tokenType:e,pageNames:t};await figma.clientStorage.setAsync(r,i),this.debugLogging&&console.log(`[Cache] SAVED - ${n.length} components for ${e} (version: ${o.documentVersion})`)}catch(r){this.debugLogging&&console.error("Error saving persistent cache:",r)}}async invalidatePagesCache(e){try{let n=(await figma.clientStorage.keysAsync()).filter(r=>r.startsWith("componentCache_"));for(let r of n)try{let o=await figma.clientStorage.getAsync(r);if(!o)continue;o.pageNames.some(a=>e.some(s=>a.toLowerCase()===s.toLowerCase()))&&(await figma.clientStorage.deleteAsync(r),this.debugLogging&&console.log(`[Cache] INVALIDATED - ${r} (affected pages: ${e.join(", ")})`))}catch(o){}}catch(t){this.debugLogging&&console.error("Error invalidating page caches:",t)}}async getCachedPageNames(){try{let t=(await figma.clientStorage.keysAsync()).filter(r=>r.startsWith("componentCache_")),n=new Set;for(let r of t)try{let o=await figma.clientStorage.getAsync(r);o!=null&&o.pageNames&&o.pageNames.forEach(i=>n.add(i))}catch(o){}return Array.from(n)}catch(e){return[]}}async scanAllComponentsOptimized(e={}){this.errors=[];let t=[],n=0,{tokenType:r="all",maxNodesPerPage:o=0,maxPages:i=0,chunkSize:a=100,onProgress:s,includeChildren:p=!0,maxDepth:f=3,useCache:l=!0,usePersistentCache:u=!0,pageFilter:h=[]}=e,N=figma.root.children.filter(w=>w.type==="PAGE"),k=h.length>0?N.filter(w=>h.includes(w.name)):N,C=i>0?Math.min(i,k.length):k.length,S=k.slice(0,C).map(w=>w.name);if(u&&l){s==null||s({currentPage:0,totalPages:C,currentPageName:"Checking cache...",componentsFound:0,nodesScanned:0,phase:"loading"});let w=await this.getFromPersistentCache(r,S);if(w)return this.buildTokenIndex(w),s==null||s({currentPage:C,totalPages:C,currentPageName:"Complete (from cache)",componentsFound:w.length,nodesScanned:0,phase:"complete"}),{components:w,totalComponents:w.length,totalInstances:0,pagesScanned:C,errors:[]}}for(let w=0;w<C;w++){let H=k[w];s==null||s({currentPage:w+1,totalPages:C,currentPageName:H.name,componentsFound:t.length,nodesScanned:0,phase:"scanning"});let oe=`${H.id}-${r}`;if(l){let te=this.getFromCache(oe);if(te){t.push(...te);continue}}let ee=await this.scanPageChunked(H,r,a,o,p,f,te=>{s==null||s({currentPage:w+1,totalPages:C,currentPageName:H.name,componentsFound:t.length,nodesScanned:te,phase:"scanning"})});l&&this.cache.set(oe,{components:ee.components,timestamp:Date.now()}),t.push(...ee.components),n+=ee.totalInstances,await this.yieldToMain()}return this.buildTokenIndex(t),u&&l&&t.length>0&&await this.saveToPersistentCache(r,S,t),s==null||s({currentPage:C,totalPages:C,currentPageName:"Complete",componentsFound:t.length,nodesScanned:0,phase:"complete"}),{components:t,totalComponents:t.length,totalInstances:n,pagesScanned:C,errors:this.errors}}async scanPageChunked(e,t,n,r,o,i,a){let s=[],p=0,f=0;if(e.children.length===0)return{components:[],totalInstances:0};let l=this.pageHasComponents(e),u=[],h=l?r:r>0?Math.min(r,50):50;this.collectComponentNodes(e,u,h),!l&&u.length>=h&&(u.length=0,this.collectComponentNodes(e,u,r)),this.nodeTokenRefsCache=new WeakMap;let N=u.length;for(let k=0;k<N;k+=n){let C=Math.min(k+n,N);for(let S=k;S<C;S++){let w=u[S];try{let H=await this.extractComponentPropertiesOptimized(w,e.name,t,o,i,0);H&&s.push(H),f++,a==null||a(f)}catch(H){this.errors.push({componentId:w.id,componentName:w.name,error:H instanceof Error?H.message:"Unknown error"})}}C<N&&await this.yieldToMain()}return{components:s,totalInstances:p}}collectComponentNodes(e,t,n,r=0){if(n>0&&t.length>=n||r>15)return;let o=e.children,i=o.length;for(let a=0;a<i&&!(n>0&&t.length>=n);a++){let s=o[a],p=s.type;if(p==="COMPONENT"||p==="COMPONENT_SET"){t.push(s);continue}if(!this.SKIP_NODE_TYPES.has(p)&&p!=="INSTANCE"&&!(p!=="GROUP"&&"visible"in s&&!s.visible)&&"children"in s){let f=s;if(f.children.length===0)continue;(p==="FRAME"||p==="GROUP"||p==="SECTION")&&this.collectComponentNodes(f,t,n,r+1)}}}pageHasComponents(e){let t=e.children;if(t.length===0)return!1;let n=Math.min(t.length,30);for(let r=0;r<n;r++){let o=t[r],i=o.type;if(i==="COMPONENT"||i==="COMPONENT_SET")return!0;if((i==="FRAME"||i==="SECTION")&&"children"in o){let a=o.children,s=Math.min(a.length,15);for(let p=0;p<s;p++){let f=a[p];if(f.type==="COMPONENT"||f.type==="COMPONENT_SET")return!0}}}return!1}async extractComponentPropertiesOptimized(e,t,n,r,o,i){var h,N,k;if(e.type!=="COMPONENT"&&e.type!=="COMPONENT_SET"&&e.type!=="INSTANCE"&&e.type!=="FRAME")return null;let a=e.type==="FRAME"?"COMPONENT":e.type,s={id:e.id,name:e.name,type:a,pageName:t,colors:[],typography:[],spacing:[],effects:[]};if(e.type==="COMPONENT_SET")s.mainComponentName=e.name,s.mainComponentId=e.id;else if(e.type==="COMPONENT"){let C=e;((h=C.parent)==null?void 0:h.type)==="COMPONENT_SET"?(s.mainComponentName=C.parent.name,s.mainComponentId=C.parent.id,s.variantName=C.name):(s.mainComponentName=e.name,s.mainComponentId=e.id)}else if(e.type==="INSTANCE"){let C=e;try{let S=await C.getMainComponentAsync();S&&(((N=S.parent)==null?void 0:N.type)==="COMPONENT_SET"?(s.mainComponentName=S.parent.name,s.mainComponentId=S.parent.id,s.variantName=S.name):(s.mainComponentName=S.name,s.mainComponentId=S.id))}catch(S){try{let w=C.mainComponent;w?((k=w.parent)==null?void 0:k.type)==="COMPONENT_SET"?(s.mainComponentName=w.parent.name,s.mainComponentId=w.parent.id,s.variantName=w.name):(s.mainComponentName=w.name,s.mainComponentId=w.id):s.mainComponentName=e.name.split(",")[0].trim()}catch(w){s.mainComponentName=e.name.split(",")[0].trim()}}}let p=n==="all"||n==="color",f=n==="all"||n==="typography",l=n==="all"||["dimension","spacing","borderRadius","borderWidth"].includes(n),u=n==="all"||["effect","shadow"].includes(n);if(p&&(s.colors=this.extractColorsOptimized(e)),f&&(s.typography=this.extractTypographyOptimized(e,r)),l&&(s.spacing=this.extractSpacingOptimized(e,n)),u&&(s.effects=this.extractEffectsOptimized(e)),e.type==="COMPONENT"||e.type==="COMPONENT_SET"||e.type==="FRAME"){let C=e;"layoutMode"in C&&C.layoutMode&&(s.layoutMode=C.layoutMode,s.itemSpacing=C.itemSpacing),s.width=C.width,s.height=C.height}if(r&&i<o&&"children"in e){let C=[];for(let S of e.children){if(this.shouldSkipNode(S,n))continue;let w=await this.extractComponentPropertiesOptimized(S,t,n,r,o,i+1);w&&this.hasRelevantProperties(w)&&C.push(w)}C.length>0&&(s.children=C)}return s}shouldSkipNode(e,t){return"visible"in e&&!e.visible||(e.type==="VECTOR"||e.type==="BOOLEAN_OPERATION")&&t!=="color"||"width"in e&&"height"in e&&(e.width<1||e.height<1)}hasRelevantProperties(e){return!!(e.colors.length>0||e.typography.length>0||e.spacing.length>0||e.effects.length>0||e.children&&e.children.length>0)}extractColorsOptimized(e){var n,r;let t=[];if("fills"in e&&Array.isArray(e.fills))for(let o=0;o<e.fills.length;o++){let i=e.fills[o];if(i.type==="SOLID"){let a=(n=i.opacity)!=null?n:1,s=this.rgbaToColor(i.color,a),p=this.getFillTokenReferencesFast(e,o);t.push({type:"fill",color:{r:i.color.r,g:i.color.g,b:i.color.b,a},hex:s.hex,rgba:s.rgba,opacity:a,tokenReference:p})}}if("strokes"in e&&Array.isArray(e.strokes))for(let o=0;o<e.strokes.length;o++){let i=e.strokes[o];if(i.type==="SOLID"){let a=(r=i.opacity)!=null?r:1,s=this.rgbaToColor(i.color,a),p=this.getStrokeTokenReferencesFast(e,o);t.push({type:"stroke",color:{r:i.color.r,g:i.color.g,b:i.color.b,a},hex:s.hex,rgba:s.rgba,opacity:a,tokenReference:p})}}return t}extractTypographyOptimized(e,t){let n=[];if(e.type==="TEXT"){let r=e;if(typeof r.fontName!="symbol"){let o=r.fontName,i=this.getTypographyTokenFast(r);n.push({fontFamily:o.family,fontSize:typeof r.fontSize=="number"?r.fontSize:16,fontWeight:typeof o.style=="string"?this.parseFontWeight(o.style):400,lineHeight:typeof r.lineHeight=="number"?r.lineHeight:void 0,letterSpacing:typeof r.letterSpacing=="number"?r.letterSpacing:void 0,tokenReference:i})}}if(t&&"children"in e)for(let r of e.children)(r.type==="TEXT"||"children"in r&&this.containsTextNode(r))&&n.push(...this.extractTypographyOptimized(r,t));return n}containsTextNode(e){if(e.type==="TEXT")return!0;if("children"in e){for(let t of e.children)if(t.type==="TEXT"||"children"in t&&t.children.length>0&&t.children.some(n=>n.type==="TEXT"))return!0}return!1}extractSpacingOptimized(e,t){let n=[],r=e.type==="COMPONENT"||e.type==="COMPONENT_SET"||e.type==="FRAME"||e.type==="INSTANCE";if(!r&&!("cornerRadius"in e))return n;let o=t==="all"||t==="dimension"||t==="spacing",i=t==="all"||t==="borderRadius",a=t==="all"||t==="borderWidth";if(r){let s=e;if(o&&n.push({type:"width",value:s.width,unit:"px",tokenReference:this.getSpacingTokenFast(e,"width")},{type:"height",value:s.height,unit:"px",tokenReference:this.getSpacingTokenFast(e,"height")}),o&&"paddingTop"in s&&typeof s.paddingTop=="number"){let p=this.getSpacingTokenFast(e,"horizontalPadding"),f=this.getSpacingTokenFast(e,"verticalPadding"),l=this.getSpacingTokenFast(e,"padding");s.paddingTop&&n.push({type:"padding",value:s.paddingTop,unit:"px",tokenReference:f||l}),s.paddingRight&&n.push({type:"padding",value:s.paddingRight,unit:"px",tokenReference:p||l}),s.paddingBottom&&n.push({type:"padding",value:s.paddingBottom,unit:"px",tokenReference:f||l}),s.paddingLeft&&n.push({type:"padding",value:s.paddingLeft,unit:"px",tokenReference:p||l})}if(o&&"itemSpacing"in s&&s.itemSpacing&&n.push({type:"gap",value:s.itemSpacing,unit:"px",tokenReference:this.getSpacingTokenFast(e,"itemSpacing")}),i&&"cornerRadius"in s){let p=this.getBorderRadiusTokenFast(e);typeof s.cornerRadius=="number"&&s.cornerRadius>0&&n.push({type:"borderRadius",value:s.cornerRadius,unit:"px",tokenReference:p})}a&&"strokeWeight"in s&&typeof s.strokeWeight=="number"&&s.strokeWeight>0&&n.push({type:"borderWidth",value:s.strokeWeight,unit:"px",tokenReference:this.getBorderWidthTokenFast(e)})}else if(i&&"cornerRadius"in e){let s=e,p=this.getBorderRadiusTokenFast(e);typeof s.cornerRadius=="number"&&s.cornerRadius>0&&n.push({type:"borderRadius",value:s.cornerRadius,unit:"px",tokenReference:p})}return n}extractEffectsOptimized(e){var n,r,o,i;let t=[];if(!("effects"in e)||!Array.isArray(e.effects))return t;for(let a=0;a<e.effects.length;a++){let s=e.effects[a];if(!s.visible)continue;let p=this.getEffectTokenFast(e,a);s.type==="DROP_SHADOW"||s.type==="INNER_SHADOW"?t.push({type:s.type==="DROP_SHADOW"?"drop-shadow":"inner-shadow",visible:s.visible,radius:s.radius,color:s.color?{r:s.color.r,g:s.color.g,b:s.color.b,a:s.color.a}:void 0,offset:{x:(r=(n=s.offset)==null?void 0:n.x)!=null?r:0,y:(i=(o=s.offset)==null?void 0:o.y)!=null?i:0},spread:s.spread,tokenReference:p}):(s.type==="LAYER_BLUR"||s.type==="BACKGROUND_BLUR")&&t.push({type:s.type==="LAYER_BLUR"?"layer-blur":"background-blur",visible:s.visible,radius:s.radius,tokenReference:p})}return t}getNodeTokenRefs(e){let t=this.nodeTokenRefsCache.get(e);if(t)return t;t=new Map;try{let n=e.getSharedPluginDataKeys("tokens");for(let r of n){let o=e.getSharedPluginData("tokens",r);o&&o.trim()&&t.set(r,this.cleanTokenReference(o))}}catch(n){}return this.nodeTokenRefsCache.set(e,t),t}getFillTokenReferencesFast(e,t){let n=this.getNodeTokenRefs(e);return n.get("fill")||n.get(`fills.${t}`)||n.get(`fills[${t}]`)||n.get("fillColor")||this.getVariableBindingFast(e,"fills")}getStrokeTokenReferencesFast(e,t){let n=this.getNodeTokenRefs(e);return n.get("stroke")||n.get(`strokes.${t}`)||n.get(`strokes[${t}]`)||n.get("strokeColor")||this.getVariableBindingFast(e,"strokes")}getTypographyTokenFast(e){let t=this.getNodeTokenRefs(e);return t.get("typography")||t.get("fontFamily")||t.get("fontSize")||t.get("fontWeight")}getSpacingTokenFast(e,t){return this.getNodeTokenRefs(e).get(t)||this.getVariableBindingFast(e,t)}getBorderRadiusTokenFast(e){let t=this.getNodeTokenRefs(e);return t.get("borderRadius")||t.get("cornerRadius")||t.get("radius")||this.getVariableBindingFast(e,"cornerRadius")}getBorderWidthTokenFast(e){let t=this.getNodeTokenRefs(e);return t.get("borderWidth")||t.get("strokeWeight")||this.getVariableBindingFast(e,"strokeWeight")}getEffectTokenFast(e,t){let n=this.getNodeTokenRefs(e);return n.get("boxShadow")||n.get(`effects.${t}`)||n.get(`effects[${t}]`)||n.get("shadow")||this.getVariableBindingFast(e,"effects")}getVariableBindingFast(e,t){try{if(!("boundVariables"in e)||!e.boundVariables)return;let r=e.boundVariables[t];if(r){let o=Array.isArray(r)?r[0]:r;if(o!=null&&o.id){let i=figma.variables.getVariableById(o.id);return i==null?void 0:i.name}}}catch(n){}}cleanTokenReference(e){let t=e.trim();for(;t.startsWith('"')&&t.endsWith('"')||t.startsWith("'")&&t.endsWith("'");)t=t.slice(1,-1);return t=t.replace(/^[{]|[}]$/g,""),t=t.replace(/^\$/,""),t.trim()}buildTokenIndex(e){this.tokenIndex={byPath:new Map,byValue:new Map};let t=n=>{for(let r of n.colors)r.tokenReference&&this.addToIndex(this.tokenIndex.byPath,r.tokenReference.toLowerCase(),n.id),r.hex&&this.addToIndex(this.tokenIndex.byValue,r.hex.toLowerCase(),n.id);for(let r of n.spacing){if(r.tokenReference){let o=r.tokenReference.replace(/^\[\w+\]\s*/,"").toLowerCase();this.addToIndex(this.tokenIndex.byPath,o,n.id)}this.addToIndex(this.tokenIndex.byValue,`${r.value}${r.unit}`,n.id)}for(let r of n.effects)r.tokenReference&&this.addToIndex(this.tokenIndex.byPath,r.tokenReference.toLowerCase(),n.id);for(let r of n.typography)r.tokenReference&&this.addToIndex(this.tokenIndex.byPath,r.tokenReference.toLowerCase(),n.id);if(n.children)for(let r of n.children)t(r)};for(let n of e)t(n)}addToIndex(e,t,n){e.has(t)||e.set(t,new Set),e.get(t).add(n)}getComponentsByTokenPath(e){let t=e.toLowerCase(),n=this.tokenIndex.byPath.get(t);if(n)return Array.from(n);let r=new Set,o=Array.from(this.tokenIndex.byPath.entries());for(let[i,a]of o)(i.includes(t)||t.includes(i))&&a.forEach(s=>r.add(s));return Array.from(r)}getComponentsByTokenValue(e){let t=e.toLowerCase();return Array.from(this.tokenIndex.byValue.get(t)||[])}yieldToMain(){return new Promise(e=>setTimeout(e,0))}getFromCache(e){let t=this.cache.get(e);return t&&Date.now()-t.timestamp<this.cacheMaxAge?t.components:null}rgbaToColor(e,t){let n=Math.round(e.r*255),r=Math.round(e.g*255),o=Math.round(e.b*255),i=`#${[n,r,o].map(s=>s.toString(16).padStart(2,"0")).join("")}`,a=`rgba(${n}, ${r}, ${o}, ${t.toFixed(2)})`;return{hex:i,rgba:a}}parseFontWeight(e){let t={thin:100,extralight:200,light:300,regular:400,medium:500,semibold:600,bold:700,extrabold:800,black:900},n=e.toLowerCase();for(let[o,i]of Object.entries(t))if(n.includes(o))return i;let r=e.match(/(\d+)/);return r?parseInt(r[1],10):400}async scanAllComponents(){this.errors=[];let e=[],t=0,n=figma.root.children;for(let r of n)if(r.type==="PAGE"){let o=r.findAll(i=>i.type==="COMPONENT"||i.type==="COMPONENT_SET");for(let i of o)try{let a=await this.extractComponentPropertiesOptimized(i,r.name,"all",!0,3,0);a&&e.push(a)}catch(a){this.errors.push({componentId:i.id,componentName:i.name,error:a instanceof Error?a.message:"Unknown error"})}}return{components:e,totalComponents:e.length,totalInstances:t,pagesScanned:n.length,errors:this.errors}}async scanFilteredPages(e){this.errors=[];let t=[],n=0,r=figma.root.children,o=e.map(a=>a.toLowerCase().trim()),i=r.filter(a=>a.type==="PAGE"&&o.includes(a.name.toLowerCase().trim()));for(let a of i)if(a.type==="PAGE"){let s=a.findAll(p=>p.type==="COMPONENT"||p.type==="COMPONENT_SET");for(let p of s)try{let f=await this.extractComponentPropertiesOptimized(p,a.name,"all",!0,3,0);f&&t.push(f)}catch(f){this.errors.push({componentId:p.id,componentName:p.name,error:f instanceof Error?f.message:"Unknown error"})}}return{components:t,totalComponents:t.length,totalInstances:n,pagesScanned:i.length,errors:this.errors}}async scanCurrentPage(){this.errors=[];let e=[],t=figma.currentPage,n=t.findAll(r=>r.type==="COMPONENT"||r.type==="COMPONENT_SET");for(let r of n)try{let o=await this.extractComponentPropertiesOptimized(r,t.name,"all",!0,3,0);o&&e.push(o)}catch(o){this.errors.push({componentId:r.id,componentName:r.name,error:o instanceof Error?o.message:"Unknown error"})}return{components:e,totalComponents:e.length,totalInstances:0,pagesScanned:1,errors:this.errors}}async scanNodes(e){this.errors=[];let t=[],n=figma.currentPage;for(let r of e){if("findAll"in r&&typeof r.findAll=="function"){let o=r.findAll(i=>i.type==="COMPONENT"||i.type==="COMPONENT_SET");for(let i of o)try{let a=await this.extractComponentPropertiesOptimized(i,n.name,"all",!0,3,0);a&&t.push(a)}catch(a){this.errors.push({componentId:i.id,componentName:i.name,error:a instanceof Error?a.message:"Unknown error"})}}if(r.type==="COMPONENT"||r.type==="COMPONENT_SET")try{let o=await this.extractComponentPropertiesOptimized(r,n.name,"all",!0,3,0);o&&!t.find(i=>i.id===o.id)&&t.push(o)}catch(o){this.errors.push({componentId:r.id,componentName:r.name,error:o instanceof Error?o.message:"Unknown error"})}}return{components:t,totalComponents:t.length,totalInstances:0,pagesScanned:1,errors:this.errors}}getComponentUsageStats(e){let t=new Set,n=0;for(let r of figma.root.children)if(r.type==="PAGE"){let o=r.findAll(i=>{var a;return i.type==="INSTANCE"&&((a=i.mainComponent)==null?void 0:a.id)===e});o.length>0&&(n+=o.length,t.add(r.name))}return{instances:n,pages:Array.from(t)}}}});var fe,Pe=X(()=>{"use strict";fe=class{constructor(){F(this,"MIN_CONFIDENCE_THRESHOLD",.85)}matchTokenToComponents(e,t){let n=[];for(let r of t.components){let i=this.matchComponentRecursively(e,r).filter(a=>a.confidence>=this.MIN_CONFIDENCE_THRESHOLD);if(i.length>0){let a=i.reduce((s,p)=>s+p.confidence,0)/i.length;n.push({component:r,matches:i,confidence:a})}}return n.sort((r,o)=>o.confidence-r.confidence),{token:e,matchingComponents:n,totalMatches:n.length,totalComponentsScanned:t.totalComponents}}matchComponentRecursively(e,t){let n=[];switch(e.type){case"color":n.push(...this.matchColor(e,t));break;case"fontFamily":case"fontWeight":case"typography":n.push(...this.matchTypography(e,t));break;case"dimension":n.push(...this.matchSpacing(e,t));break;case"shadow":n.push(...this.matchEffects(e,t));break;case"borderRadius":n.push(...this.matchSpacing(e,t,"borderRadius"));break;case"borderWidth":n.push(...this.matchSpacing(e,t,"borderWidth"));break;case"border":n.push(...this.matchBorder(e,t));break;case"composition":n.push(...this.matchComposition(e,t));break;default:n.push(...this.matchByValue(e,t)),this.looksLikeSpacingToken(e)&&n.push(...this.matchSpacing(e,t)),this.looksLikeBorderRadiusToken(e)&&n.push(...this.matchSpacing(e,t,"borderRadius")),this.looksLikeBorderToken(e)&&n.push(...this.matchSpacing(e,t,"borderWidth")),this.looksLikeEffectToken(e)&&n.push(...this.matchEffects(e,t))}if(n.length>0&&t.mainComponentId&&n.forEach(r=>{r.nestedMainComponentId||(r.nestedMainComponentId=t.mainComponentId)}),t.children&&t.children.length>0)for(let r of t.children){let o=this.matchComponentRecursively(e,r);for(let i of o)n.push(Q(Z({},i),{property:`${r.name} \u2192 ${i.property}`}))}return n}matchColor(e,t){let n=[],r=e.path.join("."),o=this.normalizeColor(e.value);for(let s of t.colors)if(s.tokenReference){let p=s.tokenReference.trim();p=p.replace(/^["']|["']$/g,""),p=p.replace(/^[{]|[}]$/g,""),p=p.replace(/^\$/,"");let f=p.toLowerCase(),l=r.toLowerCase();f===l?n.push({property:`${s.type} color (token ref)`,propertyType:"color",matchedValue:`${s.hex} \u2190 ${s.tokenReference}`,tokenValue:r,confidence:1}):(f.endsWith("."+l)||f===l||l.endsWith("."+f)||l===f)&&n.push({property:`${s.type} color (token ref)`,propertyType:"color",matchedValue:`${s.hex} \u2190 ${s.tokenReference}`,tokenValue:r,confidence:.9})}let i=n.filter(s=>s.confidence>=.9);if(i.length>0)return i;let a=this.extractTokenReference(e.value);if(a){let s=a.toLowerCase();for(let p of t.colors)if(p.tokenReference){let l=p.tokenReference.trim().replace(/^["']|["']$/g,"").replace(/^[{]|[}]$/g,"").replace(/^\$/,"").toLowerCase();(l===s||l.endsWith("."+s)||s.endsWith("."+l))&&n.push({property:`${p.type} color (via ${r})`,propertyType:"color",matchedValue:`${p.hex} \u2190 ${p.tokenReference}`,tokenValue:`${r} \u2192 ${e.value}`,confidence:.95})}if(n.length>0)return n}if(o)for(let s of t.colors){let p=this.normalizeColor(s.hex);p&&o===p&&n.push({property:`${s.type} color (value match)`,propertyType:"color",matchedValue:`${s.hex}`,tokenValue:`${r} = ${e.value}`,confidence:.7})}return n}matchTypography(e,t){let n=[],r=e.path.join(".");for(let o of t.typography){let i=0,a="",s="value";if(o.tokenReference){let f=o.tokenReference.replace(/[{}]/g,"").replace(/^\$/,"").toLowerCase().replace(/\./g,"."),l=r.toLowerCase();f===l?(i=1,a=`${o.fontFamily} (ref: ${o.tokenReference})`,s="reference"):(f.includes(l)||l.includes(f))&&(i=.8,a=`${o.fontFamily} (ref: ${o.tokenReference})`,s="reference")}if(i===0){if(e.type==="fontFamily"){let p=String(e.value).toLowerCase().trim(),f=o.fontFamily.toLowerCase().trim();p===f&&(i=.9,a=o.fontFamily)}else if(e.type==="fontWeight"){let p=this.normalizeFontWeight(e.value),f=o.fontWeight;p===f&&(i=.9,a=String(f))}else if(e.type==="typography"&&typeof e.value=="object"&&e.value!==null){let p=e.value,f=this.extractTokenReference(p.fontFamily),l=this.extractTokenReference(p.fontSize),u=this.extractTokenReference(p.fontWeight),h=this.extractTokenReference(p.lineHeight);if(o.tokenReference){let N=o.tokenReference.replace(/[{}]/g,"").replace(/^\$/,"").toLowerCase(),k=[f,l,u,h].filter(Boolean);for(let C of k){if(!C)continue;let S=C.toLowerCase();if(N===S||N.endsWith("."+S)||S.endsWith("."+N)){i=.95,a=`${o.fontFamily} (via ${r})`,s="reference";break}}}if(i===0){let N=!1,k=0,C=[];if(p.fontFamily&&!p.fontFamily.toString().includes("{")){let S=String(p.fontFamily).toLowerCase().trim(),w=o.fontFamily.toLowerCase().trim();S===w&&(N=!0,k+=.4,C.push(`fontFamily: ${o.fontFamily}`))}if(p.fontSize&&!String(p.fontSize).includes("{")){let S=Number(p.fontSize),w=o.fontSize;!isNaN(S)&&Math.abs(S-w)<.5&&(N=!0,k+=.3,C.push(`fontSize: ${w}`))}p.fontWeight&&!String(p.fontWeight).includes("{")&&this.normalizeFontWeight(p.fontWeight)===o.fontWeight&&(N=!0,k+=.3,C.push(`fontWeight: ${o.fontWeight}`)),N&&(i=Math.min(k,1),a=C.join(", "))}}}i>0&&n.push({property:`typography${s==="reference"?" (token ref)":""}`,propertyType:"typography",matchedValue:a,tokenValue:typeof e.value=="object"?JSON.stringify(e.value):String(e.value),confidence:i})}return n}matchSpacing(e,t,n){let r=[],o=e.path.join("."),i=this.normalizeDimension(e.value),a=n?t.spacing.filter(f=>f.type===n):t.spacing;for(let f of a)if(f.tokenReference){let l=f.tokenReference.trim();l=l.replace(/^["']|["']$/g,""),l=l.replace(/^[{]|[}]$/g,""),l=l.replace(/^\$/,""),l=l.replace(/^\[\w+\]\s*/,"");let u=l.toLowerCase(),h=o.toLowerCase(),N=this.formatSpacingType(f.type);u===h?r.push({property:`${N} (token ref)`,propertyType:"spacing",matchedValue:`${f.value}${f.unit} \u2190 ${f.tokenReference}`,tokenValue:o,confidence:1}):(u.endsWith("."+h)||u===h||h.endsWith("."+u)||h===u)&&r.push({property:`${N} (token ref)`,propertyType:"spacing",matchedValue:`${f.value}${f.unit} \u2190 ${f.tokenReference}`,tokenValue:o,confidence:.9})}let s=r.filter(f=>f.confidence>=.9);if(s.length>0)return s;let p=this.extractTokenReference(e.value);if(p){let f=p.toLowerCase();for(let l of a)if(l.tokenReference){let h=l.tokenReference.trim().replace(/^["']|["']$/g,"").replace(/^[{]|[}]$/g,"").replace(/^\$/,"").replace(/^\[\w+\]\s*/,"").toLowerCase(),N=this.formatSpacingType(l.type);(h===f||h.endsWith("."+f)||f.endsWith("."+h))&&r.push({property:`${N} (via ${o})`,propertyType:"spacing",matchedValue:`${l.value}${l.unit} \u2190 ${l.tokenReference}`,tokenValue:`${o} \u2192 ${e.value}`,confidence:.95})}if(r.length>0)return r}if(i!==null){for(let f of a)if(Math.abs(f.value-i)<.5){let l=this.formatSpacingType(f.type);r.push({property:`${l} (value match)`,propertyType:"spacing",matchedValue:`${f.value}${f.unit}`,tokenValue:`${o} = ${e.value}`,confidence:.6})}}return r}formatSpacingType(e){switch(e){case"borderRadius":return"border-radius";case"borderWidth":return"border-width";case"gap":return"gap/spacing";default:return e}}matchEffects(e,t){let n=[],r=e.path.join("."),o=r.toLowerCase();for(let s of t.effects)if(s.tokenReference){let p=s.tokenReference.trim();p=p.replace(/^["']|["']$/g,""),p=p.replace(/^[{]|[}]$/g,""),p=p.replace(/^\$/,"");let f=p.toLowerCase();f===o?n.push({property:`${s.type} (token ref)`,propertyType:"effect",matchedValue:`${s.type} \u2190 ${s.tokenReference}`,tokenValue:r,confidence:1}):(f.endsWith("."+o)||o.endsWith("."+f))&&n.push({property:`${s.type} (token ref)`,propertyType:"effect",matchedValue:`${s.type} \u2190 ${s.tokenReference}`,tokenValue:r,confidence:.9})}if(typeof e.value=="object"&&e.value!==null){let s=e.value;for(let[p,f]of Object.entries(s)){let l=this.extractTokenReference(f);if(!l)continue;let u=l.toLowerCase();for(let h of t.effects)if(h.tokenReference){let k=h.tokenReference.trim().replace(/^["']|["']$/g,"").replace(/^[{]|[}]$/g,"").replace(/^\$/,"").toLowerCase();(k===u||k.endsWith("."+u)||u.endsWith("."+k))&&n.push({property:`${h.type} (via ${r}.${p})`,propertyType:"effect",matchedValue:`${h.type} \u2190 ${h.tokenReference}`,tokenValue:`${r} \u2192 ${p}: ${f}`,confidence:.95})}if(p.toLowerCase().includes("color")){for(let h of t.colors)if(h.tokenReference){let k=h.tokenReference.trim().replace(/^["']|["']$/g,"").replace(/^[{]|[}]$/g,"").replace(/^\$/,"").toLowerCase();(k===u||k.endsWith("."+u)||u.endsWith("."+k))&&n.push({property:`shadow color (via ${r}.${p})`,propertyType:"color",matchedValue:`${h.hex} \u2190 ${h.tokenReference}`,tokenValue:`${r} \u2192 ${p}: ${f}`,confidence:.95})}}}}let i=this.deduplicateMatches(n),a=i.filter(s=>s.confidence>=.9);return a.length>0?a:i}extractTokenReference(e){if(typeof e!="string")return null;let n=e.trim().match(/^[{$]?([^{}$]+)[}]?$/);return n?n[1].trim():null}matchBorder(e,t){let n=[],r=e.path.join("."),o=e.value;if(typeof o=="object"&&o!==null&&("color"in o||"width"in o||"style"in o)){let f=o,l=this.extractTokenReference(f.color),u=this.extractTokenReference(f.width);if(l){let k=l.toLowerCase();for(let C of t.colors.filter(S=>S.type==="stroke"))if(C.tokenReference){let w=C.tokenReference.trim().replace(/^["']|["']$/g,"").replace(/^[{]|[}]$/g,"").replace(/^\$/,"").toLowerCase();(w===k||w.endsWith("."+k)||k.endsWith("."+w))&&n.push({property:`stroke color (via ${r})`,propertyType:"color",matchedValue:`${C.hex} \u2190 ${C.tokenReference}`,tokenValue:`${r} \u2192 color: ${f.color}`,confidence:.95})}}if(u){let k=u.toLowerCase();for(let C of t.spacing.filter(S=>S.type==="borderWidth"))if(C.tokenReference){let w=C.tokenReference.trim().replace(/^["']|["']$/g,"").replace(/^[{]|[}]$/g,"").replace(/^\$/,"").toLowerCase();(w===k||w.endsWith("."+k)||k.endsWith("."+w))&&n.push({property:`border-width (via ${r})`,propertyType:"spacing",matchedValue:`${C.value}${C.unit} \u2190 ${C.tokenReference}`,tokenValue:`${r} \u2192 width: ${f.width}`,confidence:.95})}}let h=n.some(k=>k.property.includes("stroke color")),N=n.some(k=>k.property.includes("border-width"));h&&N&&n.forEach(k=>{k.confidence=Math.min(1,k.confidence+.05),k.property=k.property.replace("(via ","(full match via ")})}let a=r.toLowerCase();for(let f of t.colors.filter(l=>l.type==="stroke"))if(f.tokenReference){let u=f.tokenReference.trim().replace(/^["']|["']$/g,"").replace(/^[{]|[}]$/g,"").replace(/^\$/,"").toLowerCase();u===a?n.push({property:"stroke color (direct border ref)",propertyType:"color",matchedValue:`${f.hex} \u2190 ${f.tokenReference}`,tokenValue:r,confidence:1}):(u.endsWith("."+a)||a.endsWith("."+u))&&n.push({property:"stroke color (direct border ref)",propertyType:"color",matchedValue:`${f.hex} \u2190 ${f.tokenReference}`,tokenValue:r,confidence:.9})}for(let f of t.spacing.filter(l=>l.type==="borderWidth"))if(f.tokenReference){let u=f.tokenReference.trim().replace(/^["']|["']$/g,"").replace(/^[{]|[}]$/g,"").replace(/^\$/,"").toLowerCase();u===a?n.push({property:"border-width (direct ref)",propertyType:"spacing",matchedValue:`${f.value}${f.unit} \u2190 ${f.tokenReference}`,tokenValue:r,confidence:1}):(u.endsWith("."+a)||a.endsWith("."+u))&&n.push({property:"border-width (direct ref)",propertyType:"spacing",matchedValue:`${f.value}${f.unit} \u2190 ${f.tokenReference}`,tokenValue:r,confidence:.9})}this.looksLikeBorderRadiusToken(e)&&n.push(...this.matchSpacing(e,t,"borderRadius")),this.looksLikeBorderToken(e)&&!this.looksLikeBorderRadiusToken(e)&&n.push(...this.matchSpacing(e,t,"borderWidth"));let s=this.deduplicateMatches(n),p=s.filter(f=>f.confidence>=.85);return p.length>0?p:s}matchComposition(e,t){let n=[],r=e.path.join("."),o=e.value;if(typeof o=="object"&&o!==null){let i=o;for(let[a,s]of Object.entries(i)){let p=this.extractTokenReference(s);if(p){let f=p.toLowerCase();for(let l of t.colors)if(l.tokenReference){let h=l.tokenReference.trim().replace(/^["']|["']$/g,"").replace(/^[{]|[}]$/g,"").replace(/^\$/,"").toLowerCase();(h===f||h.endsWith("."+f)||f.endsWith("."+h))&&n.push({property:`${l.type} color (via ${r}.${a})`,propertyType:"color",matchedValue:`${l.hex} \u2190 ${l.tokenReference}`,tokenValue:`${r} \u2192 ${a}: ${s}`,confidence:.95})}for(let l of t.spacing)if(l.tokenReference){let h=l.tokenReference.trim().replace(/^["']|["']$/g,"").replace(/^[{]|[}]$/g,"").replace(/^\$/,"").toLowerCase();(h===f||h.endsWith("."+f)||f.endsWith("."+h))&&n.push({property:`${l.type} (via ${r}.${a})`,propertyType:"spacing",matchedValue:`${l.value}${l.unit} \u2190 ${l.tokenReference}`,tokenValue:`${r} \u2192 ${a}: ${s}`,confidence:.95})}for(let l of t.effects)if(l.tokenReference){let h=l.tokenReference.trim().replace(/^["']|["']$/g,"").replace(/^[{]|[}]$/g,"").replace(/^\$/,"").toLowerCase();(h===f||h.endsWith("."+f)||f.endsWith("."+h))&&n.push({property:`${l.type} (via ${r}.${a})`,propertyType:"effect",matchedValue:`${l.type} \u2190 ${l.tokenReference}`,tokenValue:`${r} \u2192 ${a}: ${s}`,confidence:.95})}}else if(this.looksLikeColor(s))for(let f of t.colors){let l=this.normalizeColor(s),u=this.normalizeColor(f.hex);l===u&&n.push({property:`${f.type} color (composition.${a} literal)`,propertyType:"color",matchedValue:`${f.hex}`,tokenValue:`${r}.${a}`,confidence:.7})}}}for(let i of t.spacing)if(i.tokenReference){let s=i.tokenReference.trim().replace(/^["']|["']$/g,"").replace(/^[{]|[}]$/g,"").replace(/^\$/,"").toLowerCase(),p=r.toLowerCase();s===p?n.push({property:`${i.type} (composition token ref)`,propertyType:"spacing",matchedValue:`${i.value}${i.unit} \u2190 ${i.tokenReference}`,tokenValue:r,confidence:1}):(s.endsWith("."+p)||p.endsWith("."+s))&&n.push({property:`${i.type} (composition token ref)`,propertyType:"spacing",matchedValue:`${i.value}${i.unit} \u2190 ${i.tokenReference}`,tokenValue:r,confidence:.9})}for(let i of t.colors)if(i.tokenReference){let s=i.tokenReference.trim().replace(/^["']|["']$/g,"").replace(/^[{]|[}]$/g,"").replace(/^\$/,"").toLowerCase(),p=r.toLowerCase();s===p?n.push({property:`${i.type} color (composition token ref)`,propertyType:"color",matchedValue:`${i.hex} \u2190 ${i.tokenReference}`,tokenValue:r,confidence:1}):(s.endsWith("."+p)||p.endsWith("."+s))&&n.push({property:`${i.type} color (composition token ref)`,propertyType:"color",matchedValue:`${i.hex} \u2190 ${i.tokenReference}`,tokenValue:r,confidence:.9})}return this.deduplicateMatches(n)}deduplicateMatches(e){let t=new Set;return e.filter(n=>{let r=`${n.property}|${n.matchedValue}`;return t.has(r)?!1:(t.add(r),!0)})}matchByValue(e,t){let n=[];return this.looksLikeColor(e.value)&&n.push(...this.matchColor(e,t)),this.looksLikeDimension(e.value)&&n.push(...this.matchSpacing(e,t)),n}normalizeColor(e){if(typeof e!="string")return null;let t=e.trim().toLowerCase();return t.match(/^#[0-9a-f]{3,8}$/)||t.match(/^rgba?\(/)||t.match(/^hsla?\(/)?t:null}normalizeHex(e){if(!e)return null;let t=e.trim().toLowerCase().replace("#","");return t.length===3&&(t=t.split("").map(n=>n+n).join("")),t.length===6?t:null}normalizeRgba(e){if(!e)return null;let t=e.match(/rgba?\(([^)]+)\)/i);return t?t[1].trim():null}parseRgba(e){let t=this.normalizeRgba(e);if(!t)return null;let n=t.split(",").map(r=>parseFloat(r.trim()));return n.length>=3?{r:n[0],g:n[1],b:n[2],a:n.length>3?n[3]:1}:null}rgbaToString(e){return`rgba(${Math.round(e.r)}, ${Math.round(e.g)}, ${Math.round(e.b)}, ${e.a.toFixed(2)})`}colorsMatch(e,t){let n=this.parseRgba(e),r=this.parseRgba(t);if(n&&r)return Math.abs(n.r-r.r)<2&&Math.abs(n.g-r.g)<2&&Math.abs(n.b-r.b)<2&&Math.abs(n.a-r.a)<.01;let o=this.normalizeHex(e),i=this.normalizeHex(t);return o!==null&&i!==null&&o===i}normalizeFontWeight(e){if(typeof e=="number")return e;if(typeof e!="string")return 400;let t={thin:100,extralight:200,light:300,regular:400,normal:400,medium:500,semibold:600,bold:700,extrabold:800,black:900},n=e.toLowerCase().trim();if(t[n])return t[n];let r=parseInt(e,10);return isNaN(r)?400:r}normalizeDimension(e){if(typeof e=="number")return e;if(typeof e!="string")return null;let t=e.replace(/px|rem|em|pt|pc|in|cm|mm|q|vh|vw|vmin|vmax|%/g,"").trim(),n=parseFloat(t);return isNaN(n)?null:n}looksLikeColor(e){if(typeof e!="string")return!1;let t=e.trim().toLowerCase();return t.match(/^#[0-9a-f]{3,8}$/)!==null||t.match(/^rgba?\(/)!==null||t.match(/^hsla?\(/)!==null}looksLikeDimension(e){return typeof e=="number"?!0:typeof e!="string"?!1:/^-?\d+(\.\d+)?(px|rem|em|pt|pc|in|cm|mm|q|vh|vw|vmin|vmax|%)$/.test(e.trim())}looksLikeSpacingToken(e){let t=e.path.join(".").toLowerCase();return["spacing","space","size","sizing","dimension","width","height","padding","margin","gap","radius","border","inset","offset","corner","round","stroke","weight","1x","2x","3x","4x","5x","6x","8x","10x","12x","16x"].some(r=>t.includes(r))}looksLikeBorderRadiusToken(e){let t=e.path.join(".").toLowerCase();return["radius","corner","round","rounded","borderradius"].some(r=>t.includes(r))}looksLikeBorderToken(e){let t=e.path.join(".").toLowerCase(),n=["border","stroke","outline","line"];return t.includes("radius")?!1:n.some(r=>t.includes(r))}looksLikeEffectToken(e){let t=e.path.join(".").toLowerCase();return["shadow","effect","blur","elevation","drop"].some(r=>t.includes(r))}}});function _(b,e){let t=`${Se}`;return Se+=1,re[t]={handler:e,name:b},function(){delete re[t]}}function $e(b,e){let t=!1;for(let n in re)re[n].name===b&&(re[n].handler.apply(null,e),t=!0);if(t===!1)throw new Error(`No event handler with name \`${b}\``)}var re,Se,T,Ee=X(()=>{re={},Se=0;T=typeof window=="undefined"?function(b,...e){figma.ui.postMessage([b,...e])}:function(b,...e){window.parent.postMessage({pluginMessage:[b,...e]},"*")};typeof window=="undefined"?figma.ui.onmessage=function(b){if(!Array.isArray(b))return;let[e,...t]=b;typeof e=="string"&&$e(e,t)}:window.onmessage=function(b){if(typeof b.data.pluginMessage=="undefined")return;let e=b.data.pluginMessage;if(!Array.isArray(e))return;let[t,...n]=b.data.pluginMessage;typeof t=="string"&&$e(t,n)}});function ye(b,e){if(typeof __html__=="undefined")throw new Error("No UI defined");let t=`<div id="create-figma-plugin"></div><script>document.body.classList.add('theme-${figma.editorType}');const __FIGMA_COMMAND__='${typeof figma.command=="undefined"?"":figma.command}';const __SHOW_UI_DATA__=${JSON.stringify(typeof e=="undefined"?{}:e)};${__html__}</script>`;figma.showUI(t,Q(Z({},b),{themeColors:typeof b.themeColors=="undefined"?!0:b.themeColors}))}var xe=X(()=>{});var Ae=X(()=>{Ee();xe()});var Oe={};Ke(Oe,{default:()=>qe});function qe(){ye({width:400,height:550},{resizable:!0}),figma.loadAllPagesAsync().catch(d=>{console.error("Error loading pages on startup:",d)});let b=new ae,e=new le,t=new pe,n=new fe,r=!0,o=null;function i(){let d=figma.root.children.filter(m=>m.type==="PAGE").map(m=>m.id).join(",");if(o===null)return o=d,!1;let c=d!==o;return o=d,c}async function a(){i()&&(console.log("[Cache] Document changed, clearing component cache"),await t.clearCache())}let s=10*60*1e3;function p(d,c,m,g){return`tokenCache_${d}_${c}_${m}_${g||"root"}`}async function f(d){try{let c=await figma.clientStorage.getAsync(d);if(c&&c.sha&&c.tokens&&Date.now()-c.timestamp<s)return c}catch(c){console.error("Error reading token cache:",c)}return null}async function l(d,c,m,g){try{let R={sha:c,tokens:m,metadata:g,timestamp:Date.now()};await figma.clientStorage.setAsync(d,R)}catch(R){console.error("Error saving token cache:",R)}}async function u(d){try{await figma.clientStorage.deleteAsync(d)}catch(c){console.error("Error clearing token cache:",c)}}async function h(){try{return await figma.clientStorage.getAsync("repoConfig")||null}catch(d){return console.error("Error loading config:",d),null}}async function N(d){try{await figma.clientStorage.setAsync("repoConfig",d)}catch(c){console.error("Error saving config:",c)}}async function k(){try{await figma.clientStorage.deleteAsync("repoConfig")}catch(d){console.error("Error clearing config:",d)}}_("load-config",async()=>{let d=await h();T("config-loaded",d)}),_("clear-config",async()=>{await k(),T("config-loaded",null)}),_("test-connection",async d=>{let c=b.parseGitHubUrl(d.repoUrl);if(!c){T("connection-result",{success:!1,error:"Invalid GitHub URL format"});return}try{T("connection-progress",{message:"Connecting to GitHub..."});let m=await b.fetchBranches(c.owner,c.repo,d.token),g=0,R=[];if(m.length>0)try{let $=m[0];T("connection-progress",{message:"Scanning for token files..."});let y=await b.detectTokenFiles(c.owner,c.repo,$,d.token,d.filePath||"");g=y.length,R=y.slice(0,5)}catch($){console.error("Token detection failed:",$)}T("connection-result",{success:!0,branches:m.slice(0,10),owner:c.owner,repo:c.repo,fileCount:g,tokenCount:g,sampleFiles:R.map($=>$.length>50?$.substring(0,47)+"...":$)})}catch(m){T("connection-result",{success:!1,error:m instanceof Error?m.message:"Connection failed"})}}),_("save-config",async d=>{await N(d),T("config-saved",{success:!0})});let C=/^#[0-9A-Fa-f]{3,8}$/,S=/^rgba?\(/,w=/^hsla?\(/,H=/^\d+(\.\d+)?(ms|s)$/,oe=/^-?\d+(\.\d+)?(px|rem|em|pt|pc|in|cm|mm|q|vh|vw|vmin|vmax|%)$/,ee=/\d+x$/,te=(d,c)=>{if(typeof d=="string")return C.test(d)||S.test(d)||w.test(d)||c.includes("color")||c.includes("colour")?"color":H.test(d)||c.includes("duration")?"duration":c.includes("radius")||c.includes("corner")||c.includes("rounded")||c.includes("borderradius")?"borderRadius":c.includes("border")&&(c.includes("width")||c.includes("weight"))||c.includes("stroke")&&c.includes("weight")?"borderWidth":oe.test(d)||c.includes("size")||c.includes("spacing")||c.includes("space")||c.includes("gap")||c.includes("padding")||c.includes("margin")||c.includes("sizing")||c.includes("dimension")||ee.test(c)?"dimension":c.includes("font")||c.includes("typography")||c.includes("text")?c.includes("weight")?"fontWeight":c.includes("family")?"fontFamily":"typography":c.includes("shadow")||c.includes("elevation")?"shadow":c.includes("border")&&!c.includes("radius")?"border":"string";if(typeof d=="number")return c.includes("radius")||c.includes("corner")||c.includes("rounded")?"borderRadius":c.includes("border")&&c.includes("width")||c.includes("stroke")&&c.includes("weight")?"borderWidth":c.includes("weight")&&c.includes("font")?"fontWeight":c.includes("opacity")||c.includes("alpha")||c.includes("z-index")||c.includes("zindex")?"number":c.includes("spacing")||c.includes("space")||c.includes("gap")||c.includes("padding")||c.includes("margin")||c.includes("size")||ee.test(c)?"dimension":"number";if(typeof d=="object"&&d!==null&&!Array.isArray(d)){let m=Object.keys(d).map(g=>g.toLowerCase());if(c.includes("shadow")||c.includes("elevation")||m.some(g=>["blur","spread","offsetx","offsety"].includes(g)))return"shadow";if(c.includes("typography")||m.some(g=>["fontfamily","fontsize","fontweight","lineheight"].includes(g)))return"typography";if(c.includes("border")||m.includes("width")&&(m.includes("color")||m.includes("style"))||m.includes("color")&&m.includes("style"))return"border"}return"string"},Ie=d=>d&&typeof d=="object"&&"$value"in d,Le=d=>{if(!d||typeof d!="object"||"$value"in d||!("value"in d))return!1;let c=d.value;if(typeof c=="string"||typeof c=="number"||typeof c=="boolean")return!0;if(typeof c=="object"&&c!==null){if("type"in d||"description"in d)return!0;let m=Object.keys(c);if(m.some(g=>["color","width","style"].includes(g.toLowerCase()))&&m.filter(R=>["color","width","style","bordercolor","borderwidth","borderstyle"].includes(R.toLowerCase())).length>=2||m.some(g=>["fontfamily","fontsize","fontweight","lineheight","letterspacing"].includes(g.toLowerCase()))||m.some(g=>["blur","spread","offsetx","offsety","x","y"].includes(g.toLowerCase()))&&m.some(g=>g.toLowerCase()==="color")||m.length<=6&&m.length>=2&&m.some(R=>{let $=c[R];return typeof $=="string"&&($.startsWith("{")||$.startsWith("$"))}))return!0}return!1},Fe=(d,c)=>{if(!d||typeof d!="object"||Array.isArray(d)||"$value"in d||"value"in d)return!1;let g=Object.keys(d).map(L=>L.toLowerCase()),R=["fontfamily","fontsize","fontweight","lineheight","letterspacing","texttransform","textdecoration"];return!!(g.filter(L=>R.includes(L)).length>=2||g.includes("color")&&(g.includes("width")||g.includes("style"))||g.some(L=>["blur","spread"].includes(L))&&g.includes("color")&&g.some(L=>["x","y","offsetx","offsety"].includes(L)))},We=(d,c)=>!(typeof d!="string"&&typeof d!="number"&&typeof d!="boolean"||c.length<1),De=(d,c)=>{let m=[],g=[],R=(y,x)=>{let L=g[g.length-1]||"unnamed",O=g.join(".").toLowerCase(),I=x||te(y,O);m.push({name:L,path:g.slice(),type:I,sourceFile:c,value:y})},$=y=>{if(y==null)return;let x=g[g.length-1]||"";if(!(x.startsWith("$")&&x!=="$value"&&x!=="$type")){if(Ie(y)){R(y.$value,y.$type);return}if(Le(y)){R(y.value,y.type);return}if(We(y,g)){R(y,void 0);return}if(Fe(y,g)){R(y,void 0);return}if(typeof y=="object"){let L=Array.isArray(y)?y.map((O,I)=>String(I)):Object.keys(y);for(let O of L){if(!Array.isArray(y)&&(O.startsWith("$")||O==="extensions"))continue;let I=Array.isArray(y)?y[parseInt(O)]:y[O];g.push(O),$(I),g.pop()}}}};return $(d),m},de=5,ne=100;_("fetch-tokens",async d=>{let c=b.parseGitHubUrl(d.repoUrl);if(!c){T("tokens-result",{success:!1,error:"Invalid GitHub URL format"});return}try{let m=d.filePath||"",g=p(c.owner,c.repo,d.branch,m);if(!d.forceRefresh){T("tokens-progress",{message:"Checking for cached tokens..."});let[M,z]=await Promise.all([b.getLatestCommitSha(c.owner,c.repo,d.branch,d.token),f(g)]);if(z&&M&&z.sha===M){T("tokens-progress",{message:"Using cached tokens (no changes detected)"});let P=z.tokens;for(let v=0;v<P.length;v+=ne){let E=P.slice(v,v+ne),W=v+ne>=P.length;T("tokens-chunk",{tokens:E,chunkIndex:Math.floor(v/ne),totalChunks:Math.ceil(P.length/ne),isLast:W})}T("tokens-result",{success:!0,tokens:P,metadata:Q(Z({},z.metadata),{fromCache:!0,cacheAge:Date.now()-z.timestamp,errors:[]})});return}}T("tokens-progress",{message:"Scanning for token files..."});let R=await b.detectTokenFiles(c.owner,c.repo,d.branch,d.token,m);if(R.length===0){T("tokens-result",{success:!1,error:`No token files found${m?` in '${m}'`:" in repository"}. Looking for .json files (excluding config files).`});return}let $=[],y=[],x=0,L=0,O=[],I=[];T("tokens-progress",{message:`Fetching ${R.length} files...`});for(let M=0;M<R.length;M+=de){let z=R.slice(M,M+de),P=Math.min(M+de,R.length);T("tokens-progress",{message:`Fetching files ${M+1}-${P} of ${R.length}...`});let v=await Promise.all(z.map(async E=>{try{let W=await b.fetchFileContents(c.owner,c.repo,d.branch,d.token,E);if(!W.content)return{path:E,error:"Empty file content"};let D=b.decodeBase64Content(W.content);return{path:E,content:D}}catch(W){return{path:E,error:W instanceof Error?W.message:"Fetch failed"}}}));for(let E of v)"content"in E&&E.content?I.push({path:E.path,content:E.content}):"error"in E&&(y.push({file:E.path,message:E.error}),O.push({file:E.path,count:0}))}T("tokens-progress",{message:`Processing ${I.length} files...`});let V=[],j=0;for(let{path:M,content:z}of I)try{let P;try{P=JSON.parse(z)}catch(W){throw new Error(`JSON parse failed: ${W.message}`)}let v=De(P,M),E=v.length;L+=E,O.push({file:M,count:E}),E===0&&y.push({file:M,message:"No token values found in this file (checked $value, value, and primitives)"});for(let W of v){let D={name:W.name||"",path:W.path||"",type:W.type||"unknown",sourceFile:W.sourceFile||"",value:W.value};$.push(D),V.push(D),V.length>=ne&&(T("tokens-chunk",{tokens:V,chunkIndex:j++,isLast:!1}),V=[])}x++}catch(P){console.error(`Failed to parse ${M}:`,P),O.push({file:M,count:0}),y.push({file:M,message:P instanceof Error?P.message:"Failed to parse file"})}V.length>0&&T("tokens-chunk",{tokens:V,chunkIndex:j++,isLast:!0}),T("tokens-progress",{message:`Found ${L} tokens in ${x} files`});let q=await b.getLatestCommitSha(c.owner,c.repo,d.branch,d.token);q&&await l(g,q,$,{totalTokens:L,filesProcessed:x,totalFiles:R.length,perFileCounts:O}),T("tokens-result",{success:!0,tokens:$,metadata:{totalTokens:L,filesProcessed:x,totalFiles:R.length,perFileCounts:O,errors:y,fromCache:!1}})}catch(m){T("tokens-result",{success:!1,error:m instanceof Error?m.message:"Failed to fetch tokens"})}}),_("detect-token-files",async d=>{let c=b.parseGitHubUrl(d.repoUrl);if(!c){T("token-files-result",{success:!1,error:"Invalid GitHub URL format"});return}try{let m=await b.detectTokenFiles(c.owner,c.repo,d.branch,d.token,d.directoryPath||"");T("token-files-result",{success:!0,files:m})}catch(m){T("token-files-result",{success:!1,error:m instanceof Error?m.message:"Failed to detect token files"})}}),_("scan-components",async d=>{try{let c=d.scanAll===!0;c?(T("scan-progress",{message:"Loading all pages..."}),await figma.loadAllPagesAsync(),T("scan-progress",{message:"Scanning all pages..."})):T("scan-progress",{message:"Scanning current page..."});let m=c?await e.scanAllComponents():await e.scanCurrentPage();T("scan-result",{success:!0,result:m})}catch(c){T("scan-result",{success:!1,error:c instanceof Error?c.message:"Failed to scan components"})}}),_("scan-components-for-token",async d=>{try{let{token:c,scanAll:m,scanSelection:g,pageFilter:R}=d,$=m===!0,y=g===!0,x=R&&R.length>0;if(!c){T("scan-result",{success:!1,error:"No token provided"});return}await a();let L=c.type||"all",O="Scanning for token matches...";$?(O=x?`Loading ${R.length} page(s)...`:"Loading all pages...",T("scan-progress",{message:O}),await figma.loadAllPagesAsync(),O=x?`Scanning ${R.join(", ")} for token matches...`:"Scanning all pages for token matches..."):y?O="Scanning selection for token matches...":O="Scanning current page for token matches...",T("scan-progress",{message:O});let I;if(r&&$){T("scan-progress",{message:"Scanning components (optimized)..."});let P={tokenType:L,useCache:!0,usePersistentCache:!0,chunkSize:100,maxDepth:3,includeChildren:!0,pageFilter:x?R:void 0,onProgress:v=>{let E=Math.round(v.currentPage/v.totalPages*100);T("scan-progress",{message:`Page ${v.currentPage}/${v.totalPages}: ${v.currentPageName} (${v.componentsFound} found)`,progress:E})}};I=await t.scanAllComponentsOptimized(P)}else if(T("scan-progress",{message:"Scanning components..."}),$)x?I=await e.scanFilteredPages(R):I=await e.scanAllComponents();else if(y){let P=figma.currentPage.selection;if(P.length===0){T("scan-result",{success:!1,error:"No selection found. Please select a frame or node to scan."});return}I=await e.scanNodes(P)}else I=await e.scanCurrentPage();T("scan-progress",{message:`Found ${I.totalComponents} components. Matching tokens...`});let V=n.matchTokenToComponents(c,I);T("scan-progress",{message:"Filtering nested duplicates..."});let j=P=>{if(!P.includes(" \u2192 "))return!0;let v=P.split(" \u2192 ");return v.length===2&&v[0].includes("=")?!0:(v.length>2,!1)},q=new Set;for(let P of V.matchingComponents)P.matches.some(E=>j(E.property))&&P.component.mainComponentId&&q.add(P.component.mainComponentId);let M=V.matchingComponents.filter(P=>P.matches.some(E=>j(E.property))?!0:P.matches.some(E=>j(E.property)?!1:!E.nestedMainComponentId||!q.has(E.nestedMainComponentId)));T("scan-progress",{message:"Matching complete!"});let z={token:{name:c.name,path:c.path,type:c.type,value:c.value},matchingComponents:M.map(P=>({id:P.component.id,name:P.component.name,page:P.component.pageName,type:P.component.type,mainComponentName:P.component.mainComponentName,mainComponentId:P.component.mainComponentId,variantName:P.component.variantName,matches:P.matches.map(v=>`${v.property}: ${v.matchedValue}`),matchDetails:P.matches,confidence:P.confidence})),totalMatches:M.length,totalComponentsScanned:V.totalComponentsScanned};T("scan-result",{success:!0,result:z})}catch(c){T("scan-result",{success:!1,error:c instanceof Error?c.message:"Failed to scan components for token"})}}),_("get-component-usage",async d=>{try{let{componentId:c}=d,m=e.getComponentUsageStats(c);T("component-usage-result",{success:!0,stats:m})}catch(c){T("component-usage-result",{success:!1,error:c instanceof Error?c.message:"Failed to get usage stats"})}}),_("navigate-to-component",async d=>{try{let{componentId:c}=d,m=await figma.getNodeByIdAsync(c);if(m&&"type"in m){let g=Ve(m);g&&g.type==="PAGE"&&g!==figma.currentPage&&await figma.setCurrentPageAsync(g),m.type!=="DOCUMENT"&&m.type!=="PAGE"?(figma.currentPage.selection=[m],figma.viewport.scrollAndZoomIntoView([m]),T("navigate-result",{success:!0})):T("navigate-result",{success:!1,error:"Cannot select document or page nodes"})}else T("navigate-result",{success:!1,error:"Node not found"})}catch(c){T("navigate-result",{success:!1,error:c instanceof Error?c.message:"Failed to navigate to component"})}});function Ve(d){let c=d;for(;c&&c.type!=="PAGE";)c=c.parent;return c}async function Ze(d){let c=await figma.getNodeByIdAsync(d);if(!c)return null;if(c.type==="COMPONENT_SET"){let m=c,g=m.defaultVariant||m.children[0];if((g==null?void 0:g.type)==="COMPONENT")return g}return c.type==="COMPONENT"?c:c.type==="INSTANCE"?await c.getMainComponentAsync():null}_("create-component-collection",async d=>{try{let{token:c,groupedComponents:m,matchingComponents:g}=d,R=Object.entries(m||{});if(R.length===0&&(!g||g.length===0)){T("create-collection-result",{success:!1,error:"No components to collect"});return}let $=Array.isArray(c.path)?c.path.join("."):c.name,y=figma.createFrame();y.name=`Token Matches: ${$}`,y.layoutMode="VERTICAL",y.primaryAxisSizingMode="AUTO",y.counterAxisSizingMode="AUTO",y.paddingTop=32,y.paddingBottom=32,y.paddingLeft=32,y.paddingRight=32,y.itemSpacing=24,y.fills=[{type:"SOLID",color:{r:.95,g:.95,b:.95}}],y.cornerRadius=8;let x=figma.createText();await figma.loadFontAsync({family:"Inter",style:"Bold"}),await figma.loadFontAsync({family:"Inter",style:"Regular"}),x.fontName={family:"Inter",style:"Bold"},x.characters=`Token: ${$}`,x.fontSize=18,x.fills=[{type:"SOLID",color:{r:.1,g:.1,b:.1}}],y.appendChild(x);let L=R.length,O=(g==null?void 0:g.length)||0,I=figma.createText();I.fontName={family:"Inter",style:"Regular"},I.characters=`${L} component${L!==1?"s":""}${O>L?` (${O} variants total)`:""}`,I.fontSize=12,I.fills=[{type:"SOLID",color:{r:.4,g:.4,b:.4}}],y.appendChild(I);let V=figma.createFrame();V.name="Components List",V.layoutMode="VERTICAL",V.primaryAxisSizingMode="AUTO",V.counterAxisSizingMode="AUTO",V.itemSpacing=16,V.fills=[],y.appendChild(V);let j=0;for(let[M,z]of R){let P=z.length;try{let v=figma.createFrame();v.name=M,v.layoutMode="VERTICAL",v.primaryAxisSizingMode="AUTO",v.counterAxisSizingMode="AUTO",v.paddingTop=16,v.paddingBottom=16,v.paddingLeft=16,v.paddingRight=16,v.itemSpacing=8,v.fills=[{type:"SOLID",color:{r:1,g:1,b:1}}],v.strokes=[{type:"SOLID",color:{r:.85,g:.85,b:.85}}],v.strokeWeight=1,v.cornerRadius=6;let E=figma.createText();E.fontName={family:"Inter",style:"Bold"},E.characters=M,E.fontSize=12,E.fills=[{type:"SOLID",color:{r:.1,g:.1,b:.1}}],v.appendChild(E);let W=z[0];if(W!=null&&W.matchDetails&&W.matchDetails.length>0){let U=W.matchDetails[0],G=figma.createText();G.fontName={family:"Inter",style:"Regular"};let A="";if(U.matchedValue){let Y=U.matchedValue.match(/^([^]+)/);Y&&(A=Y[1].trim())}let K=U.property.replace(/\s*\([^)]*\)\s*/g,"").trim(),B=A?`${A} \u2192 ${K}`:K;P>1&&(B+=` (${P} variants)`),G.characters=B,G.fontSize=10,G.fills=[{type:"SOLID",color:{r:.5,g:.5,b:.5}}],v.appendChild(G)}let D=figma.createFrame();D.name="Variants",D.layoutMode="HORIZONTAL",D.layoutWrap="WRAP",D.primaryAxisSizingMode="AUTO",D.counterAxisSizingMode="AUTO",D.paddingTop=60,D.paddingBottom=60,D.paddingLeft=60,D.paddingRight=60,D.itemSpacing=20,D.counterAxisSpacing=20,D.fills=[],D.clipsContent=!1,v.appendChild(D);let ue=0,J=new Set,ge=new Set;for(let U of z){if(U.matchDetails&&U.matchDetails.length>0)for(let G of U.matchDetails){let A=G.property.split(" \u2192 ");A.length>0&&A[0].includes("=")&&ge.add(A[0].trim())}U.variantName&&ge.add(U.variantName)}let Ce=z[0];if(!Ce)continue;try{let U=await figma.getNodeByIdAsync(Ce.id);if(!U)continue;if(U.type==="COMPONENT_SET"){let G=U;for(let A of Array.from(ge)){if(J.has(A))continue;J.add(A);let K=null;for(let B of G.children)if(B.type==="COMPONENT"&&B.name===A){K=B;break}if(K){let B=K.createInstance();D.appendChild(B),ue++}}}else for(let G of z)try{let A=await figma.getNodeByIdAsync(G.id);if(!A)continue;let K=null,B=G.name;if(A.type==="INSTANCE"){let Y=A;try{let he=await Y.getMainComponentAsync();he&&(B=he.name)}catch(he){}if(J.has(B))continue;J.add(B),K=Y.clone()}else if(A.type==="COMPONENT"){let Y=A;if(B=Y.name,J.has(B))continue;J.add(B),K=Y.createInstance()}else if(A.type==="FRAME"||A.type==="GROUP"||A.type==="RECTANGLE"||A.type==="ELLIPSE"||A.type==="LINE"||A.type==="TEXT"||A.type==="VECTOR"||A.type==="POLYGON"||A.type==="STAR"){if(J.has(B))continue;J.add(B),K=A.clone()}K&&(D.appendChild(K),ue++)}catch(A){console.error(`Failed to create instance for variant ${G.id}:`,A)}}catch(U){console.error(`Failed to process component ${M}:`,U)}ue>0?(V.appendChild(v),j++):v.remove()}catch(v){console.error(`Failed to create card for ${M}:`,v)}}let q=figma.viewport;y.x=q.center.x-y.width/2,y.y=q.center.y-y.height/2,figma.currentPage.appendChild(y),figma.currentPage.selection=[y],figma.viewport.scrollAndZoomIntoView([y]),figma.notify(`Created collection with ${j} component${j!==1?"s":""}`),T("create-collection-result",{success:!0,count:j,frameId:y.id})}catch(c){console.error("Failed to create component collection:",c),T("create-collection-result",{success:!1,error:c instanceof Error?c.message:"Failed to create collection"})}}),_("cancel",()=>{figma.closePlugin()}),_("resize-window",d=>{figma.ui.resize(d.width,d.height)});function ze(d){let c={nodeId:d.id,nodeName:d.name,nodeType:d.type,pluginData:{},sharedPluginData:{}};try{let g=d.getPluginDataKeys();for(let R of g)c.pluginData[R]=d.getPluginData(R)}catch(g){console.error("Error getting plugin data keys:",g)}let m=["tokens","tokens-studio","tokensStudio","figma-tokens","design-tokens","token-studio","com.tokens.studio","tokens.studio","io.tokens.studio","figmatokens","style-dictionary","ds","design-system","theme","variables"];for(let g of m)try{let R=d.getSharedPluginDataKeys(g);if(R.length>0){c.sharedPluginData[g]={};for(let $ of R){let y=d.getSharedPluginData(g,$);c.sharedPluginData[g][$]=y}}}catch(R){}try{if("boundVariables"in d&&d.boundVariables){c.boundVariables={};let g=d.boundVariables;for(let[R,$]of Object.entries(g))if($){if(Array.isArray($))c.boundVariables[R]=$.map(y=>{try{let x=figma.variables.getVariableById(y.id);return{id:y.id,name:x==null?void 0:x.name,resolvedType:x==null?void 0:x.resolvedType,valuesByMode:x==null?void 0:x.valuesByMode}}catch(x){return{id:y.id,error:"Could not resolve variable"}}});else if($.id)try{let y=figma.variables.getVariableById($.id);c.boundVariables[R]={id:$.id,name:y==null?void 0:y.name,resolvedType:y==null?void 0:y.resolvedType,valuesByMode:y==null?void 0:y.valuesByMode}}catch(y){c.boundVariables[R]={id:$.id,error:"Could not resolve variable"}}}}}catch(g){console.error("Error getting bound variables:",g)}return c}function ke(d,c=3,m=0){let g=[],R=ze(d),$=Object.keys(R.pluginData).length>0||Object.keys(R.sharedPluginData).length>0||R.boundVariables&&Object.keys(R.boundVariables).length>0;if(g.push(Q(Z({},R),{pluginData:$?R.pluginData:{_noData:"true"}})),m<c&&"children"in d)for(let y of d.children)g.push(...ke(y,c,m+1));return g}_("inspect-selection",async()=>{try{let d=figma.currentPage.selection;if(d.length===0){T("inspect-result",{success:!1,error:"No selection. Please select a node to inspect."});return}T("inspect-progress",{message:"Inspecting plugin data..."});let c=[];for(let g of d){let R=ke(g,3);c.push(...R)}let m=c.filter(g=>!g.pluginData._noData&&(Object.keys(g.pluginData).length>0||Object.keys(g.sharedPluginData).length>0||g.boundVariables&&Object.keys(g.boundVariables).length>0));c.forEach(g=>{g.pluginData._noData&&(g.pluginData={})}),T("inspect-result",{success:!0,results:c,summary:{totalNodesInspected:c.length,nodesWithPluginData:m.length,namespacesFound:Array.from(new Set(m.flatMap(g=>Object.keys(g.sharedPluginData)))),pluginDataKeysFound:Array.from(new Set(m.flatMap(g=>Object.keys(g.pluginData)))),hasVariableBindings:m.some(g=>g.boundVariables&&Object.keys(g.boundVariables).length>0)}})}catch(d){T("inspect-result",{success:!1,error:d instanceof Error?d.message:"Failed to inspect selection"})}})}var Me=X(()=>{"use strict";Ne();we();ve();Pe();Ae()});var Je={"src/main.ts--default":(Me(),Xe(Oe)).default},Ye="src/main.ts--default";Je[Ye]();
