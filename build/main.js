var ie=Object.defineProperty,_e=Object.defineProperties,ze=Object.getOwnPropertyDescriptor,Ue=Object.getOwnPropertyDescriptors,Ge=Object.getOwnPropertyNames,be=Object.getOwnPropertySymbols;var Ne=Object.prototype.hasOwnProperty,He=Object.prototype.propertyIsEnumerable;var me=(y,e,t)=>e in y?ie(y,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):y[e]=t,Z=(y,e)=>{for(var t in e||(e={}))Ne.call(e,t)&&me(y,t,e[t]);if(be)for(var t of be(e))He.call(e,t)&&me(y,t,e[t]);return y},Q=(y,e)=>_e(y,Ue(e));var X=(y,e)=>()=>(y&&(e=y(y=0)),e);var Ke=(y,e)=>{for(var t in e)ie(y,t,{get:e[t],enumerable:!0})},je=(y,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of Ge(e))!Ne.call(y,r)&&r!==t&&ie(y,r,{get:()=>e[r],enumerable:!(n=ze(e,r))||n.enumerable});return y};var Xe=y=>je(ie({},"__esModule",{value:!0}),y);var F=(y,e,t)=>me(y,typeof e!="symbol"?e+"":e,t);var se,Pe=X(()=>{"use strict";se=class{constructor(){F(this,"tokens",[]);F(this,"errors",[]);F(this,"tokenMap",new Map)}parse(e,t=""){return this.tokens=[],this.errors=[],this.tokenMap=new Map,this.collectTokens(e,[]),this.resolveAliases(),this.validateTokens(),{tokens:this.tokens,metadata:{filePath:t,format:"auto-detected",errors:this.errors}}}collectTokens(e,t){if(e==null)return;let n=t[t.length-1]||"";if(!(n.startsWith("$")&&n!=="$value"&&n!=="$type")){if(this.isW3CToken(e)){this.addToken(e.$value,e.$type,e.$description,e.$extensions,t);return}if(this.isTokenStudioToken(e)){this.addToken(e.value,e.type,e.description,e.extensions,t);return}if(this.isPrimitiveToken(e,t)){this.addToken(e,void 0,void 0,void 0,t);return}if(typeof e=="object"){let r=Array.isArray(e)?e.map((o,i)=>String(i)):Object.keys(e);for(let o of r){if(o.startsWith("$")||o==="extensions"||o==="description")continue;let i=Array.isArray(e)?e[parseInt(o)]:e[o];this.collectTokens(i,[...t,o])}}}}addToken(e,t,n,r,o){let i=o[o.length-1]||"unnamed",a=this.inferTokenType({$value:e,$type:t},o),s;typeof e=="string"&&(e.startsWith("{")||e.startsWith("$"))&&(s=this.extractAliases(e));let l={name:i,value:e,type:a,path:[...o],description:n,extensions:r,rawValue:e,aliases:s};this.tokens.push(l),this.tokenMap.set(o.join("."),l)}isW3CToken(e){return e&&typeof e=="object"&&"$value"in e}isTokenStudioToken(e){if(!e||typeof e!="object"||"$value"in e||!("value"in e))return!1;let t=e.value;return typeof t=="string"||typeof t=="number"||typeof t=="boolean"?!0:typeof t=="object"&&t!==null?"type"in e||"description"in e:!1}isPrimitiveToken(e,t){return!(typeof e!="string"&&typeof e!="number"&&typeof e!="boolean"||t.length<1)}isDesignToken(e){return this.isW3CToken(e)}inferTokenType(e,t){if(e.$type)return e.$type;let n=t.join(".").toLowerCase();if(n.includes("color")||n.includes("colour"))return"color";if(n.includes("font")||n.includes("typography")||n.includes("text"))return n.includes("weight")?"fontWeight":n.includes("family")?"fontFamily":"typography";if(n.includes("spacing")||n.includes("size")||n.includes("gap"))return"dimension";if(n.includes("shadow"))return"shadow";if(n.includes("border"))return"border";let r=e.$value;if(typeof r=="string"){if(r.match(/^#[0-9A-Fa-f]{3,8}$/)||r.match(/^rgba?\(/)||r.match(/^hsla?\(/))return"color";if(r.match(/^-?\d+(\.\d+)?(px|rem|em|pt|pc|in|cm|mm|q|vh|vw|vmin|vmax|%)$/))return"dimension";if(r.match(/^\d+(\.\d+)?(ms|s)$/))return"duration"}return typeof r=="number"?"number":typeof r=="boolean"?"boolean":"string"}extractAliases(e){let t=[],n=/\{([^}]+)\}/g,r;for(;(r=n.exec(e))!==null;){let o=r[1].split(",").map(i=>i.trim())[0];o.startsWith("$")&&(o=o.substring(1)),t.push(o)}if(e.startsWith("$")&&!e.startsWith("{")){let o=/\$([a-zA-Z0-9._-]+)/g;for(;(r=o.exec(e))!==null;)t.push(r[1])}return t}resolveAliases(){for(let e of this.tokens)if(e.aliases&&e.aliases.length>0)for(let t of e.aliases){let n=this.tokenMap.get(t);n?(e.value=n.value,e.aliases||(e.aliases=[])):this.errors.push({path:e.path,message:`Unresolved alias: ${t}`,severity:"error"})}}validateTokens(){for(let e of this.tokens){let t=this.validateTokenValue(e);t.valid||this.errors.push({path:e.path,message:t.message||"Validation error",severity:t.severity||"error"})}}validateTokenValue(e){let{type:t,value:n}=e;if(n==null)return{valid:!1,message:"Token value cannot be null or undefined",severity:"error"};switch(t){case"color":return this.validateColor(n);case"dimension":return this.validateDimension(n);case"fontWeight":return this.validateFontWeight(n);case"duration":return this.validateDuration(n);case"typography":return this.validateTypography(n);case"shadow":return this.validateShadow(n);default:return{valid:!0}}}validateColor(e){return typeof e!="string"?{valid:!1,message:"Color value must be a string",severity:"error"}:[/^#[0-9A-Fa-f]{3,8}$/,/^rgba?\([^)]+\)$/,/^hsla?\([^)]+\)$/].some(r=>r.test(e))?{valid:!0}:{valid:!1,message:`Invalid color format: ${e}`,severity:"error"}}validateDimension(e){if(typeof e=="string"){if(!/^-?\d+(\.\d+)?(px|rem|em|pt|pc|in|cm|mm|q|vh|vw|vmin|vmax|%)$/.test(e))return{valid:!1,message:`Invalid dimension format: ${e}`,severity:"error"}}else return typeof e=="number"?{valid:!0}:{valid:!1,message:"Dimension value must be a string or number",severity:"error"};return{valid:!0}}validateFontWeight(e){if(typeof e=="string"){if(!["100","200","300","400","500","600","700","800","900","normal","bold"].includes(e))return{valid:!1,message:`Invalid font weight: ${e}`,severity:"warning"}}else if(typeof e=="number"){if(e<1||e>1e3)return{valid:!1,message:"Font weight must be between 1 and 1000",severity:"error"}}else return{valid:!1,message:"Font weight must be a string or number",severity:"error"};return{valid:!0}}validateDuration(e){return typeof e!="string"?{valid:!1,message:"Duration value must be a string",severity:"error"}:/^\d+(\.\d+)?(ms|s)$/.test(e)?{valid:!0}:{valid:!1,message:`Invalid duration format: ${e}`,severity:"error"}}validateTypography(e){return typeof e!="object"||Array.isArray(e)?{valid:!1,message:"Typography value must be an object",severity:"error"}:e.fontFamily?{valid:!0}:{valid:!1,message:"Typography token missing fontFamily",severity:"warning"}}validateShadow(e){return typeof e!="object"||Array.isArray(e)?{valid:!1,message:"Shadow value must be an object",severity:"error"}:e.color?{valid:!0}:{valid:!1,message:"Shadow token missing color",severity:"warning"}}getTokensByType(e){return this.tokens.filter(t=>t.type===e)}getTokenByPath(e){return this.tokenMap.get(e.join("."))}getErrors(){return this.errors}}});var ce,ae,Re=X(()=>{"use strict";Pe();ce=class ce{constructor(){F(this,"parser");this.parser=new se}parseGitHubUrl(e){let t=[/github\.com[\/:]([^\/]+)\/([^\/\.]+)(\.git)?$/,/github\.com\/([^\/]+)\/([^\/]+)/];for(let n of t){let r=e.match(n);if(r)return{owner:r[1],repo:r[2]}}return null}async fetchBranches(e,t,n){try{let r=await fetch(`https://api.github.com/repos/${e}/${t}/branches`,{headers:{Authorization:`Bearer ${n}`,Accept:"application/vnd.github.v3+json"}});if(!r.ok)throw new Error(`GitHub API error: ${r.status}`);return(await r.json()).map(i=>i.name)}catch(r){throw new Error(`Failed to fetch branches: ${r}`)}}async getLatestCommitSha(e,t,n,r){try{let o=`https://api.github.com/repos/${e}/${t}/commits/${n}`,i=await fetch(o,{headers:{Authorization:`Bearer ${r}`,Accept:"application/vnd.github.v3+json"}});return i.ok?(await i.json()).sha||null:(console.warn(`Failed to get commit SHA: ${i.status}`),null)}catch(o){return console.warn("Failed to get latest commit SHA:",o),null}}async fetchFileContents(e,t,n,r,o){try{let i=`https://api.github.com/repos/${e}/${t}/contents/${o}?ref=${n}`,a=await fetch(i,{headers:{Authorization:`Bearer ${r}`,Accept:"application/vnd.github.v3+json"}});if(!a.ok)throw new Error(`GitHub API error: ${a.status}`);return await a.json()}catch(i){throw new Error(`Failed to fetch file contents: ${i}`)}}async fetchDirectoryContents(e,t,n,r,o=""){try{let i=`https://api.github.com/repos/${e}/${t}/contents/${o}?ref=${n}`,a=await fetch(i,{headers:{Authorization:`Bearer ${r}`,Accept:"application/vnd.github.v3+json"}});if(!a.ok)throw new Error(`GitHub API error: ${a.status}`);let s=await a.json();return Array.isArray(s)?s:[s]}catch(i){throw new Error(`Failed to fetch directory contents: ${i}`)}}decodeBase64Content(e){try{let t=e.replace(/\s/g,""),n;if(typeof atob=="function")n=atob(t);else{let o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";n="";let i=0,a=t.replace(/=+$/,"");for(;i<a.length;){let s=o.indexOf(a.charAt(i++)),l=o.indexOf(a.charAt(i++)),f=o.indexOf(a.charAt(i++)),d=o.indexOf(a.charAt(i++)),g=s<<18|l<<12|(f&63)<<6|d&63;n+=String.fromCharCode(g>>16&255),f!==-1&&(n+=String.fromCharCode(g>>8&255)),d!==-1&&(n+=String.fromCharCode(g&255))}}let r;if(typeof TextDecoder!="undefined"){let o=new Uint8Array(n.length);for(let i=0;i<n.length;i++)o[i]=n.charCodeAt(i);r=new TextDecoder("utf-8").decode(o)}else try{r=decodeURIComponent(escape(n))}catch(o){r=n}return r.charCodeAt(0)===65279&&(r=r.slice(1)),r=r.replace(/\0/g,""),r=r.trim(),r}catch(t){throw new Error(`Failed to decode base64 content: ${t}`)}}parseJSONContent(e){try{return JSON.parse(e)}catch(t){throw new Error(`Failed to parse JSON: ${t}`)}}flattenTokens(e,t=[]){let n=[],r=[],o=d=>d&&typeof d=="object"&&"$value"in d,i=d=>{if(!d||typeof d!="object"||"$value"in d||!("value"in d))return!1;let g=d.value;return typeof g=="string"||typeof g=="number"||typeof g=="boolean"?!0:typeof g=="object"&&g!==null?"type"in d||"description"in d:!1},a=(d,g)=>!(typeof d!="string"&&typeof d!="number"&&typeof d!="boolean"||g.length<1),s=(d,g)=>{let N=g.join(".").toLowerCase();if(typeof d=="string"){if(d.match(/^#[0-9A-Fa-f]{3,8}$/)||d.match(/^rgba?\(/)||d.match(/^hsla?\(/)||N.includes("color"))return"color";if(d.match(/^\d+(\.\d+)?(ms|s)$/)||N.includes("duration"))return"duration";if(d.match(/^-?\d+(\.\d+)?(px|rem|em|pt|pc|in|cm|mm|q|vh|vw|vmin|vmax|%)$/)||N.includes("size")||N.includes("spacing")||N.includes("radius"))return"dimension";if(N.includes("font")||N.includes("typography"))return"typography";if(N.includes("shadow"))return"shadow"}else if(typeof d=="number")return"number";return"string"},l=(d,g,N)=>{let I=N[N.length-1]||"unnamed",A=g||s(d,N);n.push({name:I,path:N,type:A,value:d,rawValue:d})},f=(d,g)=>{if(d==null)return;let N=g[g.length-1]||"";if(!(N.startsWith("$")&&N!=="$value"&&N!=="$type")){if(o(d)){l(d.$value,d.$type,g);return}if(i(d)){l(d.value,d.type,g);return}if(a(d,g)){l(d,void 0,g);return}if(d&&typeof d=="object"){let I=Array.isArray(d)?d.map((A,b)=>String(b)):Object.keys(d);for(let A of I){if(!Array.isArray(d)&&(A.startsWith("$")||A==="extensions"))continue;let b=Array.isArray(d)?d[parseInt(A)]:d[A];f(b,[...g,A])}}}};try{f(e,[])}catch(d){r.push({path:[],message:d instanceof Error?d.message:"Failed to walk tokens"})}return{tokens:n,metadata:{filePath:"",format:"auto-detected",errors:r}}}async fetchTokens(e,t,n,r,o){let i=await this.fetchFileContents(e,t,n,r,o);if(i.type!=="file")throw new Error(`Path is not a file: ${o}`);if(!i.content)throw new Error("File content is empty");let a=this.decodeBase64Content(i.content),s=this.parseJSONContent(a),l=this.parser.parse(s,o);return(!l.tokens||l.tokens.length===0)&&(l=this.flattenTokens(s,[])),l}isExcludedFile(e){var n;let t=((n=e.split("/").pop())==null?void 0:n.toLowerCase())||"";return ce.EXCLUDE_PATTERNS.some(r=>r.test(t)||r.test(e))}async fetchRepoTree(e,t,n,r){try{let o=`https://api.github.com/repos/${e}/${t}/git/trees/${n}?recursive=1`,i=await fetch(o,{headers:{Authorization:`Bearer ${r}`,Accept:"application/vnd.github.v3+json"}});if(!i.ok)throw new Error(`GitHub API error: ${i.status}`);let a=await i.json();return a.truncated?(console.warn("Repository tree was truncated - falling back to recursive fetch"),[]):a.tree||[]}catch(o){return console.error("Failed to fetch repo tree:",o),[]}}async detectTokenFiles(e,t,n,r,o=""){let i=await this.fetchRepoTree(e,t,n,r);if(i.length>0){let a=o.replace(/^\/|\/$/g,"");return i.filter(s=>s.type!=="blob"||!s.path.toLowerCase().endsWith(".json")||a&&!s.path.startsWith(a+"/")&&s.path!==a?!1:!this.isExcludedFile(s.path)).map(s=>s.path)}return this.detectTokenFilesRecursive(e,t,n,r,o)}async detectTokenFilesRecursive(e,t,n,r,o=""){let i=await this.fetchDirectoryContents(e,t,n,r,o),a=[];for(let s of i)if(s.type==="file")s.name.toLowerCase().endsWith(".json")&&!this.isExcludedFile(s.path)&&a.push(s.path);else if(s.type==="dir"&&!this.isExcludedFile(s.path+"/")){let l=await this.detectTokenFilesRecursive(e,t,n,r,s.path);a.push(...l)}return a}};F(ce,"EXCLUDE_PATTERNS",[/package\.json$/i,/package-lock\.json$/i,/tsconfig\.json$/i,/\.config\.json$/i,/eslint.*\.json$/i,/prettier.*\.json$/i,/jest\.config\.json$/i,/webpack\.config\.json$/i,/^\$metadata\.json$/i,/^\$themes\.json$/i,/\(ignore\)\.json$/i,/node_modules\//i,/\.github\//i,/\.vscode\//i]);ae=ce});var le,Se=X(()=>{"use strict";le=class{constructor(){F(this,"errors",[]);F(this,"TOKENS_STUDIO_NAMESPACE","tokens");F(this,"DEBUG_LOGGING",!1)}getAllTokenKeys(e){let t={},n=["tokens","tokens-studio","tokensStudio","design-tokens","figma-tokens"];for(let r of n)try{let o=e.getSharedPluginDataKeys(r);for(let i of o){let a=e.getSharedPluginData(r,i);a&&a.trim()&&(t[`${r}:${i}`]=a)}}catch(o){}return t}getVariableBinding(e,t){try{if(!("boundVariables"in e)||!e.boundVariables)return;let r=e.boundVariables[t];if(r){let o=Array.isArray(r)?r[0]:r;if(o!=null&&o.id)try{let i=figma.variables.getVariableById(o.id);if(i!=null&&i.name)return this.DEBUG_LOGGING&&console.log(`[Variable] ${e.name}.${t} \u2192 ${i.name}`),i.name}catch(i){}}}catch(n){}}cleanTokenReference(e){let t=e.trim();for(;t.startsWith('"')&&t.endsWith('"')||t.startsWith("'")&&t.endsWith("'");)t=t.slice(1,-1);return t=t.replace(/^[{]|[}]$/g,""),t=t.replace(/^\$/,""),t.trim()}getTokenReference(e,t){try{let n=["tokens","tokens-studio","tokensStudio","design-tokens"];for(let r of n)try{let o=e.getSharedPluginData(r,t);if(o&&o.trim()){let i=this.cleanTokenReference(o);return this.DEBUG_LOGGING&&console.log(`[TokenRef] Found ${r}:${t} = "${i}" on ${e.name}`),i}}catch(o){}try{let r=e.getPluginData(t);if(r&&r.trim())return this.cleanTokenReference(r)}catch(r){}}catch(n){}}getFillTokenReferences(e,t){let n=[`fills[${t}]`,`fill[${t}]`,`fills.${t}`,`fill.${t}`,"fill","fills","fillColor",`fillColor[${t}]`];for(let r of n){let o=this.getTokenReference(e,r);if(o)return o}}getStrokeTokenReferences(e,t){let n=[`strokes[${t}]`,`stroke[${t}]`,`strokes.${t}`,`stroke.${t}`,"stroke","strokes","strokeColor",`strokeColor[${t}]`,"borderColor"];for(let r of n){let o=this.getTokenReference(e,r);if(o)return o}}getTypographyTokenReference(e,t){let r={fontFamily:["fontFamily","fontFamilies","font-family","typography.fontFamily"],fontSize:["fontSize","fontSizes","font-size","typography.fontSize"],fontWeight:["fontWeight","fontWeights","font-weight","typography.fontWeight"],lineHeight:["lineHeight","lineHeights","line-height","typography.lineHeight"],letterSpacing:["letterSpacing","letter-spacing","typography.letterSpacing"],typography:["typography","text","textStyle","text-style"]}[t]||[t];for(let o of r){let i=this.getTokenReference(e,o);if(i)return i}}getSpacingTokenReference(e,t){let r={width:["width","sizing","dimension","sizing.width","dimensions.width"],height:["height","sizing","dimension","sizing.height","dimensions.height"],padding:["padding","spacing","paddingTop","paddingRight","paddingBottom","paddingLeft"],paddingTop:["paddingTop","verticalPadding","padding","spacing"],paddingRight:["paddingRight","horizontalPadding","padding","spacing"],paddingBottom:["paddingBottom","verticalPadding","padding","spacing"],paddingLeft:["paddingLeft","horizontalPadding","padding","spacing"],verticalPadding:["verticalPadding","paddingTop","paddingBottom","padding","spacing"],horizontalPadding:["horizontalPadding","paddingLeft","paddingRight","padding","spacing"],gap:["itemSpacing","spacing","gap","counterAxisSpacing"],itemSpacing:["itemSpacing","spacing","gap"],counterAxisSpacing:["counterAxisSpacing","spacing"],borderRadius:["borderRadius","borderRadiusTopLeft","borderRadiusTopRight","borderRadiusBottomRight","borderRadiusBottomLeft","radius","cornerRadius"],borderRadiusTopLeft:["borderRadiusTopLeft","borderRadius","radius"],borderRadiusTopRight:["borderRadiusTopRight","borderRadius","radius"],borderRadiusBottomRight:["borderRadiusBottomRight","borderRadius","radius"],borderRadiusBottomLeft:["borderRadiusBottomLeft","borderRadius","radius"],borderWidth:["borderWidth","strokeWeight","borderWidthTop","borderWidthRight","borderWidthBottom","borderWidthLeft","border"],strokeWeight:["strokeWeight","borderWidth","border"],dimension:["dimension","spacing","sizing","size"]}[t]||[t];for(let i of r){let a=this.getTokenReference(e,i);if(a)return a}let o=this.getVariableBinding(e,t);if(o)return o}getBorderRadiusTokenReference(e){let t=["borderRadius","borderRadiusTopLeft","borderRadiusTopRight","borderRadiusBottomRight","borderRadiusBottomLeft","radius","cornerRadius","topLeftRadius","topRightRadius","bottomRightRadius","bottomLeftRadius"];for(let r of t){let o=this.getTokenReference(e,r);if(o)return this.DEBUG_LOGGING&&console.log(`[BorderRadius] Found ${r} = "${o}" on ${e.name}`),o}let n=this.getVariableBinding(e,"cornerRadius");if(n)return n}getBorderWidthTokenReference(e){let t=["borderWidth","strokeWeight","borderWidthTop","borderWidthRight","borderWidthBottom","borderWidthLeft","border","strokeWidth"];for(let r of t){let o=this.getTokenReference(e,r);if(o)return this.DEBUG_LOGGING&&console.log(`[BorderWidth] Found ${r} = "${o}" on ${e.name}`),o}let n=this.getVariableBinding(e,"strokeWeight");if(n)return n}getEffectTokenReference(e,t){let n=["boxShadow","shadow",`boxShadow[${t}]`,`shadow[${t}]`,"effects","effect",`effects[${t}]`,`effect[${t}]`,"dropShadow","innerShadow","elevation","shadowColor","shadowOffset","shadowRadius","shadowSpread"];for(let o of n){let i=this.getTokenReference(e,o);if(i)return this.DEBUG_LOGGING&&console.log(`[Effect] Found ${o} = "${i}" on ${e.name}`),i}let r=this.getVariableBinding(e,"effects");if(r)return r}logNodeTokenData(e){if(!this.DEBUG_LOGGING)return;let t=this.getAllTokenKeys(e);if(Object.keys(t).length>0){console.log(`
[TokenData] Node: "${e.name}" (${e.type})`);for(let[n,r]of Object.entries(t)){let o=this.cleanTokenReference(r);console.log(o!==r?`  ${n} = ${o} (raw: ${r})`:`  ${n} = ${o}`)}}}scanAllComponents(){this.errors=[];let e=[],t=0,n=figma.root.children;for(let r of n)if(r.type==="PAGE"){let o=r.findAll(a=>a.type==="COMPONENT"||a.type==="COMPONENT_SET"),i=r.findAll(a=>a.type==="INSTANCE");t+=i.length;for(let a of o)try{let s=this.extractComponentProperties(a,r.name);s&&e.push(s)}catch(s){this.errors.push({componentId:a.id,componentName:a.name,error:s instanceof Error?s.message:"Unknown error"})}}return{components:e,totalComponents:e.length,totalInstances:t,pagesScanned:n.length,errors:this.errors}}scanFilteredPages(e){this.errors=[];let t=[],n=0,r=figma.root.children,o=e.map(a=>a.toLowerCase().trim()),i=r.filter(a=>a.type==="PAGE"&&o.includes(a.name.toLowerCase().trim()));for(let a of i)if(a.type==="PAGE"){let s=a.findAll(f=>f.type==="COMPONENT"||f.type==="COMPONENT_SET"),l=a.findAll(f=>f.type==="INSTANCE");n+=l.length;for(let f of s)try{let d=this.extractComponentProperties(f,a.name);d&&t.push(d)}catch(d){this.errors.push({componentId:f.id,componentName:f.name,error:d instanceof Error?d.message:"Unknown error"})}}return{components:t,totalComponents:t.length,totalInstances:n,pagesScanned:i.length,errors:this.errors}}scanCurrentPage(){this.errors=[];let e=[],t=figma.currentPage,n=0,r=t.findAll(i=>i.type==="COMPONENT"||i.type==="COMPONENT_SET"),o=t.findAll(i=>i.type==="INSTANCE");n+=o.length;for(let i of r)try{let a=this.extractComponentProperties(i,t.name);a&&e.push(a)}catch(a){this.errors.push({componentId:i.id,componentName:i.name,error:a instanceof Error?a.message:"Unknown error"})}return{components:e,totalComponents:e.length,totalInstances:n,pagesScanned:1,errors:this.errors}}scanNodes(e){this.errors=[];let t=[],n=0,r=figma.currentPage;for(let o of e){let i=[],a=[];"findAll"in o&&typeof o.findAll=="function"&&(i=o.findAll(s=>s.type==="COMPONENT"||s.type==="COMPONENT_SET"),a=o.findAll(s=>s.type==="INSTANCE"),n+=a.length);for(let s of i)try{let l=this.extractComponentProperties(s,r.name);l&&t.push(l)}catch(l){this.errors.push({componentId:s.id,componentName:s.name,error:l instanceof Error?l.message:"Unknown error"})}if(o.type==="COMPONENT"||o.type==="COMPONENT_SET")try{let s=this.extractComponentProperties(o,r.name);s&&(t.find(l=>l.id===s.id)||t.push(s))}catch(s){this.errors.push({componentId:o.id,componentName:o.name,error:s instanceof Error?s.message:"Unknown error"})}}return{components:t,totalComponents:t.length,totalInstances:n,pagesScanned:1,errors:this.errors}}extractComponentProperties(e,t){var r,o;if(e.type!=="COMPONENT"&&e.type!=="COMPONENT_SET"&&e.type!=="INSTANCE")return null;let n={id:e.id,name:e.name,type:e.type,pageName:t,colors:[],typography:[],spacing:[],effects:[]};if(e.type==="COMPONENT_SET")n.mainComponentName=e.name,n.mainComponentId=e.id;else if(e.type==="COMPONENT"){let i=e;((r=i.parent)==null?void 0:r.type)==="COMPONENT_SET"?(n.mainComponentName=i.parent.name,n.mainComponentId=i.parent.id):(n.mainComponentName=e.name,n.mainComponentId=e.id)}else if(e.type==="INSTANCE"){let i=e;try{let a=i.mainComponent;a&&(((o=a.parent)==null?void 0:o.type)==="COMPONENT_SET"?(n.mainComponentName=a.parent.name,n.mainComponentId=a.parent.id):(n.mainComponentName=a.name,n.mainComponentId=a.id))}catch(a){n.mainComponentName=e.name.split(",")[0].trim()}}if(n.colors=this.extractColors(e),n.typography=this.extractTypography(e),n.spacing=this.extractSpacing(e),n.effects=this.extractEffects(e),e.type==="COMPONENT"||e.type==="COMPONENT_SET"){let i=e;"layoutMode"in i&&i.layoutMode&&(n.layoutMode=i.layoutMode,n.itemSpacing=i.itemSpacing,n.paddingTop=i.paddingTop,n.paddingRight=i.paddingRight,n.paddingBottom=i.paddingBottom,n.paddingLeft=i.paddingLeft),n.width=i.width,n.height=i.height}else if(e.type==="INSTANCE"){let i=e;n.width=i.width,n.height=i.height}if("children"in e){let i=[];for(let a of e.children){let s=this.extractComponentProperties(a,t);s&&i.push(s)}i.length>0&&(n.children=i)}return n}extractColors(e){var n,r;let t=[];if("fills"in e&&Array.isArray(e.fills))for(let o=0;o<e.fills.length;o++){let i=e.fills[o];if(i.type==="SOLID"){let a=(n=i.opacity)!=null?n:1,s=this.rgbaToColor(i.color,a),l=this.getFillTokenReferences(e,o);t.push({type:"fill",color:{r:i.color.r,g:i.color.g,b:i.color.b,a},hex:s.hex,rgba:s.rgba,opacity:a,tokenReference:l})}}if("strokes"in e&&Array.isArray(e.strokes))for(let o=0;o<e.strokes.length;o++){let i=e.strokes[o];if(i.type==="SOLID"){let a=(r=i.opacity)!=null?r:1,s=this.rgbaToColor(i.color,a),l=this.getStrokeTokenReferences(e,o);t.push({type:"stroke",color:{r:i.color.r,g:i.color.g,b:i.color.b,a},hex:s.hex,rgba:s.rgba,opacity:a,tokenReference:l})}}return t}extractTypography(e){let t=[];if(e.type==="TEXT"){let n=e;if(typeof n.fontName!="symbol"){let r=n.fontName,o=this.getTypographyTokenReference(n,"typography"),i=this.getTypographyTokenReference(n,"fontFamily"),a=this.getTypographyTokenReference(n,"fontSize"),s=this.getTypographyTokenReference(n,"fontWeight"),l=this.getTypographyTokenReference(n,"lineHeight"),f=this.getTypographyTokenReference(n,"letterSpacing"),d=o||i||a||s||l||f;t.push({fontFamily:r.family,fontSize:typeof n.fontSize=="number"?n.fontSize:16,fontWeight:typeof r.style=="string"?this.parseFontWeight(r.style):400,lineHeight:typeof n.lineHeight=="number"||typeof n.lineHeight=="string"?n.lineHeight:void 0,letterSpacing:typeof n.letterSpacing=="number"?n.letterSpacing:void 0,textDecoration:typeof n.textDecoration=="string"?n.textDecoration:void 0,textCase:typeof n.textCase=="string"?n.textCase:void 0,tokenReference:d})}}if("children"in e)for(let n of e.children)t.push(...this.extractTypography(n));return t}extractSpacing(e){let t=[];if(this.logNodeTokenData(e),e.type==="COMPONENT"||e.type==="COMPONENT_SET"||e.type==="FRAME"||e.type==="INSTANCE"){let r=e,o=this.getSpacingTokenReference(e,"width"),i=this.getSpacingTokenReference(e,"height");if(t.push({type:"width",value:r.width,unit:"px",tokenReference:o}),t.push({type:"height",value:r.height,unit:"px",tokenReference:i}),"paddingTop"in r&&typeof r.paddingTop=="number"){let a=this.getSpacingTokenReference(e,"horizontalPadding"),s=this.getSpacingTokenReference(e,"verticalPadding"),l=this.getSpacingTokenReference(e,"padding"),f=this.getSpacingTokenReference(e,"paddingTop"),d=this.getSpacingTokenReference(e,"paddingRight"),g=this.getSpacingTokenReference(e,"paddingBottom"),N=this.getSpacingTokenReference(e,"paddingLeft"),I=(b,x)=>b?`[${x}] ${b}`:void 0,A=(b,x,R)=>{if(b)return b;if(x)return I(x,R);if(l)return I(l,"all")};r.paddingTop&&t.push({type:"padding",value:r.paddingTop,unit:"px",tokenReference:A(f,s,"vertical")}),r.paddingRight&&t.push({type:"padding",value:r.paddingRight,unit:"px",tokenReference:A(d,a,"horizontal")}),r.paddingBottom&&t.push({type:"padding",value:r.paddingBottom,unit:"px",tokenReference:A(g,s,"vertical")}),r.paddingLeft&&t.push({type:"padding",value:r.paddingLeft,unit:"px",tokenReference:A(N,a,"horizontal")})}if("itemSpacing"in r&&typeof r.itemSpacing=="number"&&r.itemSpacing){let a=this.getSpacingTokenReference(e,"itemSpacing")||this.getSpacingTokenReference(e,"gap")||this.getSpacingTokenReference(e,"spacing");t.push({type:"gap",value:r.itemSpacing,unit:"px",tokenReference:a})}if("counterAxisSpacing"in r&&typeof r.counterAxisSpacing=="number"&&r.counterAxisSpacing){let a=this.getSpacingTokenReference(e,"counterAxisSpacing");t.push({type:"gap",value:r.counterAxisSpacing,unit:"px",tokenReference:a})}if("cornerRadius"in r){let a=this.getBorderRadiusTokenReference(e);typeof r.cornerRadius=="number"&&r.cornerRadius>0?t.push({type:"borderRadius",value:r.cornerRadius,unit:"px",tokenReference:a}):r.cornerRadius===figma.mixed&&("topLeftRadius"in r&&typeof r.topLeftRadius=="number"&&r.topLeftRadius>0&&t.push({type:"borderRadius",value:r.topLeftRadius,unit:"px",tokenReference:this.getSpacingTokenReference(e,"borderRadiusTopLeft")||a}),"topRightRadius"in r&&typeof r.topRightRadius=="number"&&r.topRightRadius>0&&t.push({type:"borderRadius",value:r.topRightRadius,unit:"px",tokenReference:this.getSpacingTokenReference(e,"borderRadiusTopRight")||a}),"bottomRightRadius"in r&&typeof r.bottomRightRadius=="number"&&r.bottomRightRadius>0&&t.push({type:"borderRadius",value:r.bottomRightRadius,unit:"px",tokenReference:this.getSpacingTokenReference(e,"borderRadiusBottomRight")||a}),"bottomLeftRadius"in r&&typeof r.bottomLeftRadius=="number"&&r.bottomLeftRadius>0&&t.push({type:"borderRadius",value:r.bottomLeftRadius,unit:"px",tokenReference:this.getSpacingTokenReference(e,"borderRadiusBottomLeft")||a}))}if("strokeWeight"in r&&typeof r.strokeWeight=="number"&&r.strokeWeight>0){let a=this.getBorderWidthTokenReference(e);t.push({type:"borderWidth",value:r.strokeWeight,unit:"px",tokenReference:a})}}else if("cornerRadius"in e){let r=this.getBorderRadiusTokenReference(e),o=e;typeof o.cornerRadius=="number"&&o.cornerRadius>0&&t.push({type:"borderRadius",value:o.cornerRadius,unit:"px",tokenReference:r})}return t}extractEffects(e){var n,r,o,i,a,s,l,f;let t=[];if("effects"in e&&Array.isArray(e.effects))for(let d=0;d<e.effects.length;d++){let g=e.effects[d];if(g.visible){let N=this.getEffectTokenReference(e,d);switch(g.type){case"DROP_SHADOW":t.push({type:"drop-shadow",visible:g.visible,radius:g.radius,color:g.color?{r:g.color.r,g:g.color.g,b:g.color.b,a:g.color.a}:void 0,offset:{x:(r=(n=g.offset)==null?void 0:n.x)!=null?r:0,y:(i=(o=g.offset)==null?void 0:o.y)!=null?i:0},spread:g.spread,tokenReference:N});break;case"INNER_SHADOW":t.push({type:"inner-shadow",visible:g.visible,radius:g.radius,color:g.color?{r:g.color.r,g:g.color.g,b:g.color.b,a:g.color.a}:void 0,offset:{x:(s=(a=g.offset)==null?void 0:a.x)!=null?s:0,y:(f=(l=g.offset)==null?void 0:l.y)!=null?f:0},spread:g.spread,tokenReference:N});break;case"LAYER_BLUR":t.push({type:"layer-blur",visible:g.visible,radius:g.radius,tokenReference:N});break;case"BACKGROUND_BLUR":t.push({type:"background-blur",visible:g.visible,radius:g.radius,tokenReference:N});break}}}return t}rgbaToColor(e,t){let n=Math.round(e.r*255),r=Math.round(e.g*255),o=Math.round(e.b*255),i=t,a=`#${[n,r,o].map(l=>{let f=l.toString(16);return f.length===1?"0"+f:f}).join("")}`,s=`rgba(${n}, ${r}, ${o}, ${i.toFixed(2)})`;return{hex:a,rgba:s}}parseFontWeight(e){let t={thin:100,extralight:200,light:300,regular:400,medium:500,semibold:600,bold:700,extrabold:800,black:900},n=e.toLowerCase();for(let[o,i]of Object.entries(t))if(n.includes(o))return i;let r=e.match(/(\d+)/);return r?parseInt(r[1],10):400}getComponentUsageStats(e){let t=[],n=new Set;for(let r of figma.root.children)if(r.type==="PAGE"){let o=r.findAll(i=>{var a;return i.type==="INSTANCE"&&((a=i.mainComponent)==null?void 0:a.id)===e});o.length>0&&(t.push(...o),n.add(r.name))}return{instances:t.length,pages:Array.from(n)}}}});var pe,ve=X(()=>{"use strict";pe=class{constructor(){F(this,"errors",[]);F(this,"cache",new Map);F(this,"cacheMaxAge",5*60*1e3);F(this,"tokenIndex",{byPath:new Map,byValue:new Map});F(this,"nodeTokenRefsCache",new WeakMap);F(this,"TOKENS_STUDIO_NAMESPACE","tokens");F(this,"debugLogging",!1);F(this,"SKIP_NODE_TYPES",new Set(["VECTOR","BOOLEAN_OPERATION","LINE","ELLIPSE","STAR","POLYGON","TEXT","RECTANGLE","SLICE","STAMP","STICKY","SHAPE_WITH_TEXT","CODE_BLOCK","WIDGET","EMBED","LINK_UNFURL","MEDIA"]))}setDebugLogging(e){this.debugLogging=e}async clearCache(){this.cache.clear(),this.tokenIndex={byPath:new Map,byValue:new Map},this.nodeTokenRefsCache=new WeakMap;try{let t=(await figma.clientStorage.keysAsync()).filter(n=>n.startsWith("componentCache_"));for(let n of t)await figma.clientStorage.deleteAsync(n)}catch(e){console.error("Error clearing persistent cache:",e)}}getCacheStats(){return{entries:this.cache.size,indexedPaths:this.tokenIndex.byPath.size,indexedValues:this.tokenIndex.byValue.size}}getDocumentVersion(){return{documentVersion:figma.root.children.filter(n=>n.type==="PAGE").map(n=>`${n.id}:${n.name}`).join("|").split("").reduce((n,r)=>(n<<5)-n+r.charCodeAt(0),0).toString(36),editSessionId:figma.root.id}}getPersistentCacheKey(e,t){let n=t.slice().sort().join(",");return`componentCache_${e}_${n||"all"}`}async getFromPersistentCache(e,t){try{let n=this.getPersistentCacheKey(e,t),r=await figma.clientStorage.getAsync(n);if(!r)return null;let o=this.getDocumentVersion();if(r.documentVersion===o.documentVersion&&r.editSessionId===o.editSessionId&&Date.now()-r.timestamp<this.cacheMaxAge)return this.debugLogging&&console.log(`[Cache] HIT - Persistent cache valid for ${e} (${t.length} pages)`),r.components;this.debugLogging&&console.log(`[Cache] MISS - Invalidated (version: ${r.documentVersion} vs ${o.documentVersion})`),await figma.clientStorage.deleteAsync(n)}catch(n){this.debugLogging&&console.error("Error reading persistent cache:",n)}return null}async saveToPersistentCache(e,t,n){try{let r=this.getPersistentCacheKey(e,t),o=this.getDocumentVersion(),i={components:n,timestamp:Date.now(),documentVersion:o.documentVersion,editSessionId:o.editSessionId,tokenType:e,pageNames:t};await figma.clientStorage.setAsync(r,i),this.debugLogging&&console.log(`[Cache] SAVED - ${n.length} components for ${e} (version: ${o.documentVersion})`)}catch(r){this.debugLogging&&console.error("Error saving persistent cache:",r)}}async invalidatePagesCache(e){try{let n=(await figma.clientStorage.keysAsync()).filter(r=>r.startsWith("componentCache_"));for(let r of n)try{let o=await figma.clientStorage.getAsync(r);if(!o)continue;o.pageNames.some(a=>e.some(s=>a.toLowerCase()===s.toLowerCase()))&&(await figma.clientStorage.deleteAsync(r),this.debugLogging&&console.log(`[Cache] INVALIDATED - ${r} (affected pages: ${e.join(", ")})`))}catch(o){}}catch(t){this.debugLogging&&console.error("Error invalidating page caches:",t)}}async getCachedPageNames(){try{let t=(await figma.clientStorage.keysAsync()).filter(r=>r.startsWith("componentCache_")),n=new Set;for(let r of t)try{let o=await figma.clientStorage.getAsync(r);o!=null&&o.pageNames&&o.pageNames.forEach(i=>n.add(i))}catch(o){}return Array.from(n)}catch(e){return[]}}async scanAllComponentsOptimized(e={}){this.errors=[];let t=[],n=0,{tokenType:r="all",maxNodesPerPage:o=0,maxPages:i=0,chunkSize:a=100,onProgress:s,includeChildren:l=!0,maxDepth:f=3,useCache:d=!0,usePersistentCache:g=!0,pageFilter:N=[]}=e,I=figma.root.children.filter(R=>R.type==="PAGE"),A=N.length>0?I.filter(R=>N.includes(R.name)):I,b=i>0?Math.min(i,A.length):A.length,x=A.slice(0,b).map(R=>R.name);if(g&&d){s==null||s({currentPage:0,totalPages:b,currentPageName:"Checking cache...",componentsFound:0,nodesScanned:0,phase:"loading"});let R=await this.getFromPersistentCache(r,x);if(R)return this.buildTokenIndex(R),s==null||s({currentPage:b,totalPages:b,currentPageName:"Complete (from cache)",componentsFound:R.length,nodesScanned:0,phase:"complete"}),{components:R,totalComponents:R.length,totalInstances:0,pagesScanned:b,errors:[]}}for(let R=0;R<b;R++){let H=A[R];s==null||s({currentPage:R+1,totalPages:b,currentPageName:H.name,componentsFound:t.length,nodesScanned:0,phase:"scanning"});let oe=`${H.id}-${r}`;if(d){let te=this.getFromCache(oe);if(te){t.push(...te);continue}}let ee=await this.scanPageChunked(H,r,a,o,l,f,te=>{s==null||s({currentPage:R+1,totalPages:b,currentPageName:H.name,componentsFound:t.length,nodesScanned:te,phase:"scanning"})});d&&this.cache.set(oe,{components:ee.components,timestamp:Date.now()}),t.push(...ee.components),n+=ee.totalInstances,await this.yieldToMain()}return this.buildTokenIndex(t),g&&d&&t.length>0&&await this.saveToPersistentCache(r,x,t),s==null||s({currentPage:b,totalPages:b,currentPageName:"Complete",componentsFound:t.length,nodesScanned:0,phase:"complete"}),{components:t,totalComponents:t.length,totalInstances:n,pagesScanned:b,errors:this.errors}}async scanPageChunked(e,t,n,r,o,i,a){let s=[],l=0,f=0;if(e.children.length===0)return{components:[],totalInstances:0};let d=this.pageHasComponents(e),g=[],N=d?r:r>0?Math.min(r,50):50;this.collectComponentNodes(e,g,N),!d&&g.length>=N&&(g.length=0,this.collectComponentNodes(e,g,r)),this.nodeTokenRefsCache=new WeakMap;let I=g.length;for(let A=0;A<I;A+=n){let b=Math.min(A+n,I);for(let x=A;x<b;x++){let R=g[x];try{let H=await this.extractComponentPropertiesOptimized(R,e.name,t,o,i,0);H&&s.push(H),f++,a==null||a(f)}catch(H){this.errors.push({componentId:R.id,componentName:R.name,error:H instanceof Error?H.message:"Unknown error"})}}b<I&&await this.yieldToMain()}return{components:s,totalInstances:l}}collectComponentNodes(e,t,n,r=0){if(n>0&&t.length>=n||r>15)return;let o=e.children,i=o.length;for(let a=0;a<i&&!(n>0&&t.length>=n);a++){let s=o[a],l=s.type;if(l==="COMPONENT"||l==="COMPONENT_SET"){t.push(s);continue}if(!this.SKIP_NODE_TYPES.has(l)&&l!=="INSTANCE"&&!(l!=="GROUP"&&"visible"in s&&!s.visible)&&"children"in s){let f=s;if(f.children.length===0)continue;(l==="FRAME"||l==="GROUP"||l==="SECTION")&&this.collectComponentNodes(f,t,n,r+1)}}}pageHasComponents(e){let t=e.children;if(t.length===0)return!1;let n=Math.min(t.length,30);for(let r=0;r<n;r++){let o=t[r],i=o.type;if(i==="COMPONENT"||i==="COMPONENT_SET")return!0;if((i==="FRAME"||i==="SECTION")&&"children"in o){let a=o.children,s=Math.min(a.length,15);for(let l=0;l<s;l++){let f=a[l];if(f.type==="COMPONENT"||f.type==="COMPONENT_SET")return!0}}}return!1}async extractComponentPropertiesOptimized(e,t,n,r,o,i){var N,I,A;if(e.type!=="COMPONENT"&&e.type!=="COMPONENT_SET"&&e.type!=="INSTANCE"&&e.type!=="FRAME")return null;let a=e.type==="FRAME"?"COMPONENT":e.type,s={id:e.id,name:e.name,type:a,pageName:t,colors:[],typography:[],spacing:[],effects:[]};if(e.type==="COMPONENT_SET")s.mainComponentName=e.name,s.mainComponentId=e.id;else if(e.type==="COMPONENT"){let b=e;((N=b.parent)==null?void 0:N.type)==="COMPONENT_SET"?(s.mainComponentName=b.parent.name,s.mainComponentId=b.parent.id,s.variantName=b.name):(s.mainComponentName=e.name,s.mainComponentId=e.id)}else if(e.type==="INSTANCE"){let b=e;try{let x=await b.getMainComponentAsync();x&&(((I=x.parent)==null?void 0:I.type)==="COMPONENT_SET"?(s.mainComponentName=x.parent.name,s.mainComponentId=x.parent.id,s.variantName=x.name):(s.mainComponentName=x.name,s.mainComponentId=x.id))}catch(x){try{let R=b.mainComponent;R?((A=R.parent)==null?void 0:A.type)==="COMPONENT_SET"?(s.mainComponentName=R.parent.name,s.mainComponentId=R.parent.id,s.variantName=R.name):(s.mainComponentName=R.name,s.mainComponentId=R.id):s.mainComponentName=e.name.split(",")[0].trim()}catch(R){s.mainComponentName=e.name.split(",")[0].trim()}}}let l=n==="all"||n==="color",f=n==="all"||n==="typography",d=n==="all"||["dimension","spacing","borderRadius","borderWidth"].includes(n),g=n==="all"||["effect","shadow"].includes(n);if(l&&(s.colors=this.extractColorsOptimized(e)),f&&(s.typography=this.extractTypographyOptimized(e,r)),d&&(s.spacing=this.extractSpacingOptimized(e,n)),g&&(s.effects=this.extractEffectsOptimized(e)),e.type==="COMPONENT"||e.type==="COMPONENT_SET"||e.type==="FRAME"){let b=e;"layoutMode"in b&&b.layoutMode&&(s.layoutMode=b.layoutMode,s.itemSpacing=b.itemSpacing),s.width=b.width,s.height=b.height}if(r&&i<o&&"children"in e){let b=[];for(let x of e.children){if(this.shouldSkipNode(x,n))continue;let R=await this.extractComponentPropertiesOptimized(x,t,n,r,o,i+1);R&&this.hasRelevantProperties(R)&&b.push(R)}b.length>0&&(s.children=b)}return s}shouldSkipNode(e,t){return"visible"in e&&!e.visible||(e.type==="VECTOR"||e.type==="BOOLEAN_OPERATION")&&t!=="color"||"width"in e&&"height"in e&&(e.width<1||e.height<1)}hasRelevantProperties(e){return!!(e.colors.length>0||e.typography.length>0||e.spacing.length>0||e.effects.length>0||e.children&&e.children.length>0)}extractColorsOptimized(e){var n,r;let t=[];if("fills"in e&&Array.isArray(e.fills))for(let o=0;o<e.fills.length;o++){let i=e.fills[o];if(i.type==="SOLID"){let a=(n=i.opacity)!=null?n:1,s=this.rgbaToColor(i.color,a),l=this.getFillTokenReferencesFast(e,o);t.push({type:"fill",color:{r:i.color.r,g:i.color.g,b:i.color.b,a},hex:s.hex,rgba:s.rgba,opacity:a,tokenReference:l})}}if("strokes"in e&&Array.isArray(e.strokes))for(let o=0;o<e.strokes.length;o++){let i=e.strokes[o];if(i.type==="SOLID"){let a=(r=i.opacity)!=null?r:1,s=this.rgbaToColor(i.color,a),l=this.getStrokeTokenReferencesFast(e,o);t.push({type:"stroke",color:{r:i.color.r,g:i.color.g,b:i.color.b,a},hex:s.hex,rgba:s.rgba,opacity:a,tokenReference:l})}}return t}extractTypographyOptimized(e,t){let n=[];if(e.type==="TEXT"){let r=e;if(typeof r.fontName!="symbol"){let o=r.fontName,i=this.getTypographyTokenFast(r);n.push({fontFamily:o.family,fontSize:typeof r.fontSize=="number"?r.fontSize:16,fontWeight:typeof o.style=="string"?this.parseFontWeight(o.style):400,lineHeight:typeof r.lineHeight=="number"?r.lineHeight:void 0,letterSpacing:typeof r.letterSpacing=="number"?r.letterSpacing:void 0,tokenReference:i})}}if(t&&"children"in e)for(let r of e.children)(r.type==="TEXT"||"children"in r&&this.containsTextNode(r))&&n.push(...this.extractTypographyOptimized(r,t));return n}containsTextNode(e){if(e.type==="TEXT")return!0;if("children"in e){for(let t of e.children)if(t.type==="TEXT"||"children"in t&&t.children.length>0&&t.children.some(n=>n.type==="TEXT"))return!0}return!1}extractSpacingOptimized(e,t){let n=[],r=e.type==="COMPONENT"||e.type==="COMPONENT_SET"||e.type==="FRAME"||e.type==="INSTANCE";if(!r&&!("cornerRadius"in e))return n;let o=t==="all"||t==="dimension"||t==="spacing",i=t==="all"||t==="borderRadius",a=t==="all"||t==="borderWidth";if(r){let s=e;if(o&&n.push({type:"width",value:s.width,unit:"px",tokenReference:this.getSpacingTokenFast(e,"width")},{type:"height",value:s.height,unit:"px",tokenReference:this.getSpacingTokenFast(e,"height")}),o&&"paddingTop"in s&&typeof s.paddingTop=="number"){let l=this.getSpacingTokenFast(e,"horizontalPadding"),f=this.getSpacingTokenFast(e,"verticalPadding"),d=this.getSpacingTokenFast(e,"padding");s.paddingTop&&n.push({type:"padding",value:s.paddingTop,unit:"px",tokenReference:f||d}),s.paddingRight&&n.push({type:"padding",value:s.paddingRight,unit:"px",tokenReference:l||d}),s.paddingBottom&&n.push({type:"padding",value:s.paddingBottom,unit:"px",tokenReference:f||d}),s.paddingLeft&&n.push({type:"padding",value:s.paddingLeft,unit:"px",tokenReference:l||d})}if(o&&"itemSpacing"in s&&s.itemSpacing&&n.push({type:"gap",value:s.itemSpacing,unit:"px",tokenReference:this.getSpacingTokenFast(e,"itemSpacing")}),i&&"cornerRadius"in s){let l=this.getBorderRadiusTokenFast(e);typeof s.cornerRadius=="number"&&s.cornerRadius>0&&n.push({type:"borderRadius",value:s.cornerRadius,unit:"px",tokenReference:l})}a&&"strokeWeight"in s&&typeof s.strokeWeight=="number"&&s.strokeWeight>0&&n.push({type:"borderWidth",value:s.strokeWeight,unit:"px",tokenReference:this.getBorderWidthTokenFast(e)})}else if(i&&"cornerRadius"in e){let s=e,l=this.getBorderRadiusTokenFast(e);typeof s.cornerRadius=="number"&&s.cornerRadius>0&&n.push({type:"borderRadius",value:s.cornerRadius,unit:"px",tokenReference:l})}return n}extractEffectsOptimized(e){var n,r,o,i;let t=[];if(!("effects"in e)||!Array.isArray(e.effects))return t;for(let a=0;a<e.effects.length;a++){let s=e.effects[a];if(!s.visible)continue;let l=this.getEffectTokenFast(e,a);s.type==="DROP_SHADOW"||s.type==="INNER_SHADOW"?t.push({type:s.type==="DROP_SHADOW"?"drop-shadow":"inner-shadow",visible:s.visible,radius:s.radius,color:s.color?{r:s.color.r,g:s.color.g,b:s.color.b,a:s.color.a}:void 0,offset:{x:(r=(n=s.offset)==null?void 0:n.x)!=null?r:0,y:(i=(o=s.offset)==null?void 0:o.y)!=null?i:0},spread:s.spread,tokenReference:l}):(s.type==="LAYER_BLUR"||s.type==="BACKGROUND_BLUR")&&t.push({type:s.type==="LAYER_BLUR"?"layer-blur":"background-blur",visible:s.visible,radius:s.radius,tokenReference:l})}return t}getNodeTokenRefs(e){let t=this.nodeTokenRefsCache.get(e);if(t)return t;t=new Map;try{let n=e.getSharedPluginDataKeys("tokens");for(let r of n){let o=e.getSharedPluginData("tokens",r);o&&o.trim()&&t.set(r,this.cleanTokenReference(o))}}catch(n){}return this.nodeTokenRefsCache.set(e,t),t}getFillTokenReferencesFast(e,t){let n=this.getNodeTokenRefs(e);return n.get("fill")||n.get(`fills.${t}`)||n.get(`fills[${t}]`)||n.get("fillColor")||this.getVariableBindingFast(e,"fills")}getStrokeTokenReferencesFast(e,t){let n=this.getNodeTokenRefs(e);return n.get("stroke")||n.get(`strokes.${t}`)||n.get(`strokes[${t}]`)||n.get("strokeColor")||this.getVariableBindingFast(e,"strokes")}getTypographyTokenFast(e){let t=this.getNodeTokenRefs(e);return t.get("typography")||t.get("fontFamily")||t.get("fontSize")||t.get("fontWeight")}getSpacingTokenFast(e,t){return this.getNodeTokenRefs(e).get(t)||this.getVariableBindingFast(e,t)}getBorderRadiusTokenFast(e){let t=this.getNodeTokenRefs(e);return t.get("borderRadius")||t.get("cornerRadius")||t.get("radius")||this.getVariableBindingFast(e,"cornerRadius")}getBorderWidthTokenFast(e){let t=this.getNodeTokenRefs(e);return t.get("borderWidth")||t.get("strokeWeight")||this.getVariableBindingFast(e,"strokeWeight")}getEffectTokenFast(e,t){let n=this.getNodeTokenRefs(e);return n.get("boxShadow")||n.get(`effects.${t}`)||n.get(`effects[${t}]`)||n.get("shadow")||this.getVariableBindingFast(e,"effects")}getVariableBindingFast(e,t){try{if(!("boundVariables"in e)||!e.boundVariables)return;let r=e.boundVariables[t];if(r){let o=Array.isArray(r)?r[0]:r;if(o!=null&&o.id){let i=figma.variables.getVariableById(o.id);return i==null?void 0:i.name}}}catch(n){}}cleanTokenReference(e){let t=e.trim();for(;t.startsWith('"')&&t.endsWith('"')||t.startsWith("'")&&t.endsWith("'");)t=t.slice(1,-1);return t=t.replace(/^[{]|[}]$/g,""),t=t.replace(/^\$/,""),t.trim()}buildTokenIndex(e){this.tokenIndex={byPath:new Map,byValue:new Map};let t=n=>{for(let r of n.colors)r.tokenReference&&this.addToIndex(this.tokenIndex.byPath,r.tokenReference.toLowerCase(),n.id),r.hex&&this.addToIndex(this.tokenIndex.byValue,r.hex.toLowerCase(),n.id);for(let r of n.spacing){if(r.tokenReference){let o=r.tokenReference.replace(/^\[\w+\]\s*/,"").toLowerCase();this.addToIndex(this.tokenIndex.byPath,o,n.id)}this.addToIndex(this.tokenIndex.byValue,`${r.value}${r.unit}`,n.id)}for(let r of n.effects)r.tokenReference&&this.addToIndex(this.tokenIndex.byPath,r.tokenReference.toLowerCase(),n.id);for(let r of n.typography)r.tokenReference&&this.addToIndex(this.tokenIndex.byPath,r.tokenReference.toLowerCase(),n.id);if(n.children)for(let r of n.children)t(r)};for(let n of e)t(n)}addToIndex(e,t,n){e.has(t)||e.set(t,new Set),e.get(t).add(n)}getComponentsByTokenPath(e){let t=e.toLowerCase(),n=this.tokenIndex.byPath.get(t);if(n)return Array.from(n);let r=new Set,o=Array.from(this.tokenIndex.byPath.entries());for(let[i,a]of o)(i.includes(t)||t.includes(i))&&a.forEach(s=>r.add(s));return Array.from(r)}getComponentsByTokenValue(e){let t=e.toLowerCase();return Array.from(this.tokenIndex.byValue.get(t)||[])}yieldToMain(){return new Promise(e=>setTimeout(e,0))}getFromCache(e){let t=this.cache.get(e);return t&&Date.now()-t.timestamp<this.cacheMaxAge?t.components:null}rgbaToColor(e,t){let n=Math.round(e.r*255),r=Math.round(e.g*255),o=Math.round(e.b*255),i=`#${[n,r,o].map(s=>s.toString(16).padStart(2,"0")).join("")}`,a=`rgba(${n}, ${r}, ${o}, ${t.toFixed(2)})`;return{hex:i,rgba:a}}parseFontWeight(e){let t={thin:100,extralight:200,light:300,regular:400,medium:500,semibold:600,bold:700,extrabold:800,black:900},n=e.toLowerCase();for(let[o,i]of Object.entries(t))if(n.includes(o))return i;let r=e.match(/(\d+)/);return r?parseInt(r[1],10):400}async scanAllComponents(){this.errors=[];let e=[],t=0,n=figma.root.children;for(let r of n)if(r.type==="PAGE"){let o=r.findAll(i=>i.type==="COMPONENT"||i.type==="COMPONENT_SET");for(let i of o)try{let a=await this.extractComponentPropertiesOptimized(i,r.name,"all",!0,3,0);a&&e.push(a)}catch(a){this.errors.push({componentId:i.id,componentName:i.name,error:a instanceof Error?a.message:"Unknown error"})}}return{components:e,totalComponents:e.length,totalInstances:t,pagesScanned:n.length,errors:this.errors}}async scanFilteredPages(e){this.errors=[];let t=[],n=0,r=figma.root.children,o=e.map(a=>a.toLowerCase().trim()),i=r.filter(a=>a.type==="PAGE"&&o.includes(a.name.toLowerCase().trim()));for(let a of i)if(a.type==="PAGE"){let s=a.findAll(l=>l.type==="COMPONENT"||l.type==="COMPONENT_SET");for(let l of s)try{let f=await this.extractComponentPropertiesOptimized(l,a.name,"all",!0,3,0);f&&t.push(f)}catch(f){this.errors.push({componentId:l.id,componentName:l.name,error:f instanceof Error?f.message:"Unknown error"})}}return{components:t,totalComponents:t.length,totalInstances:n,pagesScanned:i.length,errors:this.errors}}async scanCurrentPage(){this.errors=[];let e=[],t=figma.currentPage,n=t.findAll(r=>r.type==="COMPONENT"||r.type==="COMPONENT_SET");for(let r of n)try{let o=await this.extractComponentPropertiesOptimized(r,t.name,"all",!0,3,0);o&&e.push(o)}catch(o){this.errors.push({componentId:r.id,componentName:r.name,error:o instanceof Error?o.message:"Unknown error"})}return{components:e,totalComponents:e.length,totalInstances:0,pagesScanned:1,errors:this.errors}}async scanNodes(e){this.errors=[];let t=[],n=figma.currentPage;for(let r of e){if("findAll"in r&&typeof r.findAll=="function"){let o=r.findAll(i=>i.type==="COMPONENT"||i.type==="COMPONENT_SET");for(let i of o)try{let a=await this.extractComponentPropertiesOptimized(i,n.name,"all",!0,3,0);a&&t.push(a)}catch(a){this.errors.push({componentId:i.id,componentName:i.name,error:a instanceof Error?a.message:"Unknown error"})}}if(r.type==="COMPONENT"||r.type==="COMPONENT_SET")try{let o=await this.extractComponentPropertiesOptimized(r,n.name,"all",!0,3,0);o&&!t.find(i=>i.id===o.id)&&t.push(o)}catch(o){this.errors.push({componentId:r.id,componentName:r.name,error:o instanceof Error?o.message:"Unknown error"})}}return{components:t,totalComponents:t.length,totalInstances:0,pagesScanned:1,errors:this.errors}}getComponentUsageStats(e){let t=new Set,n=0;for(let r of figma.root.children)if(r.type==="PAGE"){let o=r.findAll(i=>{var a;return i.type==="INSTANCE"&&((a=i.mainComponent)==null?void 0:a.id)===e});o.length>0&&(n+=o.length,t.add(r.name))}return{instances:n,pages:Array.from(t)}}}});var de,we=X(()=>{"use strict";de=class{constructor(){F(this,"MIN_CONFIDENCE_THRESHOLD",.85)}matchTokenToComponents(e,t){let n=[];for(let r of t.components){let i=this.matchComponentRecursively(e,r).filter(a=>a.confidence>=this.MIN_CONFIDENCE_THRESHOLD);if(i.length>0){let a=i.reduce((s,l)=>s+l.confidence,0)/i.length;n.push({component:r,matches:i,confidence:a})}}return n.sort((r,o)=>o.confidence-r.confidence),{token:e,matchingComponents:n,totalMatches:n.length,totalComponentsScanned:t.totalComponents}}matchComponentRecursively(e,t){let n=[];switch(e.type){case"color":n.push(...this.matchColor(e,t));break;case"fontFamily":case"fontWeight":case"typography":n.push(...this.matchTypography(e,t));break;case"dimension":n.push(...this.matchSpacing(e,t));break;case"shadow":n.push(...this.matchEffects(e,t));break;case"borderRadius":n.push(...this.matchSpacing(e,t,"borderRadius"));break;case"borderWidth":n.push(...this.matchSpacing(e,t,"borderWidth"));break;default:n.push(...this.matchByValue(e,t)),this.looksLikeSpacingToken(e)&&n.push(...this.matchSpacing(e,t)),this.looksLikeBorderRadiusToken(e)&&n.push(...this.matchSpacing(e,t,"borderRadius")),this.looksLikeBorderToken(e)&&n.push(...this.matchSpacing(e,t,"borderWidth")),this.looksLikeEffectToken(e)&&n.push(...this.matchEffects(e,t))}if(n.length>0&&t.mainComponentId&&n.forEach(r=>{r.nestedMainComponentId||(r.nestedMainComponentId=t.mainComponentId)}),t.children&&t.children.length>0)for(let r of t.children){let o=this.matchComponentRecursively(e,r);for(let i of o)n.push(Q(Z({},i),{property:`${r.name} \u2192 ${i.property}`}))}return n}matchColor(e,t){let n=[],r=e.path.join("."),o=this.normalizeColor(e.value);for(let a of t.colors)if(a.tokenReference){let s=a.tokenReference.trim();s=s.replace(/^["']|["']$/g,""),s=s.replace(/^[{]|[}]$/g,""),s=s.replace(/^\$/,"");let l=s.toLowerCase(),f=r.toLowerCase();l===f?n.push({property:`${a.type} color (token ref)`,propertyType:"color",matchedValue:`${a.hex} \u2190 ${a.tokenReference}`,tokenValue:r,confidence:1}):(l.endsWith("."+f)||l===f||f.endsWith("."+l)||f===l)&&n.push({property:`${a.type} color (token ref)`,propertyType:"color",matchedValue:`${a.hex} \u2190 ${a.tokenReference}`,tokenValue:r,confidence:.9})}let i=n.filter(a=>a.confidence>=.9);return i.length>0?i:n}matchTypography(e,t){let n=[],r=e.path.join(".");for(let o of t.typography){let i=0,a="",s="value";if(o.tokenReference){let f=o.tokenReference.replace(/[{}]/g,"").replace(/^\$/,"").toLowerCase().replace(/\./g,"."),d=r.toLowerCase();f===d?(i=1,a=`${o.fontFamily} (ref: ${o.tokenReference})`,s="reference"):(f.includes(d)||d.includes(f))&&(i=.8,a=`${o.fontFamily} (ref: ${o.tokenReference})`,s="reference")}if(i===0){if(e.type==="fontFamily"){let l=String(e.value).toLowerCase().trim(),f=o.fontFamily.toLowerCase().trim();l===f&&(i=.9,a=o.fontFamily)}else if(e.type==="fontWeight"){let l=this.normalizeFontWeight(e.value),f=o.fontWeight;l===f&&(i=.9,a=String(f))}else if(e.type==="typography"&&typeof e.value=="object"&&e.value!==null){let l=e.value,f=!1,d=0,g=[];if(l.fontFamily){let N=String(l.fontFamily).toLowerCase().trim(),I=o.fontFamily.toLowerCase().trim();N===I&&(f=!0,d+=.4,g.push(`fontFamily: ${o.fontFamily}`))}if(l.fontSize){let N=Number(l.fontSize),I=o.fontSize;Math.abs(N-I)<.5&&(f=!0,d+=.3,g.push(`fontSize: ${I}`))}l.fontWeight&&this.normalizeFontWeight(l.fontWeight)===o.fontWeight&&(f=!0,d+=.3,g.push(`fontWeight: ${o.fontWeight}`)),f&&(i=Math.min(d,1),a=g.join(", "))}}i>0&&n.push({property:`typography${s==="reference"?" (token ref)":""}`,propertyType:"typography",matchedValue:a,tokenValue:String(e.value),confidence:i})}return n}matchSpacing(e,t,n){let r=[],o=e.path.join("."),i=this.normalizeDimension(e.value),a=n?t.spacing.filter(l=>l.type===n):t.spacing;for(let l of a)if(l.tokenReference){let f=l.tokenReference.trim();f=f.replace(/^["']|["']$/g,""),f=f.replace(/^[{]|[}]$/g,""),f=f.replace(/^\$/,""),f=f.replace(/^\[\w+\]\s*/,"");let d=f.toLowerCase(),g=o.toLowerCase(),N=this.formatSpacingType(l.type);d===g?r.push({property:`${N} (token ref)`,propertyType:"spacing",matchedValue:`${l.value}${l.unit} \u2190 ${l.tokenReference}`,tokenValue:o,confidence:1}):(d.endsWith("."+g)||d===g||g.endsWith("."+d)||g===d)&&r.push({property:`${N} (token ref)`,propertyType:"spacing",matchedValue:`${l.value}${l.unit} \u2190 ${l.tokenReference}`,tokenValue:o,confidence:.9})}let s=r.filter(l=>l.confidence>=.9);return s.length>0?s:r}formatSpacingType(e){switch(e){case"borderRadius":return"border-radius";case"borderWidth":return"border-width";case"gap":return"gap/spacing";default:return e}}matchEffects(e,t){let n=[],r=e.path.join(".");for(let i of t.effects)if(i.tokenReference){let a=i.tokenReference.trim();a=a.replace(/^["']|["']$/g,""),a=a.replace(/^[{]|[}]$/g,""),a=a.replace(/^\$/,"");let s=a.toLowerCase(),l=r.toLowerCase();s===l?n.push({property:`${i.type} (token ref)`,propertyType:"effect",matchedValue:`${i.type} \u2190 ${i.tokenReference}`,tokenValue:r,confidence:1}):(s.endsWith("."+l)||s===l||l.endsWith("."+s)||l===s)&&n.push({property:`${i.type} (token ref)`,propertyType:"effect",matchedValue:`${i.type} \u2190 ${i.tokenReference}`,tokenValue:r,confidence:.9})}let o=n.filter(i=>i.confidence>=.9);return o.length>0?o:n}matchByValue(e,t){let n=[];return this.looksLikeColor(e.value)&&n.push(...this.matchColor(e,t)),this.looksLikeDimension(e.value)&&n.push(...this.matchSpacing(e,t)),n}normalizeColor(e){if(typeof e!="string")return null;let t=e.trim().toLowerCase();return t.match(/^#[0-9a-f]{3,8}$/)||t.match(/^rgba?\(/)||t.match(/^hsla?\(/)?t:null}normalizeHex(e){if(!e)return null;let t=e.trim().toLowerCase().replace("#","");return t.length===3&&(t=t.split("").map(n=>n+n).join("")),t.length===6?t:null}normalizeRgba(e){if(!e)return null;let t=e.match(/rgba?\(([^)]+)\)/i);return t?t[1].trim():null}parseRgba(e){let t=this.normalizeRgba(e);if(!t)return null;let n=t.split(",").map(r=>parseFloat(r.trim()));return n.length>=3?{r:n[0],g:n[1],b:n[2],a:n.length>3?n[3]:1}:null}rgbaToString(e){return`rgba(${Math.round(e.r)}, ${Math.round(e.g)}, ${Math.round(e.b)}, ${e.a.toFixed(2)})`}colorsMatch(e,t){let n=this.parseRgba(e),r=this.parseRgba(t);if(n&&r)return Math.abs(n.r-r.r)<2&&Math.abs(n.g-r.g)<2&&Math.abs(n.b-r.b)<2&&Math.abs(n.a-r.a)<.01;let o=this.normalizeHex(e),i=this.normalizeHex(t);return o!==null&&i!==null&&o===i}normalizeFontWeight(e){if(typeof e=="number")return e;if(typeof e!="string")return 400;let t={thin:100,extralight:200,light:300,regular:400,normal:400,medium:500,semibold:600,bold:700,extrabold:800,black:900},n=e.toLowerCase().trim();if(t[n])return t[n];let r=parseInt(e,10);return isNaN(r)?400:r}normalizeDimension(e){if(typeof e=="number")return e;if(typeof e!="string")return null;let t=e.replace(/px|rem|em|pt|pc|in|cm|mm|q|vh|vw|vmin|vmax|%/g,"").trim(),n=parseFloat(t);return isNaN(n)?null:n}looksLikeColor(e){if(typeof e!="string")return!1;let t=e.trim().toLowerCase();return t.match(/^#[0-9a-f]{3,8}$/)!==null||t.match(/^rgba?\(/)!==null||t.match(/^hsla?\(/)!==null}looksLikeDimension(e){return typeof e=="number"?!0:typeof e!="string"?!1:/^-?\d+(\.\d+)?(px|rem|em|pt|pc|in|cm|mm|q|vh|vw|vmin|vmax|%)$/.test(e.trim())}looksLikeSpacingToken(e){let t=e.path.join(".").toLowerCase();return["spacing","space","size","sizing","dimension","width","height","padding","margin","gap","radius","border","inset","offset","corner","round","stroke","weight","1x","2x","3x","4x","5x","6x","8x","10x","12x","16x"].some(r=>t.includes(r))}looksLikeBorderRadiusToken(e){let t=e.path.join(".").toLowerCase();return["radius","corner","round","rounded","borderradius"].some(r=>t.includes(r))}looksLikeBorderToken(e){let t=e.path.join(".").toLowerCase(),n=["border","stroke","outline","line"];return t.includes("radius")?!1:n.some(r=>t.includes(r))}looksLikeEffectToken(e){let t=e.path.join(".").toLowerCase();return["shadow","effect","blur","elevation","drop"].some(r=>t.includes(r))}}});function _(y,e){let t=`${Ee}`;return Ee+=1,re[t]={handler:e,name:y},function(){delete re[t]}}function Ae(y,e){let t=!1;for(let n in re)re[n].name===y&&(re[n].handler.apply(null,e),t=!0);if(t===!1)throw new Error(`No event handler with name \`${y}\``)}var re,Ee,k,xe=X(()=>{re={},Ee=0;k=typeof window=="undefined"?function(y,...e){figma.ui.postMessage([y,...e])}:function(y,...e){window.parent.postMessage({pluginMessage:[y,...e]},"*")};typeof window=="undefined"?figma.ui.onmessage=function(y){if(!Array.isArray(y))return;let[e,...t]=y;typeof e=="string"&&Ae(e,t)}:window.onmessage=function(y){if(typeof y.data.pluginMessage=="undefined")return;let e=y.data.pluginMessage;if(!Array.isArray(e))return;let[t,...n]=y.data.pluginMessage;typeof t=="string"&&Ae(t,n)}});function ye(y,e){if(typeof __html__=="undefined")throw new Error("No UI defined");let t=`<div id="create-figma-plugin"></div><script>document.body.classList.add('theme-${figma.editorType}');const __FIGMA_COMMAND__='${typeof figma.command=="undefined"?"":figma.command}';const __SHOW_UI_DATA__=${JSON.stringify(typeof e=="undefined"?{}:e)};${__html__}</script>`;figma.showUI(t,Q(Z({},y),{themeColors:typeof y.themeColors=="undefined"?!0:y.themeColors}))}var $e=X(()=>{});var Oe=X(()=>{xe();$e()});var Ie={};Ke(Ie,{default:()=>qe});function qe(){ye({width:400,height:550},{resizable:!0}),figma.loadAllPagesAsync().catch(p=>{console.error("Error loading pages on startup:",p)});let y=new ae,e=new le,t=new pe,n=new de,r=!0,o=null;function i(){let p=figma.root.children.filter(m=>m.type==="PAGE").map(m=>m.id).join(",");if(o===null)return o=p,!1;let c=p!==o;return o=p,c}async function a(){i()&&(console.log("[Cache] Document changed, clearing component cache"),await t.clearCache())}let s=10*60*1e3;function l(p,c,m,h){return`tokenCache_${p}_${c}_${m}_${h||"root"}`}async function f(p){try{let c=await figma.clientStorage.getAsync(p);if(c&&c.sha&&c.tokens&&Date.now()-c.timestamp<s)return c}catch(c){console.error("Error reading token cache:",c)}return null}async function d(p,c,m,h){try{let C={sha:c,tokens:m,metadata:h,timestamp:Date.now()};await figma.clientStorage.setAsync(p,C)}catch(C){console.error("Error saving token cache:",C)}}async function g(p){try{await figma.clientStorage.deleteAsync(p)}catch(c){console.error("Error clearing token cache:",c)}}async function N(){try{return await figma.clientStorage.getAsync("repoConfig")||null}catch(p){return console.error("Error loading config:",p),null}}async function I(p){try{await figma.clientStorage.setAsync("repoConfig",p)}catch(c){console.error("Error saving config:",c)}}async function A(){try{await figma.clientStorage.deleteAsync("repoConfig")}catch(p){console.error("Error clearing config:",p)}}_("load-config",async()=>{let p=await N();k("config-loaded",p)}),_("clear-config",async()=>{await A(),k("config-loaded",null)}),_("test-connection",async p=>{let c=y.parseGitHubUrl(p.repoUrl);if(!c){k("connection-result",{success:!1,error:"Invalid GitHub URL format"});return}try{k("connection-progress",{message:"Connecting to GitHub..."});let m=await y.fetchBranches(c.owner,c.repo,p.token),h=0,C=[];if(m.length>0)try{let S=m[0];k("connection-progress",{message:"Scanning for token files..."});let u=await y.detectTokenFiles(c.owner,c.repo,S,p.token,p.filePath||"");h=u.length,C=u.slice(0,5)}catch(S){console.error("Token detection failed:",S)}k("connection-result",{success:!0,branches:m.slice(0,10),owner:c.owner,repo:c.repo,fileCount:h,tokenCount:h,sampleFiles:C.map(S=>S.length>50?S.substring(0,47)+"...":S)})}catch(m){k("connection-result",{success:!1,error:m instanceof Error?m.message:"Connection failed"})}}),_("save-config",async p=>{await I(p),k("config-saved",{success:!0})});let b=/^#[0-9A-Fa-f]{3,8}$/,x=/^rgba?\(/,R=/^hsla?\(/,H=/^\d+(\.\d+)?(ms|s)$/,oe=/^-?\d+(\.\d+)?(px|rem|em|pt|pc|in|cm|mm|q|vh|vw|vmin|vmax|%)$/,ee=/\d+x$/,te=(p,c)=>{if(typeof p=="string")return b.test(p)||x.test(p)||R.test(p)||c.includes("color")||c.includes("colour")?"color":H.test(p)||c.includes("duration")?"duration":c.includes("radius")||c.includes("corner")||c.includes("rounded")||c.includes("borderradius")?"borderRadius":c.includes("border")&&(c.includes("width")||c.includes("weight"))||c.includes("stroke")&&c.includes("weight")?"borderWidth":oe.test(p)||c.includes("size")||c.includes("spacing")||c.includes("space")||c.includes("gap")||c.includes("padding")||c.includes("margin")||c.includes("sizing")||c.includes("dimension")||ee.test(c)?"dimension":c.includes("font")||c.includes("typography")||c.includes("text")?c.includes("weight")?"fontWeight":c.includes("family")?"fontFamily":"typography":c.includes("shadow")||c.includes("elevation")?"shadow":c.includes("border")&&!c.includes("radius")?"border":"string";if(typeof p=="number")return c.includes("radius")||c.includes("corner")||c.includes("rounded")?"borderRadius":c.includes("border")&&c.includes("width")||c.includes("stroke")&&c.includes("weight")?"borderWidth":c.includes("weight")&&c.includes("font")?"fontWeight":c.includes("opacity")||c.includes("alpha")||c.includes("z-index")||c.includes("zindex")?"number":c.includes("spacing")||c.includes("space")||c.includes("gap")||c.includes("padding")||c.includes("margin")||c.includes("size")||ee.test(c)?"dimension":"number";if(typeof p=="object"&&p!==null){if(c.includes("shadow")||p.blur!==void 0||p.spread!==void 0)return"shadow";if(c.includes("typography")||p.fontFamily!==void 0)return"typography";if(c.includes("border")||p.width!==void 0&&p.style!==void 0)return"border"}return"string"},Fe=p=>p&&typeof p=="object"&&"$value"in p,Le=p=>{if(!p||typeof p!="object"||"$value"in p||!("value"in p))return!1;let c=p.value;return typeof c=="string"||typeof c=="number"||typeof c=="boolean"?!0:typeof c=="object"&&c!==null?"type"in p||"description"in p:!1},De=(p,c)=>!(typeof p!="string"&&typeof p!="number"&&typeof p!="boolean"||c.length<1),We=(p,c)=>{let m=[],h=[],C=(u,w)=>{let z=h[h.length-1]||"unnamed",$=h.join(".").toLowerCase(),M=w||te(u,$);m.push({name:z,path:h.slice(),type:M,sourceFile:c,value:u})},S=u=>{if(u==null)return;let w=h[h.length-1]||"";if(!(w.startsWith("$")&&w!=="$value"&&w!=="$type")){if(Fe(u)){C(u.$value,u.$type);return}if(Le(u)){C(u.value,u.type);return}if(De(u,h)){C(u,void 0);return}if(typeof u=="object"){let z=Array.isArray(u)?u.map(($,M)=>String(M)):Object.keys(u);for(let $ of z){if(!Array.isArray(u)&&($.startsWith("$")||$==="extensions"))continue;let M=Array.isArray(u)?u[parseInt($)]:u[$];h.push($),S(M),h.pop()}}}};return S(p),m},fe=5,ke=500,ne=100;_("fetch-tokens",async p=>{let c=y.parseGitHubUrl(p.repoUrl);if(!c){k("tokens-result",{success:!1,error:"Invalid GitHub URL format"});return}try{let m=p.filePath||"",h=l(c.owner,c.repo,p.branch,m);if(!p.forceRefresh){k("tokens-progress",{message:"Checking for cached tokens..."});let[O,B]=await Promise.all([y.getLatestCommitSha(c.owner,c.repo,p.branch,p.token),f(h)]);if(B&&O&&B.sha===O){k("tokens-progress",{message:"Using cached tokens (no changes detected)"});let P=B.tokens;for(let T=0;T<P.length;T+=ne){let v=P.slice(T,T+ne),D=T+ne>=P.length;k("tokens-chunk",{tokens:v,chunkIndex:Math.floor(T/ne),totalChunks:Math.ceil(P.length/ne),isLast:D})}k("tokens-result",{success:!0,tokens:P,metadata:Q(Z({},B.metadata),{fromCache:!0,cacheAge:Date.now()-B.timestamp,errors:[]})});return}}k("tokens-progress",{message:"Scanning for token files..."});let C=await y.detectTokenFiles(c.owner,c.repo,p.branch,p.token,m);if(C.length===0){k("tokens-result",{success:!1,error:`No token files found${m?` in '${m}'`:" in repository"}. Looking for .json files (excluding config files).`});return}let S=[],u=[],w=0,z=0,$=[],M=[];k("tokens-progress",{message:`Fetching ${C.length} files...`});for(let O=0;O<C.length;O+=fe){let B=C.slice(O,O+fe),P=Math.min(O+fe,C.length);k("tokens-progress",{message:`Fetching files ${O+1}-${P} of ${C.length}...`});let T=await Promise.all(B.map(async v=>{try{let D=await y.fetchFileContents(c.owner,c.repo,p.branch,p.token,v);if(!D.content)return{path:v,error:"Empty file content"};let L=y.decodeBase64Content(D.content);return{path:v,content:L}}catch(D){return{path:v,error:D instanceof Error?D.message:"Fetch failed"}}}));for(let v of T)"content"in v&&v.content?M.push({path:v.path,content:v.content}):"error"in v&&(u.push({file:v.path,message:v.error}),$.push({file:v.path,count:0}))}k("tokens-progress",{message:`Processing ${M.length} files...`});let W=[],j=0;for(let{path:O,content:B}of M)try{let P;try{P=JSON.parse(B)}catch(D){throw new Error(`JSON parse failed: ${D.message}`)}let T=We(P,O),v=T.length;z+=v,$.push({file:O,count:v}),v===0&&u.push({file:O,message:"No token values found in this file (checked $value, value, and primitives)"});for(let D of T)if(S.length<ke){let L={name:D.name||"",path:D.path||"",type:D.type||"unknown",sourceFile:D.sourceFile||""};S.push(L),W.push(L),W.length>=ne&&(k("tokens-chunk",{tokens:W,chunkIndex:j++,isLast:!1}),W=[])}w++}catch(P){console.error(`Failed to parse ${O}:`,P),$.push({file:O,count:0}),u.push({file:O,message:P instanceof Error?P.message:"Failed to parse file"})}W.length>0&&k("tokens-chunk",{tokens:W,chunkIndex:j++,isLast:!0}),k("tokens-progress",{message:`Found ${z} tokens in ${w} files`});let q=await y.getLatestCommitSha(c.owner,c.repo,p.branch,p.token);q&&await d(h,q,S,{totalTokens:z,filesProcessed:w,totalFiles:C.length,perFileCounts:$}),k("tokens-result",{success:!0,tokens:S,metadata:{totalTokens:z,truncated:z>ke,filesProcessed:w,totalFiles:C.length,perFileCounts:$,errors:u,fromCache:!1}})}catch(m){k("tokens-result",{success:!1,error:m instanceof Error?m.message:"Failed to fetch tokens"})}}),_("detect-token-files",async p=>{let c=y.parseGitHubUrl(p.repoUrl);if(!c){k("token-files-result",{success:!1,error:"Invalid GitHub URL format"});return}try{let m=await y.detectTokenFiles(c.owner,c.repo,p.branch,p.token,p.directoryPath||"");k("token-files-result",{success:!0,files:m})}catch(m){k("token-files-result",{success:!1,error:m instanceof Error?m.message:"Failed to detect token files"})}}),_("scan-components",async p=>{try{let c=p.scanAll===!0;c?(k("scan-progress",{message:"Loading all pages..."}),await figma.loadAllPagesAsync(),k("scan-progress",{message:"Scanning all pages..."})):k("scan-progress",{message:"Scanning current page..."});let m=c?await e.scanAllComponents():await e.scanCurrentPage();k("scan-result",{success:!0,result:m})}catch(c){k("scan-result",{success:!1,error:c instanceof Error?c.message:"Failed to scan components"})}}),_("scan-components-for-token",async p=>{try{let{token:c,scanAll:m,scanSelection:h,pageFilter:C}=p,S=m===!0,u=h===!0,w=C&&C.length>0;if(!c){k("scan-result",{success:!1,error:"No token provided"});return}await a();let z=c.type||"all",$="Scanning for token matches...";S?($=w?`Loading ${C.length} page(s)...`:"Loading all pages...",k("scan-progress",{message:$}),await figma.loadAllPagesAsync(),$=w?`Scanning ${C.join(", ")} for token matches...`:"Scanning all pages for token matches..."):u?$="Scanning selection for token matches...":$="Scanning current page for token matches...",k("scan-progress",{message:$});let M;if(r&&S){k("scan-progress",{message:"Scanning components (optimized)..."});let P={tokenType:z,useCache:!0,usePersistentCache:!0,chunkSize:100,maxDepth:3,includeChildren:!0,pageFilter:w?C:void 0,onProgress:T=>{let v=Math.round(T.currentPage/T.totalPages*100);k("scan-progress",{message:`Page ${T.currentPage}/${T.totalPages}: ${T.currentPageName} (${T.componentsFound} found)`,progress:v})}};M=await t.scanAllComponentsOptimized(P)}else if(k("scan-progress",{message:"Scanning components..."}),S)w?M=await e.scanFilteredPages(C):M=await e.scanAllComponents();else if(u){let P=figma.currentPage.selection;if(P.length===0){k("scan-result",{success:!1,error:"No selection found. Please select a frame or node to scan."});return}M=await e.scanNodes(P)}else M=await e.scanCurrentPage();k("scan-progress",{message:`Found ${M.totalComponents} components. Matching tokens...`});let W=n.matchTokenToComponents(c,M);k("scan-progress",{message:"Filtering nested duplicates..."});let j=P=>{if(!P.includes(" \u2192 "))return!0;let T=P.split(" \u2192 ");return T.length===2&&T[0].includes("=")?!0:(T.length>2,!1)},q=new Set;for(let P of W.matchingComponents)P.matches.some(v=>j(v.property))&&P.component.mainComponentId&&q.add(P.component.mainComponentId);let O=W.matchingComponents.filter(P=>P.matches.some(v=>j(v.property))?!0:P.matches.some(v=>j(v.property)?!1:!v.nestedMainComponentId||!q.has(v.nestedMainComponentId)));k("scan-progress",{message:"Matching complete!"});let B={token:{name:c.name,path:c.path,type:c.type,value:c.value},matchingComponents:O.map(P=>({id:P.component.id,name:P.component.name,page:P.component.pageName,type:P.component.type,mainComponentName:P.component.mainComponentName,mainComponentId:P.component.mainComponentId,variantName:P.component.variantName,matches:P.matches.map(T=>`${T.property}: ${T.matchedValue}`),matchDetails:P.matches,confidence:P.confidence})),totalMatches:O.length,totalComponentsScanned:W.totalComponentsScanned};k("scan-result",{success:!0,result:B})}catch(c){k("scan-result",{success:!1,error:c instanceof Error?c.message:"Failed to scan components for token"})}}),_("get-component-usage",async p=>{try{let{componentId:c}=p,m=e.getComponentUsageStats(c);k("component-usage-result",{success:!0,stats:m})}catch(c){k("component-usage-result",{success:!1,error:c instanceof Error?c.message:"Failed to get usage stats"})}}),_("navigate-to-component",async p=>{try{let{componentId:c}=p,m=await figma.getNodeByIdAsync(c);if(m&&"type"in m){let h=Be(m);h&&h.type==="PAGE"&&h!==figma.currentPage&&await figma.setCurrentPageAsync(h),m.type!=="DOCUMENT"&&m.type!=="PAGE"?(figma.currentPage.selection=[m],figma.viewport.scrollAndZoomIntoView([m]),k("navigate-result",{success:!0})):k("navigate-result",{success:!1,error:"Cannot select document or page nodes"})}else k("navigate-result",{success:!1,error:"Node not found"})}catch(c){k("navigate-result",{success:!1,error:c instanceof Error?c.message:"Failed to navigate to component"})}});function Be(p){let c=p;for(;c&&c.type!=="PAGE";)c=c.parent;return c}async function Ze(p){let c=await figma.getNodeByIdAsync(p);if(!c)return null;if(c.type==="COMPONENT_SET"){let m=c,h=m.defaultVariant||m.children[0];if((h==null?void 0:h.type)==="COMPONENT")return h}return c.type==="COMPONENT"?c:c.type==="INSTANCE"?await c.getMainComponentAsync():null}_("create-component-collection",async p=>{try{let{token:c,groupedComponents:m,matchingComponents:h}=p,C=Object.entries(m||{});if(C.length===0&&(!h||h.length===0)){k("create-collection-result",{success:!1,error:"No components to collect"});return}let S=Array.isArray(c.path)?c.path.join("."):c.name,u=figma.createFrame();u.name=`Token Matches: ${S}`,u.layoutMode="VERTICAL",u.primaryAxisSizingMode="AUTO",u.counterAxisSizingMode="AUTO",u.paddingTop=32,u.paddingBottom=32,u.paddingLeft=32,u.paddingRight=32,u.itemSpacing=24,u.fills=[{type:"SOLID",color:{r:.95,g:.95,b:.95}}],u.cornerRadius=8;let w=figma.createText();await figma.loadFontAsync({family:"Inter",style:"Bold"}),await figma.loadFontAsync({family:"Inter",style:"Regular"}),w.fontName={family:"Inter",style:"Bold"},w.characters=`Token: ${S}`,w.fontSize=18,w.fills=[{type:"SOLID",color:{r:.1,g:.1,b:.1}}],u.appendChild(w);let z=C.length,$=(h==null?void 0:h.length)||0,M=figma.createText();M.fontName={family:"Inter",style:"Regular"},M.characters=`${z} component${z!==1?"s":""}${$>z?` (${$} variants total)`:""}`,M.fontSize=12,M.fills=[{type:"SOLID",color:{r:.4,g:.4,b:.4}}],u.appendChild(M);let W=figma.createFrame();W.name="Components List",W.layoutMode="VERTICAL",W.primaryAxisSizingMode="AUTO",W.counterAxisSizingMode="AUTO",W.itemSpacing=16,W.fills=[],u.appendChild(W);let j=0;for(let[O,B]of C){let P=B.length;try{let T=figma.createFrame();T.name=O,T.layoutMode="VERTICAL",T.primaryAxisSizingMode="AUTO",T.counterAxisSizingMode="AUTO",T.paddingTop=16,T.paddingBottom=16,T.paddingLeft=16,T.paddingRight=16,T.itemSpacing=8,T.fills=[{type:"SOLID",color:{r:1,g:1,b:1}}],T.strokes=[{type:"SOLID",color:{r:.85,g:.85,b:.85}}],T.strokeWeight=1,T.cornerRadius=6;let v=figma.createText();v.fontName={family:"Inter",style:"Bold"},v.characters=O,v.fontSize=12,v.fills=[{type:"SOLID",color:{r:.1,g:.1,b:.1}}],T.appendChild(v);let D=B[0];if(D!=null&&D.matchDetails&&D.matchDetails.length>0){let U=D.matchDetails[0],G=figma.createText();G.fontName={family:"Inter",style:"Regular"};let E="";if(U.matchedValue){let Y=U.matchedValue.match(/^([^]+)/);Y&&(E=Y[1].trim())}let K=U.property.replace(/\s*\([^)]*\)\s*/g,"").trim(),V=E?`${E} \u2192 ${K}`:K;P>1&&(V+=` (${P} variants)`),G.characters=V,G.fontSize=10,G.fills=[{type:"SOLID",color:{r:.5,g:.5,b:.5}}],T.appendChild(G)}let L=figma.createFrame();L.name="Variants",L.layoutMode="HORIZONTAL",L.layoutWrap="WRAP",L.primaryAxisSizingMode="AUTO",L.counterAxisSizingMode="AUTO",L.paddingTop=60,L.paddingBottom=60,L.paddingLeft=60,L.paddingRight=60,L.itemSpacing=20,L.counterAxisSpacing=20,L.fills=[],L.clipsContent=!1,T.appendChild(L);let ge=0,J=new Set,ue=new Set;for(let U of B){if(U.matchDetails&&U.matchDetails.length>0)for(let G of U.matchDetails){let E=G.property.split(" \u2192 ");E.length>0&&E[0].includes("=")&&ue.add(E[0].trim())}U.variantName&&ue.add(U.variantName)}let Te=B[0];if(!Te)continue;try{let U=await figma.getNodeByIdAsync(Te.id);if(!U)continue;if(U.type==="COMPONENT_SET"){let G=U;for(let E of Array.from(ue)){if(J.has(E))continue;J.add(E);let K=null;for(let V of G.children)if(V.type==="COMPONENT"&&V.name===E){K=V;break}if(K){let V=K.createInstance();L.appendChild(V),ge++}}}else for(let G of B)try{let E=await figma.getNodeByIdAsync(G.id);if(!E)continue;let K=null,V=G.name;if(E.type==="INSTANCE"){let Y=E;try{let he=await Y.getMainComponentAsync();he&&(V=he.name)}catch(he){}if(J.has(V))continue;J.add(V),K=Y.clone()}else if(E.type==="COMPONENT"){let Y=E;if(V=Y.name,J.has(V))continue;J.add(V),K=Y.createInstance()}else if(E.type==="FRAME"||E.type==="GROUP"||E.type==="RECTANGLE"||E.type==="ELLIPSE"||E.type==="LINE"||E.type==="TEXT"||E.type==="VECTOR"||E.type==="POLYGON"||E.type==="STAR"){if(J.has(V))continue;J.add(V),K=E.clone()}K&&(L.appendChild(K),ge++)}catch(E){console.error(`Failed to create instance for variant ${G.id}:`,E)}}catch(U){console.error(`Failed to process component ${O}:`,U)}ge>0?(W.appendChild(T),j++):T.remove()}catch(T){console.error(`Failed to create card for ${O}:`,T)}}let q=figma.viewport;u.x=q.center.x-u.width/2,u.y=q.center.y-u.height/2,figma.currentPage.appendChild(u),figma.currentPage.selection=[u],figma.viewport.scrollAndZoomIntoView([u]),figma.notify(`Created collection with ${j} component${j!==1?"s":""}`),k("create-collection-result",{success:!0,count:j,frameId:u.id})}catch(c){console.error("Failed to create component collection:",c),k("create-collection-result",{success:!1,error:c instanceof Error?c.message:"Failed to create collection"})}}),_("cancel",()=>{figma.closePlugin()}),_("resize-window",p=>{figma.ui.resize(p.width,p.height)});function Ve(p){let c={nodeId:p.id,nodeName:p.name,nodeType:p.type,pluginData:{},sharedPluginData:{}};try{let h=p.getPluginDataKeys();for(let C of h)c.pluginData[C]=p.getPluginData(C)}catch(h){console.error("Error getting plugin data keys:",h)}let m=["tokens","tokens-studio","tokensStudio","figma-tokens","design-tokens","token-studio","com.tokens.studio","tokens.studio","io.tokens.studio","figmatokens","style-dictionary","ds","design-system","theme","variables"];for(let h of m)try{let C=p.getSharedPluginDataKeys(h);if(C.length>0){c.sharedPluginData[h]={};for(let S of C){let u=p.getSharedPluginData(h,S);c.sharedPluginData[h][S]=u}}}catch(C){}try{if("boundVariables"in p&&p.boundVariables){c.boundVariables={};let h=p.boundVariables;for(let[C,S]of Object.entries(h))if(S){if(Array.isArray(S))c.boundVariables[C]=S.map(u=>{try{let w=figma.variables.getVariableById(u.id);return{id:u.id,name:w==null?void 0:w.name,resolvedType:w==null?void 0:w.resolvedType,valuesByMode:w==null?void 0:w.valuesByMode}}catch(w){return{id:u.id,error:"Could not resolve variable"}}});else if(S.id)try{let u=figma.variables.getVariableById(S.id);c.boundVariables[C]={id:S.id,name:u==null?void 0:u.name,resolvedType:u==null?void 0:u.resolvedType,valuesByMode:u==null?void 0:u.valuesByMode}}catch(u){c.boundVariables[C]={id:S.id,error:"Could not resolve variable"}}}}}catch(h){console.error("Error getting bound variables:",h)}return c}function Ce(p,c=3,m=0){let h=[],C=Ve(p),S=Object.keys(C.pluginData).length>0||Object.keys(C.sharedPluginData).length>0||C.boundVariables&&Object.keys(C.boundVariables).length>0;if(h.push(Q(Z({},C),{pluginData:S?C.pluginData:{_noData:"true"}})),m<c&&"children"in p)for(let u of p.children)h.push(...Ce(u,c,m+1));return h}_("inspect-selection",async()=>{try{let p=figma.currentPage.selection;if(p.length===0){k("inspect-result",{success:!1,error:"No selection. Please select a node to inspect."});return}k("inspect-progress",{message:"Inspecting plugin data..."});let c=[];for(let h of p){let C=Ce(h,3);c.push(...C)}let m=c.filter(h=>!h.pluginData._noData&&(Object.keys(h.pluginData).length>0||Object.keys(h.sharedPluginData).length>0||h.boundVariables&&Object.keys(h.boundVariables).length>0));c.forEach(h=>{h.pluginData._noData&&(h.pluginData={})}),k("inspect-result",{success:!0,results:c,summary:{totalNodesInspected:c.length,nodesWithPluginData:m.length,namespacesFound:Array.from(new Set(m.flatMap(h=>Object.keys(h.sharedPluginData)))),pluginDataKeysFound:Array.from(new Set(m.flatMap(h=>Object.keys(h.pluginData)))),hasVariableBindings:m.some(h=>h.boundVariables&&Object.keys(h.boundVariables).length>0)}})}catch(p){k("inspect-result",{success:!1,error:p instanceof Error?p.message:"Failed to inspect selection"})}})}var Me=X(()=>{"use strict";Re();Se();ve();we();Oe()});var Je={"src/main.ts--default":(Me(),Xe(Ie)).default},Ye="src/main.ts--default";Je[Ye]();
